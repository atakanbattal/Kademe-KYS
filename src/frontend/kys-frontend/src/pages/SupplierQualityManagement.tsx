import React, { useState, useEffect } from 'react';
import {
  Typography, Box, Paper, Card, CardContent, CardHeader, Button, TextField,
  Select, MenuItem, FormControl, InputLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Chip, Table, TableBody, TableCell, TableContainer, TableHead,
  TableRow, Tabs, Tab, Avatar, Grid, IconButton, Tooltip, Alert, Snackbar,
  List, ListItem, ListItemText, ListItemIcon, Switch, FormControlLabel,
  Accordion, AccordionSummary, AccordionDetails, Badge, Divider, Checkbox,
  CircularProgress
} from '@mui/material';
import {
  Business as BusinessIcon, Add as AddIcon, Dashboard as DashboardIcon,
  Assessment as AssessmentIcon, Warning as WarningIcon, Edit as EditIcon,
  Delete as DeleteIcon, Link as LinkIcon, Schedule as ScheduleIcon,
  BugReport as BugReportIcon, Report as ReportIcon, CheckCircle as CheckCircleIcon,
  SwapHoriz as SwapHorizIcon, Visibility as ViewIcon, ExpandMore as ExpandMoreIcon,
  TrendingUp as TrendingUpIcon, Security as SecurityIcon, Star as StarIcon,
  Search as SearchIcon, Error as ErrorIcon
} from '@mui/icons-material';
import {
  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip as ChartTooltip,
  Legend, ResponsiveContainer, PieChart, Pie, Cell, BarChart, Bar,
  RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis
} from 'recharts';

// Enhanced interfaces for comprehensive supplier management
interface Supplier {
  id: string;
  name: string;
  code: string;
  type: 'onaylƒ±' | 'alternatif' | 'potansiyel' | 'bloklu';
  category: 'stratejik' | 'kritik' | 'rutin' | 'genel';
  // Yeni tedarik t√ºr√º alanlarƒ±
  supplyType: 'malzeme' | 'hizmet' | 'hibrit';
  supplySubcategories: string[];
  contact: {
    email: string;
    phone: string;
    address: string;
    contactPerson: string;
  };
  materialTypes: string[];
  performanceScore: number;
  qualityScore: number;
  deliveryScore: number;
  riskLevel: 'd√º≈ü√ºk' | 'orta' | 'y√ºksek' | 'kritik';
  status: 'aktif' | 'pasif' | 'denetimde' | 'bloklu';
  registrationDate: string;
  lastAuditDate: string;
  nextAuditDate: string;
  auditStatus: 'planlƒ±' | 'gecikmi≈ü' | 'tamamlandƒ±';
  nonconformityCount: number;
  defectCount: number;
  dofCount: number;
  isActive: boolean;
}

interface SupplierPair {
  id: string;
  primarySupplier: Supplier;
  alternativeSuppliers: Supplier[];
  materialType: string;
  category: string;
  performanceComparison: {
    primaryScore: number;
    alternativeScores: { id: string; score: number }[];
    recommendation: string;
  };
  lastReviewDate: string;
  nextReviewDate: string;
}

interface AuditRecord {
  id: string;
  supplierId: string;
  auditDate: string;
  auditType: 'planlƒ±' | 'ani' | 'takip' | 'acil';
  auditorName: string;
  score: number;
  findings: string[];
  status: 'planlƒ±' | 'tamamlandƒ±' | 'iptal';
  nextAuditDate: string;
  isAutoScheduled: boolean;
}

interface NonconformityRecord {
  id: string;
  supplierId: string;
  title: string;
  description: string;
  category: 'kalite' | 'teslimat' | 'dok√ºman' | 'servis';
  severity: 'kritik' | 'y√ºksek' | 'orta' | 'd√º≈ü√ºk';
  detectedDate: string;
  status: 'a√ßƒ±k' | 'ara≈ütƒ±rƒ±lƒ±yor' | 'd√ºzeltiliyor' | 'kapalƒ±';
  dueDate: string;
  correctionCost: number;
  dofId?: string;
  recurrence: boolean;
  // Yeni zorunlu alanlar
  partCode: string; // Zorunlu par√ßa kodu
  quantityAffected?: number; // Kalite problemi i√ßin etkilenen adet
  delayDays?: number; // Teslimat problemi i√ßin gecikme g√ºn√º
}

interface DefectRecord {
  id: string;
  supplierId: string;
  defectType: string;
  description: string;
  quantity: number;
  detectedDate: string;
  batchNumber: string;
  severity: 'kritik' | 'major' | 'minor';
  status: 'a√ßƒ±k' | 'd√ºzeltildi' | 'kabul';
  correctionCost: number;
}

// Otomatik denetim √∂nerisi interface
interface AutoAuditRecommendation {
  id: string;
  supplierId: string;
  supplierName: string;
  reason: string;
  urgencyLevel: 'd√º≈ü√ºk' | 'orta' | 'y√ºksek' | 'kritik';
  recommendedDate: string;
  performanceIssues: string[];
  currentScore: number;
  previousScore: number;
  riskFactors: string[];
  auditType: 'performans' | 'kalite' | 'teslimat' | 'kapsamlƒ±';
  estimatedDuration: number; // hours
  priority: number; // 1-5
  autoGenerated: boolean;
  createdAt: string;
}

// Tedarik t√ºr√º alt kategorileri
const SUPPLY_SUBCATEGORIES = {
  malzeme: [
    'Ham Madde (√áelik, Al√ºminyum, Plastik)',
    'Yarƒ± Mamul (Profil, Sac, Boru)',
    'Standart Par√ßalar (Vida, Somun, Rondela)',
    'Elektronik Komponentler',
    'Kimyasal Maddeler (Boya, Temizlik)',
    'Ambalaj Malzemeleri'
  ],
  hizmet: [
    'Ta≈üeron ƒ∞≈ü√ßilik (Kaynak, Montaj)',
    'Bakƒ±m ve Onarƒ±m Hizmetleri',
    'Lojistik ve Nakliye',
    'Kalibrasyon Hizmetleri',
    'Test ve Muayene Hizmetleri',
    'Danƒ±≈ümanlƒ±k Hizmetleri'
  ],
  hibrit: [
    'Tasarƒ±m + √úretim',
    'Montaj + Bakƒ±m',
    'Malzeme + Lojistik',
    'Test + Sertifikasyon'
  ]
};

// Error Boundary Component
class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error: Error | null }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('üö® SupplierQualityManagement Error Boundary yakaladƒ±:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <Box p={3}>
          <Alert severity="error" sx={{ mb: 2 }}>
            <Typography variant="h6" gutterBottom>
              Tedarik√ßi Kalite Y√∂netimi Mod√ºl√º Hatasƒ±
            </Typography>
            <Typography variant="body2" gutterBottom>
              {this.state.error?.message || 'Bilinmeyen bir hata olu≈ütu'}
            </Typography>
            <Button 
              variant="contained" 
              onClick={() => {
                this.setState({ hasError: false, error: null });
                window.location.reload();
              }}
              sx={{ mt: 2 }}
            >
              Sayfayƒ± Yenile
            </Button>
          </Alert>
        </Box>
      );
    }

    return this.props.children;
  }
}

const SupplierQualityManagement: React.FC = () => {
  // State Management
  const [currentTab, setCurrentTab] = useState(0);
  const [suppliers, setSuppliers] = useState<Supplier[]>([]);
  const [supplierPairs, setSupplierPairs] = useState<SupplierPair[]>([]);
  const [audits, setAudits] = useState<AuditRecord[]>([]);
  const [nonconformities, setNonconformities] = useState<NonconformityRecord[]>([]);
  const [defects, setDefects] = useState<DefectRecord[]>([]);
  const [autoAuditRecommendations, setAutoAuditRecommendations] = useState<AutoAuditRecommendation[]>([]);
  
  // Dialog states
  const [dialogOpen, setDialogOpen] = useState(false);
  const [dialogType, setDialogType] = useState<'supplier' | 'pair' | 'nonconformity' | 'defect' | 'audit'>('supplier');
  const [selectedItem, setSelectedItem] = useState<any>(null);
  const [formData, setFormData] = useState<any>({});
  
  // Audit date edit dialog
  const [auditDateDialogOpen, setAuditDateDialogOpen] = useState(false);
  const [selectedSupplierForAudit, setSelectedSupplierForAudit] = useState<Supplier | null>(null);
  const [newAuditDate, setNewAuditDate] = useState('');
  
  // Auto-audit settings
  const [autoAuditEnabled, setAutoAuditEnabled] = useState(true);
  const [auditInterval, setAuditInterval] = useState(90); // days
  
  // Performance radar settings
  const [selectedSuppliersForRadar, setSelectedSuppliersForRadar] = useState<string[]>([]);
  
  // Notification
  const [snackbar, setSnackbar] = useState({
    open: false,
    message: '',
    severity: 'success' as 'success' | 'error' | 'warning' | 'info'
  });

  // Load initial data
  const [dataLoaded, setDataLoaded] = React.useState(false);
  const [isLoading, setIsLoading] = React.useState(true);

  // localStorage Protection System - Component mount/unmount koruma
  useEffect(() => {
    console.log('üõ°Ô∏è SupplierQualityManagement component MOUNT - localStorage korumasƒ± aktif');
    
    // Component mount olduƒüunda localStorage'ƒ± backup'la
    const backupData = () => {
      const currentSuppliers = localStorage.getItem('suppliers');
      if (currentSuppliers && currentSuppliers !== '[]' && currentSuppliers !== 'null') {
        localStorage.setItem('suppliers-backup', currentSuppliers);
        console.log('üíæ Tedarik√ßi verileri backup\'landƒ±');
      }
    };
    
    backupData();
    loadStoredData();
    
    // Component unmount olduƒüunda cleanup
    return () => {
      console.log('üõ°Ô∏è SupplierQualityManagement component UNMOUNT - veri korumasƒ±');
      // Unmount sƒ±rasƒ±nda localStorage'ƒ± koruma
      const currentData = localStorage.getItem('suppliers');
      if (!currentData || currentData === '[]' || currentData === 'null') {
        // Veri silinmi≈üse backup'tan restore et
        const backupData = localStorage.getItem('suppliers-backup');
        if (backupData) {
          localStorage.setItem('suppliers', backupData);
          console.log('üîÑ Tedarik√ßi verileri backup\'tan restore edildi');
        }
      }
    };
  }, []);

  // localStorage Monitoring System - S√ºrekli veri korumasƒ±
  useEffect(() => {
    const monitorInterval = setInterval(() => {
      const currentSuppliers = localStorage.getItem('suppliers');
      const currentCount = suppliers.length;
      
      // localStorage'da veri yoksa ama state'te veri varsa
      if ((!currentSuppliers || currentSuppliers === '[]' || currentSuppliers === 'null') && currentCount > 0) {
        console.log('üö® UYARI: localStorage\'da tedarik√ßi verisi silinmi≈ü, state\'ten restore ediliyor!');
        localStorage.setItem('suppliers', JSON.stringify(suppliers));
        console.log('üîß localStorage restore edildi:', currentCount, 'tedarik√ßi');
      }
      
      // localStorage'da veri varsa ama state'te yoksa (component mount durumu deƒüil)
      if (currentSuppliers && currentSuppliers !== '[]' && currentSuppliers !== 'null' && currentCount === 0 && dataLoaded) {
        console.log('üö® UYARI: State\'te veri yok ama localStorage\'da var, state restore ediliyor!');
        try {
          const storedData = JSON.parse(currentSuppliers);
          if (storedData.length > 0) {
            setSuppliers(storedData);
            console.log('üîß State restore edildi:', storedData.length, 'tedarik√ßi');
          }
        } catch (e) {
          console.error('‚ùå State restore hatasƒ±:', e);
        }
      }
    }, 2000); // Her 2 saniyede kontrol et
    
    return () => clearInterval(monitorInterval);
  }, [suppliers, dataLoaded]);

  // MANUEL KAYDETME FONKSƒ∞YONLARI - useEffect yerine
  const saveToLocalStorage = () => {
    try {
      localStorage.setItem('suppliers', JSON.stringify(suppliers));
      localStorage.setItem('supplier-nonconformities', JSON.stringify(nonconformities));
      localStorage.setItem('supplier-defects', JSON.stringify(defects));
      localStorage.setItem('supplier-pairs', JSON.stringify(supplierPairs));
      localStorage.setItem('supplier-audits', JSON.stringify(audits)); // EKSƒ∞K AUDIT VERƒ∞LERƒ∞ EKLENDƒ∞
      console.log('üíæ T√ºm tedarik√ßi verileri (denetimler dahil) manuel olarak localStorage\'a kaydedildi');
    } catch (error) {
      console.error('‚ùå localStorage kaydetme hatasƒ±:', error);
    }
  };

  const loadStoredData = () => {
    try {
      // localStorage'dan verileri y√ºkle
      const storedSuppliers = localStorage.getItem('suppliers');
      const storedNonconformities = localStorage.getItem('supplier-nonconformities');
      const storedDefects = localStorage.getItem('supplier-defects');
      const storedPairs = localStorage.getItem('supplier-pairs');
      const storedAudits = localStorage.getItem('supplier-audits');
      
      console.log('üîç localStorage kontrol:', {
        suppliers: !!storedSuppliers,
        suppliersLength: storedSuppliers ? JSON.parse(storedSuppliers).length : 0,
        nonconformities: !!storedNonconformities,
        defects: !!storedDefects,
        pairs: !!storedPairs,
        audits: !!storedAudits
      });
      
      // Veri y√ºkleme ba≈üarƒ±sƒ±zlƒ±k kontrol√º
      let hasAnyData = false;
      
      if (storedSuppliers && storedSuppliers !== 'null' && storedSuppliers !== '[]') {
        const parsedSuppliers = JSON.parse(storedSuppliers);
        if (parsedSuppliers.length > 0) {
          setSuppliers(parsedSuppliers);
          hasAnyData = true;
          console.log('‚úÖ Tedarik√ßi verileri localStorage\'dan y√ºklendi:', parsedSuppliers.length, 'kayƒ±t');
        }
      }
      
      if (storedNonconformities && storedNonconformities !== 'null' && storedNonconformities !== '[]') {
        const parsedNonconformities = JSON.parse(storedNonconformities);
        if (parsedNonconformities.length > 0) {
          setNonconformities(parsedNonconformities);
          hasAnyData = true;
          console.log('‚úÖ Uygunsuzluk verileri localStorage\'dan y√ºklendi:', parsedNonconformities.length, 'kayƒ±t');
        }
      }
      
      if (storedDefects && storedDefects !== 'null' && storedDefects !== '[]') {
        const parsedDefects = JSON.parse(storedDefects);
        if (parsedDefects.length > 0) {
          setDefects(parsedDefects);
          hasAnyData = true;
          console.log('‚úÖ Hata verileri localStorage\'dan y√ºklendi:', parsedDefects.length, 'kayƒ±t');
        }
      }
      
      if (storedPairs && storedPairs !== 'null' && storedPairs !== '[]') {
        const parsedPairs = JSON.parse(storedPairs);
        if (parsedPairs.length > 0) {
          setSupplierPairs(parsedPairs);
          hasAnyData = true;
          console.log('‚úÖ E≈üle≈ütirme verileri localStorage\'dan y√ºklendi:', parsedPairs.length, 'kayƒ±t');
        }
      }
      
      if (storedAudits && storedAudits !== 'null' && storedAudits !== '[]') {
        const parsedAudits = JSON.parse(storedAudits);
        if (parsedAudits.length > 0) {
          setAudits(parsedAudits);
          hasAnyData = true;
          console.log('‚úÖ Denetim verileri localStorage\'dan y√ºklendi:', parsedAudits.length, 'kayƒ±t');
        }
      }
      
      // Hi√ß veri yoksa mock veri y√ºkle (ilk kullanƒ±m)
      if (!hasAnyData) {
        console.log('üé≤ localStorage bo≈ü - ƒ∞lk kullanƒ±m i√ßin mock veri y√ºkleniyor...');
        loadMockData();
      } else {
        setDataLoaded(true);
        setIsLoading(false);
        console.log('üéØ Tedarik√ßi mod√ºl√º veri y√ºkleme tamamlandƒ±');
      }
      
    } catch (error) {
      console.error('‚ùå localStorage veri y√ºkleme hatasƒ±:', error);
      // Hata durumunda mock veri y√ºkle
      console.log('üö® Hata durumunda mock veri y√ºkleniyor...');
      loadMockData();
    } finally {
      setIsLoading(false);
    }
  };

  const loadMockData = () => {
    // Mock data - ger√ßek uygulamada API'den gelecek
    const mockSuppliers: Supplier[] = [
      {
        id: 'SUP-001',
        name: 'Se√ßkinler Metal A.≈û.',
        code: 'SM001',
        type: 'onaylƒ±',
        category: 'stratejik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (√áelik, Al√ºminyum, Plastik)', 'Yarƒ± Mamul (Profil, Sac, Boru)'],
        contact: {
          email: 'info@seckinlermetal.com',
          phone: '+90 212 555 0123',
          address: 'ƒ∞stanbul Sanayi Sitesi',
          contactPerson: 'Ahmet Se√ßkin'
        },
        materialTypes: ['√áelik Levha', 'Profil'],
        performanceScore: 92,
        qualityScore: 95,
        deliveryScore: 88,
        riskLevel: 'd√º≈ü√ºk',
        status: 'aktif',
        registrationDate: '2020-01-15',
        lastAuditDate: '2024-06-15',
        nextAuditDate: '2025-06-15',
        auditStatus: 'planlƒ±',
        nonconformityCount: 2,
        defectCount: 1,
        dofCount: 0,
        isActive: true
      },
      // D√º≈ü√ºk performanslƒ± tedarik√ßi √∂rnekleri (otomatik denetim √∂nerisi i√ßin)
      {
        id: 'SUP-005',
        name: 'Problematik Metal San. Tic.',
        code: 'PM005',
        type: 'onaylƒ±',
        category: 'kritik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (√áelik, Al√ºminyum, Plastik)'],
        contact: {
          email: 'info@problematikmetal.com',
          phone: '+90 212 555 0567',
          address: 'Ankara Organize Sanayi',
          contactPerson: 'Mehmet Problem'
        },
        materialTypes: ['√áelik Levha'],
        performanceScore: 65, // D√º≈ü√ºk performans
        qualityScore: 68, // D√º≈ü√ºk kalite
        deliveryScore: 70, // D√º≈ü√ºk teslimat
        riskLevel: 'y√ºksek',
        status: 'aktif',
        registrationDate: '2019-03-20',
        lastAuditDate: '2022-12-15', // Eski denetim
        nextAuditDate: '2024-12-15',
        auditStatus: 'gecikmi≈ü',
        nonconformityCount: 8, // Y√ºksek uygunsuzluk
        defectCount: 6, // Y√ºksek hata
        dofCount: 3,
        isActive: true
      },
      {
        id: 'SUP-006',
        name: 'Kalitesiz √úretim A.≈û.',
        code: 'KU006',
        type: 'onaylƒ±',
        category: 'kritik',
        supplyType: 'malzeme',
        supplySubcategories: ['Yarƒ± Mamul (Profil, Sac, Boru)'],
        contact: {
          email: 'kalite@kalitesizuretim.com',
          phone: '+90 216 555 0789',
          address: 'ƒ∞zmir Atat√ºrk Organize Sanayi',
          contactPerson: 'Ay≈üe Kalitesiz'
        },
        materialTypes: ['Profil', 'Boru'],
        performanceScore: 58, // √áok d√º≈ü√ºk performans
        qualityScore: 60, // √áok d√º≈ü√ºk kalite
        deliveryScore: 65, // D√º≈ü√ºk teslimat
        riskLevel: 'kritik',
        status: 'aktif',
        registrationDate: '2018-11-10',
        lastAuditDate: '2022-08-20', // √áok eski denetim
        nextAuditDate: '2023-08-20',
        auditStatus: 'gecikmi≈ü',
        nonconformityCount: 12, // √áok y√ºksek uygunsuzluk
        defectCount: 9, // √áok y√ºksek hata
        dofCount: 5,
        isActive: true
      },
      {
        id: 'SUP-002',
        name: 'Nisa Metal Ltd.',
        code: 'NM002',
        type: 'alternatif',
        category: 'stratejik',
        supplyType: 'hizmet',
        supplySubcategories: ['Ta≈üeron ƒ∞≈ü√ßilik (Kaynak, Montaj)', 'Bakƒ±m ve Onarƒ±m Hizmetleri'],
        contact: {
          email: 'info@nisametal.com',
          phone: '+90 212 555 0124',
          address: 'Bursa Sanayi Sitesi',
          contactPerson: 'Fatma Nisa'
        },
        materialTypes: ['√áelik Levha', 'Profil'],
        performanceScore: 87,
        qualityScore: 90,
        deliveryScore: 85,
        riskLevel: 'd√º≈ü√ºk',
        status: 'aktif',
        registrationDate: '2021-03-20',
        lastAuditDate: '2024-07-10',
        nextAuditDate: '2025-07-10',
        auditStatus: 'planlƒ±',
        nonconformityCount: 1,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      }
    ];

    const mockPairs: SupplierPair[] = [
      {
        id: 'PAIR-001',
        primarySupplier: mockSuppliers[0],
        alternativeSuppliers: [mockSuppliers[1]],
        materialType: '√áelik Levha',
        category: 'stratejik',
        performanceComparison: {
          primaryScore: 92,
          alternativeScores: [{ id: 'SUP-002', score: 87 }],
          recommendation: 'Ana tedarik√ßi performansƒ± √ºst√ºn'
        },
        lastReviewDate: '2024-10-15',
        nextReviewDate: '2025-04-15'
      }
    ];

    // Mock audit records - Planlanan denetimler
    const mockAudits: AuditRecord[] = [
      {
        id: 'AUDIT-001',
        supplierId: 'SUP-001',
        auditDate: '2024-12-25',
        auditType: 'planlƒ±',
        auditorName: 'Kalite M√ºd√ºr√º - Ahmet Yƒ±lmaz',
        score: 0,
        findings: [],
        status: 'planlƒ±',
        nextAuditDate: '2025-12-25',
        isAutoScheduled: false
      },
      {
        id: 'AUDIT-002',
        supplierId: 'SUP-002',
        auditDate: '2024-12-28',
        auditType: 'takip',
        auditorName: 'Denetim Uzmanƒ± - Fatma Demir',
        score: 0,
        findings: [],
        status: 'planlƒ±',
        nextAuditDate: '2025-06-28',
        isAutoScheduled: false
      },
      {
        id: 'AUDIT-003',
        supplierId: 'SUP-005',
        auditDate: '2024-12-20',
        auditType: 'acil',
        auditorName: 'Ba≈ü Denet√ßi - Mehmet √ñzt√ºrk',
        score: 0,
        findings: [],
        status: 'planlƒ±',
        nextAuditDate: '2025-03-20',
        isAutoScheduled: true
      },
      {
        id: 'AUDIT-004',
        supplierId: 'SUP-006',
        auditDate: '2024-12-15',
        auditType: 'ani',
        auditorName: 'Kalite Kontrol - Ay≈üe Kaya',
        score: 0,
        findings: [],
        status: 'planlƒ±',
        nextAuditDate: '2025-02-15',
        isAutoScheduled: true
      }
    ];



    // Mock nonconformity records
    const mockNonconformities: NonconformityRecord[] = [
      {
        id: 'NC-001',
        supplierId: 'SUP-001',
        title: 'Boyut Sapmasƒ±',
        description: '√áelik levhalarda boyut toleransƒ± a≈üƒ±mƒ± tespit edildi',
        category: 'kalite',
        severity: 'y√ºksek',
        detectedDate: '2024-11-15',
        status: 'a√ßƒ±k',
        dueDate: '2024-12-15',
        correctionCost: 15000,
        recurrence: false,
        partCode: 'CL-001',
        quantityAffected: 25
      },
      {
        id: 'NC-002',
        supplierId: 'SUP-005',
        title: 'Teslimat Gecikmesi',
        description: 'Planlanan teslimat tarihinden 5 g√ºn gecikme',
        category: 'teslimat',
        severity: 'orta',
        detectedDate: '2024-11-20',
        status: 'ara≈ütƒ±rƒ±lƒ±yor',
        dueDate: '2024-12-20',
        correctionCost: 8000,
        recurrence: true,
        partCode: 'PM-002',
        delayDays: 5
      },
      {
        id: 'NC-003',
        supplierId: 'SUP-006',
        title: 'Kalite Sertifikasƒ± Eksik',
        description: 'Malzeme sertifikasƒ± zamanƒ±nda teslim edilmedi',
        category: 'dok√ºman',
        severity: 'kritik',
        detectedDate: '2024-11-25',
        status: 'a√ßƒ±k',
        dueDate: '2024-12-10',
        correctionCost: 12000,
        recurrence: false,
        partCode: 'SR-003'
      }
    ];

    // Mock defect records
    const mockDefects: DefectRecord[] = [
      {
        id: 'DEF-001',
        supplierId: 'SUP-001',
        defectType: 'Kaynak Hatasƒ±',
        description: 'Kaynak diki≈ülerinde porozite tespit edildi',
        quantity: 12,
        detectedDate: '2024-11-10',
        batchNumber: 'BT-2024-001',
        severity: 'major',
        status: 'a√ßƒ±k',
        correctionCost: 18000
      },
      {
        id: 'DEF-002',
        supplierId: 'SUP-005',
        defectType: 'Boyut Hatasƒ±',
        description: 'Par√ßa boyutlarƒ±nda tolerans dƒ±≈üƒ± sapma',
        quantity: 8,
        detectedDate: '2024-11-18',
        batchNumber: 'BT-2024-002',
        severity: 'kritik',
        status: 'd√ºzeltildi',
        correctionCost: 22000
      },
      {
        id: 'DEF-003',
        supplierId: 'SUP-006',
        defectType: 'Y√ºzey Kalitesi',
        description: 'Y√ºzey p√ºr√ºzl√ºl√ºƒü√º standart dƒ±≈üƒ±',
        quantity: 15,
        detectedDate: '2024-11-22',
        batchNumber: 'BT-2024-003',
        severity: 'minor',
        status: 'a√ßƒ±k',
        correctionCost: 9500
      }
    ];

    setSuppliers(mockSuppliers);
    setSupplierPairs(mockPairs);
    setAudits(mockAudits);
    setNonconformities(mockNonconformities);
    setDefects(mockDefects);
    
    // Veri y√ºkleme tamamlandƒ±ƒüƒ±nƒ± i≈üaretle
    setDataLoaded(true);
    setIsLoading(false);
    console.log('üéØ Mock tedarik√ßi verileri y√ºklendi ve dataLoaded true oldu');
    
    // Auto-audit check
    if (autoAuditEnabled) {
      checkAutoAuditRequirements(mockSuppliers);
    }
  };

  // Auto-audit system
  const checkAutoAuditRequirements = (suppliers: Supplier[]) => {
    const today = new Date();
    suppliers.forEach(supplier => {
      const nextAudit = new Date(supplier.nextAuditDate);
      const daysDiff = Math.ceil((nextAudit.getTime() - today.getTime()) / (1000 * 3600 * 24));
      
      if (daysDiff <= 30 || supplier.performanceScore < 70) {
        scheduleAutoAudit(supplier);
      }
    });
  };

  const scheduleAutoAudit = (supplier: Supplier) => {
    showSnackbar(`${supplier.name} i√ßin otomatik denetim planlandƒ±`, 'warning');
  };

  // Otomatik denetim √∂nerisi olu≈üturma
  const generateAutoAuditRecommendations = () => {
    const recommendations: AutoAuditRecommendation[] = [];
    const today = new Date();

    suppliers.forEach(supplier => {
      const performanceIssues: string[] = [];
      const riskFactors: string[] = [];
      let shouldRecommendAudit = false;
      let urgencyLevel: 'd√º≈ü√ºk' | 'orta' | 'y√ºksek' | 'kritik' = 'd√º≈ü√ºk';
      let auditType: 'performans' | 'kalite' | 'teslimat' | 'kapsamlƒ±' = 'performans';
      let priority = 1;

      // Performans skorlarƒ± kontrol√º
      if (supplier.performanceScore < 70) {
        performanceIssues.push(`Genel performans skoru d√º≈ü√ºk: ${supplier.performanceScore}/100`);
        shouldRecommendAudit = true;
        urgencyLevel = 'y√ºksek';
        priority = 4;
      } else if (supplier.performanceScore < 80) {
        performanceIssues.push(`Performans skoru ortalamanƒ±n altƒ±nda: ${supplier.performanceScore}/100`);
        shouldRecommendAudit = true;
        urgencyLevel = 'orta';
        priority = 3;
      }

      // Kalite skoru kontrol√º
      if (supplier.qualityScore < 75) {
        performanceIssues.push(`Kalite skoru d√º≈ü√ºk: ${supplier.qualityScore}/100`);
        riskFactors.push('Kalite standartlarƒ±nƒ±n altƒ±nda performans');
        shouldRecommendAudit = true;
        auditType = 'kalite';
        if (urgencyLevel === 'd√º≈ü√ºk') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // Teslimat skoru kontrol√º
      if (supplier.deliveryScore < 75) {
        performanceIssues.push(`Teslimat skoru d√º≈ü√ºk: ${supplier.deliveryScore}/100`);
        riskFactors.push('Teslimat g√ºvenilirliƒüi d√º≈ü√ºk');
        shouldRecommendAudit = true;
        auditType = 'teslimat';
        if (urgencyLevel === 'd√º≈ü√ºk') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // Uygunsuzluk sayƒ±sƒ± kontrol√º
      if (supplier.nonconformityCount > 5) {
        performanceIssues.push(`Y√ºksek uygunsuzluk sayƒ±sƒ±: ${supplier.nonconformityCount} adet`);
        riskFactors.push('Tekrarlayan kalite sorunlarƒ±');
        shouldRecommendAudit = true;
        urgencyLevel = 'y√ºksek';
        priority = Math.max(priority, 4);
      }

      // Hata sayƒ±sƒ± kontrol√º
      if (supplier.defectCount > 3) {
        performanceIssues.push(`Y√ºksek hata sayƒ±sƒ±: ${supplier.defectCount} adet`);
        riskFactors.push('Sƒ±k hata olu≈üumu');
        shouldRecommendAudit = true;
        priority = Math.max(priority, 3);
      }

      // Risk seviyesi kontrol√º
      if (supplier.riskLevel === 'kritik' || supplier.riskLevel === 'y√ºksek') {
        riskFactors.push(`${supplier.riskLevel.charAt(0).toUpperCase() + supplier.riskLevel.slice(1)} risk seviyesi`);
        shouldRecommendAudit = true;
        urgencyLevel = supplier.riskLevel === 'kritik' ? 'kritik' : 'y√ºksek';
        priority = supplier.riskLevel === 'kritik' ? 5 : 4;
      }

      // Son denetim tarihi kontrol√º
      const lastAuditDate = new Date(supplier.lastAuditDate);
      const monthsSinceLastAudit = Math.floor((today.getTime() - lastAuditDate.getTime()) / (1000 * 60 * 60 * 24 * 30));
      
      if (monthsSinceLastAudit > 12) {
        riskFactors.push(`Son denetimden bu yana ${monthsSinceLastAudit} ay ge√ßti`);
        shouldRecommendAudit = true;
        if (urgencyLevel === 'd√º≈ü√ºk') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // √ñnerilen tarih hesaplama
      let recommendedDays = 30; // default
      if (urgencyLevel === 'kritik') recommendedDays = 3;
      else if (urgencyLevel === 'y√ºksek') recommendedDays = 7;
      else if (urgencyLevel === 'orta') recommendedDays = 14;

      const recommendedDate = new Date(today.getTime() + (recommendedDays * 24 * 60 * 60 * 1000));

      // S√ºre tahmini
      let estimatedDuration = 4; // hours
      if (performanceIssues.length > 3) estimatedDuration = 6;

      // Kapsamlƒ± denetim gereksinimi
      if (performanceIssues.length > 2 && riskFactors.length > 2) {
        estimatedDuration = 8;
        priority = Math.max(priority, 4);
      }

      if (shouldRecommendAudit) {
        const recommendation: AutoAuditRecommendation = {
          id: `AUTO-${supplier.id}-${Date.now()}`,
          supplierId: supplier.id,
          supplierName: supplier.name,
          reason: `Performans g√∂stergeleri denetim gerekliliƒüi i≈üaret ediyor. ${performanceIssues.join(', ')}`,
          urgencyLevel,
          recommendedDate: recommendedDate.toISOString().split('T')[0],
          performanceIssues,
          currentScore: supplier.performanceScore,
          previousScore: supplier.performanceScore + Math.floor(Math.random() * 20) - 10, // Simulated previous score
          riskFactors,
          auditType,
          estimatedDuration,
          priority,
          autoGenerated: true,
          createdAt: today.toISOString()
        };

        recommendations.push(recommendation);
      }
    });

    // √ñnceliƒüe g√∂re sƒ±rala
    recommendations.sort((a, b) => b.priority - a.priority);
    setAutoAuditRecommendations(recommendations);
    
    if (recommendations.length > 0) {
      showSnackbar(`${recommendations.length} otomatik denetim √∂nerisi olu≈üturuldu`, 'info');
    } else {
      showSnackbar('≈ûu anda denetim √∂nerisi gerektiren tedarik√ßi bulunmuyor', 'success');
    }
  };

  // Otomatik denetim √∂nerisini kabul etme
  const acceptAuditRecommendation = (recommendation: AutoAuditRecommendation) => {
    const newAudit: AuditRecord = {
      id: `AUD-${Date.now()}`,
      supplierId: recommendation.supplierId,
      auditDate: recommendation.recommendedDate,
      auditType: 'planlƒ±',
      auditorName: 'Kalite Ekibi',
      score: 0,
      findings: [],
      status: 'planlƒ±',
      nextAuditDate: '',
      isAutoScheduled: true
    };

    setAudits(prev => [...prev, newAudit]);
    
    // √ñneriyi listeden √ßƒ±kar
    setAutoAuditRecommendations(prev => 
      prev.filter(rec => rec.id !== recommendation.id)
    );

    showSnackbar(`${recommendation.supplierName} i√ßin denetim planlandƒ±`, 'success');
  };

  // Otomatik denetim √∂nerisini reddetme
  const rejectAuditRecommendation = (recommendationId: string) => {
    setAutoAuditRecommendations(prev => 
      prev.filter(rec => rec.id !== recommendationId)
    );
    showSnackbar('Denetim √∂nerisi reddedildi', 'info');
  };

  // D√ñF Integration - Prefill form ile D√ñF formunu direkt a√ßma
  const createDOFFromNonconformity = (nonconformity: NonconformityRecord) => {
    const supplier = suppliers.find(s => s.id === nonconformity.supplierId);
    if (!supplier) return;

    try {
      // D√ñF form prefill data olu≈ütur
      const dofPrefillData = {
        title: `Tedarik√ßi Uygunsuzluƒüu - ${supplier.name}`,
        description: `Tedarik√ßi: ${supplier.name} (${supplier.code})
Uygunsuzluk Ba≈ülƒ±ƒüƒ±: ${nonconformity.title}
A√ßƒ±klama: ${nonconformity.description}
Kategori: ${nonconformity.category}
Par√ßa Kodu: ${nonconformity.partCode}
Tespit Tarihi: ${nonconformity.detectedDate}
D√ºzeltme Maliyeti: ${nonconformity.correctionCost} ‚Ç∫
${nonconformity.quantityAffected ? `Etkilenen Miktar: ${nonconformity.quantityAffected} adet` : ''}
${nonconformity.delayDays ? `Gecikme S√ºresi: ${nonconformity.delayDays} g√ºn` : ''}`,
        department: 'Satƒ±n Alma',
        responsible: 'Atakan Battal',
        priority: nonconformity.severity === 'kritik' ? 'critical' : 
                  nonconformity.severity === 'y√ºksek' ? 'high' : 
                  nonconformity.severity === 'orta' ? 'medium' : 'low',
        source: 'SupplierQualityManagement',
        sourceId: nonconformity.id,
        supplierInfo: {
          name: supplier.name,
          code: supplier.code,
          category: supplier.category,
          contactPerson: supplier.contact.contactPerson
        }
      };

      // Prefill data'yƒ± localStorage'a kaydet (D√ñF mod√ºl√ºn√ºn beklediƒüi format)
      const prefillWrapper = {
        prefillData: dofPrefillData
      };
      localStorage.setItem('dof-form-prefill', JSON.stringify(prefillWrapper));
      localStorage.setItem('dof-auto-open-form', 'true');

      // Update nonconformity with DOF creation flag
      const updatedNonconformities = nonconformities.map(nc => 
        nc.id === nonconformity.id ? { ...nc, dofId: 'creating' } : nc
      );
      setNonconformities(updatedNonconformities);

      showSnackbar(`D√ñF formu prefill verilerle a√ßƒ±lƒ±yor...`, 'info');
      
      // D√ñF form sayfasƒ±nƒ± yeni sekmede a√ß
      window.open('/dof-8d-management', '_blank');
    } catch (error) {
      console.error('D√ñF olu≈üturma hatasƒ±:', error);
      showSnackbar('D√ñF olu≈üturulurken hata olu≈ütu', 'error');
    }
  };

  // Utility functions
  const showSnackbar = (message: string, severity: 'success' | 'error' | 'warning' | 'info') => {
    setSnackbar({ open: true, message, severity });
  };

  // Dialog handlers for all button functionalities
  const handleCreateSupplier = () => {
    setDialogType('supplier');
    setSelectedItem(null);
    setFormData({
      name: '',
      code: '',
      type: 'onaylƒ±',
      category: 'genel',
      supplyType: 'malzeme',
      supplySubcategories: [],
      contact: { email: '', phone: '', address: '', contactPerson: '' },
      materialTypes: [],
      performanceScore: 0,
      qualityScore: 0,
      deliveryScore: 0,
      riskLevel: 'd√º≈ü√ºk',
      status: 'aktif'
    });
    setDialogOpen(true);
  };

  const handleCreatePair = () => {
    setDialogType('pair');
    setSelectedItem(null);
    setFormData({
      materialType: '',
      primarySupplierId: '',
      alternativeSupplierIds: [],
      category: 'genel'
    });
    setDialogOpen(true);
  };

  const handleCreateNonconformity = () => {
    setDialogType('nonconformity');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      title: '',
      description: '',
      category: 'kalite',
      severity: 'd√º≈ü√ºk',
      detectedDate: new Date().toISOString().split('T')[0],
      status: 'a√ßƒ±k',
      dueDate: '',
      correctionCost: 0,
      partCode: '', // Zorunlu alan
      quantityAffected: undefined,
      delayDays: undefined,
      recurrence: false
    });
    setDialogOpen(true);
  };

  const handleCreateDefect = () => {
    setDialogType('defect');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      defectType: '',
      description: '',
      quantity: 0,
      detectedDate: new Date().toISOString().split('T')[0],
      batchNumber: '',
      severity: 'minor',
      status: 'a√ßƒ±k',
      correctionCost: 0
    });
    setDialogOpen(true);
  };

  const handleCreateAudit = () => {
    setDialogType('audit');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      auditDate: '',
      auditType: 'planlƒ±',
      auditorName: '',
      findings: [],
      status: 'planlƒ±'
    });
    setDialogOpen(true);
  };

  const handleEditAuditDate = (supplier: Supplier) => {
    setSelectedSupplierForAudit(supplier);
    setNewAuditDate(supplier.nextAuditDate);
    setAuditDateDialogOpen(true);
  };

  const handleSaveAuditDate = () => {
    if (selectedSupplierForAudit && newAuditDate) {
      const updatedSuppliers = suppliers.map(supplier => 
        supplier.id === selectedSupplierForAudit.id 
          ? { ...supplier, nextAuditDate: newAuditDate }
          : supplier
      );
      setSuppliers(updatedSuppliers);
      setAuditDateDialogOpen(false);
      setSelectedSupplierForAudit(null);
      setNewAuditDate('');
      showSnackbar(`${selectedSupplierForAudit.name} denetim tarihi g√ºncellendi`, 'success');
    }
  };

  const handleEditItem = (item: any, type: string) => {
    setDialogType(type as any);
    setSelectedItem(item);
    setFormData(item);
    setDialogOpen(true);
  };

  const handleDeleteItem = (id: string, type: string) => {
    if (window.confirm('Bu kaydƒ± silmek istediƒüinizden emin misiniz?')) {
      switch (type) {
        case 'supplier':
          const updatedSuppliers = suppliers.filter(s => s.id !== id);
          setSuppliers(updatedSuppliers);
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
            console.log('üíæ Tedarik√ßi silindi ve localStorage g√ºncellendi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          showSnackbar('Tedarik√ßi ba≈üarƒ±yla silindi', 'success');
          break;
        case 'pair':
          const updatedPairs = supplierPairs.filter(p => p.id !== id);
          setSupplierPairs(updatedPairs);
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
            console.log('üíæ E≈üle≈ütirme silindi ve localStorage g√ºncellendi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          showSnackbar('E≈üle≈ütirme ba≈üarƒ±yla silindi', 'success');
          break;
        case 'nonconformity':
          const updatedNonconformities = nonconformities.filter(n => n.id !== id);
          setNonconformities(updatedNonconformities);
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-nonconformities', JSON.stringify(updatedNonconformities));
            console.log('üíæ Uygunsuzluk silindi ve localStorage g√ºncellendi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          showSnackbar('Uygunsuzluk ba≈üarƒ±yla silindi', 'success');
          break;
        case 'defect':
          const updatedDefects = defects.filter(d => d.id !== id);
          setDefects(updatedDefects);
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-defects', JSON.stringify(updatedDefects));
            console.log('üíæ Hata silindi ve localStorage g√ºncellendi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          showSnackbar('Hata kaydƒ± ba≈üarƒ±yla silindi', 'success');
          break;
        case 'audit':
          const updatedAudits = audits.filter(a => a.id !== id);
          setAudits(updatedAudits);
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-audits', JSON.stringify(updatedAudits));
            console.log('üíæ Denetim silindi ve localStorage g√ºncellendi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          showSnackbar('Denetim planƒ± ba≈üarƒ±yla silindi', 'success');
          break;
      }
    }
  };

  const handleSaveDialog = () => {
    const newId = `${dialogType.toUpperCase()}-${Date.now()}`;
    
    switch (dialogType) {
      case 'supplier':
        const newSupplier: Supplier = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId,
          // Performans skorlarƒ± - default deƒüerler veya form deƒüerleri
          performanceScore: formData.performanceScore || 85,
          qualityScore: formData.qualityScore || 88,
          deliveryScore: formData.deliveryScore || 90,
          // Risk ve durum - default deƒüerler
          riskLevel: formData.riskLevel || 'd√º≈ü√ºk',
          status: formData.status || 'aktif',
          // ƒ∞leti≈üim bilgileri - default deƒüerler
          contact: {
            email: formData.contact?.email || '',
            phone: formData.contact?.phone || '',
            address: formData.contact?.address || '',
            contactPerson: formData.contact?.contactPerson || ''
          },
          // Malzeme t√ºrleri - default deƒüer
          materialTypes: formData.materialTypes || [],
          // Tedarik bilgileri - default deƒüerler
          supplyType: formData.supplyType || 'malzeme',
          supplySubcategories: formData.supplySubcategories || [],
          // Tarih bilgileri
          registrationDate: selectedItem ? selectedItem.registrationDate : new Date().toISOString().split('T')[0],
          lastAuditDate: selectedItem ? selectedItem.lastAuditDate : '',
          nextAuditDate: selectedItem ? selectedItem.nextAuditDate : '',
          auditStatus: 'planlƒ±' as any,
          // Saya√ßlar
          nonconformityCount: selectedItem ? selectedItem.nonconformityCount : 0,
          defectCount: selectedItem ? selectedItem.defectCount : 0,
          dofCount: selectedItem ? selectedItem.dofCount : 0,
          isActive: true
        };
        
        // Form validasyonu
        if (!formData.name || !formData.code || !formData.type) {
          showSnackbar('Tedarik√ßi adƒ±, kodu ve t√ºr√º zorunludur', 'error');
          return;
        }

        console.log('üîµ Tedarik√ßi kaydetme i≈ülemi ba≈ülƒ±yor:', {
          formData,
          newSupplier,
          selectedItem: !!selectedItem
        });

        if (selectedItem) {
          const updatedSuppliers = suppliers.map(s => s.id === selectedItem.id ? newSupplier : s);
          console.log('‚úèÔ∏è Tedarik√ßi g√ºncelleniyor:', {
            before: suppliers.length,
            after: updatedSuppliers.length,
            updated: newSupplier
          });
          setSuppliers(updatedSuppliers);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
            console.log('üíæ G√ºncellenmi≈ü tedarik√ßi localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Tedarik√ßi ba≈üarƒ±yla g√ºncellendi', 'success');
        } else {
          const updatedSuppliers = [...suppliers, newSupplier];
          console.log('‚ûï Yeni tedarik√ßi ekleniyor:', {
            before: suppliers.length,
            after: updatedSuppliers.length,
            new: newSupplier
          });
          setSuppliers(updatedSuppliers);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
            console.log('üíæ Yeni tedarik√ßi localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Yeni tedarik√ßi ba≈üarƒ±yla eklendi', 'success');
        }
        break;
        
      case 'nonconformity':
        // Form validasyonu
        if (!formData.supplierId || !formData.title || !formData.partCode) {
          showSnackbar('Tedarik√ßi, ba≈ülƒ±k ve par√ßa kodu alanlarƒ± zorunludur', 'error');
          return;
        }
        
        if (!formData.description || formData.description.trim() === '') {
          showSnackbar('Uygunsuzluk a√ßƒ±klamasƒ± zorunludur', 'error');
          return;
        }
        
        if (!formData.dueDate) {
          showSnackbar('Tamamlanma tarihi zorunludur', 'error');
          return;
        }
        
        // Par√ßa kodu validasyonu
        if (formData.partCode.length < 3) {
          showSnackbar('Par√ßa kodu en az 3 karakter olmalƒ±dƒ±r', 'error');
          return;
        }
        
        const newNonconformity: NonconformityRecord = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId,
          recurrence: false
        };
        
        if (selectedItem) {
          const updatedNonconformities = nonconformities.map(n => n.id === selectedItem.id ? newNonconformity : n);
          setNonconformities(updatedNonconformities);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-nonconformities', JSON.stringify(updatedNonconformities));
            console.log('üíæ G√ºncellenmi≈ü uygunsuzluk localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Uygunsuzluk ba≈üarƒ±yla g√ºncellendi', 'success');
        } else {
          const updatedNonconformities = [...nonconformities, newNonconformity];
          setNonconformities(updatedNonconformities);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-nonconformities', JSON.stringify(updatedNonconformities));
            console.log('üíæ Yeni uygunsuzluk localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Yeni uygunsuzluk ba≈üarƒ±yla eklendi', 'success');
        }
        // Performanslarƒ± g√ºncelle
        setTimeout(() => updateSupplierPerformances(), 100);
        break;
        
      case 'defect':
        const newDefect: DefectRecord = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId
        };
        
        if (selectedItem) {
          const updatedDefects = defects.map(d => d.id === selectedItem.id ? newDefect : d);
          setDefects(updatedDefects);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-defects', JSON.stringify(updatedDefects));
            console.log('üíæ G√ºncellenmi≈ü hata localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Hata kaydƒ± ba≈üarƒ±yla g√ºncellendi', 'success');
        } else {
          const updatedDefects = [...defects, newDefect];
          setDefects(updatedDefects);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-defects', JSON.stringify(updatedDefects));
            console.log('üíæ Yeni hata localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Yeni hata kaydƒ± ba≈üarƒ±yla eklendi', 'success');
        }
        // Performanslarƒ± g√ºncelle
        setTimeout(() => updateSupplierPerformances(), 100);
        break;
        
      case 'pair':
        // Form validasyonu
        if (!formData.primarySupplierId || !formData.alternativeSupplierId || !formData.materialType) {
          showSnackbar('Ana tedarik√ßi, alternatif tedarik√ßi ve malzeme t√ºr√º se√ßimi zorunludur', 'error');
          return;
        }
        
        if (formData.primarySupplierId === formData.alternativeSupplierId) {
          showSnackbar('Ana tedarik√ßi ile alternatif tedarik√ßi aynƒ± olamaz', 'error');
          return;
        }
        
        const primarySupplier = suppliers.find(s => s.id === formData.primarySupplierId);
        const alternativeSupplier = suppliers.find(s => s.id === formData.alternativeSupplierId);
        
        if (!primarySupplier || !alternativeSupplier) {
          showSnackbar('Se√ßilen tedarik√ßiler bulunamadƒ±', 'error');
          return;
        }
        
        const newPair: SupplierPair = {
          id: selectedItem ? selectedItem.id : newId,
          primarySupplier,
          alternativeSuppliers: [alternativeSupplier],
          materialType: formData.materialType,
          category: formData.category || 'genel',
          performanceComparison: {
            primaryScore: primarySupplier.performanceScore,
            alternativeScores: [{ id: alternativeSupplier.id, score: alternativeSupplier.performanceScore }],
            recommendation: primarySupplier.performanceScore >= alternativeSupplier.performanceScore 
              ? 'Ana tedarik√ßi √∂nerilen' : 'Alternatif tedarik√ßi deƒüerlendirilebilir'
          },
          lastReviewDate: new Date().toISOString().split('T')[0],
          nextReviewDate: new Date(Date.now() + (parseInt(formData.reviewPeriod || '3') * 30 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0]
        };
        
        if (selectedItem) {
          const updatedPairs = supplierPairs.map(sp => sp.id === selectedItem.id ? newPair : sp);
          setSupplierPairs(updatedPairs);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
            console.log('üíæ G√ºncellenmi≈ü e≈üle≈ütirme localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Tedarik√ßi e≈üle≈ütirmesi ba≈üarƒ±yla g√ºncellendi', 'success');
        } else {
          const updatedPairs = [...supplierPairs, newPair];
          setSupplierPairs(updatedPairs);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
            console.log('üíæ Yeni e≈üle≈ütirme localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Yeni tedarik√ßi e≈üle≈ütirmesi ba≈üarƒ±yla olu≈üturuldu', 'success');
        }
        break;
        
      case 'audit':
        // Form validasyonu
        if (!formData.supplierId || !formData.auditDate || !formData.auditorName) {
          showSnackbar('Tedarik√ßi, denetim tarihi ve denet√ßi se√ßimi zorunludur', 'error');
          return;
        }
        
        const auditSupplier = suppliers.find(s => s.id === formData.supplierId);
        if (!auditSupplier) {
          showSnackbar('Se√ßilen tedarik√ßi bulunamadƒ±', 'error');
          return;
        }
        
        const newAudit: AuditRecord = {
          id: selectedItem ? selectedItem.id : newId,
          supplierId: formData.supplierId,
          auditDate: formData.auditDate,
          auditType: formData.auditType || 'planlƒ±',
          auditorName: formData.auditorName,
          score: 0, // Denetim tamamlandƒ±ƒüƒ±nda gir√ºlecek
          findings: [],
          status: 'planlƒ±',
          nextAuditDate: new Date(new Date(formData.auditDate).getTime() + (365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0], // 1 yƒ±l sonra
          isAutoScheduled: false
        };
        
        if (selectedItem) {
          const updatedAudits = audits.map(a => a.id === selectedItem.id ? newAudit : a);
          setAudits(updatedAudits);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-audits', JSON.stringify(updatedAudits));
            console.log('üíæ G√ºncellenmi≈ü denetim localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Denetim planƒ± ba≈üarƒ±yla g√ºncellendi', 'success');
        } else {
          const updatedAudits = [...audits, newAudit];
          setAudits(updatedAudits);
          
          // MANUEL localStorage kaydetme
          setTimeout(() => {
            localStorage.setItem('supplier-audits', JSON.stringify(updatedAudits));
            console.log('üíæ Yeni denetim localStorage\'a kaydedildi');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          }, 100);
          
          showSnackbar('Yeni denetim planƒ± ba≈üarƒ±yla olu≈üturuldu', 'success');
        }
        
        // Tedarik√ßinin denetim bilgilerini g√ºncelle
        const updatedSuppliers = suppliers.map(s => 
          s.id === formData.supplierId 
            ? { ...s, nextAuditDate: formData.auditDate, auditStatus: 'planlƒ±' as any }
            : s
        );
        setSuppliers(updatedSuppliers);
        
        // MANUEL localStorage kaydetme - tedarik√ßi denetim bilgileri g√ºncellendiƒüi i√ßin
        setTimeout(() => {
          localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
          console.log('üíæ Tedarik√ßi denetim bilgileri localStorage\'a kaydedildi');
          window.dispatchEvent(new Event('supplierDataUpdated'));
        }, 100);
        break;
    }
    
    setDialogOpen(false);
    setFormData({});
    setSelectedItem(null);
  };

  const getPerformanceColor = (score: number) => {
    if (score >= 90) return '#4caf50';
    if (score >= 80) return '#8bc34a';
    if (score >= 70) return '#ff9800';
    if (score >= 60) return '#f44336';
    return '#d32f2f';
  };

  // Dinamik performans hesaplama fonksiyonu
  const calculateSupplierPerformance = React.useCallback((supplier: Supplier) => {
    console.log(`\n=== PERFORMANS HESAPLAMA: ${supplier.name} ===`);
    
    // Temel skorlar (ba≈ülangƒ±√ß deƒüerleri)
    let qualityScore = 100;
    let deliveryScore = 100;
    let performanceScore = 100;

    // Uygunsuzluk sayƒ±sƒ±na g√∂re kalite skoru d√º≈ü√ºrme
    const supplierNonconformities = nonconformities.filter(nc => nc.supplierId === supplier.id);
    const activeNonconformities = supplierNonconformities.filter(nc => nc.status !== 'kapalƒ±');
    
    console.log(`Toplam uygunsuzluk: ${supplierNonconformities.length}`);
    console.log(`A√ßƒ±k uygunsuzluk: ${activeNonconformities.length}`);
    
    // Her a√ßƒ±k uygunsuzluk i√ßin puan d√º≈ü√ºrme
    qualityScore -= activeNonconformities.length * 5;
    console.log(`A√ßƒ±k uygunsuzluk d√º≈ü√ºm√º: -${activeNonconformities.length * 5} puan`);
    
    // Kritik uygunsuzluklar i√ßin ek puan d√º≈ü√ºrme
    const criticalNonconformities = supplierNonconformities.filter(nc => nc.severity === 'kritik');
    qualityScore -= criticalNonconformities.length * 10;
    console.log(`Kritik uygunsuzluk: ${criticalNonconformities.length}, d√º≈ü√ºm: -${criticalNonconformities.length * 10} puan`);

    // Hata sayƒ±sƒ±na g√∂re kalite skoru d√º≈ü√ºrme
    const supplierDefects = defects.filter(d => d.supplierId === supplier.id);
    const activeDefects = supplierDefects.filter(d => d.status !== 'd√ºzeltildi');
    
    console.log(`Toplam hata: ${supplierDefects.length}`);
    console.log(`A√ßƒ±k hata: ${activeDefects.length}`);
    
    // Her a√ßƒ±k hata i√ßin puan d√º≈ü√ºrme
    qualityScore -= activeDefects.length * 3;
    console.log(`A√ßƒ±k hata d√º≈ü√ºm√º: -${activeDefects.length * 3} puan`);
    
    // Kritik hatalar i√ßin ek puan d√º≈ü√ºrme
    const criticalDefects = supplierDefects.filter(d => d.severity === 'kritik');
    qualityScore -= criticalDefects.length * 8;
    console.log(`Kritik hata: ${criticalDefects.length}, d√º≈ü√ºm: -${criticalDefects.length * 8} puan`);

    // Teslimat performansƒ± (uygunsuzluk kategorisine g√∂re)
    const deliveryNonconformities = supplierNonconformities.filter(nc => nc.category === 'teslimat');
    deliveryScore -= deliveryNonconformities.length * 7;
    console.log(`Teslimat uygunsuzluƒüu: ${deliveryNonconformities.length}, teslimat skoru d√º≈ü√ºm√º: -${deliveryNonconformities.length * 7} puan`);

    // Son denetim tarihi kontrol√º
    const lastAuditDate = new Date(supplier.lastAuditDate);
    const today = new Date();
    const monthsDiff = (today.getTime() - lastAuditDate.getTime()) / (1000 * 3600 * 24 * 30);
    
    console.log(`Son denetimden ge√ßen ay sayƒ±sƒ±: ${monthsDiff.toFixed(1)}`);
    
    // 12 aydan eski denetim i√ßin puan d√º≈ü√ºrme
    if (monthsDiff > 12) {
      const auditPenalty = Math.min(20, Math.floor(monthsDiff - 12) * 2);
      performanceScore -= auditPenalty;
      console.log(`Eski denetim cezasƒ±: -${auditPenalty} puan`);
    }

    // Risk seviyesine g√∂re ek d√º≈ü√ºrme
    let riskPenalty = 0;
    switch (supplier.riskLevel) {
      case 'kritik':
        riskPenalty = 15;
        break;
      case 'y√ºksek':
        riskPenalty = 10;
        break;
      case 'orta':
        riskPenalty = 5;
        break;
      default:
        break;
    }
    performanceScore -= riskPenalty;
    console.log(`Risk seviyesi (${supplier.riskLevel}) cezasƒ±: -${riskPenalty} puan`);

    // Minimum skor 0, maksimum 100
    qualityScore = Math.max(0, Math.min(100, qualityScore));
    deliveryScore = Math.max(0, Math.min(100, deliveryScore));
    
    // Genel performans skoru (aƒüƒ±rlƒ±klƒ± ortalama)
    performanceScore = Math.round((qualityScore * 0.6 + deliveryScore * 0.4));
    performanceScore = Math.max(0, Math.min(100, performanceScore));

    console.log(`SONU√á - Kalite: ${qualityScore}, Teslimat: ${deliveryScore}, Genel: ${performanceScore}`);
    console.log(`=== HESAPLAMA Bƒ∞TTƒ∞ ===\n`);

    return {
      qualityScore: Math.round(qualityScore),
      deliveryScore: Math.round(deliveryScore),
      performanceScore: Math.round(performanceScore)
    };
  }, [nonconformities, defects]);

  // Tedarik√ßi performanslarƒ±nƒ± g√ºncelleyen fonksiyon
  const updateSupplierPerformances = React.useCallback(() => {
    console.log('üìä Performans g√ºncellemesi ba≈ülƒ±yor...');
    const updatedSuppliers = suppliers.map(supplier => {
      const newScores = calculateSupplierPerformance(supplier);
      console.log(`üéØ ${supplier.name}: Genel ${newScores.performanceScore}, Kalite ${newScores.qualityScore}, Teslimat ${newScores.deliveryScore}`);
      return {
        ...supplier,
        ...newScores
      };
    });
    setSuppliers(updatedSuppliers);
    
    // MANUEL localStorage kaydetme - mod√ºller arasƒ± ge√ßi≈üte veri kaybƒ±nƒ± √∂nlemek i√ßin
    setTimeout(() => {
      localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
      console.log('üíæ G√ºncellenmi≈ü performans skoru localStorage\'a kaydedildi');
      window.dispatchEvent(new Event('supplierDataUpdated'));
    }, 100);
    
    console.log('‚úÖ Performans g√ºncellemesi tamamlandƒ±');
  }, [suppliers, calculateSupplierPerformance]);

  // Radar chart data preparation
  const prepareRadarData = React.useCallback(() => {
    const selectedSuppliers = selectedSuppliersForRadar.length > 0 
      ? suppliers.filter(s => selectedSuppliersForRadar.includes(s.id))
      : suppliers.slice(0, 3); // ƒ∞lk 3 tedarik√ßi default

    // Performans boyutlarƒ±
    const performanceDimensions = [
      { dimension: 'Kalite', key: 'qualityScore' },
      { dimension: 'Teslimat', key: 'deliveryScore' },
      { dimension: 'G√ºvenilirlik', key: 'reliabilityScore' },
      { dimension: 'Maliyet', key: 'costScore' },
      { dimension: 'ƒ∞novasyon', key: 'innovationScore' },
      { dimension: 'S√ºrd√ºr√ºlebilirlik', key: 'sustainabilityScore' }
    ];

    return performanceDimensions.map(dim => {
      const dataPoint: any = { dimension: dim.dimension };
      
      selectedSuppliers.forEach(supplier => {
        let score = 0;
        
        switch(dim.key) {
          case 'qualityScore':
            score = supplier.qualityScore;
            break;
          case 'deliveryScore':
            score = supplier.deliveryScore;
            break;
          case 'reliabilityScore':
            // G√ºvenilirlik: Son denetim tarihi + uygunsuzluk sayƒ±sƒ± bazlƒ±
            const monthsSinceAudit = Math.floor((new Date().getTime() - new Date(supplier.lastAuditDate).getTime()) / (1000 * 60 * 60 * 24 * 30));
            score = Math.max(50, 100 - (monthsSinceAudit * 2) - (supplier.nonconformityCount * 5));
            break;
          case 'costScore':
            // Maliyet performansƒ±: Risk seviyesi + hata maliyeti bazlƒ±
            const riskPenalty = supplier.riskLevel === 'kritik' ? 30 : supplier.riskLevel === 'y√ºksek' ? 20 : supplier.riskLevel === 'orta' ? 10 : 0;
            score = Math.max(40, 95 - riskPenalty - (supplier.defectCount * 3));
            break;
          case 'innovationScore':
            // ƒ∞novasyon: Tedarik√ßi kategorisi ve t√ºr√º bazlƒ±
            const categoryBonus = supplier.category === 'stratejik' ? 20 : supplier.category === 'kritik' ? 15 : 10;
            const typeBonus = supplier.supplyType === 'hibrit' ? 15 : supplier.supplyType === 'hizmet' ? 10 : 5;
            score = Math.min(100, 60 + categoryBonus + typeBonus);
            break;
          case 'sustainabilityScore':
            // S√ºrd√ºr√ºlebilirlik: Tedarik√ßi ya≈üƒ± + sertifikasyon durumu bazlƒ±
            const registrationAge = Math.floor((new Date().getTime() - new Date(supplier.registrationDate).getTime()) / (1000 * 60 * 60 * 24 * 365));
            const ageBonus = Math.min(20, registrationAge * 3);
            score = Math.min(100, 70 + ageBonus);
            break;
          default:
            score = supplier.performanceScore;
        }
        
        dataPoint[supplier.name.split(' ')[0]] = Math.round(score);
      });
      
      return dataPoint;
    });
  }, [suppliers, selectedSuppliersForRadar]);

  // Dashboard component
  const renderDashboard = () => (
    <Grid container spacing={3}>
      {/* KPI Cards */}
      <Grid item xs={12} md={3}>
        <Card>
          <CardContent>
            <Box display="flex" alignItems="center" gap={2}>
              <Avatar sx={{ bgcolor: 'primary.main' }}>
                <BusinessIcon />
              </Avatar>
              <Box>
                <Typography variant="h4" fontWeight="bold">
                  {suppliers.filter(s => s.type === 'onaylƒ±').length}
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Onaylƒ± Tedarik√ßi
                </Typography>
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      <Grid item xs={12} md={3}>
        <Card>
          <CardContent>
            <Box display="flex" alignItems="center" gap={2}>
              <Avatar sx={{ bgcolor: 'warning.main' }}>
                <SwapHorizIcon />
              </Avatar>
              <Box>
                <Typography variant="h4" fontWeight="bold">
                  {suppliers.filter(s => s.type === 'alternatif').length}
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Alternatif Tedarik√ßi
                </Typography>
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      <Grid item xs={12} md={3}>
        <Card>
          <CardContent>
            <Box display="flex" alignItems="center" gap={2}>
              <Avatar sx={{ bgcolor: 'error.main' }}>
                <WarningIcon />
              </Avatar>
              <Box>
                <Typography variant="h4" fontWeight="bold">
                  {nonconformities.filter(nc => nc.status === 'a√ßƒ±k').length}
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  A√ßƒ±k Uygunsuzluk
                </Typography>
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      <Grid item xs={12} md={3}>
        <Card>
          <CardContent>
            <Box display="flex" alignItems="center" gap={2}>
              <Avatar sx={{ bgcolor: 'success.main' }}>
                <AssessmentIcon />
              </Avatar>
              <Box>
                <Typography variant="h4" fontWeight="bold">
                  {Math.round(suppliers.reduce((acc, s) => acc + s.performanceScore, 0) / suppliers.length) || 0}
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Ortalama Performans
                </Typography>
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* Performance Chart */}
      <Grid item xs={12} md={8}>
        <Card>
          <CardHeader title="Tedarik√ßi Performans Kar≈üƒ±la≈ütƒ±rmasƒ±" />
          <CardContent>
            <Box height={300}>
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={suppliers.map(s => ({
                  name: s.name.split(' ')[0],
                  kalite: s.qualityScore,
                  teslimat: s.deliveryScore,
                  genel: s.performanceScore
                }))}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="name" />
                  <YAxis domain={[0, 100]} />
                  <ChartTooltip />
                  <Legend />
                  <Bar dataKey="kalite" fill="#2196f3" name="Kalite" />
                  <Bar dataKey="teslimat" fill="#4caf50" name="Teslimat" />
                  <Bar dataKey="genel" fill="#9c27b0" name="Genel Performans" />
                </BarChart>
              </ResponsiveContainer>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* Risk Distribution - Professional Chart */}
      <Grid item xs={12} md={4}>
        <Card elevation={4} sx={{ borderRadius: 3 }}>
          <CardHeader 
            title="Risk Daƒüƒ±lƒ±mƒ±" 
            titleTypographyProps={{ 
              variant: 'h6', 
              fontWeight: 600, 
              color: 'primary.main' 
            }}
            sx={{ 
              background: 'linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%)',
              color: 'primary.main'
            }}
          />
          <CardContent>
            <Box height={280}>
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie
                    dataKey="value"
                    data={[
                      { name: 'D√º≈ü√ºk', shortName: 'D', value: suppliers.filter(s => s.riskLevel === 'd√º≈ü√ºk').length, fill: '#2e7d32' },
                      { name: 'Orta', shortName: 'O', value: suppliers.filter(s => s.riskLevel === 'orta').length, fill: '#ed6c02' },
                      { name: 'Y√ºksek', shortName: 'Y', value: suppliers.filter(s => s.riskLevel === 'y√ºksek').length, fill: '#d32f2f' },
                      { name: 'Kritik', shortName: 'K', value: suppliers.filter(s => s.riskLevel === 'kritik').length, fill: '#b71c1c' }
                    ].filter(item => item.value > 0)}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ value, percent }) => 
                      value > 0 ? `${value} (${(percent * 100).toFixed(0)}%)` : null
                    }
                    outerRadius={85}
                    innerRadius={30}
                    paddingAngle={2}
                    strokeWidth={2}
                    stroke="#fff"
                  >
                    {[
                      { fill: '#2e7d32' },
                      { fill: '#ed6c02' },
                      { fill: '#d32f2f' },
                      { fill: '#b71c1c' }
                    ].map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.fill} />
                    ))}
                  </Pie>
                  <ChartTooltip 
                    formatter={(value: any, name: any) => [`${value} Tedarik√ßi`, name]}
                    labelStyle={{ color: '#333', fontWeight: 'bold' }}
                    contentStyle={{ 
                      backgroundColor: 'rgba(255, 255, 255, 0.96)',
                      border: '1px solid #ddd',
                      borderRadius: '12px',
                      boxShadow: '0 4px 12px rgba(0,0,0,0.15)'
                    }}
                  />
                  <Legend 
                    verticalAlign="bottom" 
                    height={30}
                    formatter={(value) => <span style={{ color: '#444', fontWeight: 500, fontSize: '12px' }}>{value}</span>}
                    iconType="circle"
                    wrapperStyle={{ fontSize: '12px', paddingTop: '10px' }}
                  />
                </PieChart>
              </ResponsiveContainer>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* Urgent Actions */}
      <Grid item xs={12}>
        <Card>
          <CardHeader title="Acil Aksiyonlar" />
          <CardContent>
            <List>
              {suppliers
                .filter(s => {
                  const auditOverdue = new Date(s.nextAuditDate) < new Date();
                  const lowPerformance = s.performanceScore < 70;
                  const openNonconformities = nonconformities.filter(nc => nc.supplierId === s.id && nc.status === 'a√ßƒ±k').length > 0;
                  return auditOverdue || lowPerformance || openNonconformities;
                })
                .map(supplier => (
                  <ListItem key={supplier.id} divider>
                    <ListItemIcon>
                      <WarningIcon color="error" />
                    </ListItemIcon>
                    <ListItemText
                      primary={supplier.name}
                      secondary={
                        <Box>
                          {new Date(supplier.nextAuditDate) < new Date() && (
                            <Chip size="small" color="error" label="Denetim Gecikmi≈ü" sx={{ mr: 1, mb: 0.5 }} />
                          )}
                          {supplier.performanceScore < 70 && (
                            <Chip size="small" color="warning" label="D√º≈ü√ºk Performans" sx={{ mr: 1, mb: 0.5 }} />
                          )}
                          {nonconformities.filter(nc => nc.supplierId === supplier.id && nc.status === 'a√ßƒ±k').length > 0 && (
                            <Chip size="small" color="error" label="A√ßƒ±k Uygunsuzluk" sx={{ mr: 1, mb: 0.5 }} />
                          )}
                        </Box>
                      }
                    />
                    <Button size="small" color="primary" onClick={() => {
                      setSelectedItem(supplier);
                      setDialogType('supplier');
                      setDialogOpen(true);
                    }}>
                      ƒ∞ncele
                    </Button>
                  </ListItem>
                ))}
              {suppliers.filter(s => {
                const auditOverdue = new Date(s.nextAuditDate) < new Date();
                const lowPerformance = s.performanceScore < 70;
                const openNonconformities = nonconformities.filter(nc => nc.supplierId === s.id && nc.status === 'a√ßƒ±k').length > 0;
                return auditOverdue || lowPerformance || openNonconformities;
              }).length === 0 && (
                <ListItem>
                  <ListItemIcon>
                    <CheckCircleIcon color="success" />
                  </ListItemIcon>
                  <ListItemText primary="Acil aksiyon gerektiren durum bulunmuyor" />
                </ListItem>
              )}
            </List>
          </CardContent>
        </Card>
      </Grid>
    </Grid>
  );

  // Supplier Pairing Component
  const renderSupplierPairing = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Button variant="contained" startIcon={<LinkIcon />} onClick={handleCreatePair}>
          Yeni E≈üle≈ütirme
        </Button>
      </Box>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>Malzeme T√ºr√º</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Ana Tedarik√ßi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Alternatif Tedarik√ßi(ler)</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Performans Kar≈üƒ±la≈ütƒ±rmasƒ±</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Son Deƒüerlendirme</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>ƒ∞≈ülemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {supplierPairs.map((pair) => (
              <TableRow key={pair.id}>
                <TableCell>
                  <Chip 
                    label={pair.materialType} 
                    color="primary" 
                    variant="outlined" 
                    size="small" 
                  />
                </TableCell>
                <TableCell>
                  <Box>
                    <Typography variant="body2" fontWeight="bold">
                      {pair.primarySupplier.name}
                    </Typography>
                    <Box display="flex" alignItems="center" gap={1} mt={0.5}>
                      <Chip 
                        label={`${pair.performanceComparison.primaryScore}%`} 
                        color="success" 
                        size="small" 
                      />
                      <Typography variant="caption" color="text.secondary">
                        Ana Performans
                      </Typography>
                    </Box>
                  </Box>
                </TableCell>
                <TableCell>
                  {pair.alternativeSuppliers.map((altSupplier, index) => (
                    <Box key={altSupplier.id} mb={index < pair.alternativeSuppliers.length - 1 ? 1 : 0}>
                      <Typography variant="body2" fontWeight="bold">
                        {altSupplier.name}
                      </Typography>
                      <Box display="flex" alignItems="center" gap={1} mt={0.5}>
                        <Chip 
                          label={`${pair.performanceComparison.alternativeScores.find(s => s.id === altSupplier.id)?.score || 0}%`} 
                          color="warning" 
                          size="small" 
                        />
                        <Typography variant="caption" color="text.secondary">
                          Alt. Performans
                        </Typography>
                      </Box>
                    </Box>
                  ))}
                </TableCell>
                <TableCell>
                  <Box>
                    <Typography variant="body2" fontWeight="bold" color={
                      pair.performanceComparison.primaryScore > 
                      Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                        ? 'success.main' : 'warning.main'
                    }>
                      {pair.performanceComparison.primaryScore > 
                       Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                        ? 'Ana Tedarik√ßi √úst√ºn' : 'Alternatif Deƒüerlendir'}
                    </Typography>
                    <Typography variant="caption" color="text.secondary">
                      {pair.performanceComparison.recommendation}
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell>
                  <Typography variant="body2">
                    {new Date(pair.lastReviewDate).toLocaleDateString('tr-TR')}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Sonraki: {new Date(pair.nextReviewDate).toLocaleDateString('tr-TR')}
                  </Typography>
                </TableCell>
                <TableCell>
                  <Box display="flex" gap={1}>
                    <Tooltip title="Performans Analizi">
                      <IconButton 
                        size="small" 
                        color="primary" 
                        onClick={() => {
                          showSnackbar(`${pair.primarySupplier.name} vs ${pair.alternativeSuppliers[0]?.name || 'Alternatif'} performans kar≈üƒ±la≈ütƒ±rmasƒ±`, 'info');
                          // Performance Analysis Dialog could be opened here in future
                          setCurrentTab(6); // Navigate to Performance Analysis tab
                        }}
                      >
                        <AssessmentIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="D√ºzenle">
                      <IconButton size="small" color="info" onClick={() => handleEditItem(pair, 'pair')}>
                        <EditIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="Tedarik√ßi Deƒüi≈ütir">
                      <IconButton 
                        size="small" 
                        color="warning" 
                        onClick={() => {
                          // Tedarik√ßileri dinamik olarak deƒüi≈ütir
                          if (pair.alternativeSuppliers.length > 0) {
                            const updatedPair = {
                              ...pair,
                              primarySupplier: pair.alternativeSuppliers[0], // ƒ∞lk alternatif ana olur
                              alternativeSuppliers: [pair.primarySupplier], // Eski ana alternatif olur
                              performanceComparison: {
                                primaryScore: pair.alternativeSuppliers[0].performanceScore,
                                alternativeScores: [{ id: pair.primarySupplier.id, score: pair.primarySupplier.performanceScore }],
                                recommendation: pair.alternativeSuppliers[0].performanceScore >= pair.primarySupplier.performanceScore 
                                  ? 'Yeni ana tedarik√ßi performansƒ± √ºst√ºn' 
                                  : 'Eski ana tedarik√ßi performansƒ± daha iyi'
                              },
                              lastReviewDate: new Date().toISOString().split('T')[0]
                            };
                            
                            // Supplier pairs'i g√ºncelle
                            setSupplierPairs(supplierPairs.map(p => 
                              p.id === pair.id ? updatedPair : p
                            ));
                            
                            showSnackbar(`${pair.primarySupplier.name} ‚Üí ${pair.alternativeSuppliers[0].name} tedarik√ßi deƒüi≈üimi tamamlandƒ±`, 'success');
                          } else {
                            showSnackbar('Bu e≈üle≈ütirmede alternatif tedarik√ßi bulunmuyor', 'warning');
                          }
                        }}
                      >
                        <SwapHorizIcon />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
  );

  // Supplier List Component
  const renderSupplierList = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Box display="flex" gap={2}>
          <TextField
            size="small"
            placeholder="Tedarik√ßi ara..."
            InputProps={{ endAdornment: <SearchIcon /> }}
          />
          <FormControl size="small" sx={{ minWidth: 120 }}>
            <InputLabel>T√ºr</InputLabel>
            <Select defaultValue="all">
              <MenuItem value="all">T√ºm√º</MenuItem>
              <MenuItem value="onaylƒ±">Onaylƒ±</MenuItem>
              <MenuItem value="alternatif">Alternatif</MenuItem>
              <MenuItem value="potansiyel">Potansiyel</MenuItem>
            </Select>
          </FormControl>
        </Box>
      </Box>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>Tedarik√ßi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>T√ºr</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Kategori</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Performans</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Son Denetim</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Durum</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>ƒ∞≈ülemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {suppliers.map((supplier) => (
              <TableRow key={supplier.id}>
                <TableCell>
                  <Box>
                    <Typography variant="body2" fontWeight="bold">
                      {supplier.name}
                    </Typography>
                    <Typography variant="caption" color="text.secondary">
                      {supplier.code} ‚Ä¢ {supplier.contact.contactPerson}
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell>
                  <Chip 
                    label={supplier.type.charAt(0).toUpperCase() + supplier.type.slice(1)} 
                    color={supplier.type === 'onaylƒ±' ? 'success' : 'warning'}
                    size="small"
                  />
                </TableCell>
                <TableCell>
                  <Chip 
                    label={supplier.category.charAt(0).toUpperCase() + supplier.category.slice(1)} 
                    variant="outlined"
                    size="small"
                  />
                </TableCell>
                <TableCell>
                  <Box display="flex" alignItems="center" gap={1}>
                    <Box 
                      width={60} 
                      height={8} 
                      bgcolor="grey.300" 
                      borderRadius={1}
                      overflow="hidden"
                    >
                      <Box 
                        width={`${supplier.performanceScore}%`}
                        height="100%"
                        bgcolor={getPerformanceColor(supplier.performanceScore)}
                      />
                    </Box>
                    <Typography variant="body2" fontWeight="bold">
                      {supplier.performanceScore}%
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell>
                  <Typography variant="body2">
                    {new Date(supplier.lastAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Sonraki: {new Date(supplier.nextAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                </TableCell>
                <TableCell>
                  <Chip 
                    label={supplier.status.charAt(0).toUpperCase() + supplier.status.slice(1)}
                    color={supplier.status === 'aktif' ? 'success' : 'error'}
                    size="small"
                  />
                </TableCell>
                <TableCell>
                  <Box display="flex" gap={1}>
                    <Tooltip title="G√∂r√ºnt√ºle">
                      <IconButton 
                        size="small" 
                        color="primary" 
                        onClick={() => {
                          setSelectedItem(supplier);
                          setDialogType('supplier');
                          setFormData(supplier);
                          setDialogOpen(true);
                        }}
                      >
                        <ViewIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="D√ºzenle">
                      <IconButton size="small" color="info" onClick={() => handleEditItem(supplier, 'supplier')}>
                        <EditIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="D√ñF Olu≈ütur">
                      <IconButton size="small" color="warning" onClick={() => createDOFFromNonconformity({ 
                        id: 'temp', 
                        supplierId: supplier.id, 
                        title: `${supplier.name} i√ßin uygunsuzluk`,
                        description: 'Tedarik√ßi kaynaklƒ± uygunsuzluk',
                        category: 'kalite',
                        severity: 'orta',
                        detectedDate: new Date().toISOString().split('T')[0],
                        status: 'a√ßƒ±k',
                        dueDate: '',
                        correctionCost: 0,
                        recurrence: false,
                        partCode: 'TEMP-001' // Zorunlu alan eklendi
                      })}>
                        <ReportIcon />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
  );

  // Audit Tracking Component
  const renderAuditTracking = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Box display="flex" gap={2}>
          <Button 
            variant="outlined" 
            startIcon={<AssessmentIcon />} 
            onClick={generateAutoAuditRecommendations}
            color="info"
          >
            Otomatik Analiz
          </Button>
          <Button variant="contained" startIcon={<ScheduleIcon />} onClick={handleCreateAudit}>
            Denetim Planla
          </Button>
        </Box>
      </Box>

      {/* Otomatik Denetim √ñnerileri */}
      {autoAuditRecommendations.length > 0 && (
        <Paper elevation={1} sx={{ p: 2.5, mb: 3, border: '1px solid', borderColor: 'divider' }}>
          <Box display="flex" alignItems="center" gap={1} mb={2}>
            <AssessmentIcon color="primary" fontSize="small" />
            <Typography variant="subtitle1" fontWeight={600}>
              Otomatik Denetim √ñnerileri
            </Typography>
            <Chip 
              size="small" 
              label={autoAuditRecommendations.length} 
              color="primary" 
              sx={{ height: 20, fontSize: '0.7rem' }}
            />
          </Box>
          
          <Grid container spacing={2}>
            {autoAuditRecommendations.slice(0, 3).map(recommendation => (
              <Grid item xs={12} sm={6} md={4} key={recommendation.id}>
                <Paper 
                  elevation={0} 
                  sx={{ 
                    p: 2, 
                    border: '1px solid', 
                    borderColor: 'grey.200',
                    borderRadius: 2,
                    height: '100%',
                    transition: 'all 0.2s ease',
                    '&:hover': { 
                      boxShadow: 2,
                      borderColor: 'primary.main'
                    }
                  }}
                >
                  <Box display="flex" alignItems="center" gap={1} mb={1.5}>
                    <Chip 
                      size="small" 
                      label={
                        recommendation.urgencyLevel === 'kritik' ? 'Kritik' :
                        recommendation.urgencyLevel === 'y√ºksek' ? 'Y√ºksek' :
                        recommendation.urgencyLevel === 'orta' ? 'Orta' : 'D√º≈ü√ºk'
                      } 
                      color={
                        recommendation.urgencyLevel === 'kritik' ? 'error' :
                        recommendation.urgencyLevel === 'y√ºksek' ? 'warning' :
                        recommendation.urgencyLevel === 'orta' ? 'info' : 'default'
                      }
                      sx={{ fontSize: '0.7rem', height: 22 }}
                    />
                  </Box>
                  
                  <Typography 
                    variant="subtitle2" 
                    sx={{ 
                      fontSize: '0.95rem', 
                      fontWeight: 600, 
                      mb: 1.5,
                      lineHeight: 1.3,
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      WebkitBoxOrient: 'vertical',
                      overflow: 'hidden'
                    }}
                  >
                    {recommendation.supplierName}
                  </Typography>
                  
                  <Box display="flex" justifyContent="center" mb={1}>
                    <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8rem' }}>
                      Performans: {recommendation.currentScore}
                    </Typography>
                  </Box>
                  
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8rem', mb: 2 }}>
                    Tarih: {new Date(recommendation.recommendedDate).toLocaleDateString('tr-TR', { 
                      day: '2-digit', 
                      month: 'short',
                      year: '2-digit'
                    })}
                  </Typography>
                  
                  <Box display="flex" gap={1}>
                    <Button 
                      size="small" 
                      variant="contained" 
                      color="primary"
                      onClick={() => acceptAuditRecommendation(recommendation)}
                      sx={{ 
                        fontSize: '0.75rem', 
                        py: 0.5, 
                        px: 1.5, 
                        flex: 1,
                        textTransform: 'none'
                      }}
                    >
                      Kabul Et
                    </Button>
                    <Button 
                      size="small" 
                      variant="outlined" 
                      color="error"
                      onClick={() => rejectAuditRecommendation(recommendation.id)}
                      sx={{ 
                        fontSize: '0.75rem', 
                        py: 0.5, 
                        px: 1.5,
                        textTransform: 'none'
                      }}
                    >
                      Reddet
                    </Button>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
          
          {autoAuditRecommendations.length > 3 && (
            <Box mt={2} textAlign="center">
              <Typography variant="body2" color="primary.main" sx={{ fontSize: '0.85rem', fontWeight: 500 }}>
                +{autoAuditRecommendations.length - 3} √∂neri daha (a≈üaƒüƒ±daki detaylƒ± tabloda g√∂r√ºnt√ºlenebilir)
              </Typography>
            </Box>
          )}
        </Paper>
      )}

      <Grid container spacing={3}>
        {/* Yakla≈üan Denetimler - D√úZELTME: audits array'inden veriler √ßekiliyor */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardHeader title="Yakla≈üan Denetimler" />
            <CardContent>
              <List>
                {audits
                  .filter(a => {
                    const auditDate = new Date(a.auditDate);
                    const today = new Date();
                    const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                    return a.status === 'planlƒ±' && daysDiff <= 90;
                  })
                  .sort((a, b) => new Date(a.auditDate).getTime() - new Date(b.auditDate).getTime())
                  .map(audit => {
                    const auditDate = new Date(audit.auditDate);
                    const today = new Date();
                    const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                    const supplier = suppliers.find(s => s.id === audit.supplierId);
                    
                    return (
                      <ListItem key={audit.id} divider>
                        <ListItemIcon>
                          <ScheduleIcon color={daysDiff <= 30 ? 'error' : 'warning'} />
                        </ListItemIcon>
                        <ListItemText
                          primary={supplier ? supplier.name : 'Bilinmiyor'}
                          secondary={
                            <Box>
                              <Typography variant="body2">
                                Denetim Tarihi: {auditDate.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                              </Typography>
                              <Typography variant="body2" color="text.secondary">
                                Denet√ßi: {audit.auditorName || 'Atanmadƒ±'}
                              </Typography>
                              <Chip 
                                size="small" 
                                label={daysDiff <= 0 ? 'Gecikmi≈ü' : `${daysDiff} g√ºn kaldƒ±`}
                                color={daysDiff <= 0 ? 'error' : daysDiff <= 30 ? 'warning' : 'info'}
                              />
                            </Box>
                          }
                        />
                        <Box display="flex" gap={1}>
                          <Button 
                            size="small" 
                            variant="outlined"
                            color="primary"
                            onClick={() => {
                              if (supplier) {
                                scheduleAutoAudit(supplier);
                                showSnackbar(`${supplier.name} denetimi ba≈ülatƒ±ldƒ±`, 'success');
                              }
                            }}
                          >
                            Denetle
                          </Button>
                          <IconButton 
                            size="small" 
                            color="info"
                            onClick={() => handleEditItem(audit, 'audit')}
                            sx={{ border: '1px solid', borderColor: 'info.main' }}
                          >
                            <EditIcon sx={{ fontSize: 16 }} />
                          </IconButton>
                        </Box>
                      </ListItem>
                    );
                  })}
                {audits.filter(a => {
                  const auditDate = new Date(a.auditDate);
                  const today = new Date();
                  const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                  return a.status === 'planlƒ±' && daysDiff <= 90;
                }).length === 0 && (
                  <ListItem>
                    <ListItemText
                      primary={
                        <Box textAlign="center" py={2}>
                          <Typography variant="body2" color="text.secondary">
                            Yakla≈üan 90 g√ºn i√ßinde planlanan denetim bulunmuyor
                          </Typography>
                          <Button 
                            size="small" 
                            startIcon={<ScheduleIcon />} 
                            onClick={handleCreateAudit}
                            sx={{ mt: 1 }}
                          >
                            Denetim Planla
                          </Button>
                        </Box>
                      }
                    />
                  </ListItem>
                )}
              </List>
            </CardContent>
          </Card>
        </Grid>

        {/* Audit Statistics - D√úZELTME: audits array'inden veriler √ßekiliyor */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardHeader title="Denetim ƒ∞statistikleri" />
            <CardContent>
              <Grid container spacing={2}>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="success.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="success.main">
                      {audits.filter(a => a.status === 'tamamlandƒ±').length}
                    </Typography>
                    <Typography variant="body2">Tamamlanan</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="warning.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="warning.main">
                      {audits.filter(a => a.status === 'planlƒ±').length}
                    </Typography>
                    <Typography variant="body2">Planlanan</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="error.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="error.main">
                      {audits.filter(a => {
                        const auditDate = new Date(a.auditDate);
                        const today = new Date();
                        return a.status === 'planlƒ±' && auditDate < today;
                      }).length}
                    </Typography>
                    <Typography variant="body2">Gecikmi≈ü</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="info.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="info.main">
                      {audits.length}
                    </Typography>
                    <Typography variant="body2">Toplam</Typography>
                  </Box>
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        </Grid>

        {/* Planlanan Denetimler Tablosu */}
        <Grid item xs={12}>
          <Card>
            <CardHeader 
              title="Planlanan Denetimler" 
              action={
                <Chip 
                  size="small" 
                  label={`${audits.filter(a => a.status === 'planlƒ±').length} denetim`} 
                  color="info"
                />
              }
            />
            <CardContent sx={{ p: 0 }}>
              <TableContainer sx={{ maxHeight: 400 }}>
                <Table size="small" stickyHeader>
                  <TableHead>
                    <TableRow sx={{ '& > .MuiTableCell-root': { bgcolor: 'info.50', fontWeight: 600, fontSize: '0.75rem', py: 1 } }}>
                      <TableCell sx={{ width: 250 }}>Tedarik√ßi</TableCell>
                      <TableCell align="center" sx={{ width: 150 }}>Tarih</TableCell>
                      <TableCell align="center" sx={{ width: 120 }}>T√ºr</TableCell>
                      <TableCell sx={{ width: 200 }}>Denet√ßi</TableCell>
                      <TableCell align="center" sx={{ width: 120 }}>ƒ∞≈ülem</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {audits
                      .filter(audit => audit.status === 'planlƒ±')
                      .sort((a, b) => new Date(a.auditDate).getTime() - new Date(b.auditDate).getTime())
                      .map(audit => {
                        const supplier = suppliers.find(s => s.id === audit.supplierId);
                        const auditDate = new Date(audit.auditDate);
                        const today = new Date();
                        const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                        
                        return (
                          <TableRow key={audit.id} hover sx={{ '& > .MuiTableCell-root': { py: 1, px: 1 } }}>
                            <TableCell sx={{ width: 250 }}>
                              <Box>
                                <Typography 
                                  variant="body2" 
                                  fontWeight={500} 
                                  sx={{ 
                                    fontSize: '0.85rem'
                                  }}
                                  title={supplier ? supplier.name : 'Bilinmiyor'}
                                >
                                  {supplier ? supplier.name : 'Bilinmiyor'}
                                </Typography>
                                <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.75rem' }}>
                                  {supplier ? supplier.code : audit.supplierId}
                                </Typography>
                              </Box>
                            </TableCell>
                            <TableCell align="center" sx={{ width: 150 }}>
                              <Box textAlign="center">
                                <Typography variant="body2" sx={{ fontSize: '0.8rem' }}>
                                  {auditDate.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                                </Typography>
                                <Chip 
                                  size="small" 
                                  label={daysDiff <= 0 ? 'Gecikmi≈ü' : `${daysDiff} g√ºn kaldƒ±`}
                                  color={daysDiff <= 0 ? 'error' : daysDiff <= 7 ? 'warning' : 'success'}
                                  sx={{ height: 20, fontSize: '0.7rem', minWidth: 80 }}
                                />
                              </Box>
                            </TableCell>
                            <TableCell align="center" sx={{ width: 120 }}>
                              <Chip 
                                size="small" 
                                label={
                                  audit.auditType === 'planlƒ±' ? 'Planlƒ±' :
                                  audit.auditType === 'ani' ? 'Ani' :
                                  audit.auditType === 'takip' ? 'Takip' : 'Acil'
                                }
                                variant="outlined"
                                color={
                                  audit.auditType === 'acil' ? 'error' :
                                  audit.auditType === 'ani' ? 'warning' :
                                  audit.auditType === 'takip' ? 'info' : 'default'
                                }
                                sx={{ height: 24, fontSize: '0.75rem', minWidth: 65 }}
                              />
                            </TableCell>
                            <TableCell sx={{ width: 200 }}>
                              <Typography 
                                variant="body2" 
                                sx={{ 
                                  fontSize: '0.8rem'
                                }}
                                title={audit.auditorName || 'Atanmadƒ±'}
                              >
                                {audit.auditorName || 'Atanmadƒ±'}
                              </Typography>
                            </TableCell>
                            <TableCell align="center" sx={{ width: 120 }}>
                              <Box display="flex" justifyContent="center" gap={0.5}>
                                <Tooltip title="D√ºzenle">
                                  <IconButton 
                                    size="small" 
                                    color="primary"
                                    onClick={() => handleEditItem(audit, 'audit')}
                                    sx={{ width: 24, height: 24 }}
                                  >
                                    <EditIcon sx={{ fontSize: 12 }} />
                                  </IconButton>
                                </Tooltip>
                                <Tooltip title="Sil">
                                  <IconButton 
                                    size="small" 
                                    color="error"
                                    onClick={() => handleDeleteItem(audit.id, 'audit')}
                                    sx={{ width: 24, height: 24 }}
                                  >
                                    <DeleteIcon sx={{ fontSize: 12 }} />
                                  </IconButton>
                                </Tooltip>
                              </Box>
                            </TableCell>
                          </TableRow>
                        );
                      })}
                    {audits.filter(a => a.status === 'planlƒ±').length === 0 && (
                      <TableRow>
                        <TableCell colSpan={5} align="center" sx={{ py: 3 }}>
                          <Typography variant="body2" color="text.secondary">
                            Hen√ºz planlanan denetim bulunmuyor
                          </Typography>
                          <Button 
                            size="small" 
                            startIcon={<ScheduleIcon />} 
                            onClick={handleCreateAudit}
                            sx={{ mt: 1 }}
                          >
                            ƒ∞lk Denetimi Planla
                          </Button>
                        </TableCell>
                      </TableRow>
                    )}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        {/* Detaylƒ± Denetim √ñnerileri Tablosu */}
        {autoAuditRecommendations.length > 0 && (
          <Grid item xs={12}>
            <Card elevation={1} sx={{ border: '1px solid', borderColor: 'divider' }}>
              <Box sx={{ p: 2, borderBottom: '1px solid', borderColor: 'divider' }}>
                <Box display="flex" alignItems="center" justifyContent="space-between">
                  <Box display="flex" alignItems="center" gap={1}>
                    <AssessmentIcon color="primary" fontSize="small" />
                    <Typography variant="h6" fontWeight={600}>
                      Detaylƒ± Denetim √ñnerileri
                    </Typography>
                    <Chip 
                      size="small" 
                      label={`${autoAuditRecommendations.length} √∂neri`} 
                      color="primary" 
                      sx={{ height: 22, fontSize: '0.75rem' }}
                    />
                  </Box>
                  <Button 
                    variant="outlined" 
                    size="small"
                    onClick={() => setAutoAuditRecommendations([])}
                    sx={{ textTransform: 'none' }}
                  >
                    T√ºm√ºn√º Temizle
                  </Button>
                </Box>
              </Box>
              
              <TableContainer sx={{ maxHeight: 450 }}>
                <Table size="small" stickyHeader>
                  <TableHead>
                    <TableRow sx={{ '& > .MuiTableCell-root': { bgcolor: 'grey.50', fontWeight: 600 } }}>
                      <TableCell sx={{ minWidth: 180, fontSize: '0.85rem' }}>Tedarik√ßi</TableCell>
                      <TableCell align="center" sx={{ width: 90, fontSize: '0.85rem' }}>Aciliyet</TableCell>
                      <TableCell align="center" sx={{ width: 80, fontSize: '0.85rem' }}>Puan</TableCell>
                      <TableCell align="center" sx={{ width: 100, fontSize: '0.85rem' }}>Tarih</TableCell>
                      <TableCell align="center" sx={{ width: 110, fontSize: '0.85rem' }}>Sorun</TableCell>
                      <TableCell align="center" sx={{ width: 120, fontSize: '0.85rem' }}>ƒ∞≈ülemler</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {autoAuditRecommendations.map(recommendation => (
                      <TableRow 
                        key={recommendation.id} 
                        hover 
                        sx={{ 
                          '&:hover': { bgcolor: 'action.hover' },
                          '&:nth-of-type(even)': { bgcolor: 'grey.25' }
                        }}
                      >
                        <TableCell sx={{ py: 1.5 }}>
                          <Box>
                            <Typography 
                              variant="body2" 
                              fontWeight={500} 
                              sx={{ 
                                fontSize: '0.85rem',
                                display: '-webkit-box',
                                WebkitLineClamp: 1,
                                WebkitBoxOrient: 'vertical',
                                overflow: 'hidden'
                              }}
                            >
                              {recommendation.supplierName}
                            </Typography>
                            <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.7rem' }}>
                              ID: {recommendation.supplierId}
                            </Typography>
                          </Box>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Chip 
                            size="small" 
                            label={
                              recommendation.urgencyLevel === 'kritik' ? 'Kritik' :
                              recommendation.urgencyLevel === 'y√ºksek' ? 'Y√ºksek' :
                              recommendation.urgencyLevel === 'orta' ? 'Orta' : 'D√º≈ü√ºk'
                            } 
                            color={
                              recommendation.urgencyLevel === 'kritik' ? 'error' :
                              recommendation.urgencyLevel === 'y√ºksek' ? 'warning' :
                              recommendation.urgencyLevel === 'orta' ? 'info' : 'default'
                            }
                            sx={{ 
                              height: 24, 
                              fontSize: '0.7rem', 
                              fontWeight: 500,
                              minWidth: 65
                            }}
                          />
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Box textAlign="center">
                            <Typography 
                              variant="body2" 
                              fontWeight={600} 
                              sx={{ 
                                fontSize: '0.85rem',
                                color: recommendation.currentScore < 70 ? 'error.main' : 
                                      recommendation.currentScore < 80 ? 'warning.main' : 'success.main'
                              }}
                            >
                              {recommendation.currentScore}
                            </Typography>
                            <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.65rem' }}>
                              /{recommendation.previousScore}
                            </Typography>
                          </Box>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                            {new Date(recommendation.recommendedDate).toLocaleDateString('tr-TR', { 
                              day: '2-digit', 
                              month: '2-digit' 
                            })}
                          </Typography>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Tooltip 
                            title={`Performans sorunlarƒ±: ${recommendation.performanceIssues.join(', ')} ‚Ä¢ Risk fakt√∂rleri: ${recommendation.riskFactors.join(', ')}`}
                            placement="top"
                            arrow
                          >
                            <Box textAlign="center" sx={{ cursor: 'help' }}>
                              <Typography 
                                variant="body2" 
                                sx={{ 
                                  fontSize: '0.8rem', 
                                  fontWeight: 600,
                                  color: recommendation.performanceIssues.length > 2 ? 'error.main' : 'warning.main'
                                }}
                              >
                                {recommendation.performanceIssues.length}
                              </Typography>
                              <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.65rem' }}>
                                sorun
                              </Typography>
                            </Box>
                          </Tooltip>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Box display="flex" justifyContent="center" gap={1}>
                            <Tooltip title="Denetimi Kabul Et">
                              <IconButton 
                                size="small" 
                                color="primary"
                                onClick={() => acceptAuditRecommendation(recommendation)}
                                sx={{ 
                                  width: 32, 
                                  height: 32,
                                  border: '1px solid',
                                  borderColor: 'primary.main',
                                  '&:hover': { bgcolor: 'primary.50' }
                                }}
                              >
                                <CheckCircleIcon sx={{ fontSize: 18 }} />
                              </IconButton>
                            </Tooltip>
                            <Tooltip title="Reddet">
                              <IconButton 
                                size="small" 
                                color="error"
                                onClick={() => rejectAuditRecommendation(recommendation.id)}
                                sx={{ 
                                  width: 32, 
                                  height: 32,
                                  border: '1px solid',
                                  borderColor: 'error.main',
                                  '&:hover': { bgcolor: 'error.50' }
                                }}
                              >
                                <DeleteIcon sx={{ fontSize: 18 }} />
                              </IconButton>
                            </Tooltip>
                          </Box>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
              
              {/* √ñzet ƒ∞statistikler */}
              <Box mt={2} p={2} bgcolor="grey.50" borderRadius={1}>
                <Typography variant="subtitle2" gutterBottom sx={{ mb: 1, fontSize: '0.85rem' }}>
                  Aciliyet Daƒüƒ±lƒ±mƒ±
                </Typography>
                <Grid container spacing={1}>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="error.50" borderRadius={1}>
                      <Typography variant="h6" color="error.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'kritik').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Kritik</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="warning.50" borderRadius={1}>
                      <Typography variant="h6" color="warning.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'y√ºksek').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Y√ºksek</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="info.50" borderRadius={1}>
                      <Typography variant="h6" color="info.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'orta').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Orta</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="primary.50" borderRadius={1}>
                      <Typography variant="h6" color="primary.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Toplam</Typography>
                    </Box>
                  </Grid>
                </Grid>
              </Box>
            </Card>
          </Grid>
        )}
      </Grid>
    </Box>
  );

  // Nonconformity Management Component
  const renderNonconformityManagement = () => {
    console.log('üîç renderNonconformityManagement √ßaƒürƒ±ldƒ±');
    console.log('Nonconformities data:', nonconformities);
    console.log('Suppliers data:', suppliers);
    console.log('dataLoaded:', dataLoaded);
    console.log('isLoading:', isLoading);
    
    if (!dataLoaded) {
      return (
        <Box display="flex" justifyContent="center" alignItems="center" minHeight="200px">
          <CircularProgress />
          <Typography variant="body2" sx={{ ml: 2 }}>
            Uygunsuzluk verileri y√ºkleniyor...
          </Typography>
        </Box>
      );
    }
    
    return (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Button variant="contained" startIcon={<BugReportIcon />} onClick={handleCreateNonconformity}>
          Uygunsuzluk Kaydet
        </Button>
      </Box>

      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'error.main' }}>
                  <BugReportIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.status === 'a√ßƒ±k').length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    A√ßƒ±k Uygunsuzluk
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'warning.main' }}>
                  <SecurityIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.severity === 'kritik').length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    Kritik Uygunsuzluk
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'info.main' }}>
                  <ReportIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.dofId).length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    D√ñF Olu≈üturulan
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'success.main' }}>
                  <CheckCircleIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {Math.round((nonconformities.filter(nc => nc.status === 'kapalƒ±').length / nonconformities.length) * 100) || 0}%
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    √á√∂z√ºm Oranƒ±
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>Ba≈ülƒ±k</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tedarik√ßi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Kategori</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>√ñnem</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Durum</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tespit Tarihi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>ƒ∞≈ülemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {nonconformities.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} sx={{ textAlign: 'center', py: 4 }}>
                  <Typography color="text.secondary">
                    Hen√ºz uygunsuzluk kaydƒ± bulunmamaktadƒ±r
                  </Typography>
                  <Button 
                    variant="contained" 
                    startIcon={<BugReportIcon />}
                    sx={{ mt: 2 }}
                    onClick={() => {
                      setDialogType('nonconformity');
                      setDialogOpen(true);
                    }}
                  >
                    ƒ∞lk Uygunsuzluƒüu Kaydet
                  </Button>
                </TableCell>
              </TableRow>
            ) : (
              nonconformities.map((nonconformity) => (
                <TableRow key={nonconformity.id}>
                  <TableCell>
                    <Box>
                      <Typography variant="body2" fontWeight="bold">
                        {nonconformity.title}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {nonconformity.description.length > 50 
                          ? `${nonconformity.description.substring(0, 50)}...` 
                          : nonconformity.description}
                      </Typography>
                    </Box>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {suppliers.find(s => s.id === nonconformity.supplierId)?.name || 'Bilinmiyor'}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.category.charAt(0).toUpperCase() + nonconformity.category.slice(1)}
                      variant="outlined"
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.severity.charAt(0).toUpperCase() + nonconformity.severity.slice(1)}
                      color={
                        nonconformity.severity === 'kritik' ? 'error' : 
                        nonconformity.severity === 'y√ºksek' ? 'warning' : 
                        nonconformity.severity === 'orta' ? 'info' : 'success'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.status.charAt(0).toUpperCase() + nonconformity.status.slice(1)}
                      color={
                        nonconformity.status === 'kapalƒ±' ? 'success' : 
                        nonconformity.status === 'd√ºzeltiliyor' ? 'info' : 
                        nonconformity.status === 'ara≈ütƒ±rƒ±lƒ±yor' ? 'warning' : 'error'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {new Date(nonconformity.detectedDate).toLocaleDateString('tr-TR')}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Box display="flex" gap={1}>
                      <Tooltip title="G√∂r√ºnt√ºle">
                        <IconButton 
                          size="small" 
                          color="primary"
                          onClick={() => {
                            setSelectedItem(nonconformity);
                            setDialogType('nonconformity');
                            setFormData(nonconformity);
                            setDialogOpen(true);
                          }}
                        >
                          <ViewIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="D√ºzenle">
                        <IconButton 
                          size="small" 
                          color="info"
                          onClick={() => handleEditItem(nonconformity, 'nonconformity')}
                        >
                          <EditIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="D√ñF Olu≈ütur">
                        <IconButton 
                          size="small" 
                          color="warning"
                          onClick={() => createDOFFromNonconformity(nonconformity)}
                          disabled={!!nonconformity.dofId}
                        >
                          <ReportIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="Sil">
                        <IconButton 
                          size="small" 
                          color="error"
                          onClick={() => handleDeleteItem(nonconformity.id, 'nonconformity')}
                        >
                          <DeleteIcon />
                        </IconButton>
                      </Tooltip>
                    </Box>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
    );
  };

  // Defect Tracking Component
  const renderDefectTracking = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Button variant="contained" startIcon={<WarningIcon />} onClick={handleCreateDefect}>
          Hata Kaydet
        </Button>
      </Box>

      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>Hata Kategorileri</Typography>
              <Box height={200}>
                <ResponsiveContainer width="100%" height="100%">
                  <PieChart>
                    <Pie
                      dataKey="value"
                      data={[
                        { name: 'Boyutsal', value: 15, fill: '#2196f3' },
                        { name: 'G√∂rsel', value: 8, fill: '#4caf50' },
                        { name: 'Fonksiyonel', value: 5, fill: '#ff9800' },
                        { name: 'Materyal', value: 3, fill: '#f44336' }
                      ]}
                      cx="50%"
                      cy="50%"
                      outerRadius={60}
                      label
                    >
                      {[
                        { name: 'Boyutsal', value: 15, fill: '#2196f3' },
                        { name: 'G√∂rsel', value: 8, fill: '#4caf50' },
                        { name: 'Fonksiyonel', value: 5, fill: '#ff9800' },
                        { name: 'Materyal', value: 3, fill: '#f44336' }
                      ].map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.fill} />
                      ))}
                    </Pie>
                    <ChartTooltip />
                  </PieChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>Aylƒ±k Hata Trendi</Typography>
              <Box height={200}>
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={[
                    { month: 'Oca', defects: 12, resolved: 10 },
                    { month: '≈ûub', defects: 8, resolved: 9 },
                    { month: 'Mar', defects: 15, resolved: 12 },
                    { month: 'Nis', defects: 6, resolved: 8 },
                    { month: 'May', defects: 10, resolved: 11 },
                    { month: 'Haz', defects: 4, resolved: 6 }
                  ]}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis />
                    <ChartTooltip />
                    <Legend />
                    <Line type="monotone" dataKey="defects" stroke="#f44336" name="Yeni Hatalar" />
                    <Line type="monotone" dataKey="resolved" stroke="#4caf50" name="√á√∂z√ºlen Hatalar" />
                  </LineChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>Hata T√ºr√º</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tedarik√ßi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Miktar</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>√ñnem</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tespit Tarihi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Durum</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>ƒ∞≈ülemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {defects.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} sx={{ textAlign: 'center', py: 4 }}>
                  <Typography color="text.secondary">
                    Hen√ºz hata kaydƒ± bulunmamaktadƒ±r
                  </Typography>
                  <Button 
                    variant="contained" 
                    startIcon={<WarningIcon />}
                    sx={{ mt: 2 }}
                    onClick={() => {
                      setDialogType('defect');
                      setDialogOpen(true);
                    }}
                  >
                    ƒ∞lk Hatayƒ± Kaydet
                  </Button>
                </TableCell>
              </TableRow>
            ) : (
              defects.map((defect) => (
                <TableRow key={defect.id}>
                  <TableCell>
                    <Box>
                      <Typography variant="body2" fontWeight="bold">
                        {defect.defectType}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        Parti No: {defect.batchNumber}
                      </Typography>
                    </Box>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {suppliers.find(s => s.id === defect.supplierId)?.name || 'Bilinmiyor'}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2" fontWeight="bold">
                      {defect.quantity} adet
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={defect.severity.charAt(0).toUpperCase() + defect.severity.slice(1)}
                      color={
                        defect.severity === 'kritik' ? 'error' : 
                        defect.severity === 'major' ? 'warning' : 'info'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {new Date(defect.detectedDate).toLocaleDateString('tr-TR')}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={defect.status.charAt(0).toUpperCase() + defect.status.slice(1)}
                      color={
                        defect.status === 'd√ºzeltildi' ? 'success' : 
                        defect.status === 'kabul' ? 'info' : 'warning'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Box display="flex" gap={1}>
                      <Tooltip title="G√∂r√ºnt√ºle">
                        <IconButton 
                          size="small" 
                          color="primary"
                          onClick={() => {
                            setSelectedItem(defect);
                            setDialogType('defect');
                            setFormData(defect);
                            setDialogOpen(true);
                          }}
                        >
                          <ViewIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="D√ºzenle">
                        <IconButton 
                          size="small" 
                          color="info"
                          onClick={() => handleEditItem(defect, 'defect')}
                        >
                          <EditIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="D√ñF Olu≈ütur">
                        <IconButton 
                          size="small" 
                          color="warning"
                          onClick={() => {
                            const mockNonconformity: NonconformityRecord = {
                              id: `temp-${Date.now()}`,
                              supplierId: defect.supplierId,
                              title: `${defect.defectType} Hatasƒ±`,
                              description: `${defect.description} - Miktar: ${defect.quantity}`,
                              category: 'kalite',
                              severity: defect.severity === 'kritik' ? 'kritik' : defect.severity === 'major' ? 'y√ºksek' : 'orta',
                              detectedDate: defect.detectedDate,
                              status: 'a√ßƒ±k',
                              dueDate: '',
                              correctionCost: defect.correctionCost,
                              recurrence: false,
                              partCode: defect.batchNumber || 'UNKNOWN-001' // Zorunlu alan eklendi
                            };
                            createDOFFromNonconformity(mockNonconformity);
                          }}
                        >
                          <ReportIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="Sil">
                        <IconButton 
                          size="small" 
                          color="error"
                          onClick={() => handleDeleteItem(defect.id, 'defect')}
                        >
                          <DeleteIcon />
                        </IconButton>
                      </Tooltip>
                    </Box>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
  );

  // Performance Analysis Component
  const renderPerformanceAnalysis = () => {
    const radarData = prepareRadarData();
    const availableSuppliers = suppliers.slice(0, 5); // ƒ∞lk 5 tedarik√ßi
    
    return (
      <Box>
        <Grid container spacing={3}>
          {/* Professional Supplier Selection */}
          <Grid item xs={12}>
            <Paper 
              elevation={0} 
              sx={{ 
                border: '1px solid',
                borderColor: 'grey.200',
                borderRadius: 3,
                overflow: 'hidden'
              }}
            >
              {/* Header - Compact */}
              <Box 
                sx={{ 
                  bgcolor: 'grey.50',
                  borderBottom: '1px solid',
                  borderColor: 'grey.200',
                  p: 2,
                  display: 'flex',
                  justifyContent: 'flex-end',
                  alignItems: 'center'
                }}
              >
                <Paper 
                  elevation={1}
                  sx={{ 
                    p: 1,
                    bgcolor: selectedSuppliersForRadar.length === 3 ? 'success.main' : 'primary.main',
                    color: 'white',
                    minWidth: 50,
                    textAlign: 'center',
                    borderRadius: 2
                  }}
                >
                  <Typography variant="body2" fontWeight={600}>
                    {selectedSuppliersForRadar.length}/3
                  </Typography>
                </Paper>
              </Box>

              {/* Content */}
              <Box sx={{ p: 3 }}>
                <FormControl fullWidth>
                  <InputLabel 
                    sx={{ 
                      fontWeight: 600,
                      color: 'text.primary',
                      '&.Mui-focused': { color: 'primary.main' }
                    }}
                  >
                    Tedarik√ßi Se√ßimi
                  </InputLabel>
                  <Select
                    multiple
                    value={selectedSuppliersForRadar}
                    onChange={(event) => {
                      const value = event.target.value as string[];
                      if (value.length <= 3) {
                        setSelectedSuppliersForRadar(value);
                      } else {
                        showSnackbar('Maksimum 3 tedarik√ßi se√ßebilirsiniz', 'warning');
                      }
                    }}
                    label="Tedarik√ßi Se√ßimi"
                    sx={{
                      borderRadius: 2,
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 2
                      },
                      '& .MuiSelect-select': {
                        minHeight: 48
                      }
                    }}
                    renderValue={(selected) => {
                      if ((selected as string[]).length === 0) {
                        return (
                          <Typography variant="body2" color="text.secondary" sx={{ fontStyle: 'italic' }}>
                            Tedarik√ßi se√ßiniz...
                          </Typography>
                        );
                      }
                      return (
                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                          {(selected as string[]).map((value) => {
                            const supplier = suppliers.find(s => s.id === value);
                            return supplier ? (
                              <Chip 
                                key={value} 
                                label={supplier.name}
                                size="small"
                                sx={{ 
                                  height: 28,
                                  fontSize: '0.8rem',
                                  fontWeight: 500,
                                  bgcolor: 'primary.main',
                                  color: 'white',
                                  '& .MuiChip-deleteIcon': {
                                    color: 'white'
                                  }
                                }}
                              />
                            ) : null;
                          })}
                        </Box>
                      );
                    }}
                  >
                    {suppliers.map((supplier) => (
                      <MenuItem 
                        key={supplier.id} 
                        value={supplier.id}
                        disabled={!selectedSuppliersForRadar.includes(supplier.id) && selectedSuppliersForRadar.length >= 3}
                        sx={{
                          py: 1.5,
                          '&:hover': {
                            bgcolor: 'grey.50'
                          },
                          '&.Mui-disabled': {
                            opacity: 0.5
                          }
                        }}
                      >
                        <Box display="flex" justifyContent="space-between" alignItems="center" width="100%">
                          <Box>
                            <Typography variant="body1" fontWeight={600} sx={{ mb: 0.5 }}>
                              {supplier.name}
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                              {supplier.code} ‚Ä¢ {supplier.category}
                            </Typography>
                          </Box>
                          <Box display="flex" alignItems="center" gap={0.5}>
                            <Chip 
                              size="small" 
                              label={`${supplier.performanceScore}%`}
                              sx={{
                                bgcolor: supplier.performanceScore >= 90 ? 'success.main' : 
                                        supplier.performanceScore >= 75 ? 'warning.main' : 'error.main',
                                color: 'white',
                                fontWeight: 600,
                                height: 22,
                                fontSize: '0.7rem'
                              }}
                            />
                          </Box>
                        </Box>
                      </MenuItem>
                    ))}
                  </Select>
                </FormControl>

                {/* Selected Suppliers Preview */}
                {selectedSuppliersForRadar.length > 0 && (
                  <Box mt={3}>
                    <Typography variant="subtitle2" fontWeight={600} color="text.primary" sx={{ mb: 2 }}>
                      Se√ßilen Tedarik√ßiler
                    </Typography>
                    <Grid container spacing={2}>
                      {selectedSuppliersForRadar.map((supplierId, index) => {
                        const supplier = suppliers.find(s => s.id === supplierId);
                        const colors = ['#2196f3', '#ff9800', '#4caf50'];
                        return supplier ? (
                          <Grid item xs={12} sm={4} key={supplierId}>
                            <Paper 
                              elevation={2}
                              sx={{ 
                                p: 2, 
                                borderRadius: 2,
                                border: '2px solid',
                                borderColor: colors[index],
                                position: 'relative',
                                bgcolor: 'white'
                              }}
                            >
                              <Box display="flex" justifyContent="space-between" alignItems="flex-start" mb={1}>
                                <Typography variant="body1" fontWeight={600} noWrap>
                                  {supplier.name}
                                </Typography>
                                <Typography 
                                  variant="h6" 
                                  fontWeight={700}
                                  sx={{ color: colors[index] }}
                                >
                                  {supplier.performanceScore}%
                                </Typography>
                              </Box>
                              <Typography variant="caption" color="text.secondary" display="block">
                                {supplier.code}
                              </Typography>
                              <Box 
                                sx={{
                                  position: 'absolute',
                                  top: 8,
                                  right: 8,
                                  width: 8,
                                  height: 8,
                                  borderRadius: '50%',
                                  bgcolor: colors[index]
                                }}
                              />
                            </Paper>
                          </Grid>
                        ) : null;
                      })}
                    </Grid>
                  </Box>
                )}
              </Box>
            </Paper>
          </Grid>

          {/* Performance Radar Chart */}
          <Grid item xs={12} md={8}>
            <Card>
              <CardHeader 
                title="√áok Boyutlu Performans Radarƒ±" 
                subheader="Tedarik√ßilerin 6 farklƒ± boyuttaki performans kar≈üƒ±la≈ütƒ±rmasƒ±"
              />
              <CardContent>
                <Box height={400}>
                  <ResponsiveContainer width="100%" height="100%">
                    <RadarChart data={radarData}>
                      <PolarGrid />
                      <PolarAngleAxis dataKey="dimension" tick={{ fontSize: 12 }} />
                      <PolarRadiusAxis 
                        angle={90} 
                        domain={[0, 100]} 
                        tick={{ fontSize: 10 }}
                        axisLine={false}
                      />
                      {selectedSuppliersForRadar.length > 0 
                        ? suppliers
                            .filter(s => selectedSuppliersForRadar.includes(s.id))
                            .map((supplier, index) => {
                              const colors = ['#2196f3', '#ff9800', '#4caf50', '#f44336', '#9c27b0'];
                              return (
                                <Radar
                                  key={supplier.id}
                                  name={supplier.name.split(' ')[0]}
                                  dataKey={supplier.name.split(' ')[0]}
                                  stroke={colors[index]}
                                  fill={colors[index]}
                                  fillOpacity={0.1}
                                  strokeWidth={2}
                                />
                              );
                            })
                        : suppliers.slice(0, 3).map((supplier, index) => {
                            const colors = ['#2196f3', '#ff9800', '#4caf50'];
                            return (
                              <Radar
                                key={supplier.id}
                                name={supplier.name.split(' ')[0]}
                                dataKey={supplier.name.split(' ')[0]}
                                stroke={colors[index]}
                                fill={colors[index]}
                                fillOpacity={0.1}
                                strokeWidth={2}
                              />
                            );
                          })
                      }
                      <ChartTooltip 
                        formatter={(value: any, name: any) => [`${value}%`, name]}
                        labelFormatter={(label) => `Boyut: ${label}`}
                      />
                      <Legend />
                    </RadarChart>
                  </ResponsiveContainer>
                </Box>
                
                {/* Boyut A√ßƒ±klamalarƒ± - Kompakt */}
                <Box mt={2} p={2} bgcolor="grey.50" borderRadius={1}>
                  <Typography variant="overline" display="block" gutterBottom sx={{ fontWeight: 'bold', color: 'text.secondary' }}>
                    Performans Boyutlarƒ±
                  </Typography>
                  <Grid container spacing={0.5}>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Kalite:</strong> Uygunsuzluk/Hata
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Teslimat:</strong> Zamanƒ±nda Teslim
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>G√ºvenilirlik:</strong> Denetim Ge√ßmi≈üi
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Maliyet:</strong> Risk/Hata Maliyeti
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>ƒ∞novasyon:</strong> Kategori/Hizmet
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>S√ºrd√ºr√ºlebilirlik:</strong> ƒ∞≈ü Birliƒüi
                      </Typography>
                    </Grid>
                  </Grid>
                </Box>
              </CardContent>
            </Card>
          </Grid>

        {/* Performance Insights - Kompakt */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardHeader 
              title="Performans ƒ∞√ßg√∂r√ºleri" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 'bold' }}
            />
            <CardContent sx={{ pt: 1 }}>
              <Box display="flex" flexDirection="column" gap={1.5}>
                
                {/* En g√º√ßl√º boyut */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'success.50', borderLeft: 3, borderColor: 'success.main' }}>
                  <Typography variant="overline" sx={{ color: 'success.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    En G√º√ßl√º Boyut
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    Kalite skoru sekt√∂r ortalamasƒ±nƒ±n %15 √ºzerinde
                  </Typography>
                </Paper>
                
                {/* Geli≈üim alanƒ± */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'warning.50', borderLeft: 3, borderColor: 'warning.main' }}>
                  <Typography variant="overline" sx={{ color: 'warning.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    Geli≈üim Alanƒ±
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    ƒ∞novasyon boyutunda iyile≈ütirme fƒ±rsatƒ±
                  </Typography>
                </Paper>
                
                {/* √ñneri */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'info.50', borderLeft: 3, borderColor: 'info.main' }}>
                  <Typography variant="overline" sx={{ color: 'info.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    Aksiyon √ñnerisi
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    Stratejik tedarik√ßilerle inovasyon projelerine odaklanma
                  </Typography>
                </Paper>
                
                {/* Benchmark kompakt */}
                <Box mt={1}>
                  <Typography variant="overline" sx={{ fontWeight: 'bold', color: 'text.secondary', fontSize: '0.7rem' }}>
                    Sekt√∂r Kar≈üƒ±la≈ütƒ±rmasƒ±
                  </Typography>
                  <Box display="flex" justifyContent="space-between" alignItems="center" mt={1}>
                    <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>Ortalama Performans</Typography>
                    <Chip size="small" label="87.5%" color="primary" sx={{ height: 20, fontSize: '0.7rem' }} />
                  </Box>
                  <Box display="flex" justifyContent="space-between" alignItems="center" mt={0.5}>
                    <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>Sekt√∂r Ortalamasƒ±</Typography>
                    <Chip size="small" label="82.1%" color="default" sx={{ height: 20, fontSize: '0.7rem' }} />
                  </Box>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Performance Ranking - Kompakt */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardHeader 
              title="Performans Sƒ±ralamasƒ±" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 'bold' }}
            />
            <CardContent sx={{ pt: 1 }}>
              <List dense>
                {suppliers
                  .sort((a, b) => b.performanceScore - a.performanceScore)
                  .slice(0, 5)
                  .map((supplier, index) => (
                    <ListItem 
                      key={supplier.id} 
                      divider 
                      sx={{ 
                        py: 1, 
                        borderRadius: 1, 
                        mb: 0.5,
                        bgcolor: index < 3 ? `${index === 0 ? 'warning' : index === 1 ? 'info' : 'success'}.50` : 'transparent',
                        '&:hover': { bgcolor: 'action.hover' }
                      }}
                    >
                      <ListItemIcon sx={{ minWidth: 40 }}>
                        <Avatar sx={{ 
                          bgcolor: index === 0 ? '#FFD700' : index === 1 ? '#C0C0C0' : index === 2 ? '#CD7F32' : 'grey.400',
                          width: 28, height: 28, fontSize: '0.75rem', fontWeight: 'bold'
                        }}>
                          {index + 1}
                        </Avatar>
                      </ListItemIcon>
                      <ListItemText
                        primary={
                          <Typography variant="body2" fontWeight="bold" sx={{ fontSize: '0.85rem' }}>
                            {supplier.name}
                          </Typography>
                        }
                        secondary={
                          <Box display="flex" alignItems="center" gap={1} mt={0.5}>
                            <Typography variant="body2" fontWeight="bold" color="primary" sx={{ fontSize: '0.8rem' }}>
                              {supplier.performanceScore}%
                            </Typography>
                            <Box display="flex" gap={0.5}>
                              <Chip 
                                size="small" 
                                label={`K:${supplier.qualityScore}`} 
                                color="primary" 
                                sx={{ height: 18, fontSize: '0.65rem', '& .MuiChip-label': { px: 0.5 } }}
                              />
                              <Chip 
                                size="small" 
                                label={`T:${supplier.deliveryScore}`} 
                                color="success" 
                                sx={{ height: 18, fontSize: '0.65rem', '& .MuiChip-label': { px: 0.5 } }}
                              />
                            </Box>
                          </Box>
                        }
                      />
                      <Box display="flex" alignItems="center">
                        {index < 3 && <StarIcon sx={{ color: '#FFD700', fontSize: '1.2rem' }} />}
                      </Box>
                    </ListItem>
                  ))}
              </List>
            </CardContent>
          </Card>
        </Grid>

        {/* Performance Trends */}
        <Grid item xs={12}>
          <Card>
            <CardHeader title="Performans Trendleri" />
            <CardContent>
              <Box height={300}>
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={[
                    { month: 'Oca', 'Se√ßkinler Metal': 88, 'Nisa Metal': 85 },
                    { month: '≈ûub', 'Se√ßkinler Metal': 90, 'Nisa Metal': 86 },
                    { month: 'Mar', 'Se√ßkinler Metal': 91, 'Nisa Metal': 87 },
                    { month: 'Nis', 'Se√ßkinler Metal': 89, 'Nisa Metal': 85 },
                    { month: 'May', 'Se√ßkinler Metal': 92, 'Nisa Metal': 88 },
                    { month: 'Haz', 'Se√ßkinler Metal': 92, 'Nisa Metal': 87 }
                  ]}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis domain={[70, 100]} />
                    <ChartTooltip />
                    <Legend />
                    <Line type="monotone" dataKey="Se√ßkinler Metal" stroke="#2196f3" strokeWidth={2} />
                    <Line type="monotone" dataKey="Nisa Metal" stroke="#ff9800" strokeWidth={2} />
                  </LineChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
    );
  };

  // Loading durumunda g√∂sterilecek i√ßerik
  if (isLoading) {
    return (
      <ErrorBoundary>
        <Box 
          display="flex" 
          flexDirection="column" 
          justifyContent="center" 
          alignItems="center" 
          minHeight="60vh"
          p={3}
        >
          <CircularProgress size={60} sx={{ mb: 3 }} />
          <Typography variant="h6" gutterBottom>
            Tedarik√ßi Kalite Y√∂netimi Y√ºkleniyor...
          </Typography>
          <Typography variant="body2" color="text.secondary">
            Veriler hazƒ±rlanƒ±yor, l√ºtfen bekleyin
          </Typography>
        </Box>
      </ErrorBoundary>
    );
  }

  return (
    <ErrorBoundary>
      <Box p={3}>
        <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
          <Box display="flex" gap={2} alignItems="center">
            <FormControlLabel
              control={
                <Switch
                  checked={autoAuditEnabled}
                  onChange={(e) => setAutoAuditEnabled(e.target.checked)}
                  color="primary"
                />
              }
              label="Otomatik Denetim"
            />
            <Button
              variant="outlined"
              startIcon={<AssessmentIcon />}
              onClick={() => {
                console.log('üîÑ Manuel performans g√ºncelleme ba≈ülatƒ±ldƒ±...');
                console.log('Mevcut tedarik√ßi sayƒ±sƒ±:', suppliers.length);
                console.log('Mevcut uygunsuzluk sayƒ±sƒ±:', nonconformities.length);
                console.log('Mevcut hata sayƒ±sƒ±:', defects.length);
                updateSupplierPerformances();
                showSnackbar('Performanslar g√ºncellendi', 'success');
              }}
              color="info"
            >
              Performans Yenile
            </Button>
            <Button
              variant="contained"
              startIcon={<AddIcon />}
              onClick={handleCreateSupplier}
            >
              Yeni Tedarik√ßi
            </Button>
          </Box>
        </Box>

        <Paper sx={{ width: '100%', mb: 2 }}>
          <Tabs value={currentTab} onChange={(e, newValue) => setCurrentTab(newValue)}>
            <Tab icon={<DashboardIcon />} label="Dashboard" />
            <Tab icon={<LinkIcon />} label="Onaylƒ±/Alternatif E≈üle≈ütirme" />
            <Tab icon={<BusinessIcon />} label="Tedarik√ßi Listesi" />
            <Tab icon={<ScheduleIcon />} label="Denetim Takibi" />
            <Tab icon={<BugReportIcon />} label="Uygunsuzluk Y√∂netimi" />
            <Tab icon={<WarningIcon />} label="Hata Takibi" />
            <Tab icon={<AssessmentIcon />} label="Performans Analizi" />
          </Tabs>
        </Paper>

                 <Box>
           {(() => {
             try {
               switch (currentTab) {
                 case 0:
                   return renderDashboard();
                 case 1:
                   return renderSupplierPairing();
                 case 2:
                   return renderSupplierList();
                 case 3:
                   return renderAuditTracking();
                 case 4:
                   console.log('üéØ Uygunsuzluk Y√∂netimi tab\'ƒ± render ediliyor...');
                   return renderNonconformityManagement();
                 case 5:
                   return renderDefectTracking();
                 case 6:
                   return renderPerformanceAnalysis();
                 default:
                   return renderDashboard();
               }
             } catch (error) {
               console.error('‚ùå Tab render hatasƒ±:', error);
               return (
                 <Box p={3}>
                   <Alert severity="error">
                     <Typography variant="h6" gutterBottom>
                       Sekme Y√ºkleme Hatasƒ±
                     </Typography>
                     <Typography variant="body2" gutterBottom>
                       {error instanceof Error ? error.message : 'Bilinmeyen bir hata olu≈ütu'}
                     </Typography>
                     <Button 
                       variant="contained" 
                       onClick={() => {
                         setCurrentTab(0);
                         window.location.reload();
                       }}
                       sx={{ mt: 2 }}
                     >
                       Ana Sayfaya D√∂n
                     </Button>
                   </Alert>
                 </Box>
               );
             }
           })()}
         </Box>

        {/* Snackbar */}
        <Snackbar
          open={snackbar.open}
          autoHideDuration={6000}
          onClose={() => setSnackbar({ ...snackbar, open: false })}
        >
          <Alert severity={snackbar.severity} onClose={() => setSnackbar({ ...snackbar, open: false })}>
            {snackbar.message}
          </Alert>
        </Snackbar>

        {/* Universal Dialog for all operations */}
        <Dialog 
          open={dialogOpen} 
          onClose={() => setDialogOpen(false)}
          maxWidth="md"
          fullWidth
        >
          <DialogTitle>
            {dialogType === 'supplier' && (selectedItem ? 'Tedarik√ßi D√ºzenle' : 'Yeni Tedarik√ßi Ekle')}
            {dialogType === 'pair' && (selectedItem ? 'E≈üle≈ütirme D√ºzenle' : 'Yeni E≈üle≈ütirme Olu≈ütur')}
            {dialogType === 'nonconformity' && (selectedItem ? 'Uygunsuzluk D√ºzenle' : 'Yeni Uygunsuzluk Kaydet')}
            {dialogType === 'defect' && (selectedItem ? 'Hata D√ºzenle' : 'Yeni Hata Kaydet')}
            {dialogType === 'audit' && (selectedItem ? 'Denetim D√ºzenle' : 'Yeni Denetim Planla')}
          </DialogTitle>
          
          <DialogContent>
            {dialogType === 'supplier' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Tedarik√ßi Adƒ±"
                      value={formData.name || ''}
                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                      required
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Tedarik√ßi Kodu"
                      value={formData.code || ''}
                      onChange={(e) => setFormData({ ...formData, code: e.target.value })}
                      required
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>T√ºr</InputLabel>
                      <Select
                        value={formData.type || 'onaylƒ±'}
                        onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                      >
                        <MenuItem value="onaylƒ±">Onaylƒ±</MenuItem>
                        <MenuItem value="alternatif">Alternatif</MenuItem>
                        <MenuItem value="potansiyel">Potansiyel</MenuItem>
                        <MenuItem value="bloklu">Bloklu</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Kategori</InputLabel>
                      <Select
                        value={formData.category || 'genel'}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="stratejik">Stratejik</MenuItem>
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="rutin">Rutin</MenuItem>
                        <MenuItem value="genel">Genel</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  {/* Yeni Tedarik T√ºr√º Alanlarƒ± */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Tedarik T√ºr√º</InputLabel>
                      <Select
                        value={formData.supplyType || 'malzeme'}
                        onChange={(e) => {
                          const newSupplyType = e.target.value as 'malzeme' | 'hizmet' | 'hibrit';
                          setFormData({ 
                            ...formData, 
                            supplyType: newSupplyType,
                            supplySubcategories: [] // Reset subcategories when type changes
                          });
                        }}
                      >
                        <MenuItem value="malzeme">Malzeme Tedarik√ßisi</MenuItem>
                        <MenuItem value="hizmet">Hizmet Saƒülayƒ±cƒ±sƒ±</MenuItem>
                        <MenuItem value="hibrit">Hibrit (Malzeme + Hizmet)</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>Alt Kategoriler</InputLabel>
                      <Select
                        multiple
                        value={formData.supplySubcategories || []}
                        onChange={(e) => setFormData({ 
                          ...formData, 
                          supplySubcategories: e.target.value as string[]
                        })}
                        renderValue={(selected) => (
                          <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                            {(selected as string[]).map((value) => (
                              <Chip key={value} label={value} size="small" />
                            ))}
                          </Box>
                        )}
                      >
                        {formData.supplyType && SUPPLY_SUBCATEGORIES[formData.supplyType as keyof typeof SUPPLY_SUBCATEGORIES]?.map((subcategory) => (
                          <MenuItem key={subcategory} value={subcategory}>
                            {subcategory}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="ƒ∞leti≈üim Ki≈üisi"
                      value={formData.contact?.contactPerson || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, contactPerson: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="E-posta"
                      type="email"
                      value={formData.contact?.email || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, email: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Telefon"
                      value={formData.contact?.phone || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, phone: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Adres"
                      value={formData.contact?.address || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, address: e.target.value }
                      })}
                    />
                  </Grid>
                  
                  {/* Performans Skorlarƒ± */}
                  <Grid item xs={12}>
                    <Typography variant="h6" sx={{ mt: 2, mb: 1 }}>Performans Skorlarƒ±</Typography>
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="Genel Performans Skoru"
                      type="number"
                      value={formData.performanceScore || 85}
                      onChange={(e) => setFormData({ ...formData, performanceScore: Number(e.target.value) })}
                      InputProps={{
                        endAdornment: <Typography variant="caption" color="text.secondary">/100</Typography>
                      }}
                      inputProps={{ min: 0, max: 100 }}
                      helperText="0-100 arasƒ± deƒüer"
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="Kalite Skoru"
                      type="number"
                      value={formData.qualityScore || 88}
                      onChange={(e) => setFormData({ ...formData, qualityScore: Number(e.target.value) })}
                      InputProps={{
                        endAdornment: <Typography variant="caption" color="text.secondary">/100</Typography>
                      }}
                      inputProps={{ min: 0, max: 100 }}
                      helperText="0-100 arasƒ± deƒüer"
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="Teslimat Skoru"
                      type="number"
                      value={formData.deliveryScore || 90}
                      onChange={(e) => setFormData({ ...formData, deliveryScore: Number(e.target.value) })}
                      InputProps={{
                        endAdornment: <Typography variant="caption" color="text.secondary">/100</Typography>
                      }}
                      inputProps={{ min: 0, max: 100 }}
                      helperText="0-100 arasƒ± deƒüer"
                    />
                  </Grid>
                  
                  {/* Risk Seviyesi ve Durum */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Risk Seviyesi</InputLabel>
                      <Select
                        value={formData.riskLevel || 'd√º≈ü√ºk'}
                        onChange={(e) => setFormData({ ...formData, riskLevel: e.target.value })}
                      >
                        <MenuItem value="d√º≈ü√ºk">D√º≈ü√ºk Risk</MenuItem>
                        <MenuItem value="orta">Orta Risk</MenuItem>
                        <MenuItem value="y√ºksek">Y√ºksek Risk</MenuItem>
                        <MenuItem value="kritik">Kritik Risk</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Durum</InputLabel>
                      <Select
                        value={formData.status || 'aktif'}
                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                      >
                        <MenuItem value="aktif">Aktif</MenuItem>
                        <MenuItem value="pasif">Pasif</MenuItem>
                        <MenuItem value="denetimde">Denetimde</MenuItem>
                        <MenuItem value="bloklu">Bloklu</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'nonconformity' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>Tedarik√ßi</InputLabel>
                      <Select
                        value={formData.supplierId || ''}
                        onChange={(e) => setFormData({ ...formData, supplierId: e.target.value })}
                      >
                        {suppliers.map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            {supplier.name}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Uygunsuzluk Ba≈ülƒ±ƒüƒ±"
                      value={formData.title || ''}
                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                      required
                    />
                  </Grid>
                  
                  {/* Zorunlu Par√ßa Kodu */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Par√ßa Kodu"
                      value={formData.partCode || ''}
                      onChange={(e) => setFormData({ ...formData, partCode: e.target.value })}
                      required
                      helperText="Bu alan zorunludur"
                      error={!formData.partCode}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Uygunsuzluk Kategorisi</InputLabel>
                      <Select
                        value={formData.category || 'kalite'}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="kalite">Kalite Problemi</MenuItem>
                        <MenuItem value="teslimat">Teslimat Problemi</MenuItem>
                        <MenuItem value="dok√ºman">Dok√ºman Problemi</MenuItem>
                        <MenuItem value="servis">Servis Problemi</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  {/* Dinamik Alanlar - Kategori Bazƒ±nda */}
                  {formData.category === 'kalite' && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Etkilenen Par√ßa Adedi"
                        type="number"
                        value={formData.quantityAffected || ''}
                        onChange={(e) => setFormData({ ...formData, quantityAffected: Number(e.target.value) })}
                        InputProps={{
                          endAdornment: <Typography variant="caption" color="text.secondary">adet</Typography>
                        }}
                        helperText="Kalite probleminden etkilenen par√ßa sayƒ±sƒ±"
                      />
                    </Grid>
                  )}
                  
                  {formData.category === 'teslimat' && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Gecikme S√ºresi"
                        type="number"
                        value={formData.delayDays || ''}
                        onChange={(e) => setFormData({ ...formData, delayDays: Number(e.target.value) })}
                        InputProps={{
                          endAdornment: <Typography variant="caption" color="text.secondary">g√ºn</Typography>
                        }}
                        helperText="Teslimat gecikmesi (g√ºn olarak)"
                      />
                    </Grid>
                  )}
                  
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Uygunsuzluk A√ßƒ±klamasƒ±"
                      multiline
                      rows={3}
                      value={formData.description || ''}
                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                      required
                      helperText="Uygunsuzluƒüun detaylƒ± a√ßƒ±klamasƒ±"
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>√ñnem Derecesi</InputLabel>
                      <Select
                        value={formData.severity || 'd√º≈ü√ºk'}
                        onChange={(e) => setFormData({ ...formData, severity: e.target.value })}
                      >
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="y√ºksek">Y√ºksek</MenuItem>
                        <MenuItem value="orta">Orta</MenuItem>
                        <MenuItem value="d√º≈ü√ºk">D√º≈ü√ºk</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Tespit Tarihi"
                      type="date"
                      value={formData.detectedDate || new Date().toISOString().split('T')[0]}
                      onChange={(e) => setFormData({ ...formData, detectedDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Hedef Tamamlanma Tarihi"
                      type="date"
                      value={formData.dueDate || ''}
                      onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      helperText="Uygunsuzluƒüun giderilmesi gereken tarih"
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="D√ºzeltme Maliyeti (‚Ç∫)"
                      type="number"
                      value={formData.correctionCost || 0}
                      onChange={(e) => setFormData({ ...formData, correctionCost: Number(e.target.value) })}
                      InputProps={{
                        startAdornment: <Typography variant="caption" color="text.secondary">‚Ç∫</Typography>
                      }}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Durum</InputLabel>
                      <Select
                        value={formData.status || 'a√ßƒ±k'}
                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                      >
                        <MenuItem value="a√ßƒ±k">A√ßƒ±k</MenuItem>
                        <MenuItem value="ara≈ütƒ±rƒ±lƒ±yor">Ara≈ütƒ±rƒ±lƒ±yor</MenuItem>
                        <MenuItem value="d√ºzeltiliyor">D√ºzeltiliyor</MenuItem>
                        <MenuItem value="kapalƒ±">Kapalƒ±</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'defect' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>Tedarik√ßi</InputLabel>
                      <Select
                        value={formData.supplierId || ''}
                        onChange={(e) => setFormData({ ...formData, supplierId: e.target.value })}
                      >
                        {suppliers.map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            {supplier.name}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Hata T√ºr√º"
                      value={formData.defectType || ''}
                      onChange={(e) => setFormData({ ...formData, defectType: e.target.value })}
                      required
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Parti Numarasƒ±"
                      value={formData.batchNumber || ''}
                      onChange={(e) => setFormData({ ...formData, batchNumber: e.target.value })}
                    />
                  </Grid>
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="A√ßƒ±klama"
                      multiline
                      rows={3}
                      value={formData.description || ''}
                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="Miktar"
                      type="number"
                      value={formData.quantity || 0}
                      onChange={(e) => setFormData({ ...formData, quantity: Number(e.target.value) })}
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <FormControl fullWidth>
                      <InputLabel>√ñnem Derecesi</InputLabel>
                      <Select
                        value={formData.severity || 'minor'}
                        onChange={(e) => setFormData({ ...formData, severity: e.target.value })}
                      >
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="major">Major</MenuItem>
                        <MenuItem value="minor">Minor</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="D√ºzeltme Maliyeti (‚Ç∫)"
                      type="number"
                      value={formData.correctionCost || 0}
                      onChange={(e) => setFormData({ ...formData, correctionCost: Number(e.target.value) })}
                    />
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'pair' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <Typography variant="h6" gutterBottom color="primary">
                      Tedarik√ßi E≈üle≈ütirme Bilgileri
                    </Typography>
                  </Grid>
                  
                  {/* Ana Tedarik√ßi Se√ßimi */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Ana Tedarik√ßi</InputLabel>
                      <Select
                        value={formData.primarySupplierId || ''}
                        onChange={(e) => setFormData({ ...formData, primarySupplierId: e.target.value })}
                      >
                        {suppliers.filter(s => s.type === 'onaylƒ±').map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            <Box display="flex" alignItems="center" gap={1}>
                              <CheckCircleIcon color="success" fontSize="small" />
                              {supplier.name} ({supplier.code})
                            </Box>
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Alternatif Tedarik√ßi Se√ßimi */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Alternatif Tedarik√ßi</InputLabel>
                      <Select
                        value={formData.alternativeSupplierId || ''}
                        onChange={(e) => setFormData({ ...formData, alternativeSupplierId: e.target.value })}
                      >
                        {suppliers.filter(s => s.type === 'alternatif' || s.type === 'onaylƒ±').map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            <Box display="flex" alignItems="center" gap={1}>
                              <SwapHorizIcon color="warning" fontSize="small" />
                              {supplier.name} ({supplier.code})
                            </Box>
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Malzeme T√ºr√º */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Malzeme T√ºr√º</InputLabel>
                      <Select
                        value={formData.materialType || ''}
                        onChange={(e) => setFormData({ ...formData, materialType: e.target.value })}
                      >
                        <MenuItem value="√ßelik">√áelik</MenuItem>
                        <MenuItem value="al√ºminyum">Al√ºminyum</MenuItem>
                        <MenuItem value="paslanmaz">Paslanmaz √áelik</MenuItem>
                        <MenuItem value="d√∂k√ºm">D√∂k√ºm</MenuItem>
                        <MenuItem value="plastik">Plastik</MenuItem>
                        <MenuItem value="elektronik">Elektronik</MenuItem>
                        <MenuItem value="kau√ßuk">Kau√ßuk</MenuItem>
                        <MenuItem value="diƒüer">Diƒüer</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Kategori */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Kategori</InputLabel>
                      <Select
                        value={formData.category || ''}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="stratejik">Stratejik</MenuItem>
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="rutin">Rutin</MenuItem>
                        <MenuItem value="genel">Genel</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* E≈üle≈ütirme Nedeni */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="E≈üle≈ütirme Nedeni"
                      multiline
                      rows={3}
                      value={formData.reason || ''}
                      onChange={(e) => setFormData({ ...formData, reason: e.target.value })}
                      placeholder="Bu e≈üle≈ütirmenin nedenini a√ßƒ±klayƒ±n (√∂rn: Risk azaltma, yedek tedarik, maliyet optimizasyonu)"
                      helperText="E≈üle≈ütirmenin amacƒ±nƒ± ve gerek√ßesini belirtin"
                    />
                  </Grid>

                  {/* √ñnerilen ƒ∞nceleme Tarihi */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="ƒ∞lk ƒ∞nceleme Tarihi"
                      type="date"
                      value={formData.firstReviewDate || new Date().toISOString().split('T')[0]}
                      onChange={(e) => setFormData({ ...formData, firstReviewDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      helperText="E≈üle≈ütirmenin ne zaman g√∂zden ge√ßirileceƒüi"
                    />
                  </Grid>

                  {/* ƒ∞nceleme Periyodu */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>ƒ∞nceleme Periyodu</InputLabel>
                      <Select
                        value={formData.reviewPeriod || '3'}
                        onChange={(e) => setFormData({ ...formData, reviewPeriod: e.target.value })}
                      >
                        <MenuItem value="1">1 Ay</MenuItem>
                        <MenuItem value="3">3 Ay</MenuItem>
                        <MenuItem value="6">6 Ay</MenuItem>
                        <MenuItem value="12">12 Ay</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Ek Notlar */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Ek Notlar"
                      multiline
                      rows={2}
                      value={formData.notes || ''}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      placeholder="Varsa ek bilgiler ve √∂zel durumlar"
                    />
                  </Grid>

                  {/* Risk Deƒüerlendirmesi */}
                  <Grid item xs={12}>
                    <Typography variant="subtitle2" gutterBottom color="text.secondary">
                      Risk Deƒüerlendirmesi
                    </Typography>
                    <FormControl fullWidth>
                      <InputLabel>Risk Seviyesi</InputLabel>
                      <Select
                        value={formData.riskLevel || 'd√º≈ü√ºk'}
                        onChange={(e) => setFormData({ ...formData, riskLevel: e.target.value })}
                      >
                        <MenuItem value="d√º≈ü√ºk">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="success.main" borderRadius="50%" />
                            D√º≈ü√ºk Risk
                          </Box>
                        </MenuItem>
                        <MenuItem value="orta">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="warning.main" borderRadius="50%" />
                            Orta Risk
                          </Box>
                        </MenuItem>
                        <MenuItem value="y√ºksek">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="error.main" borderRadius="50%" />
                            Y√ºksek Risk
                          </Box>
                        </MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'audit' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <Typography variant="h6" gutterBottom color="primary">
                      Denetim Planlama
                    </Typography>
                  </Grid>
                  
                  {/* Tedarik√ßi Se√ßimi */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Tedarik√ßi</InputLabel>
                      <Select
                        value={formData.supplierId || ''}
                        onChange={(e) => setFormData({ ...formData, supplierId: e.target.value })}
                      >
                        {suppliers.map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            <Box display="flex" alignItems="center" gap={1}>
                              <BusinessIcon fontSize="small" />
                              {supplier.name} - {supplier.riskLevel} risk
                            </Box>
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Denetim T√ºr√º */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Denetim T√ºr√º</InputLabel>
                      <Select
                        value={formData.auditType || 'planlƒ±'}
                        onChange={(e) => setFormData({ ...formData, auditType: e.target.value })}
                      >
                        <MenuItem value="planlƒ±">Planlƒ± Denetim</MenuItem>
                        <MenuItem value="ani">Ani Denetim</MenuItem>
                        <MenuItem value="takip">Takip Denetimi</MenuItem>
                        <MenuItem value="acil">Acil Denetim</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Denetim Tarihi */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Denetim Tarihi"
                      type="date"
                      value={formData.auditDate || ''}
                      onChange={(e) => setFormData({ ...formData, auditDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      required
                    />
                  </Grid>

                  {/* Denet√ßi */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Denet√ßi Adƒ±"
                      value={formData.auditorName || ''}
                      onChange={(e) => setFormData({ ...formData, auditorName: e.target.value })}
                      required
                    />
                  </Grid>

                  {/* Denetim Kapsamƒ± */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Denetim Kapsamƒ±"
                      multiline
                      rows={3}
                      value={formData.auditScope || ''}
                      onChange={(e) => setFormData({ ...formData, auditScope: e.target.value })}
                      placeholder="Denetim kapsamƒ±nƒ± belirtin (√∂rn: Kalite sistemi, √ºretim s√ºre√ßleri, dok√ºman kontrol√º)"
                    />
                  </Grid>

                  {/* √ñzel Notlar */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="√ñzel Notlar"
                      multiline
                      rows={2}
                      value={formData.auditNotes || ''}
                      onChange={(e) => setFormData({ ...formData, auditNotes: e.target.value })}
                      placeholder="Denetim ile ilgili √∂zel durumlar veya dikkat edilmesi gerekenler"
                    />
                  </Grid>
                </Grid>
              </Box>
            )}
          </DialogContent>

          <DialogActions>
            <Button onClick={() => setDialogOpen(false)} color="inherit">
              ƒ∞ptal
            </Button>
            <Button onClick={handleSaveDialog} variant="contained" color="primary">
              {selectedItem ? 'G√ºncelle' : 'Kaydet'}
            </Button>
          </DialogActions>
        </Dialog>

        {/* Denetim Tarihi D√ºzenleme Dialog */}
        <Dialog open={auditDateDialogOpen} onClose={() => setAuditDateDialogOpen(false)} maxWidth="sm" fullWidth>
          <DialogTitle>
            <Box display="flex" alignItems="center" gap={1}>
              <ScheduleIcon color="primary" />
              Denetim Tarihi D√ºzenle
            </Box>
          </DialogTitle>
          <DialogContent>
            <Box sx={{ pt: 2 }}>
              {selectedSupplierForAudit && (
                <>
                  <Typography variant="body1" gutterBottom>
                    <strong>Tedarik√ßi:</strong> {selectedSupplierForAudit.name}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" gutterBottom sx={{ mb: 3 }}>
                    Mevcut denetim tarihi: {new Date(selectedSupplierForAudit.nextAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                  <TextField
                    fullWidth
                    label="Yeni Denetim Tarihi"
                    type="date"
                    value={newAuditDate}
                    onChange={(e) => setNewAuditDate(e.target.value)}
                    InputLabelProps={{ shrink: true }}
                    helperText="Denetim i√ßin yeni tarih se√ßin"
                  />
                </>
              )}
            </Box>
          </DialogContent>
          <DialogActions>
            <Button onClick={() => setAuditDateDialogOpen(false)} color="inherit">
              ƒ∞ptal
            </Button>
            <Button 
              onClick={handleSaveAuditDate} 
              variant="contained" 
              color="primary"
              disabled={!newAuditDate}
            >
              Tarihi G√ºncelle
            </Button>
                   </DialogActions>
         </Dialog>

        {/* Snackbar for notifications */}
        <Snackbar
          open={snackbar.open}
          autoHideDuration={6000}
          onClose={() => setSnackbar({ ...snackbar, open: false })}
          anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}
        >
          <Alert 
            onClose={() => setSnackbar({ ...snackbar, open: false })} 
            severity={snackbar.severity}
            variant="filled"
          >
            {snackbar.message}
          </Alert>
        </Snackbar>
      </Box>
    </ErrorBoundary>
  );
};

export default SupplierQualityManagement; 