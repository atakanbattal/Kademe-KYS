import React, { useState, useEffect } from 'react';
import {
  Typography, Box, Paper, Card, CardContent, CardHeader, Button, TextField,
  Select, MenuItem, FormControl, InputLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Chip, Table, TableBody, TableCell, TableContainer, TableHead,
  TableRow, Tabs, Tab, Avatar, Grid, IconButton, Tooltip, Alert, Snackbar,
  List, ListItem, ListItemText, ListItemIcon, Switch, FormControlLabel,
  Accordion, AccordionSummary, AccordionDetails, Badge, Divider, Checkbox,
  CircularProgress, Autocomplete, LinearProgress, ButtonGroup, TablePagination,
  Slider
} from '@mui/material';
import {
  Business as BusinessIcon, Add as AddIcon, Dashboard as DashboardIcon,
  Assessment as AssessmentIcon, Warning as WarningIcon, Edit as EditIcon,
  Delete as DeleteIcon, Link as LinkIcon, Schedule as ScheduleIcon,
  BugReport as BugReportIcon, Report as ReportIcon, CheckCircle as CheckCircleIcon,
  SwapHoriz as SwapHorizIcon, Visibility as ViewIcon, ExpandMore as ExpandMoreIcon,
  TrendingUp as TrendingUpIcon, Security as SecurityIcon, Star as StarIcon,
  Search as SearchIcon, Error as ErrorIcon, FileDownload as FileDownloadIcon,
  ArrowUpward as ArrowUpwardIcon, ArrowDownward as ArrowDownwardIcon, Info as InfoIcon,
  AssignmentTurnedIn as AssignmentTurnedInIcon
} from '@mui/icons-material';
import {
  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip as ChartTooltip,
  Legend, ResponsiveContainer, PieChart, Pie, Cell, BarChart, Bar,
  RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis
} from 'recharts';

// Enhanced interfaces for comprehensive supplier management
interface Supplier {
  id: string;
  name: string;
  type: 'onaylÄ±' | 'alternatif' | 'potansiyel' | 'bloklu';
  category: 'stratejik' | 'kritik' | 'rutin' | 'genel';
  // Yeni tedarik tÃ¼rÃ¼ alanlarÄ±
  supplyType: 'malzeme' | 'hizmet' | 'hibrit';
  supplySubcategories: string[];
  contact: {
    email: string;
    phone: string;
    address: string;
    contactPerson: string;
  };
  materialTypes: string[];
  performanceScore: number;
  qualityScore: number;
  deliveryScore: number;
  riskLevel: 'dÃ¼ÅŸÃ¼k' | 'orta' | 'yÃ¼ksek' | 'kritik';
  status: 'aktif' | 'pasif' | 'denetimde' | 'bloklu';
  registrationDate: string;
  lastAuditDate: string;
  nextAuditDate: string;
  auditStatus: 'planlÄ±' | 'gecikmiÅŸ' | 'tamamlandÄ±';
  nonconformityCount: number;
  defectCount: number;
  dofCount: number;
  isActive: boolean;
}

interface SupplierPair {
  id: string;
  primarySupplier?: Supplier; // Ana tedarikÃ§i opsiyonel
  alternativeSuppliers: Supplier[];
  category: string;
  performanceComparison: {
    primaryScore?: number; // Ana tedarikÃ§i yoksa opsiyonel
    alternativeScores: { id: string; score: number }[];
    recommendation: string;
  };
  lastReviewDate: string;
  nextReviewDate: string;
}

interface AuditRecord {
  id: string;
  supplierId: string;
  auditDate: string; // Planlanan tarih
  actualAuditDate?: string; // GerÃ§ekleÅŸtirilen tarih (opsiyonel)
  auditType: 'planlÄ±' | 'ani' | 'takip' | 'acil' | 'kapsamlÄ±';
  auditorName: string;
  score: number;
  findings: string[];
  status: 'planlÄ±' | 'devam_ediyor' | 'tamamlandÄ±' | 'gecikmiÅŸ' | 'iptal';
  nextAuditDate: string;
  isAutoScheduled: boolean;
  // Gecikme yÃ¶netimi
  delayReason?: string; // Gecikme aÃ§Ä±klamasÄ±
  delayDays?: number; // KaÃ§ gÃ¼n gecikti
  isDelayed?: boolean; // GecikmiÅŸ mi?
}

interface NonconformityRecord {
  id: string;
  supplierId: string;
  title: string;
  description: string;
  category: 'kalite' | 'teslimat' | 'dokÃ¼man' | 'servis';
  severity: 'kritik' | 'yÃ¼ksek' | 'orta' | 'dÃ¼ÅŸÃ¼k';
  detectedDate: string;
  status: 'aÃ§Ä±k' | 'araÅŸtÄ±rÄ±lÄ±yor' | 'dÃ¼zeltiliyor' | 'kapalÄ±';
  dueDate: string;
  correctionCost?: number; // Opsiyonel dÃ¼zeltme maliyeti
  dofId?: string;
  recurrence: boolean;
  // Yeni zorunlu alanlar
  partCode: string; // Zorunlu parÃ§a kodu
  quantityAffected?: number; // Kalite problemi iÃ§in etkilenen adet
  delayDays?: number; // Teslimat problemi iÃ§in gecikme gÃ¼nÃ¼
}

interface DefectRecord {
  id: string;
  supplierId: string;
  defectType: string;
  description: string;
  quantity: number;
  detectedDate: string;
  batchNumber: string;
  severity: 'kritik' | 'major' | 'minor';
  status: 'aÃ§Ä±k' | 'dÃ¼zeltildi' | 'kabul';
  correctionCost: number;
  dofId?: string;
}

// Otomatik denetim Ã¶nerisi interface
interface AutoAuditRecommendation {
  id: string;
  supplierId: string;
  supplierName: string;
  reason: string;
  urgencyLevel: 'dÃ¼ÅŸÃ¼k' | 'orta' | 'yÃ¼ksek' | 'kritik';
  recommendedDate: string;
  performanceIssues: string[];
  currentScore: number;
  previousScore: number;
  riskFactors: string[];
  auditType: 'performans' | 'kalite' | 'teslimat' | 'kapsamlÄ±';
  estimatedDuration: number; // hours
  priority: number; // 1-5
  autoGenerated: boolean;
  createdAt: string;
}

// Tedarik tÃ¼rÃ¼ alt kategorileri
const SUPPLY_SUBCATEGORIES = {
  malzeme: [
    'Ambalaj Malzemeleri',
    'BaÄŸlantÄ± ElemanlarÄ± ve Fittings',
    'Conta ve SÄ±zdÄ±rmazlÄ±k ElemanlarÄ±',
    'DiÅŸli ve DiÅŸli KutularÄ±',
    'Egzoz Sistemi ParÃ§alarÄ±',
    'Elektrik ve Elektronik ParÃ§alar',
    'Elektronik Komponentler',
    'Filtre Sistemleri (EndÃ¼striyel)',
    'Filtre Sistemleri (Hava, YaÄŸ, YakÄ±t)',
    'FÄ±rÃ§a Sistemleri (Cam Silecek, Temizlik)',
    'FÄ±rÃ§a ve Temizlik Sistemleri',
    'Fren Sistemi ParÃ§alarÄ±',
    'Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)',
    'Hidrolik Sistem ParÃ§alarÄ±',
    'Hidrolik ve PnÃ¶matik Komponentler',
    'Kabin Profil AlÄ±mÄ±',
    'Kablaj ve Elektrik BaÄŸlantÄ±larÄ±',
    'Karoseri ve Åasi ParÃ§alarÄ±',
    'Kavrama ve Fren Sistemi',
    'KayÄ±ÅŸ ve Zincir ParÃ§alarÄ±',
    'Kilit Sistemleri ve GÃ¼venlik',
    'Kilit ve GÃ¼venlik Sistemleri',
    'Kimyasal Maddeler (Boya, Temizlik)',
    'Koltuk Sistemleri ve Ä°Ã§ DonanÄ±m',
    'KompresÃ¶r ve Hava Kurutu',
    'Kontrol Sistemleri',
    'Lastik ve Jant',
    'Mil ve Åaft ParÃ§alarÄ±',
    'Motor ParÃ§alarÄ± (Piston, Volan, Blok)',
    'SensÃ¶rler ve AktÃ¼atÃ¶rler',
    'SoÄŸutma Sistemi ParÃ§alarÄ±',
    'Standart ParÃ§alar (Vida, Somun, Rondela)',
    'SÃ¼spansiyon ve Direksiyon ParÃ§alarÄ±',
    'ÅanzÄ±man ve AktarÄ±m OrganlarÄ±',
    'YaÄŸlama Malzemeleri',
    'YapÄ±ÅŸtÄ±rÄ±cÄ± ve SÄ±zdÄ±rmazlÄ±k Malzemeleri',
    'YarÄ± Mamul (Profil, Sac, Boru)',
    'Yataklar ve Yatak YuvalarÄ±',
    'Yay ve AmortisÃ¶r ParÃ§alarÄ±'
  ],
  hizmet: [
    'BakÄ±m ve OnarÄ±m Hizmetleri',
    'DanÄ±ÅŸmanlÄ±k Hizmetleri',
    'IsÄ±l Ä°ÅŸlem Hizmetleri',
    'Kalibrasyon Hizmetleri',
    'Lojistik ve Nakliye',
    'Makine Ä°ÅŸleme Hizmetleri',
    'TaÅŸeron Ä°ÅŸÃ§ilik (Kaynak, Montaj)',
    'Temizlik ve BakÄ±m Hizmetleri',
    'Test ve Muayene Hizmetleri',
    'YÃ¼zey Kaplama Hizmetleri'
  ],
  hibrit: [
    'Ä°ÅŸleme + Kaplama',
    'Malzeme + Lojistik',
    'Montaj + BakÄ±m',
    'TasarÄ±m + Ãœretim',
    'Test + Sertifikasyon',
    'Ãœretim + Test'
  ]
};

// Error Boundary Component
class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error: Error | null }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('ğŸš¨ SupplierQualityManagement Error Boundary yakaladÄ±:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <Box p={3}>
          <Alert severity="error" sx={{ mb: 2 }}>
            <Typography variant="h6" gutterBottom>
              TedarikÃ§i Kalite YÃ¶netimi ModÃ¼lÃ¼ HatasÄ±
            </Typography>
            <Typography variant="body2" gutterBottom>
              {this.state.error?.message || 'Bilinmeyen bir hata oluÅŸtu'}
            </Typography>
            <Button 
              variant="contained" 
              onClick={() => {
                this.setState({ hasError: false, error: null });
                window.location.reload();
              }}
              sx={{ mt: 2 }}
            >
              SayfayÄ± Yenile
            </Button>
          </Alert>
        </Box>
      );
    }

    return this.props.children;
  }
}

const SupplierQualityManagement: React.FC = () => {
  // State Management
  const [currentTab, setCurrentTab] = useState(0);
  const [suppliers, setSuppliers] = useState<Supplier[]>([]);
  const [supplierPairs, setSupplierPairs] = useState<SupplierPair[]>([]);
  const [audits, setAudits] = useState<AuditRecord[]>([]);
  const [nonconformities, setNonconformities] = useState<NonconformityRecord[]>([]);
  const [defects, setDefects] = useState<DefectRecord[]>([]);
  const [autoAuditRecommendations, setAutoAuditRecommendations] = useState<AutoAuditRecommendation[]>([]);
  
  // Dialog states
  const [dialogOpen, setDialogOpen] = useState(false);
  const [dialogType, setDialogType] = useState<'supplier' | 'pair' | 'nonconformity' | 'defect' | 'audit'>('supplier');
  const [selectedItem, setSelectedItem] = useState<any>(null);
  const [formData, setFormData] = useState<any>({});
  
  // Audit date edit dialog
  const [auditDateDialogOpen, setAuditDateDialogOpen] = useState(false);
  const [selectedSupplierForAudit, setSelectedSupplierForAudit] = useState<Supplier | null>(null);
  const [newAuditDate, setNewAuditDate] = useState('');
  
  // Audit execution dialog
  const [auditExecutionDialogOpen, setAuditExecutionDialogOpen] = useState(false);
  const [selectedAuditForExecution, setSelectedAuditForExecution] = useState<AuditRecord | null>(null);
  const [auditScore, setAuditScore] = useState<number>(0);
  const [auditFindings, setAuditFindings] = useState<string>('');
  const [auditActualDate, setAuditActualDate] = useState<string>('');
  const [auditDelayReason, setAuditDelayReason] = useState<string>('');
  const [delayDays, setDelayDays] = useState<number>(0);
  const [isDelayed, setIsDelayed] = useState<boolean>(false);
  
  // Audit details view dialog
  const [auditDetailsDialogOpen, setAuditDetailsDialogOpen] = useState(false);
  const [selectedAuditForView, setSelectedAuditForView] = useState<AuditRecord | null>(null);
  
  // Auto-audit settings
  const [autoAuditEnabled, setAutoAuditEnabled] = useState(true);
  const [auditInterval, setAuditInterval] = useState(90); // days
  
  // Performance radar settings
  const [selectedSuppliersForRadar, setSelectedSuppliersForRadar] = useState<string[]>([]);
  
  // Notification
  const [snackbar, setSnackbar] = useState({
    open: false,
    message: '',
    severity: 'success' as 'success' | 'error' | 'warning' | 'info'
  });

  // Search and filter states - TedarikÃ§i Listesi
  const [searchTerm, setSearchTerm] = useState('');
  const [supplierTypeFilter, setSupplierTypeFilter] = useState('all');
  const [supplierCategoryFilter, setSupplierCategoryFilter] = useState('all');
  const [supplierStatusFilter, setSupplierStatusFilter] = useState('all');
  const [supplierRiskFilter, setSupplierRiskFilter] = useState('all');
  const [selectedSuppliers, setSelectedSuppliers] = useState<string[]>([]);
  const [currentPage, setCurrentPage] = useState(0);
  const [rowsPerPage, setRowsPerPage] = useState(10);
  const [sortColumn, setSortColumn] = useState<string>('');
  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('asc');
  
  // Search and filter states - TedarikÃ§i EÅŸleÅŸtirme
  const [pairingSearchTerm, setPairingSearchTerm] = useState('');
  const [pairingCategoryFilter, setPairingCategoryFilter] = useState('all');
  const [pairingStatusFilter, setPairingStatusFilter] = useState('all'); // primary-missing, alternatives-only, complete

  // Supplier switch dialog states
  const [switchDialogOpen, setSwitchDialogOpen] = useState(false);
  const [selectedPairForSwitch, setSelectedPairForSwitch] = useState<SupplierPair | null>(null);
  const [selectedAlternativeForSwitch, setSelectedAlternativeForSwitch] = useState<string>('');

  // Load initial data
  const [dataLoaded, setDataLoaded] = React.useState(false);
  const [isLoading, setIsLoading] = React.useState(true);

  // localStorage Protection System - Component mount/unmount koruma
  useEffect(() => {
    console.log('ğŸ›¡ï¸ SupplierQualityManagement component MOUNT - localStorage korumasÄ± aktif - VERSION 2.0.0 DEPLOYED');
    
    // Component mount olduÄŸunda localStorage'Ä± backup'la
    const backupData = () => {
      const currentSuppliers = localStorage.getItem('suppliers');
      if (currentSuppliers && currentSuppliers !== '[]' && currentSuppliers !== 'null') {
        localStorage.setItem('suppliers-backup', currentSuppliers);
        console.log('ğŸ’¾ TedarikÃ§i verileri backup\'landÄ±');
      }
    };
    
    backupData();
    loadStoredData();
    
    // âŒ generateAutoAuditRecommendations ve syncDataConsistency Ã§aÄŸrÄ±larÄ± kaldÄ±rÄ±ldÄ±
    // Bu fonksiyonlar veri Ã§akÄ±ÅŸmasÄ± yaratÄ±yordu
    
    // Component unmount olduÄŸunda cleanup
    return () => {
      console.log('ğŸ›¡ï¸ SupplierQualityManagement component UNMOUNT - veri korumasÄ±');
      // Unmount sÄ±rasÄ±nda localStorage'Ä± koruma
      const currentData = localStorage.getItem('suppliers');
      if (!currentData || currentData === '[]' || currentData === 'null') {
        // Veri silinmiÅŸse backup'tan restore et
        const backupData = localStorage.getItem('suppliers-backup');
        if (backupData) {
          localStorage.setItem('suppliers', backupData);
          console.log('ğŸ”„ TedarikÃ§i verileri backup\'tan restore edildi');
        }
      }
    };
  }, []);

  // âŒ localStorage Monitoring DEVRE DIÅI - Ã‡akÄ±ÅŸma sorunu yaratÄ±yordu
  // Monitoring sistemi otomatik kaydetme ile Ã§akÄ±ÅŸÄ±p veri kaybÄ±na neden oluyordu

  // âŒ Veri tutarlÄ±lÄ±ÄŸÄ± kontrolÃ¼ DEVRE DIÅI - Ã‡akÄ±ÅŸma sorunu yaratÄ±yordu
  // syncDataConsistency fonksiyonu otomatik kaydetme ile Ã§akÄ±ÅŸÄ±p veri kaybÄ±na neden oluyordu

  // ğŸš€ SÃœPER GÃœÃ‡LENDÄ°RÄ°LMÄ°Å OTOMATÄ°K KAYDETME SÄ°STEMÄ° - Veri kaybolmasÄ±nÄ± Ã¶nlemek iÃ§in
  // Suppliers deÄŸiÅŸtiÄŸinde otomatik kaydet - VERÄ° KAYBI ENGELLEME V2.0
  useEffect(() => {
    if (dataLoaded) {
      try {
        localStorage.setItem('suppliers', JSON.stringify(suppliers));
        localStorage.setItem('suppliers-backup', JSON.stringify(suppliers));
        localStorage.setItem('suppliers-timestamp', Date.now().toString());
        console.log('âœ… Suppliers otomatik localStorage\'a kaydedildi - BACKUP DAHIL');
      } catch (error) {
        console.error('âŒ Suppliers localStorage kaydetme hatasÄ±:', error);
      }
    }
  }, [suppliers, dataLoaded]);

  // Supplier pairs deÄŸiÅŸtiÄŸinde otomatik kaydet - VERÄ° KAYBI ENGELLEME V2.0
  useEffect(() => {
    if (dataLoaded) {
      try {
        localStorage.setItem('supplier-pairs', JSON.stringify(supplierPairs));
        localStorage.setItem('supplier-pairs-backup', JSON.stringify(supplierPairs));
        localStorage.setItem('supplier-pairs-timestamp', Date.now().toString());
        console.log('âœ… Supplier pairs otomatik localStorage\'a kaydedildi - BACKUP DAHIL');
      } catch (error) {
        console.error('âŒ Supplier pairs localStorage kaydetme hatasÄ±:', error);
      }
    }
  }, [supplierPairs, dataLoaded]);

  // Nonconformities deÄŸiÅŸtiÄŸinde otomatik kaydet
  useEffect(() => {
    if (dataLoaded) {
      try {
        localStorage.setItem('supplier-nonconformities', JSON.stringify(nonconformities));
        console.log('âœ… Nonconformities otomatik localStorage\'a kaydedildi');
      } catch (error) {
        console.error('âŒ Nonconformities localStorage kaydetme hatasÄ±:', error);
      }
    }
  }, [nonconformities, dataLoaded]);

  // Defects deÄŸiÅŸtiÄŸinde otomatik kaydet
  useEffect(() => {
    if (dataLoaded) {
      try {
        localStorage.setItem('supplier-defects', JSON.stringify(defects));
        console.log('âœ… Defects otomatik localStorage\'a kaydedildi');
      } catch (error) {
        console.error('âŒ Defects localStorage kaydetme hatasÄ±:', error);
      }
    }
  }, [defects, dataLoaded]);

  // Audits deÄŸiÅŸtiÄŸinde otomatik kaydet
  useEffect(() => {
    if (dataLoaded) {
      try {
        localStorage.setItem('supplier-audits', JSON.stringify(audits));
        console.log('âœ… Audits otomatik localStorage\'a kaydedildi');
      } catch (error) {
        console.error('âŒ Audits localStorage kaydetme hatasÄ±:', error);
      }
    }
  }, [audits, dataLoaded]);

  // MANUEL KAYDETME FONKSÄ°YONLARI - Acil durum iÃ§in
  const saveToLocalStorage = () => {
    try {
      localStorage.setItem('suppliers', JSON.stringify(suppliers));
      localStorage.setItem('supplier-nonconformities', JSON.stringify(nonconformities));
      localStorage.setItem('supplier-defects', JSON.stringify(defects));
      localStorage.setItem('supplier-pairs', JSON.stringify(supplierPairs));
      localStorage.setItem('supplier-audits', JSON.stringify(audits)); // EKSÄ°K AUDIT VERÄ°LERÄ° EKLENDÄ°
      console.log('ğŸ’¾ TÃ¼m tedarikÃ§i verileri (denetimler dahil) manuel olarak localStorage\'a kaydedildi');
    } catch (error) {
      console.error('âŒ localStorage kaydetme hatasÄ±:', error);
    }
  };

  const loadStoredData = () => {
    try {
      // ğŸš¨ ACÄ°L KURTARMA SÄ°STEMÄ° - VERÄ° KAYBI ENGELLEME V2.0
      // localStorage'dan verileri yÃ¼kle - BACKUP kontrollÃ¼
      let storedSuppliers = localStorage.getItem('suppliers');
      let storedNonconformities = localStorage.getItem('supplier-nonconformities');
      let storedDefects = localStorage.getItem('supplier-defects');
      let storedPairs = localStorage.getItem('supplier-pairs');
      let storedAudits = localStorage.getItem('supplier-audits');
      
      // EÄŸer ana veri yoksa veya bozuksa backup'tan yÃ¼kle
      if (!storedSuppliers || storedSuppliers === 'null' || storedSuppliers === '[]') {
        storedSuppliers = localStorage.getItem('suppliers-backup');
        console.log('ğŸ”„ Suppliers backup\'tan yÃ¼klendi');
      }
      if (!storedPairs || storedPairs === 'null' || storedPairs === '[]') {
        storedPairs = localStorage.getItem('supplier-pairs-backup');
        console.log('ğŸ”„ Supplier pairs backup\'tan yÃ¼klendi');
      }
      
      console.log('ğŸ” localStorage kontrol:', {
        suppliers: !!storedSuppliers,
        suppliersLength: storedSuppliers ? JSON.parse(storedSuppliers).length : 0,
        nonconformities: !!storedNonconformities,
        defects: !!storedDefects,
        pairs: !!storedPairs,
        audits: !!storedAudits
      });
      
      // Veri yÃ¼kleme baÅŸarÄ±sÄ±zlÄ±k kontrolÃ¼ - hasAnyData kaldÄ±rÄ±ldÄ±
      
      if (storedSuppliers && storedSuppliers !== 'null' && storedSuppliers !== '[]') {
        const parsedSuppliers = JSON.parse(storedSuppliers);
        if (parsedSuppliers.length > 0) {
          setSuppliers(parsedSuppliers);
          console.log('âœ… TedarikÃ§i verileri localStorage\'dan yÃ¼klendi:', parsedSuppliers.length, 'kayÄ±t');
        }
      }
      
      if (storedNonconformities && storedNonconformities !== 'null' && storedNonconformities !== '[]') {
        const parsedNonconformities = JSON.parse(storedNonconformities);
        if (parsedNonconformities.length > 0) {
          setNonconformities(parsedNonconformities);
          console.log('âœ… Uygunsuzluk verileri localStorage\'dan yÃ¼klendi:', parsedNonconformities.length, 'kayÄ±t');
        }
      }
      
      if (storedDefects && storedDefects !== 'null' && storedDefects !== '[]') {
        const parsedDefects = JSON.parse(storedDefects);
        if (parsedDefects.length > 0) {
          setDefects(parsedDefects);
          console.log('âœ… Hata verileri localStorage\'dan yÃ¼klendi:', parsedDefects.length, 'kayÄ±t');
        }
      }
      
      if (storedPairs && storedPairs !== 'null' && storedPairs !== '[]') {
        const parsedPairs = JSON.parse(storedPairs);
        if (parsedPairs.length > 0) {
          setSupplierPairs(parsedPairs);
          console.log('âœ… EÅŸleÅŸtirme verileri localStorage\'dan yÃ¼klendi:', parsedPairs.length, 'kayÄ±t');
        }
      }
      
      if (storedAudits && storedAudits !== 'null' && storedAudits !== '[]') {
        const parsedAudits = JSON.parse(storedAudits);
        if (parsedAudits.length > 0) {
          setAudits(parsedAudits);
          console.log('âœ… Denetim verileri localStorage\'dan yÃ¼klendi:', parsedAudits.length, 'kayÄ±t');
        }
      }
      
      // Veri yÃ¼kleme tamamlandÄ± - otomatik mock veri yÃ¼kleme kaldÄ±rÄ±ldÄ±
        setDataLoaded(true);
        setIsLoading(false);
        console.log('ğŸ¯ TedarikÃ§i modÃ¼lÃ¼ veri yÃ¼kleme tamamlandÄ±');
      
    } catch (error) {
      console.error('âŒ localStorage veri yÃ¼kleme hatasÄ±:', error);
      // Hata durumunda boÅŸ array'ler ile baÅŸla - mock veri yÃ¼kleme kaldÄ±rÄ±ldÄ±
      setSuppliers([]);
      setNonconformities([]);
      setDefects([]);
      setSupplierPairs([]);
      setAudits([]);
      setDataLoaded(true);
      setIsLoading(false);
    } finally {
      setIsLoading(false);
    }
  };

  const loadMockData = () => {
    // Mock data - gerÃ§ek uygulamada API'den gelecek
    const mockSuppliers: Supplier[] = [
      // Ana tedarikÃ§iler (OnaylÄ±)
      {
        id: 'SUP-001',
        name: 'SeÃ§kinler Metal A.Å.',
        type: 'onaylÄ±',
        category: 'stratejik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)', 'YarÄ± Mamul (Profil, Sac, Boru)'],
        contact: {
          email: 'info@seckinlermetal.com',
          phone: '+90 212 555 0123',
          address: 'Ä°stanbul Sanayi Sitesi',
          contactPerson: 'Ahmet SeÃ§kin'
        },
        materialTypes: ['St 37 YapÄ± Ã‡eliÄŸi', 'DKP SaÃ§ (Derin Ã‡ekme)'],
        performanceScore: 92,
        qualityScore: 95,
        deliveryScore: 88,
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'aktif',
        registrationDate: '2020-01-15',
        lastAuditDate: '2024-06-15',
        nextAuditDate: '2025-06-15',
        auditStatus: 'planlÄ±',
        nonconformityCount: 2,
        defectCount: 1,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-002',
        name: 'Nisa Metal Ltd.',

        type: 'alternatif',
        category: 'stratejik',
        supplyType: 'hizmet',
        supplySubcategories: ['TaÅŸeron Ä°ÅŸÃ§ilik (Kaynak, Montaj)', 'BakÄ±m ve OnarÄ±m Hizmetleri'],
        contact: {
          email: 'info@nisametal.com',
          phone: '+90 212 555 0124',
          address: 'Bursa Sanayi Sitesi',
          contactPerson: 'Fatma Nisa'
        },
        materialTypes: ['S 235 JR YapÄ± Ã‡eliÄŸi', 'Elektro Galvanizli SaÃ§'],
        performanceScore: 87,
        qualityScore: 90,
        deliveryScore: 85,
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'aktif',
        registrationDate: '2021-03-20',
        lastAuditDate: '2024-07-10',
        nextAuditDate: '2025-07-10',
        auditStatus: 'planlÄ±',
        nonconformityCount: 1,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-003',
        name: 'Demir DÃ¶kÃ¼m Sanayi A.Å.',
        type: 'onaylÄ±',
        category: 'kritik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)', 'Standart ParÃ§alar (Vida, Somun, Rondela)'],
        contact: {
          email: 'contact@demirdokum.com',
          phone: '+90 232 555 0145',
          address: 'Ä°zmir AliaÄŸa Organize Sanayi',
          contactPerson: 'Cemil Demir'
        },
        materialTypes: ['GGG-40 KÃ¼resel Grafitli DÃ¶kÃ¼m', 'DIN 912 Ä°mbus CÄ±vata'],
        performanceScore: 89,
        qualityScore: 91,
        deliveryScore: 87,
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'aktif',
        registrationDate: '2019-07-22',
        lastAuditDate: '2024-05-20',
        nextAuditDate: '2025-05-20',
        auditStatus: 'planlÄ±',
        nonconformityCount: 3,
        defectCount: 2,
        dofCount: 1,
        isActive: true
      },
      {
        id: 'SUP-004',
        name: 'AltÄ±n Kaynak Teknolojileri Ltd.',
        type: 'alternatif',
        category: 'kritik',
        supplyType: 'hizmet',
        supplySubcategories: ['TaÅŸeron Ä°ÅŸÃ§ilik (Kaynak, Montaj)', 'Test ve Muayene Hizmetleri'],
        contact: {
          email: 'info@altinkaynak.com',
          phone: '+90 262 555 0167',
          address: 'Kocaeli Gebze Organize Sanayi',
          contactPerson: 'Mustafa AltÄ±n'
        },
        materialTypes: ['Galvanizli SaÃ§', 'S 355 JR YÃ¼ksek Mukavemetli Ã‡elik'],
        performanceScore: 84,
        qualityScore: 88,
        deliveryScore: 81,
        riskLevel: 'orta',
        status: 'aktif',
        registrationDate: '2020-11-18',
        lastAuditDate: '2024-08-12',
        nextAuditDate: '2025-08-12',
        auditStatus: 'planlÄ±',
        nonconformityCount: 4,
        defectCount: 3,
        dofCount: 1,
        isActive: true
      },
      // DÃ¼ÅŸÃ¼k performanslÄ± tedarikÃ§iler (otomatik denetim Ã¶nerisi iÃ§in)
      {
        id: 'SUP-005',
        name: 'Problematik Metal San. Tic.',
        type: 'onaylÄ±',
        category: 'kritik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)'],
        contact: {
          email: 'info@problematikmetal.com',
          phone: '+90 212 555 0567',
          address: 'Ankara Organize Sanayi',
          contactPerson: 'Mehmet Problem'
        },
        materialTypes: ['DDQ SaÃ§ (Ekstra Derin Ã‡ekme)'],
        performanceScore: 65, // DÃ¼ÅŸÃ¼k performans
        qualityScore: 68, // DÃ¼ÅŸÃ¼k kalite
        deliveryScore: 70, // DÃ¼ÅŸÃ¼k teslimat
        riskLevel: 'yÃ¼ksek',
        status: 'aktif',
        registrationDate: '2019-03-20',
        lastAuditDate: '2022-12-15', // Eski denetim
        nextAuditDate: '2024-12-15',
        auditStatus: 'gecikmiÅŸ',
        nonconformityCount: 8, // YÃ¼ksek uygunsuzluk
        defectCount: 6, // YÃ¼ksek hata
        dofCount: 3,
        isActive: true
      },
      {
        id: 'SUP-006',
        name: 'Kalitesiz Ãœretim A.Å.',
        type: 'onaylÄ±',
        category: 'kritik',
        supplyType: 'malzeme',
        supplySubcategories: ['YarÄ± Mamul (Profil, Sac, Boru)'],
        contact: {
          email: 'kalite@kalitesizuretim.com',
          phone: '+90 216 555 0789',
          address: 'Ä°zmir AtatÃ¼rk Organize Sanayi',
          contactPerson: 'AyÅŸe Kalitesiz'
        },
        materialTypes: ['AA 6061 AlÃ¼minyum AlaÅŸÄ±mÄ±', 'PE-HD Polietilen (YÃ¼ksek YoÄŸunluklu)'],
        performanceScore: 58, // Ã‡ok dÃ¼ÅŸÃ¼k performans
        qualityScore: 60, // Ã‡ok dÃ¼ÅŸÃ¼k kalite
        deliveryScore: 65, // DÃ¼ÅŸÃ¼k teslimat
        riskLevel: 'kritik',
        status: 'aktif',
        registrationDate: '2018-11-10',
        lastAuditDate: '2022-08-20', // Ã‡ok eski denetim
        nextAuditDate: '2023-08-20',
        auditStatus: 'gecikmiÅŸ',
        nonconformityCount: 12, // Ã‡ok yÃ¼ksek uygunsuzluk
        defectCount: 9, // Ã‡ok yÃ¼ksek hata
        dofCount: 5,
        isActive: true
      },
      // Ek tedarikÃ§iler
      {
        id: 'SUP-007',
        name: 'Premium Ã‡elik Teknolojileri A.Å.',
        type: 'onaylÄ±',
        category: 'stratejik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)', 'YarÄ± Mamul (Profil, Sac, Boru)'],
        contact: {
          email: 'sales@premiumcelik.com',
          phone: '+90 224 555 0201',
          address: 'Bursa NilÃ¼fer Organize Sanayi',
          contactPerson: 'Hasan Premium'
        },
        materialTypes: ['AISI 304 Paslanmaz Ã‡elik', 'AISI 316 Paslanmaz Ã‡elik'],
        performanceScore: 95,
        qualityScore: 97,
        deliveryScore: 93,
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'aktif',
        registrationDate: '2021-05-12',
        lastAuditDate: '2024-09-10',
        nextAuditDate: '2025-09-10',
        auditStatus: 'planlÄ±',
        nonconformityCount: 0,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-008',
        name: 'GÃ¼ven Makine ParÃ§alarÄ± Ltd.',
        type: 'alternatif',
        category: 'rutin',
        supplyType: 'hibrit',
        supplySubcategories: ['Standart ParÃ§alar (Vida, Somun, Rondela)', 'Montaj + BakÄ±m'],
        contact: {
          email: 'info@guvenmakine.com',
          phone: '+90 274 555 0298',
          address: 'Edirne Sanayi Sitesi',
          contactPerson: 'Ali GÃ¼ven'
        },
        materialTypes: ['Bronz Yatak Malzemesi', 'DIN 931 AltÄ± KÃ¶ÅŸe CÄ±vata'],
        performanceScore: 79,
        qualityScore: 82,
        deliveryScore: 77,
        riskLevel: 'orta',
        status: 'aktif',
        registrationDate: '2020-09-15',
        lastAuditDate: '2024-04-18',
        nextAuditDate: '2025-04-18',
        auditStatus: 'planlÄ±',
        nonconformityCount: 5,
        defectCount: 4,
        dofCount: 2,
        isActive: true
      },
      {
        id: 'SUP-009',
        name: 'Elektronik Sistem Ã‡Ã¶zÃ¼mleri A.Å.',
        type: 'onaylÄ±',
        category: 'genel',
        supplyType: 'malzeme',
        supplySubcategories: ['Elektronik Komponentler'],
        contact: {
          email: 'teknik@elektroniksistem.com',
          phone: '+90 312 555 0345',
          address: 'Ankara Ostim Sanayi Sitesi',
          contactPerson: 'Zeynep Elektronik'
        },
        materialTypes: ['PCB BaskÄ± Devre KartlarÄ±', 'IC Entegre Devreler', 'KonnektÃ¶rler ve Soketler'],
        performanceScore: 86,
        qualityScore: 89,
        deliveryScore: 84,
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'aktif',
        registrationDate: '2022-01-08',
        lastAuditDate: '2024-07-25',
        nextAuditDate: '2025-07-25',
        auditStatus: 'planlÄ±',
        nonconformityCount: 2,
        defectCount: 1,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-010',
        name: 'Kimya EndÃ¼stri Malzemeleri Ltd.',
        type: 'potansiyel',
        category: 'genel',
        supplyType: 'malzeme',
        supplySubcategories: ['Kimyasal Maddeler (Boya, Temizlik)'],
        contact: {
          email: 'musteri@kimyaendus.com',
          phone: '+90 264 555 0412',
          address: 'AdapazarÄ± Organize Sanayi',
          contactPerson: 'Erkan Kimya'
        },
        materialTypes: ['NBR Nitril KauÃ§uk', 'Seramik Malzemeler'],
        performanceScore: 75,
        qualityScore: 78,
        deliveryScore: 73,
        riskLevel: 'orta',
        status: 'aktif',
        registrationDate: '2023-03-14',
        lastAuditDate: '2024-10-05',
        nextAuditDate: '2025-10-05',
        auditStatus: 'planlÄ±',
        nonconformityCount: 3,
        defectCount: 2,
        dofCount: 1,
        isActive: true
      },
      // N/A puanlÄ± tedarikÃ§iler - HenÃ¼z deÄŸerlendirilmemiÅŸ
      {
        id: 'SUP-011',
        name: 'Yeni DeÄŸerlendirilmemiÅŸ Metal A.Å.',
        type: 'potansiyel',
        category: 'stratejik',
        supplyType: 'malzeme',
        supplySubcategories: ['Ham Madde (Ã‡elik, AlÃ¼minyum, Plastik)'],
        contact: {
          email: 'info@yenimetal.com',
          phone: '+90 312 555 0888',
          address: 'Ankara Sanayi Sitesi',
          contactPerson: 'Yeni DeÄŸerlendirme'
        },
        materialTypes: ['Ã‡elik Malzemeler'],
        performanceScore: -1, // N/A deÄŸeri (-1 olarak kodlanmÄ±ÅŸ)
        qualityScore: -1, // N/A deÄŸeri
        deliveryScore: -1, // N/A deÄŸeri
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'denetimde',
        registrationDate: '2024-11-01',
        lastAuditDate: '',
        nextAuditDate: '2024-12-15',
        auditStatus: 'planlÄ±',
        nonconformityCount: 0,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-012',
        name: 'Beklemede Olan TedarikÃ§i Ltd.',
        type: 'potansiyel',
        category: 'kritik',
        supplyType: 'hizmet',
        supplySubcategories: ['Test ve Muayene Hizmetleri'],
        contact: {
          email: 'info@beklemede.com',
          phone: '+90 216 555 0999',
          address: 'Ä°stanbul Pendik',
          contactPerson: 'Beklemede KiÅŸi'
        },
        materialTypes: ['Test EkipmanlarÄ±'],
        performanceScore: -1, // N/A deÄŸeri
        qualityScore: -1, // N/A deÄŸeri 
        deliveryScore: -1, // N/A deÄŸeri
        riskLevel: 'orta',
        status: 'denetimde',
        registrationDate: '2024-10-15',
        lastAuditDate: '',
        nextAuditDate: '2024-12-20',
        auditStatus: 'planlÄ±',
        nonconformityCount: 0,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      },
      {
        id: 'SUP-013',
        name: 'DeÄŸerlendirme AÅŸamasÄ±ndaki Firma',
        type: 'potansiyel',
        category: 'rutin',
        supplyType: 'malzeme',
        supplySubcategories: ['Standart ParÃ§alar (Vida, Somun, Rondela)'],
        contact: {
          email: 'info@degerlendirme.com',
          phone: '+90 232 555 0777',
          address: 'Ä°zmir KemalpaÅŸa',
          contactPerson: 'DeÄŸerlendirme Sorumlusu'
        },
        materialTypes: ['BaÄŸlantÄ± ElemanlarÄ±'],
        performanceScore: -1, // N/A deÄŸeri
        qualityScore: -1, // N/A deÄŸeri
        deliveryScore: -1, // N/A deÄŸeri
        riskLevel: 'dÃ¼ÅŸÃ¼k',
        status: 'denetimde',
        registrationDate: '2024-11-20',
        lastAuditDate: '',
        nextAuditDate: '2025-01-15',
        auditStatus: 'planlÄ±',
        nonconformityCount: 0,
        defectCount: 0,
        dofCount: 0,
        isActive: true
      }
    ];

    const mockPairs: SupplierPair[] = [
      {
        id: 'PAIR-001',
        primarySupplier: mockSuppliers.find(s => s.id === 'SUP-001')!,
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-002')!, mockSuppliers.find(s => s.id === 'SUP-007')!],
        category: 'stratejik',
        performanceComparison: {
          primaryScore: 92,
          alternativeScores: [
            { id: 'SUP-002', score: 87 },
            { id: 'SUP-007', score: 95 }
          ],
          recommendation: 'SUP-007 Premium Ã‡elik alternatifi deÄŸerlendirilmeli'
        },
        lastReviewDate: '2024-10-15',
        nextReviewDate: '2025-04-15'
      },
      {
        id: 'PAIR-002',
        primarySupplier: mockSuppliers.find(s => s.id === 'SUP-003')!,
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-008')!],

        category: 'kritik',
        performanceComparison: {
          primaryScore: 89,
          alternativeScores: [{ id: 'SUP-008', score: 79 }],
          recommendation: 'Ana tedarikÃ§i performansÄ± Ã¼stÃ¼n'
        },
        lastReviewDate: '2024-11-20',
        nextReviewDate: '2025-05-20'
      },
      {
        id: 'PAIR-003',
        primarySupplier: mockSuppliers.find(s => s.id === 'SUP-009')!,
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-004')!],

        category: 'genel',
        performanceComparison: {
          primaryScore: 86,
          alternativeScores: [{ id: 'SUP-004', score: 84 }],
          recommendation: 'Mevcut performans dengeli'
        },
        lastReviewDate: '2024-09-12',
        nextReviewDate: '2025-03-12'
      },
      {
        id: 'PAIR-004',
        primarySupplier: mockSuppliers.find(s => s.id === 'SUP-005')!,
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-007')!, mockSuppliers.find(s => s.id === 'SUP-001')!],

        category: 'kritik',
        performanceComparison: {
          primaryScore: 65,
          alternativeScores: [
            { id: 'SUP-007', score: 95 },
            { id: 'SUP-001', score: 92 }
          ],
          recommendation: 'ACÄ°L: Ana tedarikÃ§i deÄŸiÅŸimi gerekli - her iki alternatif daha Ã¼stÃ¼n'
        },
        lastReviewDate: '2024-11-25',
        nextReviewDate: '2024-12-25'
      },
      {
        id: 'PAIR-005',
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-006')!],
        category: 'genel',
        performanceComparison: {
          alternativeScores: [{ id: 'SUP-006', score: 58 }],
          recommendation: 'Ana tedarikÃ§i atanmasÄ± gerekli - alternatif tedarikÃ§i mevcut'
        },
        lastReviewDate: '2024-10-30',
        nextReviewDate: '2025-04-30'
      },
      {
        id: 'PAIR-006',
        primarySupplier: mockSuppliers.find(s => s.id === 'SUP-004')!,
        alternativeSuppliers: [mockSuppliers.find(s => s.id === 'SUP-002')!, mockSuppliers.find(s => s.id === 'SUP-008')!],
        category: 'rutin',
        performanceComparison: {
          primaryScore: 84,
          alternativeScores: [
            { id: 'SUP-002', score: 87 },
            { id: 'SUP-008', score: 79 }
          ],
          recommendation: 'Nisa Metal alternatifi ana tedarikÃ§iden daha Ã¼stÃ¼n performansta'
        },
        lastReviewDate: '2024-11-01',
        nextReviewDate: '2025-05-01'
      }
    ];

    // Mock audit records - Planlanan denetimler (Ã§eÅŸitli durumlar)
    const mockAudits: AuditRecord[] = [
      // Tamamlanan denetim - planlanan tarihte
      {
        id: 'AUDIT-001',
        supplierId: 'SUP-001',
        auditDate: '2024-11-15', // Planlanan tarih
        actualAuditDate: '2024-11-15', // GerÃ§ekleÅŸtirilen tarih (aynÄ± gÃ¼n)
        auditType: 'planlÄ±',
        auditorName: 'Kalite MÃ¼dÃ¼rÃ¼ - Ahmet YÄ±lmaz',
        score: 92,
        findings: ['Kalite standartlarÄ± yeterli', 'DokÃ¼mantasyon tam'],
        status: 'tamamlandÄ±',
        nextAuditDate: '2025-11-15',
        isAutoScheduled: false,
        delayDays: 0,
        isDelayed: false
      },
      // Tamamlanan denetim - gecikmeyle
      {
        id: 'AUDIT-002',
        supplierId: 'SUP-002',
        auditDate: '2024-10-20', // Planlanan tarih
        actualAuditDate: '2024-10-27', // 7 gÃ¼n gecikmeyle gerÃ§ekleÅŸti
        auditType: 'takip',
        auditorName: 'Denetim UzmanÄ± - Fatma Demir',
        score: 87,
        findings: ['Ä°yileÅŸtirmeler uygulanmÄ±ÅŸ', 'KÃ¼Ã§Ã¼k eksikler giderilmiÅŸ'],
        status: 'tamamlandÄ±',
        nextAuditDate: '2025-04-20',
        isAutoScheduled: false,
        delayDays: 7,
        delayReason: 'TedarikÃ§inin Ã¼retim yoÄŸunluÄŸu nedeniyle talep ettiÄŸi gecikme',
        isDelayed: true
      },
      // GecikmiÅŸ denetim - henÃ¼z yapÄ±lmamÄ±ÅŸ
      {
        id: 'AUDIT-003',
        supplierId: 'SUP-005',
        auditDate: '2024-11-25', // Planlanan tarih geÃ§ti
        auditType: 'acil',
        auditorName: 'BaÅŸ DenetÃ§i - Mehmet Ã–ztÃ¼rk',
        score: 0,
        findings: [],
        status: 'gecikmiÅŸ',
        nextAuditDate: '2025-03-25',
        isAutoScheduled: true,
        delayDays: 9, // BugÃ¼n 4 AralÄ±k olduÄŸuna gÃ¶re
        delayReason: 'TedarikÃ§i tesisinde yangÄ±n nedeniyle denetim ertelendi',
        isDelayed: true
      },
      // Devam eden denetim
      {
        id: 'AUDIT-004',
        supplierId: 'SUP-006',
        auditDate: '2024-12-02', // Planlanan tarih
        actualAuditDate: '2024-12-03', // 1 gÃ¼n gecikmeyle baÅŸladÄ±
        auditType: 'kapsamlÄ±',
        auditorName: 'Kalite Kontrol - AyÅŸe Kaya',
        score: 0,
        findings: ['Ä°lk bulgular kaydediliyor'],
        status: 'devam_ediyor',
        nextAuditDate: '2025-06-02',
        isAutoScheduled: true,
        delayDays: 1,
        delayReason: 'DenetÃ§i hastalÄ±ÄŸÄ± nedeniyle 1 gÃ¼n ertelendi',
        isDelayed: true
      },
      // Ä°leride planlanan denetim
      {
        id: 'AUDIT-005',
        supplierId: 'SUP-003',
        auditDate: '2024-12-20', // Ä°leride planlanan
        auditType: 'planlÄ±',
        auditorName: 'Sistem DenetÃ§isi - Murat Ã‡elik',
        score: 0,
        findings: [],
        status: 'planlÄ±',
        nextAuditDate: '2025-12-20',
        isAutoScheduled: false,
        delayDays: 0,
        isDelayed: false
      },
      // Ä°ptal edilen denetim
      {
        id: 'AUDIT-006',
        supplierId: 'SUP-007',
        auditDate: '2024-11-10', // Planlanan tarih
        auditType: 'takip',
        auditorName: 'Kalite UzmanÄ± - Elif YÄ±lmaz',
        score: 0,
        findings: [],
        status: 'iptal',
        nextAuditDate: '2025-01-15',
        isAutoScheduled: false,
        delayReason: 'TedarikÃ§i sÃ¶zleÅŸme yenileme sÃ¼reci nedeniyle iptal edildi',
        isDelayed: false
      },
      // Yeni planlanan denetim
      {
        id: 'AUDIT-007',
        supplierId: 'SUP-008',
        auditDate: '2025-01-10', // Gelecek ay planlanan
        auditType: 'planlÄ±',
        auditorName: 'Denetim KoordinatÃ¶rÃ¼ - Serkan AydÄ±n',
        score: 0,
        findings: [],
        status: 'planlÄ±',
        nextAuditDate: '2025-07-10',
        isAutoScheduled: false,
        delayDays: 0,
        isDelayed: false
      }
    ];



    // Mock nonconformity records
    const mockNonconformities: NonconformityRecord[] = [
      {
        id: 'NC-001',
        supplierId: 'SUP-001',
        title: 'Boyut SapmasÄ±',
        description: 'Ã‡elik levhalarda boyut toleransÄ± aÅŸÄ±mÄ± tespit edildi',
        category: 'kalite',
        severity: 'yÃ¼ksek',
        detectedDate: '2024-11-15',
        status: 'aÃ§Ä±k',
        dueDate: '2024-12-15',
        correctionCost: 15000,
        recurrence: false,
        partCode: 'CL-001',
        quantityAffected: 25
      },
      {
        id: 'NC-002',
        supplierId: 'SUP-005',
        title: 'Teslimat Gecikmesi',
        description: 'Planlanan teslimat tarihinden 5 gÃ¼n gecikme',
        category: 'teslimat',
        severity: 'orta',
        detectedDate: '2024-11-20',
        status: 'araÅŸtÄ±rÄ±lÄ±yor',
        dueDate: '2024-12-20',
        correctionCost: 8000,
        recurrence: true,
        partCode: 'PM-002',
        delayDays: 5
      },
      {
        id: 'NC-003',
        supplierId: 'SUP-006',
        title: 'Kalite SertifikasÄ± Eksik',
        description: 'Malzeme sertifikasÄ± zamanÄ±nda teslim edilmedi',
        category: 'dokÃ¼man',
        severity: 'kritik',
        detectedDate: '2024-11-25',
        status: 'aÃ§Ä±k',
        dueDate: '2024-12-10',
        correctionCost: 12000,
        recurrence: false,
        partCode: 'SR-003'
      }
    ];

    // Mock defect records
    const mockDefects: DefectRecord[] = [
      {
        id: 'DEF-001',
        supplierId: 'SUP-001',
        defectType: 'Kaynak HatasÄ±',
        description: 'Kaynak dikiÅŸlerinde porozite tespit edildi',
        quantity: 12,
        detectedDate: '2024-11-10',
        batchNumber: 'BT-2024-001',
        severity: 'major',
        status: 'aÃ§Ä±k',
        correctionCost: 18000
      },
      {
        id: 'DEF-002',
        supplierId: 'SUP-005',
        defectType: 'Boyut HatasÄ±',
        description: 'ParÃ§a boyutlarÄ±nda tolerans dÄ±ÅŸÄ± sapma',
        quantity: 8,
        detectedDate: '2024-11-18',
        batchNumber: 'BT-2024-002',
        severity: 'kritik',
        status: 'dÃ¼zeltildi',
        correctionCost: 22000
      },
      {
        id: 'DEF-003',
        supplierId: 'SUP-006',
        defectType: 'YÃ¼zey Kalitesi',
        description: 'YÃ¼zey pÃ¼rÃ¼zlÃ¼lÃ¼ÄŸÃ¼ standart dÄ±ÅŸÄ±',
        quantity: 15,
        detectedDate: '2024-11-22',
        batchNumber: 'BT-2024-003',
        severity: 'minor',
        status: 'aÃ§Ä±k',
        correctionCost: 9500
      }
    ];

    setSuppliers(mockSuppliers);
    setSupplierPairs(mockPairs);
    setAudits(mockAudits);
    setNonconformities(mockNonconformities);
    setDefects(mockDefects);
    
    // LocalStorage'a kaydet
    saveToLocalStorage();
    
    // Veri yÃ¼kleme tamamlandÄ±ÄŸÄ±nÄ± iÅŸaretle
    setDataLoaded(true);
    setIsLoading(false);
    console.log('ğŸ¯ Mock tedarikÃ§i verileri yÃ¼klendi ve dataLoaded true oldu');
    console.log('ğŸ“Š YÃ¼klenen veriler:', {
      suppliers: mockSuppliers.length,
      pairs: mockPairs.length,
      audits: mockAudits.length,
      nonconformities: mockNonconformities.length,
      defects: mockDefects.length
    });
    
    // Auto-audit check
    if (autoAuditEnabled) {
      checkAutoAuditRequirements(mockSuppliers);
    }
  };

  // Veri tutarlÄ±lÄ±ÄŸÄ±nÄ± kontrol et ve senkronize et
  const syncDataConsistency = () => {
    console.log('ğŸ”„ Veri tutarlÄ±lÄ±ÄŸÄ± kontrol ediliyor...');
    
    // EÅŸleÅŸtirmelerdeki tedarikÃ§ilerin ana listede olup olmadÄ±ÄŸÄ±nÄ± kontrol et
    const missingSuppliers: string[] = [];
    
    supplierPairs.forEach(pair => {
      // Ana tedarikÃ§i kontrolÃ¼
      if (!suppliers.find(s => s.id === pair.primarySupplier.id)) {
        missingSuppliers.push(pair.primarySupplier.id);
      }
      
      // Alternatif tedarikÃ§iler kontrolÃ¼
      pair.alternativeSuppliers.forEach(altSupplier => {
        if (!suppliers.find(s => s.id === altSupplier.id)) {
          missingSuppliers.push(altSupplier.id);
        }
      });
    });
    
    if (missingSuppliers.length > 0) {
      console.warn('âš ï¸ EÅŸleÅŸtirmelerde eksik tedarikÃ§iler tespit edildi:', missingSuppliers);
      showSnackbar(`${missingSuppliers.length} tedarikÃ§i eÅŸleÅŸtirmede var ama ana listede yok. Veriler senkronize ediliyor...`, 'warning');
      
      // Eksik tedarikÃ§ileri eÅŸleÅŸtirmelerden ana listeye ekle
      const suppliersToAdd: Supplier[] = [];
      
      supplierPairs.forEach(pair => {
        if (!suppliers.find(s => s.id === pair.primarySupplier.id)) {
          suppliersToAdd.push(pair.primarySupplier);
        }
        
        pair.alternativeSuppliers.forEach(altSupplier => {
          if (!suppliers.find(s => s.id === altSupplier.id) && 
              !suppliersToAdd.find(s => s.id === altSupplier.id)) {
            suppliersToAdd.push(altSupplier);
          }
        });
      });
      
      if (suppliersToAdd.length > 0) {
        const updatedSuppliers = [...suppliers, ...suppliersToAdd];
        setSuppliers(updatedSuppliers);
        console.log('âœ… Eksik tedarikÃ§iler ana listeye eklendi:', suppliersToAdd.map(s => s.name));
        showSnackbar(`${suppliersToAdd.length} tedarikÃ§i ana listeye eklendi`, 'success');
      }
    } else {
      console.log('âœ… Veri tutarlÄ±lÄ±ÄŸÄ± kontrol edildi - sorun yok');
    }
  };

  // Cache temizleme fonksiyonu
  const clearSupplierCache = () => {
    try {
      localStorage.removeItem('suppliers');
      localStorage.removeItem('supplier-nonconformities');
      localStorage.removeItem('supplier-defects');
      localStorage.removeItem('supplier-pairs');
      localStorage.removeItem('supplier-audits');
      console.log('ğŸ—‘ï¸ TedarikÃ§i cache temizlendi');
      
      // State'leri temizle
      setSuppliers([]);
      setNonconformities([]);
      setDefects([]);
      setSupplierPairs([]);
      setAudits([]);
      
      showSnackbar('TedarikÃ§i verileri cache\'i temizlendi. Yeni veriler girilebilir.', 'info');
    } catch (error) {
      console.error('âŒ Cache temizleme hatasÄ±:', error);
      showSnackbar('Cache temizleme sÄ±rasÄ±nda hata oluÅŸtu', 'error');
    }
  };

  // Auto-audit system
  const checkAutoAuditRequirements = (suppliers: Supplier[]) => {
    const today = new Date();
    suppliers.forEach(supplier => {
      const nextAudit = new Date(supplier.nextAuditDate);
      const daysDiff = Math.ceil((nextAudit.getTime() - today.getTime()) / (1000 * 3600 * 24));
      
      if (daysDiff <= 30 || supplier.performanceScore < 70) {
        scheduleAutoAudit(supplier);
      }
    });
  };

  const scheduleAutoAudit = (supplier: Supplier) => {
    showSnackbar(`${supplier.name} iÃ§in otomatik denetim planlandÄ±`, 'warning');
  };

  // Otomatik denetim Ã¶nerisi oluÅŸturma
  const generateAutoAuditRecommendations = () => {
    const recommendations: AutoAuditRecommendation[] = [];
    const today = new Date();

    suppliers.forEach(supplier => {
      const performanceIssues: string[] = [];
      const riskFactors: string[] = [];
      let shouldRecommendAudit = false;
      let urgencyLevel: 'dÃ¼ÅŸÃ¼k' | 'orta' | 'yÃ¼ksek' | 'kritik' = 'dÃ¼ÅŸÃ¼k';
      let auditType: 'performans' | 'kalite' | 'teslimat' | 'kapsamlÄ±' = 'performans';
      let priority = 1;

      // Performans skorlarÄ± kontrolÃ¼
      if (supplier.performanceScore < 70) {
        performanceIssues.push(`Genel performans skoru dÃ¼ÅŸÃ¼k: ${supplier.performanceScore}/100`);
        shouldRecommendAudit = true;
        urgencyLevel = 'yÃ¼ksek';
        priority = 4;
      } else if (supplier.performanceScore < 80) {
        performanceIssues.push(`Performans skoru ortalamanÄ±n altÄ±nda: ${supplier.performanceScore}/100`);
        shouldRecommendAudit = true;
        urgencyLevel = 'orta';
        priority = 3;
      }

      // Kalite skoru kontrolÃ¼
      if (supplier.qualityScore < 75) {
        performanceIssues.push(`Kalite skoru dÃ¼ÅŸÃ¼k: ${supplier.qualityScore}/100`);
        riskFactors.push('Kalite standartlarÄ±nÄ±n altÄ±nda performans');
        shouldRecommendAudit = true;
        auditType = 'kalite';
        if (urgencyLevel === 'dÃ¼ÅŸÃ¼k') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // Teslimat skoru kontrolÃ¼
      if (supplier.deliveryScore < 75) {
        performanceIssues.push(`Teslimat skoru dÃ¼ÅŸÃ¼k: ${supplier.deliveryScore}/100`);
        riskFactors.push('Teslimat gÃ¼venilirliÄŸi dÃ¼ÅŸÃ¼k');
        shouldRecommendAudit = true;
        auditType = 'teslimat';
        if (urgencyLevel === 'dÃ¼ÅŸÃ¼k') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // Uygunsuzluk sayÄ±sÄ± kontrolÃ¼
      if (supplier.nonconformityCount > 5) {
        performanceIssues.push(`YÃ¼ksek uygunsuzluk sayÄ±sÄ±: ${supplier.nonconformityCount} adet`);
        riskFactors.push('Tekrarlayan kalite sorunlarÄ±');
        shouldRecommendAudit = true;
        urgencyLevel = 'yÃ¼ksek';
        priority = Math.max(priority, 4);
      }

      // Hata sayÄ±sÄ± kontrolÃ¼
      if (supplier.defectCount > 3) {
        performanceIssues.push(`YÃ¼ksek hata sayÄ±sÄ±: ${supplier.defectCount} adet`);
        riskFactors.push('SÄ±k hata oluÅŸumu');
        shouldRecommendAudit = true;
        priority = Math.max(priority, 3);
      }

      // Risk seviyesi kontrolÃ¼
      if (supplier.riskLevel === 'kritik' || supplier.riskLevel === 'yÃ¼ksek') {
        riskFactors.push(`${supplier.riskLevel.charAt(0).toUpperCase() + supplier.riskLevel.slice(1)} risk seviyesi`);
        shouldRecommendAudit = true;
        urgencyLevel = supplier.riskLevel === 'kritik' ? 'kritik' : 'yÃ¼ksek';
        priority = supplier.riskLevel === 'kritik' ? 5 : 4;
      }

      // Son denetim tarihi kontrolÃ¼
      const lastAuditDate = new Date(supplier.lastAuditDate);
      const monthsSinceLastAudit = Math.floor((today.getTime() - lastAuditDate.getTime()) / (1000 * 60 * 60 * 24 * 30));
      
      if (monthsSinceLastAudit > 12) {
        riskFactors.push(`Son denetimden bu yana ${monthsSinceLastAudit} ay geÃ§ti`);
        shouldRecommendAudit = true;
        if (urgencyLevel === 'dÃ¼ÅŸÃ¼k') urgencyLevel = 'orta';
        priority = Math.max(priority, 3);
      }

      // Ã–nerilen tarih hesaplama
      let recommendedDays = 30; // default
      if (urgencyLevel === 'kritik') recommendedDays = 3;
      else if (urgencyLevel === 'yÃ¼ksek') recommendedDays = 7;
      else if (urgencyLevel === 'orta') recommendedDays = 14;

      const recommendedDate = new Date(today.getTime() + (recommendedDays * 24 * 60 * 60 * 1000));

      // SÃ¼re tahmini
      let estimatedDuration = 4; // hours
      if (performanceIssues.length > 3) estimatedDuration = 6;

      // KapsamlÄ± denetim gereksinimi
      if (performanceIssues.length > 2 && riskFactors.length > 2) {
        estimatedDuration = 8;
        priority = Math.max(priority, 4);
      }

      if (shouldRecommendAudit) {
        const recommendation: AutoAuditRecommendation = {
          id: `AUTO-${supplier.id}-${Date.now()}`,
          supplierId: supplier.id,
          supplierName: supplier.name,
          reason: `Performans gÃ¶stergeleri denetim gerekliliÄŸi iÅŸaret ediyor. ${performanceIssues.join(', ')}`,
          urgencyLevel,
          recommendedDate: recommendedDate.toISOString().split('T')[0],
          performanceIssues,
          currentScore: supplier.performanceScore,
          previousScore: supplier.performanceScore + Math.floor(Math.random() * 20) - 10, // Simulated previous score
          riskFactors,
          auditType,
          estimatedDuration,
          priority,
          autoGenerated: true,
          createdAt: today.toISOString()
        };

        recommendations.push(recommendation);
      }
    });

    // Ã–nceliÄŸe gÃ¶re sÄ±rala
    recommendations.sort((a, b) => b.priority - a.priority);
    setAutoAuditRecommendations(recommendations);
    
    if (recommendations.length > 0) {
      showSnackbar(`${recommendations.length} otomatik denetim Ã¶nerisi oluÅŸturuldu`, 'info');
    } else {
      showSnackbar('Åu anda denetim Ã¶nerisi gerektiren tedarikÃ§i bulunmuyor', 'success');
    }
  };

  // Otomatik denetim Ã¶nerisini kabul etme
  const acceptAuditRecommendation = (recommendation: AutoAuditRecommendation) => {
    const newAudit: AuditRecord = {
      id: `AUD-${Date.now()}`,
      supplierId: recommendation.supplierId,
      auditDate: recommendation.recommendedDate,
      auditType: 'planlÄ±',
      auditorName: 'Kalite Ekibi',
      score: 0,
      findings: [],
      status: 'planlÄ±',
      nextAuditDate: '',
      isAutoScheduled: true
    };

    setAudits(prev => [...prev, newAudit]);
    
    // Ã–neriyi listeden Ã§Ä±kar
    setAutoAuditRecommendations(prev => 
      prev.filter(rec => rec.id !== recommendation.id)
    );

    showSnackbar(`${recommendation.supplierName} iÃ§in denetim planlandÄ±`, 'success');
  };

  // Otomatik denetim Ã¶nerisini reddetme
  const rejectAuditRecommendation = (recommendationId: string) => {
    setAutoAuditRecommendations(prev => 
      prev.filter(rec => rec.id !== recommendationId)
    );
    showSnackbar('Denetim Ã¶nerisi reddedildi', 'info');
  };

  // DÃ–F Integration - Prefill form ile DÃ–F formunu direkt aÃ§ma
  const createDOFFromNonconformity = (nonconformity: NonconformityRecord) => {
    const supplier = suppliers.find(s => s.id === nonconformity.supplierId);
    if (!supplier) return;

    try {
      // DÃ–F form prefill data oluÅŸtur
      const dofPrefillData = {
        title: `TedarikÃ§i UygunsuzluÄŸu - ${supplier.name}`,
        description: `TedarikÃ§i: ${supplier.name}
Uygunsuzluk BaÅŸlÄ±ÄŸÄ±: ${nonconformity.title}
AÃ§Ä±klama: ${nonconformity.description}
Kategori: ${nonconformity.category}
ParÃ§a Kodu: ${nonconformity.partCode}
Tespit Tarihi: ${nonconformity.detectedDate}
${nonconformity.quantityAffected ? `Etkilenen Miktar: ${nonconformity.quantityAffected} adet` : ''}
${nonconformity.delayDays ? `Gecikme SÃ¼resi: ${nonconformity.delayDays} gÃ¼n` : ''}`,
        department: 'SatÄ±n Alma',
        responsible: 'Atakan Battal',
        priority: nonconformity.severity === 'kritik' ? 'critical' : 
                  nonconformity.severity === 'yÃ¼ksek' ? 'high' : 
                  nonconformity.severity === 'orta' ? 'medium' : 'low',
        source: 'SupplierQualityManagement',
        sourceId: nonconformity.id,
        supplierInfo: {
          name: supplier.name,
          category: supplier.category,
          contactPerson: supplier.contact.contactPerson
        }
      };

      // Prefill data'yÄ± localStorage'a kaydet (DÃ–F modÃ¼lÃ¼nÃ¼n beklediÄŸi format)
      const prefillWrapper = {
        prefillData: dofPrefillData
      };
      localStorage.setItem('dof-form-prefill', JSON.stringify(prefillWrapper));
      localStorage.setItem('dof-auto-open-form', 'true');

      // Update nonconformity with DOF creation flag
      const updatedNonconformities = nonconformities.map(nc => 
        nc.id === nonconformity.id ? { ...nc, dofId: 'creating' } : nc
      );
      setNonconformities(updatedNonconformities);

      showSnackbar(`DÃ–F formu prefill verilerle aÃ§Ä±lÄ±yor...`, 'info');
      
      // DÃ–F form sayfasÄ±nÄ± yeni sekmede aÃ§
      window.open('/dof-8d-management', '_blank');
    } catch (error) {
      console.error('DÃ–F oluÅŸturma hatasÄ±:', error);
      showSnackbar('DÃ–F oluÅŸturulurken hata oluÅŸtu', 'error');
    }
  };

  // Utility functions
  const showSnackbar = (message: string, severity: 'success' | 'error' | 'warning' | 'info') => {
    setSnackbar({ open: true, message, severity });
  };

  // Supplier switch functions
  const handleOpenSwitchDialog = (pair: SupplierPair) => {
    if (pair.alternativeSuppliers.length === 0) {
      showSnackbar('Bu eÅŸleÅŸtirmede alternatif tedarikÃ§i bulunmuyor', 'warning');
      return;
    }
    
    if (pair.alternativeSuppliers.length === 1) {
      // Tek alternatif varsa doÄŸrudan deÄŸiÅŸtir
      handleDirectSwitch(pair, pair.alternativeSuppliers[0]);
      return;
    }
    
    // Birden fazla alternatif varsa dialog aÃ§
    setSelectedPairForSwitch(pair);
    setSelectedAlternativeForSwitch('');
    setSwitchDialogOpen(true);
  };

  const handleDirectSwitch = (pair: SupplierPair, selectedAlternative: Supplier) => {
    const remainingAlternatives = pair.alternativeSuppliers.filter(s => s.id !== selectedAlternative.id);
    if (pair.primarySupplier) {
      remainingAlternatives.push(pair.primarySupplier);
    }
    
    const updatedPair = {
      ...pair,
      primarySupplier: selectedAlternative,
      alternativeSuppliers: remainingAlternatives,
      performanceComparison: {
        primaryScore: selectedAlternative.performanceScore,
        alternativeScores: remainingAlternatives.map(s => ({ id: s.id, score: s.performanceScore })),
        recommendation: `${selectedAlternative.name} ana tedarikÃ§i olarak seÃ§ildi`
      },
      lastReviewDate: new Date().toISOString().split('T')[0]
    };
    
    // Supplier pairs'i gÃ¼ncelle
    const updatedPairs = supplierPairs.map(p => 
      p.id === pair.id ? updatedPair : p
    );
    setSupplierPairs(updatedPairs);
    
    // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
    localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
    console.log('ğŸ’¾ TedarikÃ§i deÄŸiÅŸimi localStorage\'a kaydedildi');
    window.dispatchEvent(new Event('supplierDataUpdated'));
    
    showSnackbar(`${selectedAlternative.name} ana tedarikÃ§i olarak seÃ§ildi`, 'success');
  };

  const handleConfirmSwitch = () => {
    if (!selectedPairForSwitch || !selectedAlternativeForSwitch) {
      showSnackbar('LÃ¼tfen bir alternatif tedarikÃ§i seÃ§in', 'error');
      return;
    }
    
    const selectedAlternative = selectedPairForSwitch.alternativeSuppliers.find(s => s.id === selectedAlternativeForSwitch);
    if (!selectedAlternative) {
      showSnackbar('SeÃ§ilen tedarikÃ§i bulunamadÄ±', 'error');
      return;
    }
    
    handleDirectSwitch(selectedPairForSwitch, selectedAlternative);
    setSwitchDialogOpen(false);
    setSelectedPairForSwitch(null);
    setSelectedAlternativeForSwitch('');
  };

  // Dialog handlers for all button functionalities
  const handleCreateSupplier = () => {
    setDialogType('supplier');
    setSelectedItem(null);
    setFormData({
      name: '',
      type: 'onaylÄ±',
      category: 'genel',
      supplyType: 'malzeme',
      supplySubcategories: [],
      contact: { email: '', phone: '', address: '', contactPerson: '' },
      materialTypes: [],
      performanceScore: 88,
      qualityScore: 88,
      deliveryScore: 90,
      riskLevel: 'dÃ¼ÅŸÃ¼k',
      status: 'aktif'
    });
    setDialogOpen(true);
  };

  const handleCreatePair = () => {
    setDialogType('pair');
    setSelectedItem(null);
    setFormData({
      primarySupplierId: '',
      alternativeSupplierIds: [],
      category: 'genel'
    });
    setDialogOpen(true);
  };

  const handleCreateNonconformity = () => {
    setDialogType('nonconformity');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      title: '',
      description: '',
      category: 'kalite',
      severity: 'dÃ¼ÅŸÃ¼k',
      detectedDate: new Date().toISOString().split('T')[0],
      status: 'aÃ§Ä±k',
      dueDate: '',
      partCode: '', // Zorunlu alan
      quantityAffected: undefined,
      delayDays: undefined,
      recurrence: false
    });
    setDialogOpen(true);
  };

  const handleCreateDefect = () => {
    setDialogType('defect');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      defectType: '',
      description: '',
      quantity: 0,
      detectedDate: new Date().toISOString().split('T')[0],
      batchNumber: '',
      severity: 'minor',
      status: 'aÃ§Ä±k',
      correctionCost: 0
    });
    setDialogOpen(true);
  };

  const handleCreateAudit = () => {
    setDialogType('audit');
    setSelectedItem(null);
    setFormData({
      supplierId: '',
      auditDate: '',
      auditType: 'planlÄ±',
      auditorName: '',
      findings: [],
      status: 'planlÄ±'
    });
    setDialogOpen(true);
  };

  const handleEditAuditDate = (supplier: Supplier) => {
    setSelectedSupplierForAudit(supplier);
    setNewAuditDate(supplier.nextAuditDate);
    setAuditDateDialogOpen(true);
  };

  const handleSaveAuditDate = () => {
    if (selectedSupplierForAudit && newAuditDate) {
      const updatedSuppliers = suppliers.map(supplier => 
        supplier.id === selectedSupplierForAudit.id 
          ? { ...supplier, nextAuditDate: newAuditDate }
          : supplier
      );
      setSuppliers(updatedSuppliers);
      setAuditDateDialogOpen(false);
      setSelectedSupplierForAudit(null);
      setNewAuditDate('');
      showSnackbar(`${selectedSupplierForAudit.name} denetim tarihi gÃ¼ncellendi`, 'success');
    }
  };

  // Gecikme hesaplama fonksiyonu
  const calculateDelayDays = (plannedDate: string, actualDate: string): number => {
    const planned = new Date(plannedDate);
    const actual = new Date(actualDate);
    const diffTime = actual.getTime() - planned.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays > 0 ? diffDays : 0;
  };

  const handleExecuteAudit = (audit: AuditRecord) => {
    setSelectedAuditForExecution(audit);
    setAuditScore(0);
    setAuditFindings('');
    setAuditDelayReason('');
    const today = new Date().toISOString().split('T')[0];
    setAuditActualDate(today);
    
    // Gecikme hesaplama
    const delayDays = calculateDelayDays(audit.auditDate, today);
    setDelayDays(delayDays);
    setIsDelayed(delayDays > 0);
    
    setAuditExecutionDialogOpen(true);
  };

  // Denetim tarihini deÄŸiÅŸtirdiÄŸinde gecikmeyi yeniden hesapla
  const handleAuditDateChange = (newDate: string) => {
    setAuditActualDate(newDate);
    if (selectedAuditForExecution) {
      const delayDays = calculateDelayDays(selectedAuditForExecution.auditDate, newDate);
      setDelayDays(delayDays);
      setIsDelayed(delayDays > 0);
      
      // EÄŸer gecikme kalktÄ±ysa gecikme aÃ§Ä±klamasÄ±nÄ± temizle
      if (delayDays === 0) {
        setAuditDelayReason('');
      }
    }
  };

  // Denetim detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leme fonksiyonu
  const handleViewAuditDetails = (audit: AuditRecord) => {
    setSelectedAuditForView(audit);
    setAuditDetailsDialogOpen(true);
  };

  const handleSaveAuditExecution = () => {
    if (!selectedAuditForExecution || auditScore === 0) {
      showSnackbar('LÃ¼tfen geÃ§erli bir puan girin', 'error');
      return;
    }

    if (!auditActualDate) {
      showSnackbar('LÃ¼tfen denetim gerÃ§ekleÅŸme tarihini seÃ§in', 'error');
      return;
    }

    // Gecikme varsa aÃ§Ä±klama zorunlu
    if (isDelayed && !auditDelayReason.trim()) {
      showSnackbar('Gecikme varsa aÃ§Ä±klama girmeniz zorunludur', 'error');
      return;
    }
      
    // Denetim kaydÄ±nÄ± gÃ¼ncelle
    const updatedAudits = audits.map(audit => 
      audit.id === selectedAuditForExecution.id 
        ? { 
            ...audit, 
            status: 'tamamlandÄ±' as const,
            actualAuditDate: auditActualDate, // SeÃ§ilen gerÃ§ekleÅŸme tarihini kullan
            score: auditScore,
            findings: auditFindings ? auditFindings.split('\n').filter(f => f.trim()) : [],
            delayDays: delayDays,
            isDelayed: isDelayed,
            delayReason: isDelayed ? auditDelayReason : undefined
          }
        : audit
    );
    setAudits(updatedAudits);

    // TedarikÃ§i performans puanÄ±nÄ± gÃ¼ncelle
    const supplier = suppliers.find(s => s.id === selectedAuditForExecution.supplierId);
    if (supplier) {
      const updatedSuppliers = suppliers.map(s => 
        s.id === supplier.id 
          ? { 
              ...s, 
              performanceScore: auditScore,
              lastAuditDate: auditActualDate, // SeÃ§ilen gerÃ§ekleÅŸme tarihini kullan
              auditStatus: 'tamamlandÄ±' as const,
              status: 'aktif' as const // Denetim tamamlandÄ±ÄŸÄ±nda aktif yap
            }
          : s
      );
      setSuppliers(updatedSuppliers);
      showSnackbar(`${supplier.name} denetimi baÅŸarÄ±yla tamamlandÄ±`, 'success');
    }

    // Dialog'u kapat ve form'u temizle
    setAuditExecutionDialogOpen(false);
    setSelectedAuditForExecution(null);
    setAuditScore(0);
    setAuditFindings('');
    setAuditActualDate('');
    setAuditDelayReason('');
    setDelayDays(0);
    setIsDelayed(false);
  };

  const handleEditItem = (item: any, type: string) => {
    setDialogType(type as any);
    setSelectedItem(item);
    
    // DÃ¼zenleme iÃ§in form data'yÄ± doÄŸru ÅŸekilde hazÄ±rla
    let editFormData = { ...item };
    
    // TedarikÃ§i dÃ¼zenlemesi iÃ§in Ã¶zel hazÄ±rlama
    if (type === 'supplier') {
      editFormData = {
        ...item,
        // Contact bilgilerini gÃ¼vence altÄ±na al
        contact: {
          email: item.contact?.email || '',
          phone: item.contact?.phone || '',
          address: item.contact?.address || '',
          contactPerson: item.contact?.contactPerson || ''
        },
        // Array alanlarÄ±nÄ± gÃ¼vence altÄ±na al
        materialTypes: item.materialTypes || [],
        supplySubcategories: item.supplySubcategories || [],
        // SkorlarÄ± gÃ¼vence altÄ±na al
        qualityScore: item.qualityScore || 0,
        deliveryScore: item.deliveryScore || 0,
        performanceScore: item.performanceScore || 0,
        // DiÄŸer alanlarÄ± gÃ¼vence altÄ±na al
        supplyType: item.supplyType || 'malzeme',
        type: item.type || 'onaylÄ±',
        category: item.category || 'genel',
        riskLevel: item.riskLevel || 'dÃ¼ÅŸÃ¼k',
        status: item.status || 'aktif'
      };
    }
    
    setFormData(editFormData);
    setDialogOpen(true);
    
    console.log('ğŸ”§ DÃ¼zenleme iÃ§in form hazÄ±rlandÄ±:', { type, original: item, prepared: editFormData });
  };

  const handleDeleteItem = (id: string, type: string) => {
    // Silme onay mesajÄ±nÄ± tÃ¼re gÃ¶re Ã¶zelleÅŸtir
    let confirmMessage = 'Bu kaydÄ± silmek istediÄŸinizden emin misiniz?';
    let itemName = '';
    
    if (type === 'supplier') {
      const supplier = suppliers.find(s => s.id === id);
      itemName = supplier ? supplier.name : 'Bilinmeyen TedarikÃ§i';
      confirmMessage = `"${itemName}" tedarikÃ§isini ve ilgili tÃ¼m kayÄ±tlarÄ±nÄ± (eÅŸleÅŸtirmeler, uygunsuzluklar, hatalar, denetimler) silmek istediÄŸinizden emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!`;
    } else if (type === 'pair') {
      confirmMessage = 'Bu tedarikÃ§i eÅŸleÅŸtirmesini silmek istediÄŸinizden emin misiniz?';
    } else if (type === 'nonconformity') {
      confirmMessage = 'Bu uygunsuzluk kaydÄ±nÄ± silmek istediÄŸinizden emin misiniz?';
    } else if (type === 'defect') {
      confirmMessage = 'Bu hata kaydÄ±nÄ± silmek istediÄŸinizden emin misiniz?';
    } else if (type === 'audit') {
      confirmMessage = 'Bu denetim planÄ±nÄ± silmek istediÄŸinizden emin misiniz?';
    }
    
    if (window.confirm(confirmMessage)) {
      switch (type) {
        case 'supplier':
          // Silinecek tedarikÃ§iyi bul
          const supplierToDelete = suppliers.find(s => s.id === id);
          if (!supplierToDelete) {
            showSnackbar('TedarikÃ§i bulunamadÄ±', 'error');
            break;
          }
          
          // TedarikÃ§i listesinden kaldÄ±r
          const updatedSuppliers = suppliers.filter(s => s.id !== id);
          setSuppliers(updatedSuppliers);
          
          // EÅŸleÅŸtirmelerden temizle
          const cleanedPairs = supplierPairs.filter(pair => {
            // Ana tedarikÃ§i bu deÄŸilse ve alternatif listesinde yoksa eÅŸleÅŸtirmeyi koru
            return pair.primarySupplier.id !== id && 
                   !pair.alternativeSuppliers.some(alt => alt.id === id);
          }).map(pair => {
            // Alternatif listesinden kaldÄ±r (varsa)
            const filteredAlternatives = pair.alternativeSuppliers.filter(alt => alt.id !== id);
            if (filteredAlternatives.length !== pair.alternativeSuppliers.length) {
              // Alternatif skor listesini de gÃ¼ncelle
              const updatedAlternativeScores = pair.performanceComparison.alternativeScores.filter(score => score.id !== id);
              return {
                ...pair,
                alternativeSuppliers: filteredAlternatives,
                performanceComparison: {
                  ...pair.performanceComparison,
                  alternativeScores: updatedAlternativeScores
                }
              };
            }
            return pair;
          });
          setSupplierPairs(cleanedPairs);
          
          // Ä°lgili uygunsuzluklarÄ± sil
          const cleanedNonconformities = nonconformities.filter(n => n.supplierId !== id);
          setNonconformities(cleanedNonconformities);
          
          // Ä°lgili hatalarÄ± sil
          const cleanedDefects = defects.filter(d => d.supplierId !== id);
          setDefects(cleanedDefects);
          
          // Ä°lgili denetimleri sil
          const cleanedAudits = audits.filter(a => a.supplierId !== id);
          setAudits(cleanedAudits);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ TedarikÃ§i ve ilgili tÃ¼m kayÄ±tlar silindi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar(
            `${supplierToDelete.name} tedarikÃ§isi ve ilgili tÃ¼m kayÄ±tlar baÅŸarÄ±yla silindi`,
            'success'
          );
          break;
        case 'pair':
          const updatedPairs = supplierPairs.filter(p => p.id !== id);
          setSupplierPairs(updatedPairs);
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ EÅŸleÅŸtirme silindi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          showSnackbar('EÅŸleÅŸtirme baÅŸarÄ±yla silindi', 'success');
          break;
        case 'nonconformity':
          const updatedNonconformities = nonconformities.filter(n => n.id !== id);
          setNonconformities(updatedNonconformities);
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Uygunsuzluk silindi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          showSnackbar('Uygunsuzluk baÅŸarÄ±yla silindi', 'success');
          break;
        case 'defect':
          const updatedDefects = defects.filter(d => d.id !== id);
          setDefects(updatedDefects);
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Hata silindi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          showSnackbar('Hata kaydÄ± baÅŸarÄ±yla silindi', 'success');
          break;
        case 'audit':
          const updatedAudits = audits.filter(a => a.id !== id);
          setAudits(updatedAudits);
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Denetim silindi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          showSnackbar('Denetim planÄ± baÅŸarÄ±yla silindi', 'success');
          break;
      }
    }
  };

  // Otomatik performans skoru hesaplama fonksiyonu
  const calculatePerformanceScore = (qualityScore: number, deliveryScore: number) => {
    // Kalite %60, Teslimat %40 aÄŸÄ±rlÄ±klÄ± ortalama
    const weightedScore = (qualityScore * 0.6) + (deliveryScore * 0.4);
    return Math.round(weightedScore);
  };

  // Performans skoruna gÃ¶re grade hesaplama fonksiyonu
  const getPerformanceGrade = (score: number, supplier?: Supplier) => {
    // N/A deÄŸerleri iÃ§in Ã¶zel durum (-1 veya negatif deÄŸerler)
    if (score < 0) {
      return { 
        grade: 'N/A', 
        color: 'default', 
        bgColor: '#9e9e9e', 
        description: 'HenÃ¼z deÄŸerlendirilmemiÅŸ' 
      };
    }
    
    // HenÃ¼z denetlenmemiÅŸ tedarikÃ§iler iÃ§in Ã¶zel durum
    if (supplier && score === 0 && (!supplier.lastAuditDate || supplier.lastAuditDate === '')) {
      return { 
        grade: 'N/A', 
        color: 'default', 
        bgColor: '#9e9e9e', 
        description: 'Denetim bekleniyor' 
      };
    }
    
    // Yeni sÄ±nÄ±flandÄ±rma sistemi
    if (score >= 90) return { grade: 'A', color: 'success', bgColor: '#4caf50', description: 'A SÄ±nÄ±fÄ± (90-100)' };
    if (score >= 75) return { grade: 'B', color: 'info', bgColor: '#2196f3', description: 'B SÄ±nÄ±fÄ± (75-89)' };
    if (score >= 60) return { grade: 'C', color: 'warning', bgColor: '#ff9800', description: 'C SÄ±nÄ±fÄ± (60-74)' };
    return { grade: 'D', color: 'error', bgColor: '#f44336', description: 'D SÄ±nÄ±fÄ± (0-59)' };
  };

  // TedarikÃ§i eÅŸleÅŸtirmelerini gÃ¼ncelleme fonksiyonu
  const updateSupplierPairings = (updatedSupplier: Supplier) => {
    const updatedPairs = supplierPairs.map(pair => {
      let updated = false;
      let newPair = { ...pair };

      // Ana tedarikÃ§i gÃ¼ncellemesi
      if (pair.primarySupplier.id === updatedSupplier.id) {
        newPair.primarySupplier = updatedSupplier;
        newPair.performanceComparison = {
          ...pair.performanceComparison,
          primaryScore: updatedSupplier.performanceScore
        };
        updated = true;
      }

      // Alternatif tedarikÃ§i gÃ¼ncellemesi
      const altIndex = pair.alternativeSuppliers.findIndex(alt => alt.id === updatedSupplier.id);
      if (altIndex !== -1) {
        newPair.alternativeSuppliers[altIndex] = updatedSupplier;
        newPair.performanceComparison = {
          ...pair.performanceComparison,
          alternativeScores: pair.performanceComparison.alternativeScores.map(score => 
            score.id === updatedSupplier.id 
              ? { ...score, score: updatedSupplier.performanceScore }
              : score
          )
        };
        updated = true;
      }

      // Ã–neri metnini gÃ¼ncelle
      if (updated) {
        const primaryScore = newPair.performanceComparison.primaryScore;
        const maxAltScore = Math.max(...newPair.performanceComparison.alternativeScores.map(s => s.score));
        
        if (primaryScore >= maxAltScore + 5) {
          newPair.performanceComparison.recommendation = 'Ana tedarikÃ§i performansÄ± Ã¼stÃ¼n';
        } else if (maxAltScore >= primaryScore + 5) {
          newPair.performanceComparison.recommendation = 'Alternatif tedarikÃ§i deÄŸerlendirilmeli';
        } else {
          newPair.performanceComparison.recommendation = 'Performans skorlarÄ± yakÄ±n, detaylÄ± analiz gerekli';
        }
        
        newPair.lastReviewDate = new Date().toISOString().split('T')[0];
      }

      return newPair;
    });

    setSupplierPairs(updatedPairs);
    
    // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
    localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
    console.log('ğŸ’¾ TedarikÃ§i eÅŸleÅŸtirmeleri gÃ¼ncellendi ve localStorage\'a kaydedildi');
    window.dispatchEvent(new Event('supplierDataUpdated'));
  };

  const handleSaveDialog = () => {
    const newId = `${dialogType.toUpperCase()}-${Date.now()}`;
    
    switch (dialogType) {
      case 'supplier':
        // Performans skorlarÄ± doÄŸrulama
        const qualityScore = Number(formData.qualityScore) || 0;
        const deliveryScore = Number(formData.deliveryScore) || 0;
        
        // Skorlar 0-100 arasÄ±nda olmalÄ±
        if (qualityScore < 0 || qualityScore > 100) {
          showSnackbar('Kalite skoru 0-100 arasÄ±nda olmalÄ±dÄ±r', 'error');
          return;
        }
        
        if (deliveryScore < 0 || deliveryScore > 100) {
          showSnackbar('Teslimat skoru 0-100 arasÄ±nda olmalÄ±dÄ±r', 'error');
          return;
        }
        
        // Otomatik performans skoru hesaplama
        const calculatedPerformanceScore = calculatePerformanceScore(qualityScore, deliveryScore);
        
        const newSupplier: Supplier = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId,
          // Performans skorlarÄ± - hesaplanmÄ±ÅŸ deÄŸerler
          performanceScore: calculatedPerformanceScore,
          qualityScore: qualityScore,
          deliveryScore: deliveryScore,
          // Risk ve durum - default deÄŸerler
          riskLevel: formData.riskLevel || 'dÃ¼ÅŸÃ¼k',
          status: formData.status || 'aktif',
          // Ä°letiÅŸim bilgileri - default deÄŸerler
          contact: {
            email: formData.contact?.email || '',
            phone: formData.contact?.phone || '',
            address: formData.contact?.address || '',
            contactPerson: formData.contact?.contactPerson || ''
          },
          // Malzeme tÃ¼rleri - default deÄŸer
          materialTypes: formData.materialTypes || [],
          // Tedarik bilgileri - default deÄŸerler
          supplyType: formData.supplyType || 'malzeme',
          supplySubcategories: formData.supplySubcategories || [],
          // Tarih bilgileri
          registrationDate: selectedItem ? selectedItem.registrationDate : new Date().toISOString().split('T')[0],
          lastAuditDate: selectedItem ? selectedItem.lastAuditDate : '',
          nextAuditDate: selectedItem ? selectedItem.nextAuditDate : '',
          auditStatus: 'planlÄ±' as any,
          // SayaÃ§lar
          nonconformityCount: selectedItem ? selectedItem.nonconformityCount : 0,
          defectCount: selectedItem ? selectedItem.defectCount : 0,
          dofCount: selectedItem ? selectedItem.dofCount : 0,
          isActive: true
        };
        
        // Form validasyonu
        if (!formData.name || !formData.type) {
          showSnackbar('TedarikÃ§i adÄ± ve tÃ¼rÃ¼ zorunludur', 'error');
          return;
        }

        console.log('ğŸ”µ TedarikÃ§i kaydetme iÅŸlemi baÅŸlÄ±yor:', {
          formData,
          newSupplier,
          selectedItem: !!selectedItem,
          calculatedScore: calculatedPerformanceScore
        });

        if (selectedItem) {
          const updatedSuppliers = suppliers.map(s => s.id === selectedItem.id ? newSupplier : s);
          console.log('âœï¸ TedarikÃ§i gÃ¼ncelleniyor:', {
            before: suppliers.length,
            after: updatedSuppliers.length,
            updated: newSupplier
          });
          setSuppliers(updatedSuppliers);
          
          // TedarikÃ§i eÅŸleÅŸtirmelerini gÃ¼ncelle
          updateSupplierPairings(newSupplier);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ TedarikÃ§i gÃ¼ncellendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar(`TedarikÃ§i baÅŸarÄ±yla gÃ¼ncellendi. Genel performans skoru: ${calculatedPerformanceScore}`, 'success');
        } else {
          const updatedSuppliers = [...suppliers, newSupplier];
          console.log('â• Yeni tedarikÃ§i ekleniyor:', {
            before: suppliers.length,
            after: updatedSuppliers.length,
            new: newSupplier
          });
          setSuppliers(updatedSuppliers);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Yeni tedarikÃ§i eklendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar(`Yeni tedarikÃ§i baÅŸarÄ±yla eklendi. Genel performans skoru: ${calculatedPerformanceScore}`, 'success');
        }
        break;
        
      case 'nonconformity':
        // Form validasyonu
        if (!formData.supplierId || !formData.title || !formData.partCode) {
          showSnackbar('TedarikÃ§i, baÅŸlÄ±k ve parÃ§a kodu alanlarÄ± zorunludur', 'error');
          return;
        }
        
        if (!formData.description || formData.description.trim() === '') {
          showSnackbar('Uygunsuzluk aÃ§Ä±klamasÄ± zorunludur', 'error');
          return;
        }
        
        if (!formData.dueDate) {
          showSnackbar('Tamamlanma tarihi zorunludur', 'error');
          return;
        }
        
        // ParÃ§a kodu validasyonu
        if (formData.partCode.length < 3) {
          showSnackbar('ParÃ§a kodu en az 3 karakter olmalÄ±dÄ±r', 'error');
          return;
        }
        
        const newNonconformity: NonconformityRecord = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId,
          recurrence: false
        };
        
        if (selectedItem) {
          const updatedNonconformities = nonconformities.map(n => n.id === selectedItem.id ? newNonconformity : n);
          setNonconformities(updatedNonconformities);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Uygunsuzluk gÃ¼ncellendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Uygunsuzluk baÅŸarÄ±yla gÃ¼ncellendi', 'success');
        } else {
          const updatedNonconformities = [...nonconformities, newNonconformity];
          setNonconformities(updatedNonconformities);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Yeni uygunsuzluk eklendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Yeni uygunsuzluk baÅŸarÄ±yla eklendi', 'success');
        }
        // âœ… DOÄRUDAN GÃœNCELLEME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
        updateSupplierPerformances();
        break;
        
      case 'defect':
        const newDefect: DefectRecord = {
          ...formData,
          id: selectedItem ? selectedItem.id : newId
        };
        
        if (selectedItem) {
          const updatedDefects = defects.map(d => d.id === selectedItem.id ? newDefect : d);
          setDefects(updatedDefects);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Hata gÃ¼ncellendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Hata kaydÄ± baÅŸarÄ±yla gÃ¼ncellendi', 'success');
        } else {
          const updatedDefects = [...defects, newDefect];
          setDefects(updatedDefects);
          
          // Otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak - setTimeout kaldÄ±rÄ±ldÄ±
          console.log('ğŸ”„ Yeni hata eklendi, otomatik kaydetme useEffect tarafÄ±ndan yapÄ±lacak');
            window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Yeni hata kaydÄ± baÅŸarÄ±yla eklendi', 'success');
        }
        // âœ… DOÄRUDAN GÃœNCELLEME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
        updateSupplierPerformances();
        break;
        
      case 'pair':
        // Form validasyonu - En az bir tedarikÃ§i seÃ§ilmeli
        const alternativeSupplierIds = formData.alternativeSupplierIds || [];
        
        if (!formData.primarySupplierId && alternativeSupplierIds.length === 0) {
          showSnackbar('En az bir ana tedarikÃ§i veya alternatif tedarikÃ§i seÃ§ilmelidir', 'error');
          return;
        }
        
        // Ana tedarikÃ§i kontrolÃ¼ (opsiyonel)
        let primarySupplier: Supplier | undefined;
        if (formData.primarySupplierId) {
          primarySupplier = suppliers.find(s => s.id === formData.primarySupplierId);
          if (!primarySupplier) {
            showSnackbar('SeÃ§ilen ana tedarikÃ§i bulunamadÄ±', 'error');
          return;
          }
        }
        
        // Alternatif tedarikÃ§iler
        const alternativeSuppliers: Supplier[] = [];
        
        // Alternatif tedarikÃ§i varsa kontrol et
        for (const altId of alternativeSupplierIds) {
          if (altId === formData.primarySupplierId) {
            showSnackbar('Ana tedarikÃ§i ile alternatif tedarikÃ§i aynÄ± olamaz', 'error');
          return;
          }
          
          const altSupplier = suppliers.find(s => s.id === altId);
          if (!altSupplier) {
            showSnackbar('SeÃ§ilen alternatif tedarikÃ§ilerden biri bulunamadÄ±', 'error');
            return;
          }
          alternativeSuppliers.push(altSupplier);
        }
        
        // Performans karÅŸÄ±laÅŸtÄ±rmasÄ±
        const alternativeScores = alternativeSuppliers.map(supplier => ({
          id: supplier.id,
          score: supplier.performanceScore
        }));
        
        let recommendation = '';
        if (primarySupplier && alternativeSuppliers.length > 0) {
          const bestAlternativeScore = Math.max(...alternativeSuppliers.map(s => s.performanceScore));
          recommendation = primarySupplier.performanceScore >= bestAlternativeScore 
            ? 'Ana tedarikÃ§i Ã¶nerilen' 
            : 'Alternatif tedarikÃ§i deÄŸerlendirilebilir';
        } else if (primarySupplier) {
          recommendation = 'Ana tedarikÃ§i mevcut - alternatif Ã¶nerilir';
        } else if (alternativeSuppliers.length > 0) {
          const bestSupplier = alternativeSuppliers.reduce((best, current) => 
            current.performanceScore > best.performanceScore ? current : best
          );
          recommendation = `En iyi performans: ${bestSupplier.name} (${bestSupplier.performanceScore} puan)`;
        }
        
        const newPair: SupplierPair = {
          id: selectedItem ? selectedItem.id : newId,
          primarySupplier: primarySupplier || undefined,
          alternativeSuppliers,
          category: formData.category || 'genel',
          performanceComparison: {
            primaryScore: primarySupplier?.performanceScore,
            alternativeScores,
            recommendation
          },
          lastReviewDate: new Date().toISOString().split('T')[0],
          nextReviewDate: new Date(Date.now() + (parseInt(formData.reviewPeriod || '3') * 30 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0]
        };
        
        if (selectedItem) {
          const updatedPairs = supplierPairs.map(sp => sp.id === selectedItem.id ? newPair : sp);
          setSupplierPairs(updatedPairs);
          
          // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
          localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
          console.log('ğŸ’¾ GÃ¼ncellenmiÅŸ eÅŸleÅŸtirme localStorage\'a kaydedildi');
          window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('TedarikÃ§i eÅŸleÅŸtirmesi baÅŸarÄ±yla gÃ¼ncellendi', 'success');
        } else {
          const updatedPairs = [...supplierPairs, newPair];
          setSupplierPairs(updatedPairs);
          
          // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
          localStorage.setItem('supplier-pairs', JSON.stringify(updatedPairs));
          console.log('ğŸ’¾ Yeni eÅŸleÅŸtirme localStorage\'a kaydedildi');
          window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Yeni tedarikÃ§i eÅŸleÅŸtirmesi baÅŸarÄ±yla oluÅŸturuldu', 'success');
        }
        break;
        
      case 'audit':
        // Form validasyonu
        if (!formData.supplierId || !formData.auditDate || !formData.auditorName) {
          showSnackbar('TedarikÃ§i, denetim tarihi ve denetÃ§i seÃ§imi zorunludur', 'error');
          return;
        }
        
        const auditSupplier = suppliers.find(s => s.id === formData.supplierId);
        if (!auditSupplier) {
          showSnackbar('SeÃ§ilen tedarikÃ§i bulunamadÄ±', 'error');
          return;
        }
        
        const newAudit: AuditRecord = {
          id: selectedItem ? selectedItem.id : newId,
          supplierId: formData.supplierId,
          auditDate: formData.auditDate,
          actualAuditDate: formData.actualAuditDate,
          auditType: formData.auditType || 'planlÄ±',
          auditorName: formData.auditorName,
          score: selectedItem ? selectedItem.score || 0 : 0, // Denetim tamamlandÄ±ÄŸÄ±nda girÃ¼lecek
          findings: selectedItem ? selectedItem.findings || [] : [],
          status: formData.status || 'planlÄ±',
          nextAuditDate: new Date(new Date(formData.auditDate).getTime() + (365 * 24 * 60 * 60 * 1000)).toISOString().split('T')[0], // 1 yÄ±l sonra
          isAutoScheduled: false,
          // Gecikme yÃ¶netimi alanlarÄ±
          delayReason: formData.delayReason,
          delayDays: formData.delayDays,
          isDelayed: formData.isDelayed || false
        };
        
        if (selectedItem) {
          const updatedAudits = audits.map(a => a.id === selectedItem.id ? newAudit : a);
          setAudits(updatedAudits);
          
          // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
          localStorage.setItem('supplier-audits', JSON.stringify(updatedAudits));
          console.log('ğŸ’¾ GÃ¼ncellenmiÅŸ denetim localStorage\'a kaydedildi');
          window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Denetim planÄ± baÅŸarÄ±yla gÃ¼ncellendi', 'success');
        } else {
          const updatedAudits = [...audits, newAudit];
          setAudits(updatedAudits);
          
          // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
          localStorage.setItem('supplier-audits', JSON.stringify(updatedAudits));
          console.log('ğŸ’¾ Yeni denetim localStorage\'a kaydedildi');
          window.dispatchEvent(new Event('supplierDataUpdated'));
          
          showSnackbar('Yeni denetim planÄ± baÅŸarÄ±yla oluÅŸturuldu', 'success');
        }
        
        // TedarikÃ§inin denetim bilgilerini gÃ¼ncelle
        const updatedSuppliers = suppliers.map(s => 
          s.id === formData.supplierId 
            ? { ...s, nextAuditDate: formData.auditDate, auditStatus: 'planlÄ±' as any }
            : s
        );
        setSuppliers(updatedSuppliers);
        
        // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
        localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
        console.log('ğŸ’¾ TedarikÃ§i denetim bilgileri localStorage\'a kaydedildi');
        window.dispatchEvent(new Event('supplierDataUpdated'));
        break;
    }
    
    setDialogOpen(false);
    setFormData({});
    setSelectedItem(null);
  };

  const getPerformanceColor = (score: number) => {
    // Yeni sÄ±nÄ±flandÄ±rma sistemi renkleri
    if (score >= 90) return '#4caf50';  // A SÄ±nÄ±fÄ± - YeÅŸil
    if (score >= 75) return '#2196f3';  // B SÄ±nÄ±fÄ± - Mavi
    if (score >= 60) return '#ff9800';  // C SÄ±nÄ±fÄ± - Turuncu
    return '#f44336';                   // D SÄ±nÄ±fÄ± - KÄ±rmÄ±zÄ±
  };

  // Dinamik performans hesaplama fonksiyonu
  const calculateSupplierPerformance = React.useCallback((supplier: Supplier) => {
    console.log(`\n=== PERFORMANS HESAPLAMA: ${supplier.name} ===`);
    
    // Temel skorlar (baÅŸlangÄ±Ã§ deÄŸerleri)
    let qualityScore = 100;
    let deliveryScore = 100;
    let performanceScore = 100;

    // Uygunsuzluk sayÄ±sÄ±na gÃ¶re kalite skoru dÃ¼ÅŸÃ¼rme
    const supplierNonconformities = nonconformities.filter(nc => nc.supplierId === supplier.id);
    const activeNonconformities = supplierNonconformities.filter(nc => nc.status !== 'kapalÄ±');
    
    console.log(`Toplam uygunsuzluk: ${supplierNonconformities.length}`);
    console.log(`AÃ§Ä±k uygunsuzluk: ${activeNonconformities.length}`);
    
    // Her aÃ§Ä±k uygunsuzluk iÃ§in puan dÃ¼ÅŸÃ¼rme
    qualityScore -= activeNonconformities.length * 5;
    console.log(`AÃ§Ä±k uygunsuzluk dÃ¼ÅŸÃ¼mÃ¼: -${activeNonconformities.length * 5} puan`);
    
    // Kritik uygunsuzluklar iÃ§in ek puan dÃ¼ÅŸÃ¼rme
    const criticalNonconformities = supplierNonconformities.filter(nc => nc.severity === 'kritik');
    qualityScore -= criticalNonconformities.length * 10;
    console.log(`Kritik uygunsuzluk: ${criticalNonconformities.length}, dÃ¼ÅŸÃ¼m: -${criticalNonconformities.length * 10} puan`);

    // Hata sayÄ±sÄ±na gÃ¶re kalite skoru dÃ¼ÅŸÃ¼rme
    const supplierDefects = defects.filter(d => d.supplierId === supplier.id);
    const activeDefects = supplierDefects.filter(d => d.status !== 'dÃ¼zeltildi');
    
    console.log(`Toplam hata: ${supplierDefects.length}`);
    console.log(`AÃ§Ä±k hata: ${activeDefects.length}`);
    
    // Her aÃ§Ä±k hata iÃ§in puan dÃ¼ÅŸÃ¼rme
    qualityScore -= activeDefects.length * 3;
    console.log(`AÃ§Ä±k hata dÃ¼ÅŸÃ¼mÃ¼: -${activeDefects.length * 3} puan`);
    
    // Kritik hatalar iÃ§in ek puan dÃ¼ÅŸÃ¼rme
    const criticalDefects = supplierDefects.filter(d => d.severity === 'kritik');
    qualityScore -= criticalDefects.length * 8;
    console.log(`Kritik hata: ${criticalDefects.length}, dÃ¼ÅŸÃ¼m: -${criticalDefects.length * 8} puan`);

    // Teslimat performansÄ± (uygunsuzluk kategorisine gÃ¶re)
    const deliveryNonconformities = supplierNonconformities.filter(nc => nc.category === 'teslimat');
    deliveryScore -= deliveryNonconformities.length * 7;
    console.log(`Teslimat uygunsuzluÄŸu: ${deliveryNonconformities.length}, teslimat skoru dÃ¼ÅŸÃ¼mÃ¼: -${deliveryNonconformities.length * 7} puan`);

    // Son denetim tarihi kontrolÃ¼
    const lastAuditDate = new Date(supplier.lastAuditDate);
    const today = new Date();
    const monthsDiff = (today.getTime() - lastAuditDate.getTime()) / (1000 * 3600 * 24 * 30);
    
    console.log(`Son denetimden geÃ§en ay sayÄ±sÄ±: ${monthsDiff.toFixed(1)}`);
    
    // 12 aydan eski denetim iÃ§in puan dÃ¼ÅŸÃ¼rme
    if (monthsDiff > 12) {
      const auditPenalty = Math.min(20, Math.floor(monthsDiff - 12) * 2);
      performanceScore -= auditPenalty;
      console.log(`Eski denetim cezasÄ±: -${auditPenalty} puan`);
    }

    // Risk seviyesine gÃ¶re ek dÃ¼ÅŸÃ¼rme
    let riskPenalty = 0;
    switch (supplier.riskLevel) {
      case 'kritik':
        riskPenalty = 15;
        break;
      case 'yÃ¼ksek':
        riskPenalty = 10;
        break;
      case 'orta':
        riskPenalty = 5;
        break;
      default:
        break;
    }
    performanceScore -= riskPenalty;
    console.log(`Risk seviyesi (${supplier.riskLevel}) cezasÄ±: -${riskPenalty} puan`);

    // Minimum skor 0, maksimum 100
    qualityScore = Math.max(0, Math.min(100, qualityScore));
    deliveryScore = Math.max(0, Math.min(100, deliveryScore));
    
    // Genel performans skoru (aÄŸÄ±rlÄ±klÄ± ortalama)
    performanceScore = Math.round((qualityScore * 0.6 + deliveryScore * 0.4));
    performanceScore = Math.max(0, Math.min(100, performanceScore));

    console.log(`SONUÃ‡ - Kalite: ${qualityScore}, Teslimat: ${deliveryScore}, Genel: ${performanceScore}`);
    console.log(`=== HESAPLAMA BÄ°TTÄ° ===\n`);

    return {
      qualityScore: Math.round(qualityScore),
      deliveryScore: Math.round(deliveryScore),
      performanceScore: Math.round(performanceScore)
    };
  }, [nonconformities, defects]);

  // TedarikÃ§i performanslarÄ±nÄ± gÃ¼ncelleyen fonksiyon
  const updateSupplierPerformances = React.useCallback(() => {
    console.log('ğŸ“Š Performans gÃ¼ncellemesi baÅŸlÄ±yor...');
    const updatedSuppliers = suppliers.map(supplier => {
      const newScores = calculateSupplierPerformance(supplier);
      console.log(`ğŸ¯ ${supplier.name}: Genel ${newScores.performanceScore}, Kalite ${newScores.qualityScore}, Teslimat ${newScores.deliveryScore}`);
      return {
        ...supplier,
        ...newScores
      };
    });
    setSuppliers(updatedSuppliers);
    
    // âœ… DOÄRUDAN KAYDETME - setTimeout kaldÄ±rÄ±ldÄ±, veri kaybi engellendi
    localStorage.setItem('suppliers', JSON.stringify(updatedSuppliers));
    console.log('ğŸ’¾ GÃ¼ncellenmiÅŸ performans skoru localStorage\'a kaydedildi');
    window.dispatchEvent(new Event('supplierDataUpdated'));
    
    console.log('âœ… Performans gÃ¼ncellemesi tamamlandÄ±');
  }, [suppliers, calculateSupplierPerformance]);

  // Radar chart data preparation
  const prepareRadarData = React.useCallback(() => {
    const selectedSuppliers = selectedSuppliersForRadar.length > 0 
      ? suppliers.filter(s => selectedSuppliersForRadar.includes(s.id))
      : suppliers.slice(0, 3); // Ä°lk 3 tedarikÃ§i default

    // Performans boyutlarÄ±
    const performanceDimensions = [
      { dimension: 'Kalite', key: 'qualityScore' },
      { dimension: 'Teslimat', key: 'deliveryScore' },
      { dimension: 'GÃ¼venilirlik', key: 'reliabilityScore' },
      { dimension: 'Maliyet', key: 'costScore' },
      { dimension: 'Ä°novasyon', key: 'innovationScore' },
      { dimension: 'SÃ¼rdÃ¼rÃ¼lebilirlik', key: 'sustainabilityScore' }
    ];

    return performanceDimensions.map(dim => {
      const dataPoint: any = { dimension: dim.dimension };
      
      selectedSuppliers.forEach(supplier => {
        let score = 0;
        
        switch(dim.key) {
          case 'qualityScore':
            score = supplier.qualityScore;
            break;
          case 'deliveryScore':
            score = supplier.deliveryScore;
            break;
          case 'reliabilityScore':
            // GÃ¼venilirlik: Son denetim tarihi + uygunsuzluk sayÄ±sÄ± bazlÄ±
            const monthsSinceAudit = Math.floor((new Date().getTime() - new Date(supplier.lastAuditDate).getTime()) / (1000 * 60 * 60 * 24 * 30));
            score = Math.max(50, 100 - (monthsSinceAudit * 2) - (supplier.nonconformityCount * 5));
            break;
          case 'costScore':
            // Maliyet performansÄ±: Risk seviyesi + hata maliyeti bazlÄ±
            const riskPenalty = supplier.riskLevel === 'kritik' ? 30 : supplier.riskLevel === 'yÃ¼ksek' ? 20 : supplier.riskLevel === 'orta' ? 10 : 0;
            score = Math.max(40, 95 - riskPenalty - (supplier.defectCount * 3));
            break;
          case 'innovationScore':
            // Ä°novasyon: TedarikÃ§i kategorisi ve tÃ¼rÃ¼ bazlÄ±
            const categoryBonus = supplier.category === 'stratejik' ? 20 : supplier.category === 'kritik' ? 15 : 10;
            const typeBonus = supplier.supplyType === 'hibrit' ? 15 : supplier.supplyType === 'hizmet' ? 10 : 5;
            score = Math.min(100, 60 + categoryBonus + typeBonus);
            break;
          case 'sustainabilityScore':
            // SÃ¼rdÃ¼rÃ¼lebilirlik: TedarikÃ§i yaÅŸÄ± + sertifikasyon durumu bazlÄ±
            const registrationAge = Math.floor((new Date().getTime() - new Date(supplier.registrationDate).getTime()) / (1000 * 60 * 60 * 24 * 365));
            const ageBonus = Math.min(20, registrationAge * 3);
            score = Math.min(100, 70 + ageBonus);
            break;
          default:
            score = supplier.performanceScore;
        }
        
        dataPoint[supplier.name.split(' ')[0]] = Math.round(score);
      });
      
      return dataPoint;
    });
  }, [suppliers, selectedSuppliersForRadar]);

  // Dashboard component
  const renderDashboard = () => {
    // Temel metrikler - N/A deÄŸerleri ayrÄ± hesaplanÄ±yor
    const totalSuppliers = suppliers.length;
    const activeSuppliers = suppliers.filter(s => s.status === 'aktif');
    
    // N/A deÄŸerleri (-1) hariÃ§ ortalama hesapla
    const ratedSuppliers = suppliers.filter(s => s.performanceScore >= 0);
    const naSuppliers = suppliers.filter(s => s.performanceScore < 0);
    
    const avgPerformance = ratedSuppliers.length > 0 
      ? Math.round(ratedSuppliers.reduce((acc, s) => acc + s.performanceScore, 0) / ratedSuppliers.length)
      : 0;
    
    const openNonconformities = nonconformities.filter(nc => nc.status === 'aÃ§Ä±k');
    const criticalSuppliers = suppliers.filter(s => s.riskLevel === 'kritik' || s.riskLevel === 'yÃ¼ksek');
    
    // Uygunsuzluk Ã§Ã¶zÃ¼m performansÄ±
    const totalNonconformities = nonconformities.length;
    const resolvedNonconformities = nonconformities.filter(nc => nc.status === 'kapalÄ±').length;
    const resolutionRate = totalNonconformities > 0 
      ? Math.round((resolvedNonconformities / totalNonconformities) * 100) 
      : 100;
    
    // Kategori bazlÄ± performans - N/A deÄŸerleri ayrÄ± hesaplanÄ±yor
    const categoryData = [
      { name: 'Stratejik', key: 'stratejik' },
      { name: 'Kritik', key: 'kritik' },
      { name: 'Rutin', key: 'rutin' },
      { name: 'Genel', key: 'genel' }
    ].map(cat => {
      const categorySuppliers = suppliers.filter(s => s.category === cat.key);
      
      // N/A deÄŸerleri (-1) ayrÄ± say
      const ratedSuppliers = categorySuppliers.filter(s => s.performanceScore >= 0);
      const naSuppliers = categorySuppliers.filter(s => s.performanceScore < 0);
      
      const avgScore = ratedSuppliers.length > 0 
        ? Math.round(ratedSuppliers.reduce((acc, s) => acc + s.performanceScore, 0) / ratedSuppliers.length)
        : 0;
      
      return {
        category: cat.name,
        ortalama: avgScore,
        adet: categorySuppliers.length,
        ratedCount: ratedSuppliers.length,
        naCount: naSuppliers.length,
        hedef: cat.key === 'stratejik' ? 90 : cat.key === 'kritik' ? 85 : cat.key === 'rutin' ? 85 : 85
      };
    }).filter(cat => cat.adet > 0); // Sadece tedarikÃ§isi olan kategorileri gÃ¶ster
    
    // Performans karÅŸÄ±laÅŸtÄ±rmasÄ± iÃ§in tedarikÃ§iler - sadece deÄŸerlendirilmiÅŸ aktif tedarikÃ§iler
    const performanceData = suppliers
      .filter(s => s.status === 'aktif' && s.performanceScore >= 0) // N/A deÄŸerleri hariÃ§
      .slice(0, 8) // En fazla 8 tedarikÃ§i gÃ¶ster
      .map(s => ({
        name: s.name.length > 15 ? s.name.substring(0, 15) + '...' : s.name,
        kalite: s.qualityScore,
        teslimat: s.deliveryScore,
        genel: s.performanceScore
      }));

    return (
    <Grid container spacing={3}>
        {/* TedarikÃ§i SayÄ±sÄ± */}
      <Grid item xs={12} md={3}>
          <Card elevation={3} sx={{ 
            borderRadius: 3, 
            background: 'linear-gradient(135deg, #1976d2 0%, #1565c0 100%)',
            color: 'white',
            height: '140px'
          }}>
            <CardContent sx={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
            <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'rgba(255,255,255,0.2)', width: 48, height: 48 }}>
                  <BusinessIcon fontSize="large" />
              </Avatar>
                <Box flex={1}>
                <Typography variant="h4" fontWeight="bold">
                    {totalSuppliers}
                </Typography>
                  <Typography variant="body2" sx={{ opacity: 0.9 }}>
                    Toplam TedarikÃ§i
                </Typography>
                  {totalSuppliers > 0 && (
                    <Typography variant="caption" sx={{ opacity: 0.8 }}>
                      {activeSuppliers.length} aktif
                    </Typography>
                  )}
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* Ortalama Performans */}
      <Grid item xs={12} md={3}>
          <Card elevation={3} sx={{ 
            borderRadius: 3, 
            background: avgPerformance >= 90 ? 'linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%)' :  // A SÄ±nÄ±fÄ± - YeÅŸil
                        avgPerformance >= 75 ? 'linear-gradient(135deg, #1976d2 0%, #1565c0 100%)' :  // B SÄ±nÄ±fÄ± - Mavi
                        avgPerformance >= 60 ? 'linear-gradient(135deg, #e65100 0%, #d84315 100%)' :  // C SÄ±nÄ±fÄ± - Turuncu
                        'linear-gradient(135deg, #d32f2f 0%, #c62828 100%)',                            // D SÄ±nÄ±fÄ± - KÄ±rmÄ±zÄ±
            color: 'white',
            height: '140px'
          }}>
            <CardContent sx={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
            <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'rgba(255,255,255,0.2)', width: 48, height: 48 }}>
                  <AssessmentIcon fontSize="large" />
              </Avatar>
                <Box flex={1}>
                <Typography variant="h4" fontWeight="bold">
                    {totalSuppliers > 0 ? avgPerformance : 0}
                </Typography>
                  <Typography variant="body2" sx={{ opacity: 0.9 }}>
                    Ortalama Performans
                </Typography>
                  {totalSuppliers > 0 && (
                    <Typography variant="caption" sx={{ opacity: 0.8 }}>
                      {ratedSuppliers.length} deÄŸerlendirilmiÅŸ tedarikÃ§i ortalamasÄ±
                    </Typography>
                  )}
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* AÃ§Ä±k Sorun */}
      <Grid item xs={12} md={3}>
          <Card elevation={3} sx={{ 
            borderRadius: 3, 
            background: 'linear-gradient(135deg, #d32f2f 0%, #c62828 100%)',
            color: 'white',
            height: '140px'
          }}>
            <CardContent sx={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
            <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'rgba(255,255,255,0.2)', width: 48, height: 48 }}>
                  <WarningIcon fontSize="large" />
              </Avatar>
                <Box flex={1}>
                <Typography variant="h4" fontWeight="bold">
                    {openNonconformities.length}
                </Typography>
                  <Typography variant="body2" sx={{ opacity: 0.9 }}>
                    AÃ§Ä±k Sorun
                </Typography>
                  {totalNonconformities > 0 && (
                    <Typography variant="caption" sx={{ opacity: 0.8 }}>
                      {totalNonconformities} toplam kayÄ±t
                    </Typography>
                  )}
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

      {/* Ã‡Ã¶zÃ¼m OranÄ± */}
      <Grid item xs={12} md={3}>
          <Card elevation={3} sx={{ 
            borderRadius: 3, 
            background: 'linear-gradient(135deg, #e65100 0%, #d84315 100%)',
            color: 'white',
            height: '140px'
          }}>
            <CardContent sx={{ height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
            <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'rgba(255,255,255,0.2)', width: 48, height: 48 }}>
                  <CheckCircleIcon fontSize="large" />
              </Avatar>
                <Box flex={1}>
                <Typography variant="h4" fontWeight="bold">
                    %{resolutionRate}
                </Typography>
                  <Typography variant="body2" sx={{ opacity: 0.9 }}>
                    Ã‡Ã¶zÃ¼m OranÄ±
                </Typography>
                  {totalNonconformities > 0 && (
                    <Typography variant="caption" sx={{ opacity: 0.8 }}>
                      {resolvedNonconformities}/{totalNonconformities}
                    </Typography>
                  )}
              </Box>
            </Box>
          </CardContent>
        </Card>
      </Grid>

        {/* Kategori BazlÄ± Performans Analizi */}
        <Grid item xs={12} md={6}>
          <Card elevation={3} sx={{ borderRadius: 3, height: '100%' }}>
            <CardHeader 
              title="Kategori BazlÄ± Performans" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 600 }}
              sx={{ background: 'linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%)' }}
            />
          <CardContent>
              {categoryData.length > 0 ? (
                <Box height={280}>
              <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={categoryData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                      <XAxis dataKey="category" tick={{ fontSize: 12 }} />
                      <YAxis domain={[0, 100]} tick={{ fontSize: 12 }} />
                      <ChartTooltip 
                        formatter={(value: any, name: any, props: any) => [
                          `${value} puan`,
                          name === 'ortalama' ? 'Ortalama Performans' : 
                          name === 'hedef' ? 'Hedef Performans' : 'TedarikÃ§i PuanÄ±'
                        ]}
                        labelFormatter={(label: any) => {
                          const categoryInfo = categoryData.find(cat => cat.category === label);
                          if (categoryInfo) {
                            return `${label} Kategori (${categoryInfo.ratedCount} deÄŸerlendirilmiÅŸ, ${categoryInfo.naCount} N/A)`;
                          }
                          return label;
                        }}
                        contentStyle={{ 
                          backgroundColor: 'rgba(255, 255, 255, 0.95)',
                          border: '1px solid #ddd',
                          borderRadius: '8px'
                        }}
                      />
                  <Legend />
                      <Bar dataKey="ortalama" fill="#1976d2" name="Ortalama Performans" radius={[4, 4, 0, 0]} />
                      <Bar dataKey="hedef" fill="#f57c00" name="Hedef" radius={[4, 4, 0, 0]} stroke="#e65100" strokeWidth={2} />
                </BarChart>
              </ResponsiveContainer>
            </Box>
              ) : (
                <Box height={280} display="flex" alignItems="center" justifyContent="center" flexDirection="column" gap={2}>
                  <BusinessIcon sx={{ fontSize: 48, color: 'grey.400' }} />
                  <Typography variant="body2" color="text.secondary" textAlign="center">
                    HenÃ¼z tedarikÃ§i bulunmuyor.<br />
                    Performans analizi iÃ§in tedarikÃ§i ekleyin.
                  </Typography>
                </Box>
              )}
          </CardContent>
        </Card>
      </Grid>

        {/* Risk DaÄŸÄ±lÄ±mÄ± */}
        <Grid item xs={12} md={6}>
          <Card elevation={3} sx={{ borderRadius: 3, height: '100%' }}>
          <CardHeader 
            title="Risk DaÄŸÄ±lÄ±mÄ±" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 600 }}
              sx={{ background: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)' }}
            />
            <CardContent>
              {totalSuppliers > 0 ? (
                <Grid container spacing={2} sx={{ height: 280 }}>
                  {[
                    { level: 'Kritik', count: suppliers.filter(s => s.riskLevel === 'kritik').length, color: '#d32f2f' },
                    { level: 'YÃ¼ksek', count: suppliers.filter(s => s.riskLevel === 'yÃ¼ksek').length, color: '#f57c00' },
                    { level: 'Orta', count: suppliers.filter(s => s.riskLevel === 'orta').length, color: '#fbc02d' },
                    { level: 'DÃ¼ÅŸÃ¼k', count: suppliers.filter(s => s.riskLevel === 'dÃ¼ÅŸÃ¼k').length, color: '#388e3c' }
                  ].map((risk, index) => (
                    <Grid item xs={6} key={risk.level}>
                      <Card 
                        elevation={2} 
            sx={{ 
                          p: 2, 
                          textAlign: 'center', 
                          background: `linear-gradient(135deg, ${risk.color}15 0%, ${risk.color}25 100%)`,
                          border: `2px solid ${risk.color}30`,
                          borderRadius: 3,
                          height: '120px',
                          display: 'flex',
                          flexDirection: 'column',
                          justifyContent: 'center'
                        }}
                      >
                        <Typography variant="h4" fontWeight="bold" sx={{ color: risk.color }}>
                          {risk.count}
                        </Typography>
                        <Typography variant="body2" sx={{ color: risk.color, fontWeight: 600 }}>
                          {risk.level} Risk
                        </Typography>
                        <Typography variant="caption" sx={{ color: 'text.secondary', mt: 0.5 }}>
                          {totalSuppliers > 0 ? `%${Math.round((risk.count / totalSuppliers) * 100)}` : '0%'}
                        </Typography>
                      </Card>
                    </Grid>
                  ))}
                </Grid>
              ) : (
                <Box height={280} display="flex" alignItems="center" justifyContent="center" flexDirection="column" gap={2}>
                  <SecurityIcon sx={{ fontSize: 48, color: 'grey.400' }} />
                  <Typography variant="body2" color="text.secondary" textAlign="center">
                    HenÃ¼z tedarikÃ§i bulunmuyor.<br />
                    Risk analizi iÃ§in tedarikÃ§i ekleyin.
                  </Typography>
                </Box>
              )}
            </CardContent>
          </Card>
        </Grid>

        {/* TedarikÃ§i Performans KarÅŸÄ±laÅŸtÄ±rmasÄ± */}
        <Grid item xs={12} md={8}>
          <Card elevation={3} sx={{ borderRadius: 3 }}>
            <CardHeader 
              title="TedarikÃ§i Performans KarÅŸÄ±laÅŸtÄ±rmasÄ±" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 600 }}
              sx={{ background: 'linear-gradient(135deg, #e8f5e8 0%, #e1f5fe 100%)' }}
          />
          <CardContent>
              {performanceData.length > 0 ? (
                <Box height={350}>
              <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={performanceData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                      <XAxis dataKey="name" tick={{ fontSize: 11 }} />
                      <YAxis domain={[0, 100]} tick={{ fontSize: 11 }} />
                  <ChartTooltip 
                        formatter={(value: any, name: any) => [`${value} puan`, name]}
                        labelStyle={{ fontWeight: 'bold' }}
                    contentStyle={{ 
                          backgroundColor: 'rgba(255, 255, 255, 0.95)',
                      border: '1px solid #ddd',
                          borderRadius: '8px',
                          boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                        }}
                      />
                      <Legend />
                      <Bar dataKey="kalite" fill="#2196f3" name="Kalite" radius={[2, 2, 0, 0]} />
                      <Bar dataKey="teslimat" fill="#4caf50" name="Teslimat" radius={[2, 2, 0, 0]} />
                      <Bar dataKey="genel" fill="#1976d2" name="Genel" radius={[2, 2, 0, 0]} />
                    </BarChart>
              </ResponsiveContainer>
            </Box>
              ) : (
                <Box height={350} display="flex" alignItems="center" justifyContent="center" flexDirection="column" gap={2}>
                  <AssessmentIcon sx={{ fontSize: 48, color: 'grey.400' }} />
                  <Typography variant="body2" color="text.secondary" textAlign="center">
                    HenÃ¼z aktif tedarikÃ§i bulunmuyor.<br />
                    Performans karÅŸÄ±laÅŸtÄ±rmasÄ± iÃ§in tedarikÃ§i ekleyin.
                  </Typography>
                </Box>
              )}
          </CardContent>
        </Card>
      </Grid>

        {/* Ä°statistikler */}
        <Grid item xs={12} md={4}>
          <Card elevation={3} sx={{ borderRadius: 3, height: '100%' }}>
            <CardHeader 
              title="Sistem Ä°statistikleri" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 600 }}
              sx={{ background: 'linear-gradient(135deg, #e8f5e8 0%, #c8e6c8 100%)' }}
            />
          <CardContent>
              <Box display="flex" flexDirection="column" gap={3} height={350} justifyContent="space-between">
                {/* Ã‡Ã¶zÃ¼m OranÄ± */}
                <Box textAlign="center" p={2} sx={{ bgcolor: '#f8f9fa', borderRadius: 2 }}>
                  <Typography variant="h4" fontWeight="bold" color="primary.main">
                    %{resolutionRate}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    Uygunsuzluk Ã‡Ã¶zÃ¼m OranÄ±
                  </Typography>
                  <Box mt={1}>
                    <LinearProgress 
                      variant="determinate" 
                      value={resolutionRate} 
                      sx={{ 
                        height: 8, 
                        borderRadius: 4,
                        backgroundColor: '#e0e0e0',
                        '& .MuiLinearProgress-bar': {
                          backgroundColor: resolutionRate >= 90 ? '#4caf50' : 
                                           resolutionRate >= 75 ? '#ff9800' : '#f44336'
                        }
                      }} 
                    />
                  </Box>
                </Box>

                {/* Aktif Sorunlar */}
                <Box textAlign="center" p={2} sx={{ bgcolor: '#f8f9fa', borderRadius: 2 }}>
                  <Typography variant="h4" fontWeight="bold" color="warning.main">
                    {openNonconformities.length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    AÃ§Ä±k Uygunsuzluk
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {totalNonconformities > 0 ? `${totalNonconformities} toplam` : 'HiÃ§ kayÄ±t yok'}
                  </Typography>
                </Box>

                {/* Risk Seviyesi */}
                <Box textAlign="center" p={2} sx={{ bgcolor: '#f8f9fa', borderRadius: 2 }}>
                  <Typography variant="h4" fontWeight="bold" color="error.main">
                    {criticalSuppliers.length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    YÃ¼ksek Risk TedarikÃ§i
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {totalSuppliers > 0 ? `${totalSuppliers} toplam` : 'HenÃ¼z tedarikÃ§i yok'}
                  </Typography>
                </Box>
              </Box>
          </CardContent>
        </Card>
      </Grid>


    </Grid>
  );
  };

  // Supplier Pairing Component
  const renderSupplierPairing = () => {
    // FiltrelenmiÅŸ eÅŸleÅŸtirme verilerini hesapla
    const filteredPairs = supplierPairs.filter(pair => {
      const matchesSearch = pairingSearchTerm === '' || 
        (pair.primarySupplier?.name.toLowerCase().includes(pairingSearchTerm.toLowerCase())) ||
        pair.alternativeSuppliers.some(alt => alt.name.toLowerCase().includes(pairingSearchTerm.toLowerCase())) ||
        pair.category.toLowerCase().includes(pairingSearchTerm.toLowerCase());
      
      const matchesCategory = pairingCategoryFilter === 'all' || pair.category === pairingCategoryFilter;
      
      const matchesStatus = pairingStatusFilter === 'all' || (
        pairingStatusFilter === 'primary-missing' && !pair.primarySupplier ||
        pairingStatusFilter === 'alternatives-only' && !pair.primarySupplier && pair.alternativeSuppliers.length > 0 ||
        pairingStatusFilter === 'complete' && pair.primarySupplier && pair.alternativeSuppliers.length > 0
      );
      
      return matchesSearch && matchesCategory && matchesStatus;
    });

    // Ã–zet istatistikler
    const stats = {
      totalPairs: supplierPairs.length,
      completePairs: supplierPairs.filter(p => p.primarySupplier && p.alternativeSuppliers.length > 0).length,
      missingPrimary: supplierPairs.filter(p => !p.primarySupplier).length,
      alternativesOnly: supplierPairs.filter(p => !p.primarySupplier && p.alternativeSuppliers.length > 0).length,
      avgPerformance: supplierPairs.length > 0 ? Math.round(
        supplierPairs
          .filter(p => p.primarySupplier)
          .reduce((acc, p) => acc + (p.performanceComparison.primaryScore || 0), 0) / 
        supplierPairs.filter(p => p.primarySupplier).length
      ) : 0
    };

    return (
    <Box>
        {/* Ã–zet Ä°statistikler */}
        <Grid container spacing={2} mb={3}>
          <Grid item xs={12} sm={6} md={2.4}>
            <Card elevation={2} sx={{ p: 2, textAlign: 'center', borderRadius: 2 }}>
              <Avatar sx={{ bgcolor: 'primary.main', mx: 'auto', mb: 1, width: 40, height: 40 }}>
                <LinkIcon />
              </Avatar>
              <Typography variant="h6" fontWeight="bold">{stats.totalPairs}</Typography>
              <Typography variant="caption" color="text.secondary">Toplam EÅŸleÅŸtirme</Typography>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={2.4}>
            <Card elevation={2} sx={{ p: 2, textAlign: 'center', borderRadius: 2 }}>
              <Avatar sx={{ bgcolor: 'success.main', mx: 'auto', mb: 1, width: 40, height: 40 }}>
                <CheckCircleIcon />
              </Avatar>
              <Typography variant="h6" fontWeight="bold" color="success.main">{stats.completePairs}</Typography>
              <Typography variant="caption" color="text.secondary">Tam EÅŸleÅŸtirme</Typography>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={2.4}>
            <Card elevation={2} sx={{ p: 2, textAlign: 'center', borderRadius: 2 }}>
              <Avatar sx={{ bgcolor: 'warning.main', mx: 'auto', mb: 1, width: 40, height: 40 }}>
                <WarningIcon />
              </Avatar>
              <Typography variant="h6" fontWeight="bold" color="warning.main">{stats.missingPrimary}</Typography>
              <Typography variant="caption" color="text.secondary">Ana TedarikÃ§i Eksik</Typography>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={2.4}>
            <Card elevation={2} sx={{ p: 2, textAlign: 'center', borderRadius: 2 }}>
              <Avatar sx={{ bgcolor: 'info.main', mx: 'auto', mb: 1, width: 40, height: 40 }}>
                <AssessmentIcon />
              </Avatar>
              <Typography variant="h6" fontWeight="bold" color="info.main">{stats.avgPerformance}%</Typography>
              <Typography variant="caption" color="text.secondary">Ortar. Performans</Typography>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={2.4}>
            <Card elevation={2} sx={{ p: 2, textAlign: 'center', borderRadius: 2 }}>
              <Avatar sx={{ bgcolor: 'secondary.main', mx: 'auto', mb: 1, width: 40, height: 40 }}>
                <BusinessIcon />
              </Avatar>
              <Typography variant="h6" fontWeight="bold" color="secondary.main">{filteredPairs.length}</Typography>
              <Typography variant="caption" color="text.secondary">Filtre Sonucu</Typography>
            </Card>
          </Grid>
        </Grid>

        {/* Filtre ve Arama */}
        <Card elevation={1} sx={{ p: 2, mb: 3, bgcolor: 'grey.50' }}>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                size="small"
                placeholder="EÅŸleÅŸtirme ara (tedarikÃ§i adÄ±, kategori)..."
                value={pairingSearchTerm}
                onChange={(e) => setPairingSearchTerm(e.target.value)}
                InputProps={{ 
                  startAdornment: <SearchIcon sx={{ mr: 1, color: 'action.active' }} />,
                  sx: { bgcolor: 'white' }
                }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>Kategori</InputLabel>
                <Select 
                  value={pairingCategoryFilter}
                  onChange={(e) => setPairingCategoryFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
                  <MenuItem value="all">TÃ¼m Kategoriler</MenuItem>
                  <MenuItem value="stratejik">Stratejik</MenuItem>
                  <MenuItem value="kritik">Kritik</MenuItem>
                  <MenuItem value="rutin">Rutin</MenuItem>
                  <MenuItem value="genel">Genel</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>Durum</InputLabel>
                <Select 
                  value={pairingStatusFilter}
                  onChange={(e) => setPairingStatusFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
                  <MenuItem value="all">TÃ¼m Durumlar</MenuItem>
                  <MenuItem value="complete">Tam EÅŸleÅŸtirme</MenuItem>
                  <MenuItem value="primary-missing">Ana TedarikÃ§i Eksik</MenuItem>
                  <MenuItem value="alternatives-only">Sadece Alternatifler</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={2}>
              <Button 
                fullWidth
                variant="contained" 
                startIcon={<LinkIcon />} 
                onClick={handleCreatePair}
                sx={{ height: 40 }}
              >
          Yeni EÅŸleÅŸtirme
        </Button>
            </Grid>
          </Grid>
        </Card>

      {/* Modern Card-Based Layout */}
      <Grid container spacing={3}>
        {filteredPairs.map((pair) => (
          <Grid item xs={12} key={pair.id}>
            <Card 
              elevation={2} 
              sx={{ 
                p: 3, 
                borderRadius: 3,
                border: '1px solid',
                borderColor: pair.primarySupplier && pair.alternativeSuppliers.length > 0 ? 'success.200' : 
                            !pair.primarySupplier ? 'warning.200' : 'info.200',
                transition: 'all 0.3s ease',
                '&:hover': { 
                  boxShadow: 4,
                  transform: 'translateY(-2px)'
                }
              }}
            >
              {/* Header with Category and Status */}
              <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
                <Box display="flex" alignItems="center" gap={2}>
                  <Chip 
                    icon={<BusinessIcon />}
                    label={`${pair.category.charAt(0).toUpperCase() + pair.category.slice(1)} (${pair.id})`}
                    color={pair.category === 'stratejik' ? 'error' : 
                           pair.category === 'kritik' ? 'warning' : 
                           pair.category === 'rutin' ? 'info' : 'default'}
                    variant="outlined" 
                    sx={{ fontWeight: 'bold' }}
                  />
                  <Chip 
                    label={pair.primarySupplier && pair.alternativeSuppliers.length > 0 ? 'Tam EÅŸleÅŸtirme' :
                           !pair.primarySupplier ? 'Ana TedarikÃ§i Eksik' : 'Alternatif Eksik'}
                    color={pair.primarySupplier && pair.alternativeSuppliers.length > 0 ? 'success' : 'warning'}
                    size="small" 
                  />
                </Box>
                <Box display="flex" gap={1}>
                  <Tooltip title="Performans Analizi">
                    <IconButton 
                      color="primary" 
                      onClick={() => {
                        showSnackbar(`${pair.primarySupplier?.name || 'N/A'} vs ${pair.alternativeSuppliers[0]?.name || 'Alternatif'} performans karÅŸÄ±laÅŸtÄ±rmasÄ±`, 'info');
                        setCurrentTab(6);
                      }}
                    >
                      <AssessmentIcon />
                    </IconButton>
                  </Tooltip>
                  <Tooltip title="DÃ¼zenle">
                    <IconButton color="info" onClick={() => handleEditItem(pair, 'pair')}>
                      <EditIcon />
                    </IconButton>
                  </Tooltip>
                  <Tooltip title="TedarikÃ§i DeÄŸiÅŸtir">
                    <IconButton color="warning" onClick={() => handleOpenSwitchDialog(pair)}>
                      <SwapHorizIcon />
                    </IconButton>
                  </Tooltip>
                </Box>
              </Box>

              {/* Main Content */}
              <Grid container spacing={3}>
                {/* Primary Supplier Section */}
                <Grid item xs={12} md={4}>
                  <Paper 
                    elevation={1} 
                    sx={{ 
                      p: 2.5, 
                      borderRadius: 2, 
                      background: pair.primarySupplier ? 'linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%)' : 'linear-gradient(135deg, #fff3e0 0%, #ffeaa7 100%)',
                      border: '1px solid',
                      borderColor: pair.primarySupplier ? 'success.200' : 'warning.200',
                      height: '100%'
                    }}
                  >
                    <Box display="flex" alignItems="center" gap={1.5} mb={2}>
                      <Avatar sx={{ bgcolor: pair.primarySupplier ? 'success.main' : 'warning.main', width: 32, height: 32 }}>
                        <StarIcon />
                      </Avatar>
                      <Typography variant="h6" fontWeight="bold" color={pair.primarySupplier ? 'success.dark' : 'warning.dark'}>
                        Ana TedarikÃ§i
                      </Typography>
                    </Box>
                    
                    {pair.primarySupplier ? (
                      <>
                        <Typography variant="h6" fontWeight="bold" mb={1.5}>
                      {pair.primarySupplier.name}
                    </Typography>
                        
                        {/* Performance Badge */}
                        <Box display="flex" alignItems="center" gap={1.5} mb={2}>
                      <Box
                        sx={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                              width: 40,
                              height: 40,
                          borderRadius: '50%',
                              backgroundColor: getPerformanceGrade(pair.performanceComparison.primaryScore || 0, pair.primarySupplier).bgColor,
                          color: 'white',
                          fontWeight: 'bold',
                              fontSize: '1.1rem',
                              boxShadow: 2
                        }}
                      >
                            {getPerformanceGrade(pair.performanceComparison.primaryScore || 0, pair.primarySupplier).grade}
                      </Box>
                          <Box>
                            <Typography variant="h5" fontWeight="bold" color="success.main">
                              {pair.performanceComparison.primaryScore || 0}%
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                              Performans Skoru
                            </Typography>
                          </Box>
                        </Box>

                        {/* Subcategories */}
                        <Box>
                          <Typography variant="subtitle2" fontWeight="bold" mb={1} color="text.secondary">
                            Tedarik Kategorileri
                          </Typography>
                          <Box display="flex" flexWrap="wrap" gap={0.5}>
                            {pair.primarySupplier.supplySubcategories.length > 0 ? (
                              pair.primarySupplier.supplySubcategories.map((subcategory, index) => (
                      <Chip 
                                  key={index}
                                  label={subcategory} 
                        color="success" 
                                  variant="outlined"
                        size="small" 
                                  sx={{ fontSize: '0.7rem', height: '24px' }}
                                />
                              ))
                            ) : (
                              <Typography variant="caption" color="text.secondary" fontStyle="italic">
                                Kategori belirtilmemiÅŸ
                              </Typography>
                            )}
                    </Box>
                  </Box>
                      </>
                    ) : (
                      <Box textAlign="center" py={3}>
                        <ErrorIcon sx={{ fontSize: 48, color: 'warning.main', mb: 1 }} />
                        <Typography variant="body1" fontWeight="bold" color="warning.main" mb={1}>
                          Ana TedarikÃ§i AtanmamÄ±ÅŸ
                        </Typography>
                        <Typography variant="body2" color="text.secondary">
                          Bu kategori iÃ§in ana tedarikÃ§i seÃ§imi yapÄ±lmalÄ±
                        </Typography>
                      </Box>
                    )}
                  </Paper>
                </Grid>

                {/* Alternative Suppliers Section */}
                <Grid item xs={12} md={5}>
                  <Paper 
                    elevation={1} 
                    sx={{ 
                      p: 2.5, 
                      borderRadius: 2, 
                      background: 'linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%)',
                      border: '1px solid',
                      borderColor: 'info.200',
                      height: '100%'
                    }}
                  >
                    <Box display="flex" alignItems="center" gap={1.5} mb={2}>
                      <Avatar sx={{ bgcolor: 'info.main', width: 32, height: 32 }}>
                        <LinkIcon />
                      </Avatar>
                      <Typography variant="h6" fontWeight="bold" color="info.dark">
                        Alternatif TedarikÃ§iler ({pair.alternativeSuppliers.length})
                      </Typography>
                    </Box>
                    
                    {pair.alternativeSuppliers.length > 0 ? (
                      <Box sx={{ maxHeight: '280px', overflow: 'auto' }}>
                  {pair.alternativeSuppliers.map((altSupplier, index) => {
                    const altScore = pair.performanceComparison.alternativeScores.find(s => s.id === altSupplier.id)?.score || 0;
                    return (
                            <Card 
                              key={altSupplier.id} 
                              elevation={0}
                              sx={{ 
                                p: 2, 
                                mb: index < pair.alternativeSuppliers.length - 1 ? 1.5 : 0,
                                border: '1px solid',
                                borderColor: 'grey.200',
                                borderRadius: 2,
                                background: 'rgba(255,255,255,0.7)'
                              }}
                            >
                              <Box display="flex" justifyContent="between" alignItems="center" mb={1}>
                                <Typography variant="subtitle1" fontWeight="bold">
                        {altSupplier.name}
                      </Typography>
                              </Box>
                              
                              <Box display="flex" alignItems="center" gap={1.5} mb={1}>
                          <Box
                            sx={{
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                                    width: 32,
                                    height: 32,
                              borderRadius: '50%',
                                    backgroundColor: getPerformanceGrade(altScore, altSupplier).bgColor,
                              color: 'white',
                              fontWeight: 'bold',
                                    fontSize: '0.9rem'
                            }}
                          >
                                  {getPerformanceGrade(altScore, altSupplier).grade}
                          </Box>
                                <Box>
                                  <Typography variant="h6" fontWeight="bold" color="info.main">
                                    {altScore}%
                                  </Typography>
                                  <Typography variant="caption" color="text.secondary">
                                    Performans
                                  </Typography>
                                </Box>
                              </Box>

                              <Box display="flex" flexWrap="wrap" gap={0.5}>
                                {altSupplier.supplySubcategories.length > 0 ? (
                                  altSupplier.supplySubcategories.slice(0, 3).map((subcategory, idx) => (
                        <Chip 
                                      key={idx}
                                      label={subcategory} 
                                      color="info"
                                      variant="outlined"
                          size="small" 
                                      sx={{ fontSize: '0.65rem', height: '20px' }}
                                    />
                                  ))
                                ) : (
                                  <Typography variant="caption" color="text.secondary" fontStyle="italic">
                                    Kategori yok
                                  </Typography>
                                )}
                                {altSupplier.supplySubcategories.length > 3 && (
                                  <Chip 
                                    label={`+${altSupplier.supplySubcategories.length - 3}`}
                                    color="default"
                                    size="small"
                                    sx={{ fontSize: '0.65rem', height: '20px' }}
                                  />
                                )}
                      </Box>
                            </Card>
                    );
                  })}
                      </Box>
                    ) : (
                      <Box textAlign="center" py={3}>
                        <BusinessIcon sx={{ fontSize: 48, color: 'grey.400', mb: 1 }} />
                        <Typography variant="body1" fontWeight="bold" color="text.secondary" mb={1}>
                          Alternatif TedarikÃ§i Yok
                        </Typography>
                        <Typography variant="body2" color="text.secondary">
                          Bu kategori iÃ§in alternatif seÃ§enekler eklenebilir
                        </Typography>
                      </Box>
                    )}
                  </Paper>
                </Grid>

                {/* Performance Comparison & Insights */}
                <Grid item xs={12} md={3}>
                  <Paper 
                    elevation={1} 
                    sx={{ 
                      p: 2.5, 
                      borderRadius: 2, 
                      background: 'linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%)',
                      border: '1px solid',
                      borderColor: 'grey.300',
                      height: '100%',
                      display: 'flex',
                      flexDirection: 'column'
                    }}
                  >
                    <Box display="flex" alignItems="center" gap={1.5} mb={2}>
                      <Avatar sx={{ bgcolor: 'primary.main', width: 32, height: 32 }}>
                        <AssessmentIcon />
                      </Avatar>
                      <Typography variant="h6" fontWeight="bold" color="primary.dark">
                        Analiz & Ã–neri
                      </Typography>
                    </Box>
                    
                    {/* Performance Comparison */}
                    {pair.primarySupplier && pair.alternativeSuppliers.length > 0 ? (
                      <Box flex={1}>
                        <Box 
                          sx={{ 
                            p: 2, 
                            borderRadius: 2, 
                            mb: 2,
                            background: (pair.performanceComparison.primaryScore || 0) > 
                      Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                              ? 'linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%)' 
                              : 'linear-gradient(135deg, #fff8e1 0%, #fff3e0 100%)',
                            border: '1px solid',
                            borderColor: (pair.performanceComparison.primaryScore || 0) > 
                       Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                              ? 'success.200' : 'warning.200'
                          }}
                        >
                          <Typography 
                            variant="subtitle2" 
                            fontWeight="bold" 
                            color={(pair.performanceComparison.primaryScore || 0) > 
                              Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                              ? 'success.main' : 'warning.main'}
                            mb={1}
                          >
                            {(pair.performanceComparison.primaryScore || 0) > 
                             Math.max(...pair.performanceComparison.alternativeScores.map(s => s.score)) 
                              ? 'âœ“ Ana TedarikÃ§i ÃœstÃ¼n' : 'âš  Alternatif DeÄŸerlendir'}
                    </Typography>
                          <Typography variant="body2" color="text.secondary">
                      {pair.performanceComparison.recommendation}
                    </Typography>
                  </Box>

                        {/* Review Dates */}
                        <Box sx={{ p: 1.5, bgcolor: 'grey.100', borderRadius: 1 }}>
                          <Typography variant="caption" color="text.secondary" fontWeight="bold" display="block">
                            Son DeÄŸerlendirme
                          </Typography>
                          <Typography variant="body2" fontWeight="bold" mb={0.5}>
                    {new Date(pair.lastReviewDate).toLocaleDateString('tr-TR')}
                  </Typography>
                          <Typography variant="caption" color="text.secondary" display="block">
                    Sonraki: {new Date(pair.nextReviewDate).toLocaleDateString('tr-TR')}
                  </Typography>
                        </Box>
                      </Box>
                    ) : pair.primarySupplier && pair.alternativeSuppliers.length === 0 ? (
                      <Box flex={1} textAlign="center">
                        <InfoIcon sx={{ fontSize: 32, color: 'info.main', mb: 1 }} />
                        <Typography variant="subtitle2" fontWeight="bold" color="info.main" mb={1}>
                          Sadece Ana TedarikÃ§i
                        </Typography>
                        <Typography variant="body2" color="text.secondary" mb={2}>
                          Risk azaltmak iÃ§in alternatif tedarikÃ§i eklenmeli
                        </Typography>
                        <Button
                        size="small" 
                          variant="outlined"
                          startIcon={<LinkIcon />}
                          onClick={() => handleEditItem(pair, 'pair')}
                        >
                          Alternatif Ekle
                        </Button>
                      </Box>
                    ) : !pair.primarySupplier && pair.alternativeSuppliers.length > 0 ? (
                      <Box flex={1} textAlign="center">
                        <WarningIcon sx={{ fontSize: 32, color: 'warning.main', mb: 1 }} />
                        <Typography variant="subtitle2" fontWeight="bold" color="warning.main" mb={1}>
                          Ana TedarikÃ§i Eksik
                        </Typography>
                        <Typography variant="body2" color="text.secondary" mb={2}>
                          Alternatifler arasÄ±ndan ana tedarikÃ§i seÃ§ilmeli
                        </Typography>
                        <Button
                        size="small" 
                          variant="outlined"
                        color="warning" 
                          startIcon={<StarIcon />}
                          onClick={() => handleOpenSwitchDialog(pair)}
                        >
                          Ana SeÃ§
                        </Button>
                      </Box>
                    ) : (
                      <Box flex={1} textAlign="center">
                        <ErrorIcon sx={{ fontSize: 32, color: 'error.main', mb: 1 }} />
                        <Typography variant="subtitle2" fontWeight="bold" color="error.main" mb={1}>
                          TedarikÃ§i Eksik
                        </Typography>
                        <Typography variant="body2" color="text.secondary" mb={2}>
                          Bu kategori iÃ§in tedarikÃ§i tanÄ±mlanmalÄ±
                        </Typography>
                        <Button
                          size="small"
                          variant="outlined"
                          color="error"
                          startIcon={<BusinessIcon />}
                          onClick={() => handleEditItem(pair, 'pair')}
                        >
                          TedarikÃ§i Ekle
                        </Button>
                      </Box>
                    )}
                  </Paper>
                </Grid>
              </Grid>
            </Card>
          </Grid>
        ))}
      </Grid>

      {/* Empty State */}
      {filteredPairs.length === 0 && (
        <Paper 
          elevation={1} 
          sx={{ 
            p: 6, 
            textAlign: 'center', 
            borderRadius: 3,
            background: 'linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%)'
          }}
        >
          <BusinessIcon sx={{ fontSize: 64, color: 'grey.400', mb: 2 }} />
          <Typography variant="h6" fontWeight="bold" color="text.secondary" mb={1}>
            EÅŸleÅŸtirme BulunamadÄ±
          </Typography>
          <Typography variant="body2" color="text.secondary" mb={3}>
            {pairingSearchTerm || pairingCategoryFilter !== 'all' || pairingStatusFilter !== 'all' 
              ? 'Arama kriterlerinize uygun eÅŸleÅŸtirme bulunamadÄ±. Filtreleri temizleyip tekrar deneyin.'
              : 'HenÃ¼z tedarikÃ§i eÅŸleÅŸtirmesi tanÄ±mlanmamÄ±ÅŸ. Ä°lk eÅŸleÅŸtirmenizi oluÅŸturun.'
            }
          </Typography>
          <Button
            variant="contained"
            startIcon={<LinkIcon />}
            onClick={handleCreatePair}
            size="large"
          >
            {supplierPairs.length === 0 ? 'Ä°lk EÅŸleÅŸtirmeyi OluÅŸtur' : 'Yeni EÅŸleÅŸtirme Ekle'}
          </Button>
        </Paper>
      )}
    </Box>
    );
  };

  // Supplier List Component with advanced filtering, sorting, and pagination
  const renderSupplierList = () => {
    // Advanced filtering
    const filteredSuppliers = suppliers.filter(supplier => {
      const matchesSearch = searchTerm === '' || 
        supplier.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        supplier.contact.contactPerson.toLowerCase().includes(searchTerm.toLowerCase()) ||
        supplier.supplySubcategories.some(sub => sub.toLowerCase().includes(searchTerm.toLowerCase())) ||
        supplier.materialTypes.some(mat => mat.toLowerCase().includes(searchTerm.toLowerCase()));
      
      const matchesType = supplierTypeFilter === 'all' || supplier.type === supplierTypeFilter;
      const matchesCategory = supplierCategoryFilter === 'all' || supplier.category === supplierCategoryFilter;
      const matchesStatus = supplierStatusFilter === 'all' || supplier.status === supplierStatusFilter;
      const matchesRisk = supplierRiskFilter === 'all' || supplier.riskLevel === supplierRiskFilter;
      
      return matchesSearch && matchesType && matchesCategory && matchesStatus && matchesRisk;
    });

    // Sorting
    const sortedSuppliers = filteredSuppliers.sort((a, b) => {
      if (!sortColumn) return 0;
      
      let aValue = '';
      let bValue = '';
      
      switch (sortColumn) {
        case 'name':
          aValue = a.name;
          bValue = b.name;
          break;
        case 'type':
          aValue = a.type;
          bValue = b.type;
          break;
        case 'category':
          aValue = a.category;
          bValue = b.category;
          break;
        case 'performance':
          return sortDirection === 'asc' ? a.performanceScore - b.performanceScore : b.performanceScore - a.performanceScore;
        case 'status':
          aValue = a.status;
          bValue = b.status;
          break;
        case 'lastAudit':
          return sortDirection === 'asc' ? 
            new Date(a.lastAuditDate).getTime() - new Date(b.lastAuditDate).getTime() :
            new Date(b.lastAuditDate).getTime() - new Date(a.lastAuditDate).getTime();
        default:
          return 0;
      }
      
      if (sortDirection === 'asc') {
        return aValue.localeCompare(bValue);
                          } else {
        return bValue.localeCompare(aValue);
      }
    });

    // Pagination
    const paginatedSuppliers = sortedSuppliers.slice(
      currentPage * rowsPerPage,
      currentPage * rowsPerPage + rowsPerPage
    );

    // Handle column sorting
    const handleSort = (column: string) => {
      if (sortColumn === column) {
        setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
      } else {
        setSortColumn(column);
        setSortDirection('asc');
      }
    };

    // Handle bulk actions
    const handleSelectAll = (event: React.ChangeEvent<HTMLInputElement>) => {
      if (event.target.checked) {
        setSelectedSuppliers(filteredSuppliers.map(s => s.id));
      } else {
        setSelectedSuppliers([]);
      }
    };

    const handleSelectSupplier = (supplierId: string) => {
      setSelectedSuppliers(prev => 
        prev.includes(supplierId) 
          ? prev.filter(id => id !== supplierId)
          : [...prev, supplierId]
      );
    };

    // Export functions
    const exportToPDF = () => {
      showSnackbar('PDF export Ã¶zelliÄŸi geliÅŸtirilmektedir...', 'info');
    };

    const exportToExcel = () => {
      showSnackbar('Excel export Ã¶zelliÄŸi geliÅŸtirilmektedir...', 'info');
    };

    return (
    <Box>
        {/* Enhanced Filter Panel */}
        <Card elevation={1} sx={{ p: 2, mb: 3, bgcolor: 'grey.50' }}>
          <Grid container spacing={2} alignItems="center" mb={2}>
            <Grid item xs={12} md={3}>
          <TextField
                fullWidth
            size="small"
                placeholder="TedarikÃ§i ara (ad, kiÅŸi, kategori)..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ 
                  startAdornment: <SearchIcon sx={{ mr: 1, color: 'action.active' }} />,
                  sx: { bgcolor: 'white' }
                }}
              />
            </Grid>
            <Grid item xs={6} md={2}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>TÃ¼r</InputLabel>
                <Select 
                  value={supplierTypeFilter}
                  onChange={(e) => setSupplierTypeFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
              <MenuItem value="all">TÃ¼mÃ¼</MenuItem>
              <MenuItem value="onaylÄ±">OnaylÄ±</MenuItem>
              <MenuItem value="alternatif">Alternatif</MenuItem>
              <MenuItem value="potansiyel">Potansiyel</MenuItem>
                  <MenuItem value="bloklu">Bloklu</MenuItem>
            </Select>
          </FormControl>
            </Grid>
            <Grid item xs={6} md={2}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>Kategori</InputLabel>
                <Select 
                  value={supplierCategoryFilter}
                  onChange={(e) => setSupplierCategoryFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
                  <MenuItem value="all">TÃ¼mÃ¼</MenuItem>
                  <MenuItem value="stratejik">Stratejik</MenuItem>
                  <MenuItem value="kritik">Kritik</MenuItem>
                  <MenuItem value="rutin">Rutin</MenuItem>
                  <MenuItem value="genel">Genel</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={6} md={2}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>Durum</InputLabel>
                <Select 
                  value={supplierStatusFilter}
                  onChange={(e) => setSupplierStatusFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
                  <MenuItem value="all">TÃ¼mÃ¼</MenuItem>
                  <MenuItem value="aktif">Aktif</MenuItem>
                  <MenuItem value="pasif">Pasif</MenuItem>
                  <MenuItem value="denetimde">Denetimde</MenuItem>
                  <MenuItem value="bloklu">Bloklu</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={6} md={2}>
              <FormControl fullWidth size="small">
                <InputLabel sx={{ bgcolor: 'white', px: 1 }}>Risk</InputLabel>
                <Select 
                  value={supplierRiskFilter}
                  onChange={(e) => setSupplierRiskFilter(e.target.value)}
                  sx={{ bgcolor: 'white' }}
                >
                  <MenuItem value="all">TÃ¼mÃ¼</MenuItem>
                  <MenuItem value="dÃ¼ÅŸÃ¼k">DÃ¼ÅŸÃ¼k</MenuItem>
                  <MenuItem value="orta">Orta</MenuItem>
                  <MenuItem value="yÃ¼ksek">YÃ¼ksek</MenuItem>
                  <MenuItem value="kritik">Kritik</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={1}>
              <ButtonGroup variant="outlined" size="small" fullWidth>
                <Tooltip title="PDF Export">
                  <IconButton onClick={exportToPDF} color="primary">
                    <FileDownloadIcon />
                  </IconButton>
                </Tooltip>
                <Tooltip title="Excel Export">
                  <IconButton onClick={exportToExcel} color="success">
                    <FileDownloadIcon />
                  </IconButton>
                </Tooltip>
              </ButtonGroup>
            </Grid>
          </Grid>

          {/* Bulk Actions */}
          {selectedSuppliers.length > 0 && (
            <Box display="flex" alignItems="center" gap={2} p={1} bgcolor="primary.50" borderRadius={1}>
              <Typography variant="body2" fontWeight="bold">
                {selectedSuppliers.length} tedarikÃ§i seÃ§ili
              </Typography>
              <Button size="small" variant="outlined" color="warning">
                Toplu Denetim Planla
              </Button>
              <Button size="small" variant="outlined" color="info">
                Toplu Mail GÃ¶nder
              </Button>
              <Button size="small" variant="outlined" color="error">
                Toplu DeÄŸerlendirme
              </Button>
            </Box>
          )}
        </Card>

        {/* Results Summary */}
        <Box display="flex" justifyContent="space-between" alignItems="center" mb={2}>
          <Typography variant="body2" color="text.secondary">
            {filteredSuppliers.length} tedarikÃ§i bulundu (toplam {suppliers.length})
          </Typography>
          <Box display="flex" alignItems="center" gap={2}>
            <FormControl size="small" sx={{ minWidth: 80 }}>
              <InputLabel>Sayfa</InputLabel>
              <Select 
                value={rowsPerPage}
                onChange={(e) => {
                  setRowsPerPage(Number(e.target.value));
                  setCurrentPage(0);
                }}
              >
                <MenuItem value={5}>5</MenuItem>
                <MenuItem value={10}>10</MenuItem>
                <MenuItem value={25}>25</MenuItem>
                <MenuItem value={50}>50</MenuItem>
              </Select>
            </FormControl>
        </Box>
      </Box>

      <TableContainer component={Paper}>
        <Table sx={{ minWidth: 1400 }}>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell padding="checkbox" sx={{ width: '50px' }}>
                <Checkbox
                  color="primary"
                  indeterminate={selectedSuppliers.length > 0 && selectedSuppliers.length < filteredSuppliers.length}
                  checked={filteredSuppliers.length > 0 && selectedSuppliers.length === filteredSuppliers.length}
                  onChange={handleSelectAll}
                />
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '200px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('name')}
              >
                <Box display="flex" alignItems="center">
                  TedarikÃ§i
                  {sortColumn === 'name' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '120px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('type')}
              >
                <Box display="flex" alignItems="center" justifyContent="center">
                  TÃ¼r
                  {sortColumn === 'type' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '100px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('category')}
              >
                <Box display="flex" alignItems="center" justifyContent="center">
                  Kategori
                  {sortColumn === 'category' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '220px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle'
                }}
              >
                Alt Kategoriler
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '150px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('performance')}
              >
                <Box display="flex" alignItems="center" justifyContent="center">
                  Performans
                  {sortColumn === 'performance' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '130px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('lastAudit')}
              >
                <Box display="flex" alignItems="center" justifyContent="center">
                  Son Denetim
                  {sortColumn === 'lastAudit' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '100px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center',
                  cursor: 'pointer',
                  '&:hover': { bgcolor: 'action.hover' }
                }}
                onClick={() => handleSort('status')}
              >
                <Box display="flex" alignItems="center" justifyContent="center">
                  Durum
                  {sortColumn === 'status' && (
                    sortDirection === 'asc' ? <ArrowUpwardIcon fontSize="small" /> : <ArrowDownwardIcon fontSize="small" />
                  )}
                </Box>
              </TableCell>
              <TableCell 
                sx={{ 
                  fontWeight: 'bold', 
                  width: '120px',
                  whiteSpace: 'nowrap',
                  verticalAlign: 'middle',
                  textAlign: 'center'
                }}
              >
                Ä°ÅŸlemler
              </TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {paginatedSuppliers.map((supplier) => (
              <TableRow 
                key={supplier.id}
                hover
                selected={selectedSuppliers.includes(supplier.id)}
                sx={{ 
                  '&.Mui-selected': { 
                    bgcolor: 'action.selected',
                    '&:hover': { bgcolor: 'action.hover' }
                  }
                }}
              >
                <TableCell padding="checkbox">
                  <Checkbox
                    color="primary"
                    checked={selectedSuppliers.includes(supplier.id)}
                    onChange={() => handleSelectSupplier(supplier.id)}
                  />
                </TableCell>
                <TableCell sx={{ width: '200px', verticalAlign: 'top' }}>
                  <Box>
                    <Typography variant="body2" fontWeight="bold" noWrap>
                      {supplier.name}
                    </Typography>
                    <Typography variant="caption" color="text.secondary" noWrap>
                      {supplier.contact.contactPerson}
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell sx={{ width: '130px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Chip 
                    label={supplier.type.charAt(0).toUpperCase() + supplier.type.slice(1)} 
                    color={supplier.type === 'onaylÄ±' ? 'success' : 'warning'}
                    size="small"
                    sx={{ fontSize: '0.75rem', whiteSpace: 'nowrap' }}
                  />
                </TableCell>
                <TableCell sx={{ width: '110px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Chip 
                    label={supplier.category.charAt(0).toUpperCase() + supplier.category.slice(1)} 
                    variant="outlined"
                    size="small"
                    sx={{ fontSize: '0.75rem', whiteSpace: 'nowrap' }}
                  />
                </TableCell>
                <TableCell sx={{ width: '250px', verticalAlign: 'top' }}>
                  <Box sx={{ maxHeight: '80px', overflow: 'auto' }}>
                    {supplier.supplySubcategories.length > 0 ? (
                      <Box display="flex" flexWrap="wrap" gap={0.5}>
                        {supplier.supplySubcategories.map((subcategory, index) => (
                          <Chip 
                            key={index}
                            label={subcategory} 
                            color="secondary"
                            variant="outlined"
                            size="small"
                            sx={{ fontSize: '0.65rem', height: '20px' }}
                          />
                        ))}
                      </Box>
                    ) : (
                      <Typography variant="caption" color="text.secondary">
                        BelirtilmemiÅŸ
                      </Typography>
                    )}
                  </Box>
                </TableCell>
                <TableCell sx={{ width: '180px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Box display="flex" alignItems="center" justifyContent="center" gap={1}>
                    {/* Grade Badge */}
                    <Box
                      sx={{
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        width: 36,
                        height: 36,
                        borderRadius: '50%',
                        backgroundColor: getPerformanceGrade(supplier.performanceScore, supplier).bgColor,
                        color: 'white',
                        fontWeight: 'bold',
                        fontSize: '1rem',
                        boxShadow: 1,
                        minWidth: 36,
                        flexShrink: 0
                      }}
                    >
                      {getPerformanceGrade(supplier.performanceScore, supplier).grade}
                    </Box>
                    
                    {/* Performans DetaylarÄ± */}
                    <Box>
                      <Typography variant="body2" fontWeight="bold" textAlign="center">
                          {supplier.performanceScore}%
                        </Typography>
                      {getPerformanceGrade(supplier.performanceScore, supplier).description && (
                        <Typography variant="caption" color="text.secondary" textAlign="center" display="block">
                          {getPerformanceGrade(supplier.performanceScore, supplier).description}
                        </Typography>
                      )}
                    </Box>
                  </Box>
                </TableCell>
                <TableCell sx={{ width: '140px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Typography variant="body2" textAlign="center" fontSize="0.8rem">
                    {new Date(supplier.lastAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                  <Typography variant="caption" color="text.secondary" textAlign="center" display="block" fontSize="0.7rem">
                    Sonraki: {new Date(supplier.nextAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                </TableCell>
                <TableCell sx={{ width: '110px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Chip 
                    label={supplier.status.charAt(0).toUpperCase() + supplier.status.slice(1)}
                    color={supplier.status === 'aktif' ? 'success' : 'error'}
                    size="small"
                    sx={{ fontSize: '0.75rem', whiteSpace: 'nowrap' }}
                  />
                </TableCell>
                <TableCell sx={{ width: '130px', textAlign: 'center', verticalAlign: 'middle' }}>
                  <Box display="flex" gap={0.5} justifyContent="center">
                    <Tooltip title="GÃ¶rÃ¼ntÃ¼le">
                      <IconButton 
                        size="small" 
                        color="primary" 
                        onClick={() => {
                          setSelectedItem(supplier);
                          setDialogType('supplier');
                          setFormData(supplier);
                          setDialogOpen(true);
                        }}
                      >
                        <ViewIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="DÃ¼zenle">
                      <IconButton size="small" color="info" onClick={() => handleEditItem(supplier, 'supplier')}>
                        <EditIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="Sil">
                      <IconButton 
                        size="small" 
                        color="error" 
                        onClick={() => handleDeleteItem(supplier.id, 'supplier')}
                        sx={{ 
                          '&:hover': { 
                            bgcolor: 'error.50' 
                          } 
                        }}
                      >
                        <DeleteIcon />
                      </IconButton>
                    </Tooltip>
                    <Tooltip title="DÃ–F OluÅŸtur">
                      <IconButton size="small" color="warning" onClick={() => createDOFFromNonconformity({ 
                        id: 'temp', 
                        supplierId: supplier.id, 
                        title: `${supplier.name} iÃ§in uygunsuzluk`,
                        description: 'TedarikÃ§i kaynaklÄ± uygunsuzluk',
                        category: 'kalite',
                        severity: 'orta',
                        detectedDate: new Date().toISOString().split('T')[0],
                        status: 'aÃ§Ä±k',
                        dueDate: '',
                        correctionCost: 0,
                        recurrence: false,
                        partCode: 'TEMP-001' // Zorunlu alan eklendi
                      })}>
                        <ReportIcon />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
      
      {/* Pagination */}
      <TablePagination
        component="div"
        count={filteredSuppliers.length}
        page={currentPage}
        onPageChange={(_, newPage) => setCurrentPage(newPage)}
        rowsPerPage={rowsPerPage}
        onRowsPerPageChange={(event) => {
          setRowsPerPage(parseInt(event.target.value, 10));
          setCurrentPage(0);
        }}
        rowsPerPageOptions={[5, 10, 25, 50]}
        labelRowsPerPage="Sayfa baÅŸÄ±na:"
        labelDisplayedRows={({ from, to, count }) => `${from}â€“${to} / ${count}`}
        sx={{ borderTop: '1px solid', borderColor: 'divider' }}
      />
    </Box>
  );
  };

  // Audit Tracking Component
  const renderAuditTracking = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Box display="flex" gap={2}>
          <Button 
            variant="outlined" 
            startIcon={<AssessmentIcon />} 
            onClick={generateAutoAuditRecommendations}
            color="info"
          >
            Otomatik Analiz
          </Button>
          <Button variant="contained" startIcon={<ScheduleIcon />} onClick={handleCreateAudit}>
            Denetim Planla
          </Button>
        </Box>
      </Box>

      {/* Otomatik Denetim Ã–nerileri */}
      {autoAuditRecommendations.length > 0 && (
        <Paper elevation={1} sx={{ p: 2.5, mb: 3, border: '1px solid', borderColor: 'divider' }}>
          <Box display="flex" alignItems="center" gap={1} mb={2}>
            <AssessmentIcon color="primary" fontSize="small" />
            <Typography variant="subtitle1" fontWeight={600}>
              Otomatik Denetim Ã–nerileri
            </Typography>
            <Chip 
              size="small" 
              label={autoAuditRecommendations.length} 
              color="primary" 
              sx={{ height: 20, fontSize: '0.7rem' }}
            />
          </Box>
          
          <Grid container spacing={2}>
            {autoAuditRecommendations.slice(0, 3).map(recommendation => (
              <Grid item xs={12} sm={6} md={4} key={recommendation.id}>
                <Paper 
                  elevation={0} 
                  sx={{ 
                    p: 2, 
                    border: '1px solid', 
                    borderColor: 'grey.200',
                    borderRadius: 2,
                    height: '100%',
                    transition: 'all 0.2s ease',
                    '&:hover': { 
                      boxShadow: 2,
                      borderColor: 'primary.main'
                    }
                  }}
                >
                  <Box display="flex" alignItems="center" gap={1} mb={1.5}>
                    <Chip 
                      size="small" 
                      label={
                        recommendation.urgencyLevel === 'kritik' ? 'Kritik' :
                        recommendation.urgencyLevel === 'yÃ¼ksek' ? 'YÃ¼ksek' :
                        recommendation.urgencyLevel === 'orta' ? 'Orta' : 'DÃ¼ÅŸÃ¼k'
                      } 
                      color={
                        recommendation.urgencyLevel === 'kritik' ? 'error' :
                        recommendation.urgencyLevel === 'yÃ¼ksek' ? 'warning' :
                        recommendation.urgencyLevel === 'orta' ? 'info' : 'default'
                      }
                      sx={{ fontSize: '0.7rem', height: 22 }}
                    />
                  </Box>
                  
                  <Typography 
                    variant="subtitle2" 
                    sx={{ 
                      fontSize: '0.95rem', 
                      fontWeight: 600, 
                      mb: 1.5,
                      lineHeight: 1.3,
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      WebkitBoxOrient: 'vertical',
                      overflow: 'hidden'
                    }}
                  >
                    {recommendation.supplierName}
                  </Typography>
                  
                  <Box display="flex" justifyContent="center" mb={1}>
                    <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8rem' }}>
                      Performans: {recommendation.currentScore}
                    </Typography>
                  </Box>
                  
                  <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8rem', mb: 2 }}>
                    Tarih: {new Date(recommendation.recommendedDate).toLocaleDateString('tr-TR', { 
                      day: '2-digit', 
                      month: 'short',
                      year: '2-digit'
                    })}
                  </Typography>
                  
                  <Box display="flex" gap={1}>
                    <Button 
                      size="small" 
                      variant="contained" 
                      color="primary"
                      onClick={() => acceptAuditRecommendation(recommendation)}
                      sx={{ 
                        fontSize: '0.75rem', 
                        py: 0.5, 
                        px: 1.5, 
                        flex: 1,
                        textTransform: 'none'
                      }}
                    >
                      Kabul Et
                    </Button>
                    <Button 
                      size="small" 
                      variant="outlined" 
                      color="error"
                      onClick={() => rejectAuditRecommendation(recommendation.id)}
                      sx={{ 
                        fontSize: '0.75rem', 
                        py: 0.5, 
                        px: 1.5,
                        textTransform: 'none'
                      }}
                    >
                      Reddet
                    </Button>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
          
          {autoAuditRecommendations.length > 3 && (
            <Box mt={2} textAlign="center">
              <Typography variant="body2" color="primary.main" sx={{ fontSize: '0.85rem', fontWeight: 500 }}>
                +{autoAuditRecommendations.length - 3} Ã¶neri daha (aÅŸaÄŸÄ±daki detaylÄ± tabloda gÃ¶rÃ¼ntÃ¼lenebilir)
              </Typography>
            </Box>
          )}
        </Paper>
      )}

      <Grid container spacing={3}>
        {/* YaklaÅŸan Denetimler - DÃœZELTME: audits array'inden veriler Ã§ekiliyor */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardHeader title="YaklaÅŸan Denetimler" />
            <CardContent>
              <List>
                {audits
                  .filter(a => {
                    const auditDate = new Date(a.auditDate);
                    const today = new Date();
                    const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                    return a.status === 'planlÄ±' && daysDiff <= 90;
                  })
                  .sort((a, b) => new Date(a.auditDate).getTime() - new Date(b.auditDate).getTime())
                  .map(audit => {
                    const auditDate = new Date(audit.auditDate);
                    const today = new Date();
                    const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                    const supplier = suppliers.find(s => s.id === audit.supplierId);
                    
                    return (
                      <ListItem key={audit.id} divider>
                        <ListItemIcon>
                          <ScheduleIcon color={daysDiff <= 30 ? 'error' : 'warning'} />
                        </ListItemIcon>
                        <ListItemText
                          primary={supplier ? supplier.name : 'Bilinmiyor'}
                          secondary={
                            <Box>
                              <Typography variant="body2">
                                Denetim Tarihi: {auditDate.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                              </Typography>
                              <Typography variant="body2" color="text.secondary">
                                DenetÃ§i: {audit.auditorName || 'AtanmadÄ±'}
                              </Typography>
                              <Chip 
                                size="small" 
                                label={daysDiff <= 0 ? 'GecikmiÅŸ' : `${daysDiff} gÃ¼n kaldÄ±`}
                                color={daysDiff <= 0 ? 'error' : daysDiff <= 30 ? 'warning' : 'info'}
                              />
                            </Box>
                          }
                        />
                        <Box display="flex" gap={1}>
                          <Button 
                            size="small" 
                            variant="outlined"
                            color="primary"
                            onClick={() => {
                              if (supplier) {
                                scheduleAutoAudit(supplier);
                                showSnackbar(`${supplier.name} denetimi baÅŸlatÄ±ldÄ±`, 'success');
                              }
                            }}
                          >
                            Denetle
                          </Button>
                          <IconButton 
                            size="small" 
                            color="info"
                            onClick={() => handleEditItem(audit, 'audit')}
                            sx={{ border: '1px solid', borderColor: 'info.main' }}
                          >
                            <EditIcon sx={{ fontSize: 16 }} />
                          </IconButton>
                        </Box>
                      </ListItem>
                    );
                  })}
                {audits.filter(a => {
                  const auditDate = new Date(a.auditDate);
                  const today = new Date();
                  const daysDiff = Math.ceil((auditDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                  return a.status === 'planlÄ±' && daysDiff <= 90;
                }).length === 0 && (
                  <ListItem>
                    <ListItemText
                      primary={
                        <Box textAlign="center" py={2}>
                          <Typography variant="body2" color="text.secondary">
                            YaklaÅŸan 90 gÃ¼n iÃ§inde planlanan denetim bulunmuyor
                          </Typography>
                          <Button 
                            size="small" 
                            startIcon={<ScheduleIcon />} 
                            onClick={handleCreateAudit}
                            sx={{ mt: 1 }}
                          >
                            Denetim Planla
                          </Button>
                        </Box>
                      }
                    />
                  </ListItem>
                )}
              </List>
            </CardContent>
          </Card>
        </Grid>

        {/* Audit Statistics - DÃœZELTME: audits array'inden veriler Ã§ekiliyor */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardHeader title="Denetim Ä°statistikleri" />
            <CardContent>
              <Grid container spacing={2}>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="success.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="success.main">
                      {audits.filter(a => a.status === 'tamamlandÄ±').length}
                    </Typography>
                    <Typography variant="body2">Tamamlanan</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="warning.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="warning.main">
                      {audits.filter(a => a.status === 'planlÄ±').length}
                    </Typography>
                    <Typography variant="body2">Planlanan</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="error.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="error.main">
                      {audits.filter(a => {
                        const auditDate = new Date(a.auditDate);
                        const today = new Date();
                        return a.status === 'planlÄ±' && auditDate < today;
                      }).length}
                    </Typography>
                    <Typography variant="body2">GecikmiÅŸ</Typography>
                  </Box>
                </Grid>
                <Grid item xs={6}>
                  <Box textAlign="center" p={2} bgcolor="info.50" borderRadius={1}>
                    <Typography variant="h4" fontWeight="bold" color="info.main">
                      {audits.length}
                    </Typography>
                    <Typography variant="body2">Toplam</Typography>
                  </Box>
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        </Grid>

                {/* Planlanan Denetimler Tablosu - GeliÅŸmiÅŸ GÃ¶rÃ¼nÃ¼m */}
        <Grid item xs={12}>
          <Card elevation={2} sx={{ borderRadius: 2 }}>
            <CardHeader 
              title={
                <Typography variant="h6" sx={{ fontWeight: 600, color: 'primary.main' }}>
                  Planlanan Denetimler
                </Typography>
              }
              action={
                <Box display="flex" gap={1}>
                <Chip 
                  size="small" 
                    label={`${audits.length} toplam`} 
                  color="info"
                    sx={{ fontWeight: 500 }}
                  />
                  <Chip 
                    size="small" 
                    label={`${audits.filter(a => a.status === 'gecikmiÅŸ' || a.isDelayed).length} gecikmiÅŸ`} 
                    color="error"
                    sx={{ fontWeight: 500 }}
                  />
                </Box>
              }
              sx={{ 
                borderBottom: '1px solid', 
                borderColor: 'divider',
                bgcolor: 'background.paper'
              }}
            />
            <CardContent sx={{ p: 0 }}>
              <TableContainer 
                sx={{ 
                  maxHeight: 600,
                  '&::-webkit-scrollbar': {
                    width: '8px',
                    height: '8px'
                  },
                  '&::-webkit-scrollbar-track': {
                    background: '#f1f1f1',
                    borderRadius: '4px'
                  },
                  '&::-webkit-scrollbar-thumb': {
                    background: '#c1c1c1',
                    borderRadius: '4px',
                    '&:hover': {
                      background: '#a8a8a8'
                    }
                  },
                  overflowX: 'auto'
                }}
              >
                <Table size="small" stickyHeader>
                  <TableHead>
                    <TableRow sx={{ 
                      '& > .MuiTableCell-root': { 
                        bgcolor: 'primary.50', 
                        fontWeight: 700, 
                        fontSize: '0.8rem', 
                        py: 1.5,
                        borderBottom: '2px solid',
                        borderColor: 'primary.200',
                        color: 'primary.dark',
                        whiteSpace: 'nowrap'
                      } 
                    }}>
                      <TableCell sx={{ minWidth: 180, maxWidth: 200 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          TedarikÃ§i
                        </Typography>
                      </TableCell>
                      <TableCell align="center" sx={{ minWidth: 110 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          Planlanan Tarih
                        </Typography>
                      </TableCell>
                      <TableCell align="center" sx={{ minWidth: 120 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          GerÃ§ekleÅŸtirilen Tarih
                        </Typography>
                      </TableCell>
                      <TableCell align="center" sx={{ minWidth: 120 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          Durum
                        </Typography>
                      </TableCell>
                      <TableCell align="center" sx={{ minWidth: 90 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          TÃ¼r
                        </Typography>
                      </TableCell>
                      <TableCell sx={{ minWidth: 160, maxWidth: 180 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          DenetÃ§i
                        </Typography>
                      </TableCell>
                      <TableCell sx={{ minWidth: 200, maxWidth: 250 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          Gecikme AÃ§Ä±klamasÄ±
                        </Typography>
                      </TableCell>
                      <TableCell align="center" sx={{ minWidth: 120 }}>
                        <Typography variant="subtitle2" sx={{ fontWeight: 700 }}>
                          Ä°ÅŸlemler
                        </Typography>
                      </TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {audits
                      .sort((a, b) => {
                        // Ä°lk Ã¶ncelik: planlama tarihine gÃ¶re sÄ±rala (en erken tarih en Ã¼stte)
                        return new Date(a.auditDate).getTime() - new Date(b.auditDate).getTime();
                      })
                      .map((audit, index) => {
                        const supplier = suppliers.find(s => s.id === audit.supplierId);
                        const plannedDate = new Date(audit.auditDate);
                        const actualDate = audit.actualAuditDate ? new Date(audit.actualAuditDate) : null;
                        const today = new Date();
                        const daysDiff = Math.ceil((plannedDate.getTime() - today.getTime()) / (1000 * 3600 * 24));
                        
                        // Durum rengi ve metni
                        const getStatusInfo = (status: string, isDelayed?: boolean): { 
                          color: 'error' | 'default' | 'success' | 'warning' | 'info' | 'primary' | 'secondary', 
                          text: string 
                        } => {
                          switch(status) {
                            case 'tamamlandÄ±':
                              return { 
                                color: isDelayed ? 'warning' : 'success', 
                                text: isDelayed ? 'Gecikmeli TamamlandÄ±' : 'TamamlandÄ±' 
                              };
                            case 'devam_ediyor':
                              return { color: 'info', text: 'Devam Ediyor' };
                            case 'gecikmiÅŸ':
                              return { color: 'error', text: 'GecikmiÅŸ' };
                            case 'iptal':
                              return { color: 'default', text: 'Ä°ptal' };
                            default:
                              return daysDiff <= 0 ? 
                                { color: 'error', text: 'GecikmiÅŸ' } : 
                                { color: 'primary', text: 'PlanlÄ±' };
                          }
                        };
                        
                        const statusInfo = getStatusInfo(audit.status, audit.isDelayed);
                        
                        return (
                          <TableRow 
                            key={audit.id} 
                            hover 
                            sx={{ 
                              '& > .MuiTableCell-root': { 
                                py: 1.5, 
                                px: 2,
                                borderBottom: '1px solid',
                                borderColor: 'grey.200'
                              },
                              backgroundColor: audit.status === 'gecikmiÅŸ' || (audit.status === 'planlÄ±' && daysDiff <= 0) ? 
                                'error.50' : 
                                audit.isDelayed ? 'warning.50' : 
                                index % 2 === 0 ? 'grey.25' : 'transparent',
                              '&:hover': {
                                backgroundColor: audit.status === 'gecikmiÅŸ' || (audit.status === 'planlÄ±' && daysDiff <= 0) ? 
                                  'error.100' : 
                                  audit.isDelayed ? 'warning.100' : 'action.hover',
                                transform: 'scale(1.001)',
                                transition: 'all 0.2s ease-in-out'
                              }
                            }}
                          >
                            <TableCell sx={{ minWidth: 180, maxWidth: 200 }}>
                              <Box>
                                <Typography 
                                  variant="body2" 
                                  fontWeight={600} 
                                  sx={{ 
                                    fontSize: '0.875rem',
                                    color: 'text.primary',
                                    overflow: 'hidden',
                                    textOverflow: 'ellipsis',
                                    whiteSpace: 'nowrap',
                                    lineHeight: 1.4
                                  }}
                                  title={supplier ? supplier.name : 'TedarikÃ§i BulunamadÄ±'}
                                >
                                  {supplier ? supplier.name : 'TedarikÃ§i BulunamadÄ±'}
                                </Typography>
                                <Typography 
                                  variant="caption" 
                                  color="text.secondary" 
                                  sx={{ 
                                    fontSize: '0.75rem',
                                    fontFamily: 'monospace',
                                    backgroundColor: 'grey.100',
                                    px: 0.5,
                                    py: 0.25,
                                    borderRadius: 0.5,
                                    display: 'inline-block',
                                    mt: 0.5
                                  }}
                                >
                                  {supplier ? supplier.name : audit.supplierId}
                                </Typography>
                              </Box>
                            </TableCell>
                            
                            <TableCell align="center" sx={{ minWidth: 110 }}>
                              <Typography 
                                variant="body2" 
                                sx={{ 
                                  fontSize: '0.8rem', 
                                  fontWeight: 500,
                                  fontFamily: 'monospace'
                                }}
                              >
                                {plannedDate.toLocaleDateString('tr-TR', { 
                                  day: '2-digit', 
                                  month: '2-digit', 
                                  year: '2-digit' 
                                })}
                                </Typography>
                            </TableCell>
                            
                            <TableCell align="center" sx={{ minWidth: 120 }}>
                              {actualDate ? (
                                <Typography 
                                  variant="body2" 
                                  sx={{ 
                                    fontSize: '0.8rem', 
                                    fontWeight: 500,
                                    color: 'success.main',
                                    fontFamily: 'monospace'
                                  }}
                                >
                                  {actualDate.toLocaleDateString('tr-TR', { 
                                    day: '2-digit', 
                                    month: '2-digit', 
                                    year: '2-digit' 
                                  })}
                                </Typography>
                              ) : (
                                <Typography 
                                  variant="body2" 
                                  color="text.secondary" 
                                  sx={{ 
                                    fontSize: '0.8rem',
                                    fontStyle: 'italic'
                                  }}
                                >
                                  HenÃ¼z gerÃ§ekleÅŸmedi
                                </Typography>
                              )}
                            </TableCell>
                            
                            <TableCell align="center" sx={{ minWidth: 120 }}>
                                <Chip 
                                  size="small" 
                                label={statusInfo.text}
                                color={statusInfo.color}
                                sx={{ 
                                  height: 26, 
                                  fontSize: '0.75rem', 
                                  fontWeight: 600,
                                  minWidth: 100,
                                  '& .MuiChip-label': {
                                    px: 1.5
                                  }
                                }}
                                />
                            </TableCell>
                            
                            <TableCell align="center" sx={{ minWidth: 90 }}>
                              <Chip 
                                size="small" 
                                label={
                                  audit.auditType === 'planlÄ±' ? 'PlanlÄ±' :
                                  audit.auditType === 'ani' ? 'Ani' :
                                  audit.auditType === 'takip' ? 'Takip' : 
                                  audit.auditType === 'acil' ? 'Acil' : 'KapsamlÄ±'
                                }
                                variant="outlined"
                                color={
                                  audit.auditType === 'acil' ? 'error' :
                                  audit.auditType === 'ani' ? 'warning' :
                                  audit.auditType === 'takip' ? 'info' : 'default'
                                }
                                sx={{ 
                                  height: 24, 
                                  fontSize: '0.7rem', 
                                  fontWeight: 500,
                                  minWidth: 70
                                }}
                              />
                            </TableCell>
                            
                            <TableCell sx={{ minWidth: 160, maxWidth: 180 }}>
                              <Typography 
                                variant="body2" 
                                sx={{ 
                                  fontSize: '0.8rem',
                                  fontWeight: 500,
                                  color: 'text.primary',
                                  overflow: 'hidden',
                                  textOverflow: 'ellipsis',
                                  whiteSpace: 'nowrap'
                                }}
                                title={audit.auditorName || 'HenÃ¼z atanmadÄ±'}
                              >
                                {audit.auditorName || 'HenÃ¼z atanmadÄ±'}
                              </Typography>
                            </TableCell>
                            
                            <TableCell sx={{ minWidth: 200, maxWidth: 250 }}>
                              {audit.delayReason ? (
                                <Tooltip 
                                  title={audit.delayReason} 
                                  arrow 
                                  placement="top"
                                  sx={{
                                    '& .MuiTooltip-tooltip': {
                                      maxWidth: 300,
                                  fontSize: '0.8rem'
                                    }
                                  }}
                                >
                                  <Box display="flex" alignItems="center" gap={1}>
                                    <WarningIcon 
                                      sx={{ 
                                        fontSize: 16, 
                                        color: audit.status === 'gecikmiÅŸ' ? 'error.main' : 'warning.main',
                                        flexShrink: 0
                                      }} 
                                    />
                                    <Typography 
                                      variant="body2" 
                                      sx={{ 
                                        fontSize: '0.75rem',
                                        color: 'text.secondary',
                                        overflow: 'hidden',
                                        textOverflow: 'ellipsis',
                                        whiteSpace: 'nowrap',
                                        cursor: 'pointer',
                                        lineHeight: 1.4
                                      }}
                              >
                                      {audit.delayReason}
                              </Typography>
                                  </Box>
                                </Tooltip>
                              ) : (
                                <Typography 
                                  variant="body2" 
                                  color="text.secondary" 
                                  sx={{ 
                                    fontSize: '0.8rem',
                                    fontStyle: 'italic',
                                    textAlign: 'center'
                                  }}
                                >
                                  Gecikme yok
                                </Typography>
                              )}
                            </TableCell>
                            
                            <TableCell align="center" sx={{ minWidth: 120 }}>
                              <Box display="flex" justifyContent="center" gap={0.5}>
                                {audit.status === 'planlÄ±' && (
                                  <Tooltip title="Denetimi GerÃ§ekleÅŸtir" arrow>
                                    <IconButton 
                                      size="small" 
                                      color="success"
                                      onClick={() => handleExecuteAudit(audit)}
                                      sx={{ 
                                        width: 28, 
                                        height: 28,
                                        border: '1px solid',
                                        borderColor: 'success.main',
                                        '&:hover': {
                                          backgroundColor: 'success.50'
                                        }
                                      }}
                                    >
                                      <AssignmentTurnedInIcon sx={{ fontSize: 14 }} />
                                    </IconButton>
                                  </Tooltip>
                                )}
                                <Tooltip title="DetaylarÄ± GÃ¶rÃ¼ntÃ¼le" arrow>
                                  <IconButton 
                                    size="small" 
                                    color="info"
                                    onClick={() => handleViewAuditDetails(audit)}
                                    sx={{ 
                                      width: 28, 
                                      height: 28,
                                      border: '1px solid',
                                      borderColor: 'info.main',
                                      '&:hover': {
                                        backgroundColor: 'info.50'
                                      }
                                    }}
                                  >
                                    <ViewIcon sx={{ fontSize: 14 }} />
                                  </IconButton>
                                </Tooltip>
                                <Tooltip title="DÃ¼zenle" arrow>
                                  <IconButton 
                                    size="small" 
                                    color="primary"
                                    onClick={() => handleEditItem(audit, 'audit')}
                                    sx={{ 
                                      width: 28, 
                                      height: 28,
                                      border: '1px solid',
                                      borderColor: 'primary.main',
                                      '&:hover': {
                                        backgroundColor: 'primary.50'
                                      }
                                    }}
                                  >
                                    <EditIcon sx={{ fontSize: 14 }} />
                                  </IconButton>
                                </Tooltip>
                                <Tooltip title="Sil" arrow>
                                  <IconButton 
                                    size="small" 
                                    color="error"
                                    onClick={() => handleDeleteItem(audit.id, 'audit')}
                                    sx={{ 
                                      width: 28, 
                                      height: 28,
                                      border: '1px solid',
                                      borderColor: 'error.main',
                                      '&:hover': {
                                        backgroundColor: 'error.50'
                                      }
                                    }}
                                  >
                                    <DeleteIcon sx={{ fontSize: 14 }} />
                                  </IconButton>
                                </Tooltip>
                              </Box>
                            </TableCell>
                          </TableRow>
                        );
                      })}
                    {audits.length === 0 && (
                      <TableRow>
                        <TableCell colSpan={8} align="center" sx={{ py: 6 }}>
                          <Box display="flex" flexDirection="column" alignItems="center" gap={2}>
                            <ScheduleIcon sx={{ fontSize: 48, color: 'text.secondary' }} />
                            <Typography variant="h6" color="text.secondary" sx={{ fontWeight: 500 }}>
                              HenÃ¼z denetim kaydÄ± bulunmuyor
                            </Typography>
                          <Typography variant="body2" color="text.secondary">
                              Ä°lk denetimi planlamak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayÄ±n
                          </Typography>
                          <Button 
                              variant="contained"
                            startIcon={<ScheduleIcon />} 
                            onClick={handleCreateAudit}
                              sx={{ 
                                mt: 1,
                                borderRadius: 2,
                                textTransform: 'none',
                                fontWeight: 600
                              }}
                          >
                            Ä°lk Denetimi Planla
                          </Button>
                          </Box>
                        </TableCell>
                      </TableRow>
                    )}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        {/* DetaylÄ± Denetim Ã–nerileri Tablosu */}
        {autoAuditRecommendations.length > 0 && (
          <Grid item xs={12}>
            <Card elevation={1} sx={{ border: '1px solid', borderColor: 'divider' }}>
              <Box sx={{ p: 2, borderBottom: '1px solid', borderColor: 'divider' }}>
                <Box display="flex" alignItems="center" justifyContent="space-between">
                  <Box display="flex" alignItems="center" gap={1}>
                    <AssessmentIcon color="primary" fontSize="small" />
                    <Typography variant="h6" fontWeight={600}>
                      DetaylÄ± Denetim Ã–nerileri
                    </Typography>
                    <Chip 
                      size="small" 
                      label={`${autoAuditRecommendations.length} Ã¶neri`} 
                      color="primary" 
                      sx={{ height: 22, fontSize: '0.75rem' }}
                    />
                  </Box>
                  <Button 
                    variant="outlined" 
                    size="small"
                    onClick={() => setAutoAuditRecommendations([])}
                    sx={{ textTransform: 'none' }}
                  >
                    TÃ¼mÃ¼nÃ¼ Temizle
                  </Button>
                </Box>
              </Box>
              
              <TableContainer sx={{ maxHeight: 450 }}>
                <Table size="small" stickyHeader>
                  <TableHead>
                    <TableRow sx={{ '& > .MuiTableCell-root': { bgcolor: 'grey.50', fontWeight: 600 } }}>
                      <TableCell sx={{ minWidth: 180, fontSize: '0.85rem' }}>TedarikÃ§i</TableCell>
                      <TableCell align="center" sx={{ width: 90, fontSize: '0.85rem' }}>Aciliyet</TableCell>
                      <TableCell align="center" sx={{ width: 80, fontSize: '0.85rem' }}>Puan</TableCell>
                      <TableCell align="center" sx={{ width: 100, fontSize: '0.85rem' }}>Tarih</TableCell>
                      <TableCell align="center" sx={{ width: 110, fontSize: '0.85rem' }}>Sorun</TableCell>
                      <TableCell align="center" sx={{ width: 120, fontSize: '0.85rem' }}>Ä°ÅŸlemler</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {autoAuditRecommendations.map(recommendation => (
                      <TableRow 
                        key={recommendation.id} 
                        hover 
                        sx={{ 
                          '&:hover': { bgcolor: 'action.hover' },
                          '&:nth-of-type(even)': { bgcolor: 'grey.25' }
                        }}
                      >
                        <TableCell sx={{ py: 1.5 }}>
                          <Box>
                            <Typography 
                              variant="body2" 
                              fontWeight={500} 
                              sx={{ 
                                fontSize: '0.85rem',
                                display: '-webkit-box',
                                WebkitLineClamp: 1,
                                WebkitBoxOrient: 'vertical',
                                overflow: 'hidden'
                              }}
                            >
                              {recommendation.supplierName}
                            </Typography>
                            <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.7rem' }}>
                              ID: {recommendation.supplierId}
                            </Typography>
                          </Box>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Chip 
                            size="small" 
                            label={
                              recommendation.urgencyLevel === 'kritik' ? 'Kritik' :
                              recommendation.urgencyLevel === 'yÃ¼ksek' ? 'YÃ¼ksek' :
                              recommendation.urgencyLevel === 'orta' ? 'Orta' : 'DÃ¼ÅŸÃ¼k'
                            } 
                            color={
                              recommendation.urgencyLevel === 'kritik' ? 'error' :
                              recommendation.urgencyLevel === 'yÃ¼ksek' ? 'warning' :
                              recommendation.urgencyLevel === 'orta' ? 'info' : 'default'
                            }
                            sx={{ 
                              height: 24, 
                              fontSize: '0.7rem', 
                              fontWeight: 500,
                              minWidth: 65
                            }}
                          />
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Box textAlign="center">
                            <Typography 
                              variant="body2" 
                              fontWeight={600} 
                              sx={{ 
                                fontSize: '0.85rem',
                                color: recommendation.currentScore < 70 ? 'error.main' : 
                                      recommendation.currentScore < 80 ? 'warning.main' : 'success.main'
                              }}
                            >
                              {recommendation.currentScore}
                            </Typography>
                            <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.65rem' }}>
                              /{recommendation.previousScore}
                            </Typography>
                          </Box>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                            {new Date(recommendation.recommendedDate).toLocaleDateString('tr-TR', { 
                              day: '2-digit', 
                              month: '2-digit' 
                            })}
                          </Typography>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Tooltip 
                            title={`Performans sorunlarÄ±: ${recommendation.performanceIssues.join(', ')} â€¢ Risk faktÃ¶rleri: ${recommendation.riskFactors.join(', ')}`}
                            placement="top"
                            arrow
                          >
                            <Box textAlign="center" sx={{ cursor: 'help' }}>
                              <Typography 
                                variant="body2" 
                                sx={{ 
                                  fontSize: '0.8rem', 
                                  fontWeight: 600,
                                  color: recommendation.performanceIssues.length > 2 ? 'error.main' : 'warning.main'
                                }}
                              >
                                {recommendation.performanceIssues.length}
                              </Typography>
                              <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.65rem' }}>
                                sorun
                              </Typography>
                            </Box>
                          </Tooltip>
                        </TableCell>
                        <TableCell align="center" sx={{ py: 1.5 }}>
                          <Box display="flex" justifyContent="center" gap={1}>
                            <Tooltip title="Denetimi Kabul Et">
                              <IconButton 
                                size="small" 
                                color="primary"
                                onClick={() => acceptAuditRecommendation(recommendation)}
                                sx={{ 
                                  width: 32, 
                                  height: 32,
                                  border: '1px solid',
                                  borderColor: 'primary.main',
                                  '&:hover': { bgcolor: 'primary.50' }
                                }}
                              >
                                <CheckCircleIcon sx={{ fontSize: 18 }} />
                              </IconButton>
                            </Tooltip>
                            <Tooltip title="Reddet">
                              <IconButton 
                                size="small" 
                                color="error"
                                onClick={() => rejectAuditRecommendation(recommendation.id)}
                                sx={{ 
                                  width: 32, 
                                  height: 32,
                                  border: '1px solid',
                                  borderColor: 'error.main',
                                  '&:hover': { bgcolor: 'error.50' }
                                }}
                              >
                                <DeleteIcon sx={{ fontSize: 18 }} />
                              </IconButton>
                            </Tooltip>
                          </Box>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
              
              {/* Ã–zet Ä°statistikler */}
              <Box mt={2} p={2} bgcolor="grey.50" borderRadius={1}>
                <Typography variant="subtitle2" gutterBottom sx={{ mb: 1, fontSize: '0.85rem' }}>
                  Aciliyet DaÄŸÄ±lÄ±mÄ±
                </Typography>
                <Grid container spacing={1}>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="error.50" borderRadius={1}>
                      <Typography variant="h6" color="error.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'kritik').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Kritik</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="warning.50" borderRadius={1}>
                      <Typography variant="h6" color="warning.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'yÃ¼ksek').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>YÃ¼ksek</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="info.50" borderRadius={1}>
                      <Typography variant="h6" color="info.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.filter(r => r.urgencyLevel === 'orta').length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Orta</Typography>
                    </Box>
                  </Grid>
                  <Grid item xs={3}>
                    <Box textAlign="center" p={1} bgcolor="primary.50" borderRadius={1}>
                      <Typography variant="h6" color="primary.main" sx={{ fontSize: '1.1rem', fontWeight: 600 }}>
                        {autoAuditRecommendations.length}
                      </Typography>
                      <Typography variant="caption" sx={{ fontSize: '0.7rem' }}>Toplam</Typography>
                    </Box>
                  </Grid>
                </Grid>
              </Box>
            </Card>
          </Grid>
        )}
      </Grid>
    </Box>
  );

  // Nonconformity Management Component
  const renderNonconformityManagement = () => {
    console.log('ğŸ” renderNonconformityManagement Ã§aÄŸrÄ±ldÄ±');
    console.log('Nonconformities data:', nonconformities);
    console.log('Suppliers data:', suppliers);
    console.log('dataLoaded:', dataLoaded);
    console.log('isLoading:', isLoading);
    
    if (!dataLoaded) {
      return (
        <Box display="flex" justifyContent="center" alignItems="center" minHeight="200px">
          <CircularProgress />
          <Typography variant="body2" sx={{ ml: 2 }}>
            Uygunsuzluk verileri yÃ¼kleniyor...
          </Typography>
        </Box>
      );
    }
    
    return (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Button variant="contained" startIcon={<BugReportIcon />} onClick={handleCreateNonconformity}>
          Uygunsuzluk Kaydet
        </Button>
      </Box>

      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'error.main' }}>
                  <BugReportIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.status === 'aÃ§Ä±k').length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    AÃ§Ä±k Uygunsuzluk
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'warning.main' }}>
                  <SecurityIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.severity === 'kritik').length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    Kritik Uygunsuzluk
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'info.main' }}>
                  <ReportIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {nonconformities.filter(nc => nc.dofId).length}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    DÃ–F OluÅŸturulan
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" alignItems="center" gap={2}>
                <Avatar sx={{ bgcolor: 'success.main' }}>
                  <CheckCircleIcon />
                </Avatar>
                <Box>
                  <Typography variant="h4" fontWeight="bold">
                    {Math.round((nonconformities.filter(nc => nc.status === 'kapalÄ±').length / nonconformities.length) * 100) || 0}%
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    Ã‡Ã¶zÃ¼m OranÄ±
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>BaÅŸlÄ±k</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>TedarikÃ§i</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Kategori</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Ã–nem</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Durum</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tespit Tarihi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Ä°ÅŸlemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {nonconformities.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} sx={{ textAlign: 'center', py: 4 }}>
                  <Typography color="text.secondary">
                    HenÃ¼z uygunsuzluk kaydÄ± bulunmamaktadÄ±r
                  </Typography>
                  <Button 
                    variant="contained" 
                    startIcon={<BugReportIcon />}
                    sx={{ mt: 2 }}
                    onClick={() => {
                      setDialogType('nonconformity');
                      setDialogOpen(true);
                    }}
                  >
                    Ä°lk UygunsuzluÄŸu Kaydet
                  </Button>
                </TableCell>
              </TableRow>
            ) : (
              nonconformities.map((nonconformity) => (
                <TableRow key={nonconformity.id}>
                  <TableCell>
                    <Box>
                      <Typography variant="body2" fontWeight="bold">
                        {nonconformity.title}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {nonconformity.description.length > 50 
                          ? `${nonconformity.description.substring(0, 50)}...` 
                          : nonconformity.description}
                      </Typography>
                    </Box>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {suppliers.find(s => s.id === nonconformity.supplierId)?.name || 'Bilinmiyor'}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.category.charAt(0).toUpperCase() + nonconformity.category.slice(1)}
                      variant="outlined"
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.severity.charAt(0).toUpperCase() + nonconformity.severity.slice(1)}
                      color={
                        nonconformity.severity === 'kritik' ? 'error' : 
                        nonconformity.severity === 'yÃ¼ksek' ? 'warning' : 
                        nonconformity.severity === 'orta' ? 'info' : 'success'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={nonconformity.status.charAt(0).toUpperCase() + nonconformity.status.slice(1)}
                      color={
                        nonconformity.status === 'kapalÄ±' ? 'success' : 
                        nonconformity.status === 'dÃ¼zeltiliyor' ? 'info' : 
                        nonconformity.status === 'araÅŸtÄ±rÄ±lÄ±yor' ? 'warning' : 'error'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {new Date(nonconformity.detectedDate).toLocaleDateString('tr-TR')}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Box display="flex" gap={1}>
                      <Tooltip title="GÃ¶rÃ¼ntÃ¼le">
                        <IconButton 
                          size="small" 
                          color="primary"
                          onClick={() => {
                            setSelectedItem(nonconformity);
                            setDialogType('nonconformity');
                            setFormData(nonconformity);
                            setDialogOpen(true);
                          }}
                        >
                          <ViewIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="DÃ¼zenle">
                        <IconButton 
                          size="small" 
                          color="info"
                          onClick={() => handleEditItem(nonconformity, 'nonconformity')}
                        >
                          <EditIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title={
                        !nonconformity.dofId ? "DÃ–F OluÅŸtur" : 
                        nonconformity.dofId === 'creating' ? "DÃ–F OluÅŸturuluyor..." : 
                        "DÃ–F OluÅŸturuldu"
                      }>
                        <IconButton 
                          size="small" 
                          color={
                            !nonconformity.dofId ? "warning" : 
                            nonconformity.dofId === 'creating' ? "info" : 
                            "success"
                          }
                          onClick={() => createDOFFromNonconformity(nonconformity)}
                          disabled={!!nonconformity.dofId}
                          sx={{
                            '&.Mui-disabled': {
                              color: nonconformity.dofId === 'creating' ? 'info.main' : 'success.main',
                              opacity: 0.7
                            }
                          }}
                        >
                          {!nonconformity.dofId ? <ReportIcon /> : 
                           nonconformity.dofId === 'creating' ? <CircularProgress size={20} /> : 
                           <CheckCircleIcon />}
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="Sil">
                        <IconButton 
                          size="small" 
                          color="error"
                          onClick={() => handleDeleteItem(nonconformity.id, 'nonconformity')}
                        >
                          <DeleteIcon />
                        </IconButton>
                      </Tooltip>
                    </Box>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
    );
  };

  // Defect Tracking Component
  const renderDefectTracking = () => (
    <Box>
      <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
        <Button variant="contained" startIcon={<WarningIcon />} onClick={handleCreateDefect}>
          Hata Kaydet
        </Button>
      </Box>

      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>Hata Kategorileri</Typography>
              <Box height={200}>
                <ResponsiveContainer width="100%" height="100%">
                  <PieChart>
                    <Pie
                      dataKey="value"
                      data={[
                        { name: 'Boyutsal', value: 15, fill: '#2196f3' },
                        { name: 'GÃ¶rsel', value: 8, fill: '#4caf50' },
                        { name: 'Fonksiyonel', value: 5, fill: '#ff9800' },
                        { name: 'Materyal', value: 3, fill: '#f44336' }
                      ]}
                      cx="50%"
                      cy="50%"
                      outerRadius={60}
                      label
                    >
                      {[
                        { name: 'Boyutsal', value: 15, fill: '#2196f3' },
                        { name: 'GÃ¶rsel', value: 8, fill: '#4caf50' },
                        { name: 'Fonksiyonel', value: 5, fill: '#ff9800' },
                        { name: 'Materyal', value: 3, fill: '#f44336' }
                      ].map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.fill} />
                      ))}
                    </Pie>
                    <ChartTooltip />
                  </PieChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>AylÄ±k Hata Trendi</Typography>
              <Box height={200}>
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={[
                    { month: 'Oca', defects: 12, resolved: 10 },
                    { month: 'Åub', defects: 8, resolved: 9 },
                    { month: 'Mar', defects: 15, resolved: 12 },
                    { month: 'Nis', defects: 6, resolved: 8 },
                    { month: 'May', defects: 10, resolved: 11 },
                    { month: 'Haz', defects: 4, resolved: 6 }
                  ]}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis />
                    <ChartTooltip />
                    <Legend />
                    <Line type="monotone" dataKey="defects" stroke="#f44336" name="Yeni Hatalar" />
                    <Line type="monotone" dataKey="resolved" stroke="#4caf50" name="Ã‡Ã¶zÃ¼len Hatalar" />
                  </LineChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow sx={{ bgcolor: 'primary.50' }}>
              <TableCell sx={{ fontWeight: 'bold' }}>Hata TÃ¼rÃ¼</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>TedarikÃ§i</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Miktar</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Ã–nem</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Tespit Tarihi</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Durum</TableCell>
              <TableCell sx={{ fontWeight: 'bold' }}>Ä°ÅŸlemler</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {defects.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} sx={{ textAlign: 'center', py: 4 }}>
                  <Typography color="text.secondary">
                    HenÃ¼z hata kaydÄ± bulunmamaktadÄ±r
                  </Typography>
                  <Button 
                    variant="contained" 
                    startIcon={<WarningIcon />}
                    sx={{ mt: 2 }}
                    onClick={() => {
                      setDialogType('defect');
                      setDialogOpen(true);
                    }}
                  >
                    Ä°lk HatayÄ± Kaydet
                  </Button>
                </TableCell>
              </TableRow>
            ) : (
              defects.map((defect) => (
                <TableRow key={defect.id}>
                  <TableCell>
                    <Box>
                      <Typography variant="body2" fontWeight="bold">
                        {defect.defectType}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        Parti No: {defect.batchNumber}
                      </Typography>
                    </Box>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {suppliers.find(s => s.id === defect.supplierId)?.name || 'Bilinmiyor'}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2" fontWeight="bold">
                      {defect.quantity} adet
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={defect.severity.charAt(0).toUpperCase() + defect.severity.slice(1)}
                      color={
                        defect.severity === 'kritik' ? 'error' : 
                        defect.severity === 'major' ? 'warning' : 'info'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Typography variant="body2">
                      {new Date(defect.detectedDate).toLocaleDateString('tr-TR')}
                    </Typography>
                  </TableCell>
                  <TableCell>
                    <Chip 
                      label={defect.status.charAt(0).toUpperCase() + defect.status.slice(1)}
                      color={
                        defect.status === 'dÃ¼zeltildi' ? 'success' : 
                        defect.status === 'kabul' ? 'info' : 'warning'
                      }
                      size="small"
                    />
                  </TableCell>
                  <TableCell>
                    <Box display="flex" gap={1}>
                      <Tooltip title="GÃ¶rÃ¼ntÃ¼le">
                        <IconButton 
                          size="small" 
                          color="primary"
                          onClick={() => {
                            setSelectedItem(defect);
                            setDialogType('defect');
                            setFormData(defect);
                            setDialogOpen(true);
                          }}
                        >
                          <ViewIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="DÃ¼zenle">
                        <IconButton 
                          size="small" 
                          color="info"
                          onClick={() => handleEditItem(defect, 'defect')}
                        >
                          <EditIcon />
                        </IconButton>
                      </Tooltip>
                      <Tooltip title={
                        !defect.dofId ? "DÃ–F OluÅŸtur" : 
                        defect.dofId === 'creating' ? "DÃ–F OluÅŸturuluyor..." : 
                        "DÃ–F OluÅŸturuldu"
                      }>
                        <IconButton 
                          size="small" 
                          color={
                            !defect.dofId ? "warning" : 
                            defect.dofId === 'creating' ? "info" : 
                            "success"
                          }
                          onClick={() => {
                            if (defect.dofId) return;
                            
                            // Defect iÃ§in DÃ–F ID'sini 'creating' olarak iÅŸaretle
                            const updatedDefects = defects.map(d => 
                              d.id === defect.id ? { ...d, dofId: 'creating' } : d
                            );
                            setDefects(updatedDefects);
                            
                            const mockNonconformity: NonconformityRecord = {
                              id: `temp-${Date.now()}`,
                              supplierId: defect.supplierId,
                              title: `${defect.defectType} HatasÄ±`,
                              description: `${defect.description} - Miktar: ${defect.quantity}`,
                              category: 'kalite',
                              severity: defect.severity === 'kritik' ? 'kritik' : defect.severity === 'major' ? 'yÃ¼ksek' : 'orta',
                              detectedDate: defect.detectedDate,
                              status: 'aÃ§Ä±k',
                              dueDate: '',
                              correctionCost: defect.correctionCost,
                              recurrence: false,
                              partCode: defect.batchNumber || 'UNKNOWN-001' // Zorunlu alan eklendi
                            };
                            createDOFFromNonconformity(mockNonconformity);
                          }}
                          disabled={!!defect.dofId}
                          sx={{
                            '&.Mui-disabled': {
                              color: defect.dofId === 'creating' ? 'info.main' : 'success.main',
                              opacity: 0.7
                            }
                          }}
                        >
                          {!defect.dofId ? <ReportIcon /> : 
                           defect.dofId === 'creating' ? <CircularProgress size={20} /> : 
                           <CheckCircleIcon />}
                        </IconButton>
                      </Tooltip>
                      <Tooltip title="Sil">
                        <IconButton 
                          size="small" 
                          color="error"
                          onClick={() => handleDeleteItem(defect.id, 'defect')}
                        >
                          <DeleteIcon />
                        </IconButton>
                      </Tooltip>
                    </Box>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </TableContainer>
    </Box>
  );

  // Performance Analysis Component
  const renderPerformanceAnalysis = () => {
    const radarData = prepareRadarData();
    const availableSuppliers = suppliers.slice(0, 5); // Ä°lk 5 tedarikÃ§i
    
    return (
      <Box>
        <Grid container spacing={3}>
          {/* Professional Supplier Selection */}
          <Grid item xs={12}>
            <Paper 
              elevation={0} 
              sx={{ 
                border: '1px solid',
                borderColor: 'grey.200',
                borderRadius: 3,
                overflow: 'hidden'
              }}
            >
              {/* Header - Compact */}
              <Box 
                sx={{ 
                  bgcolor: 'grey.50',
                  borderBottom: '1px solid',
                  borderColor: 'grey.200',
                  p: 2,
                  display: 'flex',
                  justifyContent: 'flex-end',
                  alignItems: 'center'
                }}
              >
                <Paper 
                  elevation={1}
                  sx={{ 
                    p: 1,
                    bgcolor: selectedSuppliersForRadar.length === 3 ? 'success.main' : 'primary.main',
                    color: 'white',
                    minWidth: 50,
                    textAlign: 'center',
                    borderRadius: 2
                  }}
                >
                  <Typography variant="body2" fontWeight={600}>
                    {selectedSuppliersForRadar.length}/3
                  </Typography>
                </Paper>
              </Box>

              {/* Content */}
              <Box sx={{ p: 3 }}>
                <FormControl fullWidth>
                  <InputLabel 
                    sx={{ 
                      fontWeight: 600,
                      color: 'text.primary',
                      '&.Mui-focused': { color: 'primary.main' }
                    }}
                  >
                    TedarikÃ§i SeÃ§imi
                  </InputLabel>
                  <Select
                    multiple
                    value={selectedSuppliersForRadar}
                    onChange={(event) => {
                      const value = event.target.value as string[];
                      if (value.length <= 3) {
                        setSelectedSuppliersForRadar(value);
                      } else {
                        showSnackbar('Maksimum 3 tedarikÃ§i seÃ§ebilirsiniz', 'warning');
                      }
                    }}
                    label="TedarikÃ§i SeÃ§imi"
                    sx={{
                      borderRadius: 2,
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 2
                      },
                      '& .MuiSelect-select': {
                        minHeight: 48
                      }
                    }}
                    renderValue={(selected) => {
                      if ((selected as string[]).length === 0) {
                        return (
                          <Typography variant="body2" color="text.secondary" sx={{ fontStyle: 'italic' }}>
                            TedarikÃ§i seÃ§iniz...
                          </Typography>
                        );
                      }
                      return (
                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                          {(selected as string[]).map((value) => {
                            const supplier = suppliers.find(s => s.id === value);
                            return supplier ? (
                              <Chip 
                                key={value} 
                                label={supplier.name}
                                size="small"
                                sx={{ 
                                  height: 28,
                                  fontSize: '0.8rem',
                                  fontWeight: 500,
                                  bgcolor: 'primary.main',
                                  color: 'white',
                                  '& .MuiChip-deleteIcon': {
                                    color: 'white'
                                  }
                                }}
                              />
                            ) : null;
                          })}
                        </Box>
                      );
                    }}
                  >
                    {suppliers.map((supplier) => (
                      <MenuItem 
                        key={supplier.id} 
                        value={supplier.id}
                        disabled={!selectedSuppliersForRadar.includes(supplier.id) && selectedSuppliersForRadar.length >= 3}
                        sx={{
                          py: 1.5,
                          '&:hover': {
                            bgcolor: 'grey.50'
                          },
                          '&.Mui-disabled': {
                            opacity: 0.5
                          }
                        }}
                      >
                        <Box display="flex" justifyContent="space-between" alignItems="center" width="100%">
                          <Box>
                            <Typography variant="body1" fontWeight={600} sx={{ mb: 0.5 }}>
                              {supplier.name}
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                              {supplier.category}
                            </Typography>
                          </Box>
                          <Box display="flex" alignItems="center" gap={0.5}>
                            <Chip 
                              size="small" 
                              label={`${supplier.performanceScore}%`}
                              sx={{
                                bgcolor: supplier.performanceScore >= 90 ? 'success.main' : 
                                        supplier.performanceScore >= 75 ? 'warning.main' : 'error.main',
                                color: 'white',
                                fontWeight: 600,
                                height: 22,
                                fontSize: '0.7rem'
                              }}
                            />
                          </Box>
                        </Box>
                      </MenuItem>
                    ))}
                  </Select>
                </FormControl>

                {/* Selected Suppliers Preview */}
                {selectedSuppliersForRadar.length > 0 && (
                  <Box mt={3}>
                    <Typography variant="subtitle2" fontWeight={600} color="text.primary" sx={{ mb: 2 }}>
                      SeÃ§ilen TedarikÃ§iler
                    </Typography>
                    <Grid container spacing={2}>
                      {selectedSuppliersForRadar.map((supplierId, index) => {
                        const supplier = suppliers.find(s => s.id === supplierId);
                        const colors = ['#2196f3', '#ff9800', '#4caf50'];
                        return supplier ? (
                          <Grid item xs={12} sm={4} key={supplierId}>
                            <Paper 
                              elevation={2}
                              sx={{ 
                                p: 2, 
                                borderRadius: 2,
                                border: '2px solid',
                                borderColor: colors[index],
                                position: 'relative',
                                bgcolor: 'white'
                              }}
                            >
                              <Box display="flex" justifyContent="space-between" alignItems="flex-start" mb={1}>
                                <Typography variant="body1" fontWeight={600} noWrap>
                                  {supplier.name}
                                </Typography>
                                <Typography 
                                  variant="h6" 
                                  fontWeight={700}
                                  sx={{ color: colors[index] }}
                                >
                                  {supplier.performanceScore}%
                                </Typography>
                              </Box>
                              <Typography variant="caption" color="text.secondary" display="block">
                                {supplier.category}
                              </Typography>
                              <Box 
                                sx={{
                                  position: 'absolute',
                                  top: 8,
                                  right: 8,
                                  width: 8,
                                  height: 8,
                                  borderRadius: '50%',
                                  bgcolor: colors[index]
                                }}
                              />
                            </Paper>
                          </Grid>
                        ) : null;
                      })}
                    </Grid>
                  </Box>
                )}
              </Box>
            </Paper>
          </Grid>

          {/* Performance Radar Chart */}
          <Grid item xs={12} md={8}>
            <Card>
              <CardHeader 
                title="Ã‡ok Boyutlu Performans RadarÄ±" 
                subheader="TedarikÃ§ilerin 6 farklÄ± boyuttaki performans karÅŸÄ±laÅŸtÄ±rmasÄ±"
              />
              <CardContent>
                <Box height={400}>
                  <ResponsiveContainer width="100%" height="100%">
                    <RadarChart data={radarData}>
                      <PolarGrid />
                      <PolarAngleAxis dataKey="dimension" tick={{ fontSize: 12 }} />
                      <PolarRadiusAxis 
                        angle={90} 
                        domain={[0, 100]} 
                        tick={{ fontSize: 10 }}
                        axisLine={false}
                      />
                      {selectedSuppliersForRadar.length > 0 
                        ? suppliers
                            .filter(s => selectedSuppliersForRadar.includes(s.id))
                            .map((supplier, index) => {
                              const colors = ['#2196f3', '#ff9800', '#4caf50', '#f44336', '#9c27b0'];
                              return (
                                <Radar
                                  key={supplier.id}
                                  name={supplier.name.split(' ')[0]}
                                  dataKey={supplier.name.split(' ')[0]}
                                  stroke={colors[index]}
                                  fill={colors[index]}
                                  fillOpacity={0.1}
                                  strokeWidth={2}
                                />
                              );
                            })
                        : suppliers.slice(0, 3).map((supplier, index) => {
                            const colors = ['#2196f3', '#ff9800', '#4caf50'];
                            return (
                              <Radar
                                key={supplier.id}
                                name={supplier.name.split(' ')[0]}
                                dataKey={supplier.name.split(' ')[0]}
                                stroke={colors[index]}
                                fill={colors[index]}
                                fillOpacity={0.1}
                                strokeWidth={2}
                              />
                            );
                          })
                      }
                      <ChartTooltip 
                        formatter={(value: any, name: any) => [`${value}%`, name]}
                        labelFormatter={(label) => `Boyut: ${label}`}
                      />
                      <Legend />
                    </RadarChart>
                  </ResponsiveContainer>
                </Box>
                
                {/* Boyut AÃ§Ä±klamalarÄ± - Kompakt */}
                <Box mt={2} p={2} bgcolor="grey.50" borderRadius={1}>
                  <Typography variant="overline" display="block" gutterBottom sx={{ fontWeight: 'bold', color: 'text.secondary' }}>
                    Performans BoyutlarÄ±
                  </Typography>
                  <Grid container spacing={0.5}>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Kalite:</strong> Uygunsuzluk/Hata
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Teslimat:</strong> ZamanÄ±nda Teslim
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>GÃ¼venilirlik:</strong> Denetim GeÃ§miÅŸi
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Maliyet:</strong> Risk/Hata Maliyeti
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>Ä°novasyon:</strong> Kategori/Hizmet
                      </Typography>
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>
                        <strong>SÃ¼rdÃ¼rÃ¼lebilirlik:</strong> Ä°ÅŸ BirliÄŸi
                      </Typography>
                    </Grid>
                  </Grid>
                </Box>
              </CardContent>
            </Card>
          </Grid>

        {/* Performance Insights - Kompakt */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardHeader 
              title="Performans Ä°Ã§gÃ¶rÃ¼leri" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 'bold' }}
            />
            <CardContent sx={{ pt: 1 }}>
              <Box display="flex" flexDirection="column" gap={1.5}>
                
                {/* En gÃ¼Ã§lÃ¼ boyut */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'success.50', borderLeft: 3, borderColor: 'success.main' }}>
                  <Typography variant="overline" sx={{ color: 'success.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    En GÃ¼Ã§lÃ¼ Boyut
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    Kalite skoru sektÃ¶r ortalamasÄ±nÄ±n %15 Ã¼zerinde
                  </Typography>
                </Paper>
                
                {/* GeliÅŸim alanÄ± */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'warning.50', borderLeft: 3, borderColor: 'warning.main' }}>
                  <Typography variant="overline" sx={{ color: 'warning.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    GeliÅŸim AlanÄ±
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    Ä°novasyon boyutunda iyileÅŸtirme fÄ±rsatÄ±
                  </Typography>
                </Paper>
                
                {/* Ã–neri */}
                <Paper elevation={0} sx={{ p: 1.5, bgcolor: 'info.50', borderLeft: 3, borderColor: 'info.main' }}>
                  <Typography variant="overline" sx={{ color: 'info.main', fontWeight: 'bold', fontSize: '0.7rem' }}>
                    Aksiyon Ã–nerisi
                  </Typography>
                  <Typography variant="body2" sx={{ fontSize: '0.8rem', mt: 0.5 }}>
                    Stratejik tedarikÃ§ilerle inovasyon projelerine odaklanma
                  </Typography>
                </Paper>
                
                {/* Benchmark kompakt */}
                <Box mt={1}>
                  <Typography variant="overline" sx={{ fontWeight: 'bold', color: 'text.secondary', fontSize: '0.7rem' }}>
                    SektÃ¶r KarÅŸÄ±laÅŸtÄ±rmasÄ±
                  </Typography>
                  <Box display="flex" justifyContent="space-between" alignItems="center" mt={1}>
                    <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>Ortalama Performans</Typography>
                    <Chip size="small" label="87.5%" color="primary" sx={{ height: 20, fontSize: '0.7rem' }} />
                  </Box>
                  <Box display="flex" justifyContent="space-between" alignItems="center" mt={0.5}>
                    <Typography variant="body2" sx={{ fontSize: '0.75rem' }}>SektÃ¶r OrtalamasÄ±</Typography>
                    <Chip size="small" label="82.1%" color="default" sx={{ height: 20, fontSize: '0.7rem' }} />
                  </Box>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Performance Ranking - Kompakt */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardHeader 
              title="Performans SÄ±ralamasÄ±" 
              titleTypographyProps={{ variant: 'h6', fontWeight: 'bold' }}
            />
            <CardContent sx={{ pt: 1 }}>
              <List dense>
                {suppliers
                  .sort((a, b) => b.performanceScore - a.performanceScore)
                  .slice(0, 5)
                  .map((supplier, index) => (
                    <ListItem 
                      key={supplier.id} 
                      divider 
                      sx={{ 
                        py: 1, 
                        borderRadius: 1, 
                        mb: 0.5,
                        bgcolor: index < 3 ? `${index === 0 ? 'warning' : index === 1 ? 'info' : 'success'}.50` : 'transparent',
                        '&:hover': { bgcolor: 'action.hover' }
                      }}
                    >
                      <ListItemIcon sx={{ minWidth: 40 }}>
                        <Avatar sx={{ 
                          bgcolor: index === 0 ? '#FFD700' : index === 1 ? '#C0C0C0' : index === 2 ? '#CD7F32' : 'grey.400',
                          width: 28, height: 28, fontSize: '0.75rem', fontWeight: 'bold'
                        }}>
                          {index + 1}
                        </Avatar>
                      </ListItemIcon>
                      <ListItemText
                        primary={
                          <Typography variant="body2" fontWeight="bold" sx={{ fontSize: '0.85rem' }}>
                            {supplier.name}
                          </Typography>
                        }
                        secondary={
                          <Box display="flex" alignItems="center" gap={1} mt={0.5}>
                            <Typography variant="body2" fontWeight="bold" color="primary" sx={{ fontSize: '0.8rem' }}>
                              {supplier.performanceScore}%
                            </Typography>
                            <Box display="flex" gap={0.5}>
                              <Chip 
                                size="small" 
                                label={`K:${supplier.qualityScore}`} 
                                color="primary" 
                                sx={{ height: 18, fontSize: '0.65rem', '& .MuiChip-label': { px: 0.5 } }}
                              />
                              <Chip 
                                size="small" 
                                label={`T:${supplier.deliveryScore}`} 
                                color="success" 
                                sx={{ height: 18, fontSize: '0.65rem', '& .MuiChip-label': { px: 0.5 } }}
                              />
                            </Box>
                          </Box>
                        }
                      />
                      <Box display="flex" alignItems="center">
                        {index < 3 && <StarIcon sx={{ color: '#FFD700', fontSize: '1.2rem' }} />}
                      </Box>
                    </ListItem>
                  ))}
              </List>
            </CardContent>
          </Card>
        </Grid>

        {/* Performance Trends */}
        <Grid item xs={12}>
          <Card>
            <CardHeader title="Performans Trendleri" />
            <CardContent>
              <Box height={300}>
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={[
                    { month: 'Oca', 'SeÃ§kinler Metal': 88, 'Nisa Metal': 85 },
                    { month: 'Åub', 'SeÃ§kinler Metal': 90, 'Nisa Metal': 86 },
                    { month: 'Mar', 'SeÃ§kinler Metal': 91, 'Nisa Metal': 87 },
                    { month: 'Nis', 'SeÃ§kinler Metal': 89, 'Nisa Metal': 85 },
                    { month: 'May', 'SeÃ§kinler Metal': 92, 'Nisa Metal': 88 },
                    { month: 'Haz', 'SeÃ§kinler Metal': 92, 'Nisa Metal': 87 }
                  ]}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" />
                    <YAxis domain={[70, 100]} />
                    <ChartTooltip />
                    <Legend />
                    <Line type="monotone" dataKey="SeÃ§kinler Metal" stroke="#2196f3" strokeWidth={2} />
                    <Line type="monotone" dataKey="Nisa Metal" stroke="#ff9800" strokeWidth={2} />
                  </LineChart>
                </ResponsiveContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
    );
  };

  // Loading durumunda gÃ¶sterilecek iÃ§erik
  if (isLoading) {
    return (
      <ErrorBoundary>
        <Box 
          display="flex" 
          flexDirection="column" 
          justifyContent="center" 
          alignItems="center" 
          minHeight="60vh"
          p={3}
        >
          <CircularProgress size={60} sx={{ mb: 3 }} />
          <Typography variant="h6" gutterBottom>
            TedarikÃ§i Kalite YÃ¶netimi YÃ¼kleniyor...
          </Typography>
          <Typography variant="body2" color="text.secondary">
            Veriler hazÄ±rlanÄ±yor, lÃ¼tfen bekleyin
          </Typography>
        </Box>
      </ErrorBoundary>
    );
  }

  return (
    <ErrorBoundary>
      <Box p={3}>
        <Box display="flex" justifyContent="flex-end" alignItems="center" mb={3}>
          <Box display="flex" gap={2} alignItems="center">
            <FormControlLabel
              control={
                <Switch
                  checked={autoAuditEnabled}
                  onChange={(e) => setAutoAuditEnabled(e.target.checked)}
                  color="primary"
                />
              }
              label="Otomatik Denetim"
            />
            <Button
              variant="outlined"
              startIcon={<AssessmentIcon />}
              onClick={() => {
                console.log('ğŸ”„ Manuel performans gÃ¼ncelleme baÅŸlatÄ±ldÄ±...');
                console.log('Mevcut tedarikÃ§i sayÄ±sÄ±:', suppliers.length);
                console.log('Mevcut uygunsuzluk sayÄ±sÄ±:', nonconformities.length);
                console.log('Mevcut hata sayÄ±sÄ±:', defects.length);
                updateSupplierPerformances();
                showSnackbar('Performanslar gÃ¼ncellendi', 'success');
              }}
              color="info"
            >
              Performans Yenile
            </Button>
            <Button
              variant="contained"
              startIcon={<AddIcon />}
              onClick={handleCreateSupplier}
            >
              Yeni TedarikÃ§i
            </Button>
          </Box>
        </Box>

        <Paper sx={{ width: '100%', mb: 2 }}>
          <Tabs value={currentTab} onChange={(e, newValue) => setCurrentTab(newValue)}>
            <Tab icon={<DashboardIcon />} label="Dashboard" />
            <Tab icon={<LinkIcon />} label="OnaylÄ±/Alternatif EÅŸleÅŸtirme" />
            <Tab icon={<BusinessIcon />} label="TedarikÃ§i Listesi" />
            <Tab icon={<ScheduleIcon />} label="Denetim Takibi" />
            <Tab icon={<BugReportIcon />} label="Uygunsuzluk YÃ¶netimi" />
            <Tab icon={<WarningIcon />} label="Hata Takibi" />
            <Tab icon={<AssessmentIcon />} label="Performans Analizi" />
          </Tabs>
        </Paper>

                 <Box>
           {(() => {
             try {
               switch (currentTab) {
                 case 0:
                   return renderDashboard();
                 case 1:
                   return renderSupplierPairing();
                 case 2:
                   return renderSupplierList();
                 case 3:
                   return renderAuditTracking();
                 case 4:
                   console.log('ğŸ¯ Uygunsuzluk YÃ¶netimi tab\'Ä± render ediliyor...');
                   return renderNonconformityManagement();
                 case 5:
                   return renderDefectTracking();
                 case 6:
                   return renderPerformanceAnalysis();
                 default:
                   return renderDashboard();
               }
             } catch (error) {
               console.error('âŒ Tab render hatasÄ±:', error);
               return (
                 <Box p={3}>
                   <Alert severity="error">
                     <Typography variant="h6" gutterBottom>
                       Sekme YÃ¼kleme HatasÄ±
                     </Typography>
                     <Typography variant="body2" gutterBottom>
                       {error instanceof Error ? error.message : 'Bilinmeyen bir hata oluÅŸtu'}
                     </Typography>
                     <Button 
                       variant="contained" 
                       onClick={() => {
                         setCurrentTab(0);
                         window.location.reload();
                       }}
                       sx={{ mt: 2 }}
                     >
                       Ana Sayfaya DÃ¶n
                     </Button>
                   </Alert>
                 </Box>
               );
             }
           })()}
         </Box>

        {/* Snackbar */}
        <Snackbar
          open={snackbar.open}
          autoHideDuration={6000}
          onClose={() => setSnackbar({ ...snackbar, open: false })}
        >
          <Alert severity={snackbar.severity} onClose={() => setSnackbar({ ...snackbar, open: false })}>
            {snackbar.message}
          </Alert>
        </Snackbar>

        {/* Universal Dialog for all operations */}
        <Dialog 
          open={dialogOpen} 
          onClose={() => setDialogOpen(false)}
          maxWidth="md"
          fullWidth
        >
          <DialogTitle>
            {dialogType === 'supplier' && (selectedItem ? 'TedarikÃ§i DÃ¼zenle' : 'Yeni TedarikÃ§i Ekle')}
            {dialogType === 'pair' && (selectedItem ? 'EÅŸleÅŸtirme DÃ¼zenle' : 'Yeni EÅŸleÅŸtirme OluÅŸtur')}
            {dialogType === 'nonconformity' && (selectedItem ? 'Uygunsuzluk DÃ¼zenle' : 'Yeni Uygunsuzluk Kaydet')}
            {dialogType === 'defect' && (selectedItem ? 'Hata DÃ¼zenle' : 'Yeni Hata Kaydet')}
            {dialogType === 'audit' && (selectedItem ? 'Denetim DÃ¼zenle' : 'Yeni Denetim Planla')}
          </DialogTitle>
          
          <DialogContent>
            {dialogType === 'supplier' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="TedarikÃ§i AdÄ±"
                      value={formData.name || ''}
                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                      required
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>TÃ¼r</InputLabel>
                      <Select
                        value={formData.type || 'onaylÄ±'}
                        onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                      >
                        <MenuItem value="onaylÄ±">OnaylÄ±</MenuItem>
                        <MenuItem value="alternatif">Alternatif</MenuItem>
                        <MenuItem value="potansiyel">Potansiyel</MenuItem>
                        <MenuItem value="bloklu">Bloklu</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Kategori</InputLabel>
                      <Select
                        value={formData.category || 'genel'}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="stratejik">Stratejik</MenuItem>
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="rutin">Rutin</MenuItem>
                        <MenuItem value="genel">Genel</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  {/* Yeni Tedarik TÃ¼rÃ¼ AlanlarÄ± */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Tedarik TÃ¼rÃ¼</InputLabel>
                      <Select
                        value={formData.supplyType || 'malzeme'}
                        onChange={(e) => {
                          const newSupplyType = e.target.value as 'malzeme' | 'hizmet' | 'hibrit';
                          setFormData({ 
                            ...formData, 
                            supplyType: newSupplyType,
                            supplySubcategories: [] // Reset subcategories when type changes
                          });
                        }}
                      >
                        <MenuItem value="malzeme">Malzeme TedarikÃ§isi</MenuItem>
                        <MenuItem value="hizmet">Hizmet SaÄŸlayÄ±cÄ±sÄ±</MenuItem>
                        <MenuItem value="hibrit">Hibrit (Malzeme + Hizmet)</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>Alt Kategoriler</InputLabel>
                      <Select
                        multiple
                        value={formData.supplySubcategories || []}
                        onChange={(e) => setFormData({ 
                          ...formData, 
                          supplySubcategories: e.target.value as string[]
                        })}
                        renderValue={(selected) => (
                          <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                            {(selected as string[]).map((value) => (
                              <Chip key={value} label={value} size="small" />
                            ))}
                          </Box>
                        )}
                      >
                        {formData.supplyType && SUPPLY_SUBCATEGORIES[formData.supplyType as keyof typeof SUPPLY_SUBCATEGORIES]?.map((subcategory) => (
                          <MenuItem key={subcategory} value={subcategory}>
                            {subcategory}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Ä°letiÅŸim KiÅŸisi"
                      value={formData.contact?.contactPerson || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, contactPerson: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="E-posta"
                      type="email"
                      value={formData.contact?.email || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, email: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Telefon"
                      value={formData.contact?.phone || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, phone: e.target.value }
                      })}
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Adres"
                      value={formData.contact?.address || ''}
                      onChange={(e) => setFormData({ 
                        ...formData, 
                        contact: { ...formData.contact, address: e.target.value }
                      })}
                    />
                  </Grid>
                  
                  {/* Performans SkorlarÄ± */}
                  <Grid item xs={12}>
                    <Typography variant="h6" sx={{ mt: 2, mb: 1 }}>Performans SkorlarÄ±</Typography>
                    <Alert severity="info" sx={{ mb: 2 }}>
                      Genel performans skoru kalite (%60) ve teslimat (%40) skorlarÄ±na gÃ¶re otomatik hesaplanÄ±r.
                    </Alert>
                  </Grid>
                  
                  {/* Kalite ve Teslimat SkorlarÄ± - DÃ¼zenlenebilir */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Kalite Skoru"
                      type="number"
                      value={formData.qualityScore ?? 88}
                      onChange={(e) => {
                        const newQualityScore = e.target.value === '' ? 0 : Math.max(0, Math.min(100, Number(e.target.value)));
                        const currentDeliveryScore = formData.deliveryScore ?? 90;
                        const calculatedPerformance = calculatePerformanceScore(newQualityScore, currentDeliveryScore);
                        
                        setFormData({ 
                          ...formData, 
                          qualityScore: newQualityScore,
                          performanceScore: calculatedPerformance
                        });
                      }}
                      InputProps={{
                        endAdornment: <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.7rem', minWidth: 'auto' }}>%</Typography>
                      }}
                      inputProps={{ 
                        min: 0, 
                        max: 100, 
                        step: 1,
                        'aria-label': 'Kalite Skoru'
                      }}
                      helperText="0-100 arasÄ± puan"
                      error={formData.qualityScore !== undefined && (formData.qualityScore < 0 || formData.qualityScore > 100)}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Teslimat Skoru"
                      type="number"
                      value={formData.deliveryScore ?? 90}
                      onChange={(e) => {
                        const newDeliveryScore = e.target.value === '' ? 0 : Math.max(0, Math.min(100, Number(e.target.value)));
                        const currentQualityScore = formData.qualityScore ?? 88;
                        const calculatedPerformance = calculatePerformanceScore(currentQualityScore, newDeliveryScore);
                        
                        setFormData({ 
                          ...formData, 
                          deliveryScore: newDeliveryScore,
                          performanceScore: calculatedPerformance
                        });
                      }}
                      InputProps={{
                        endAdornment: <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.7rem', minWidth: 'auto' }}>%</Typography>
                      }}
                      inputProps={{ 
                        min: 0, 
                        max: 100, 
                        step: 1,
                        'aria-label': 'Teslimat Skoru'
                      }}
                      helperText="0-100 arasÄ± puan"
                      error={formData.deliveryScore !== undefined && (formData.deliveryScore < 0 || formData.deliveryScore > 100)}
                    />
                  </Grid>
                  
                  {/* Genel Performans Skoru - Otomatik Hesaplanan, Sadece Okunur */}
                  <Grid item xs={12}>
                    <Box sx={{ p: 2, bgcolor: 'grey.50', borderRadius: 1, border: '1px solid', borderColor: 'grey.300' }}>
                      <Box display="flex" alignItems="center" justifyContent="space-between">
                        <Typography variant="body1" fontWeight="bold">
                          Genel Performans Skoru (Otomatik)
                        </Typography>
                        <Box display="flex" alignItems="center" gap={1}>
                          <Typography 
                            variant="h4" 
                            fontWeight="bold" 
                            color={
                              (formData.performanceScore !== undefined ? formData.performanceScore : 
                               calculatePerformanceScore(
                                 formData.qualityScore !== undefined ? formData.qualityScore : (selectedItem ? selectedItem.qualityScore : 88),
                                 formData.deliveryScore !== undefined ? formData.deliveryScore : (selectedItem ? selectedItem.deliveryScore : 90)
                               )) >= 90 ? 'success.main' :    // A SÄ±nÄ±fÄ±
                              (formData.performanceScore !== undefined ? formData.performanceScore : 
                               calculatePerformanceScore(
                                 formData.qualityScore !== undefined ? formData.qualityScore : (selectedItem ? selectedItem.qualityScore : 88),
                                 formData.deliveryScore !== undefined ? formData.deliveryScore : (selectedItem ? selectedItem.deliveryScore : 90)
                               )) >= 75 ? 'info.main' :       // B SÄ±nÄ±fÄ±
                              (formData.performanceScore !== undefined ? formData.performanceScore : 
                               calculatePerformanceScore(
                                 formData.qualityScore !== undefined ? formData.qualityScore : (selectedItem ? selectedItem.qualityScore : 88),
                                 formData.deliveryScore !== undefined ? formData.deliveryScore : (selectedItem ? selectedItem.deliveryScore : 90)
                               )) >= 60 ? 'warning.main' :    // C SÄ±nÄ±fÄ±
                              'error.main'                     // D SÄ±nÄ±fÄ±
                            }
                          >
                            {formData.performanceScore !== undefined ? formData.performanceScore : 
                             calculatePerformanceScore(
                               formData.qualityScore !== undefined ? formData.qualityScore : (selectedItem ? selectedItem.qualityScore : 88),
                               formData.deliveryScore !== undefined ? formData.deliveryScore : (selectedItem ? selectedItem.deliveryScore : 90)
                             )}
                          </Typography>
                          <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.7rem' }}>%</Typography>
                        </Box>
                      </Box>
                      <Typography variant="caption" color="text.secondary" sx={{ mt: 1, display: 'block' }}>
                        Kalite Skoru (%60) + Teslimat Skoru (%40) aÄŸÄ±rlÄ±klÄ± ortalamasÄ±
                      </Typography>
                    </Box>
                  </Grid>
                  
                  {/* Risk Seviyesi ve Durum */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Risk Seviyesi</InputLabel>
                      <Select
                        value={formData.riskLevel || 'dÃ¼ÅŸÃ¼k'}
                        onChange={(e) => setFormData({ ...formData, riskLevel: e.target.value })}
                      >
                        <MenuItem value="dÃ¼ÅŸÃ¼k">DÃ¼ÅŸÃ¼k Risk</MenuItem>
                        <MenuItem value="orta">Orta Risk</MenuItem>
                        <MenuItem value="yÃ¼ksek">YÃ¼ksek Risk</MenuItem>
                        <MenuItem value="kritik">Kritik Risk</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Durum</InputLabel>
                      <Select
                        value={formData.status || 'aktif'}
                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                      >
                        <MenuItem value="aktif">Aktif</MenuItem>
                        <MenuItem value="pasif">Pasif</MenuItem>
                        <MenuItem value="denetimde">Denetimde</MenuItem>
                        <MenuItem value="bloklu">Bloklu</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'nonconformity' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>TedarikÃ§i</InputLabel>
                      <Select
                        value={formData.supplierId || ''}
                        onChange={(e) => setFormData({ ...formData, supplierId: e.target.value })}
                      >
                        {suppliers.map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            {supplier.name}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Uygunsuzluk BaÅŸlÄ±ÄŸÄ±"
                      value={formData.title || ''}
                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                      required
                    />
                  </Grid>
                  
                  {/* Zorunlu ParÃ§a Kodu */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="ParÃ§a Kodu"
                      value={formData.partCode || ''}
                      onChange={(e) => setFormData({ ...formData, partCode: e.target.value })}
                      required
                      helperText="Bu alan zorunludur"
                      error={!formData.partCode}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Uygunsuzluk Kategorisi</InputLabel>
                      <Select
                        value={formData.category || 'kalite'}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="kalite">Kalite Problemi</MenuItem>
                        <MenuItem value="teslimat">Teslimat Problemi</MenuItem>
                        <MenuItem value="dokÃ¼man">DokÃ¼man Problemi</MenuItem>
                        <MenuItem value="servis">Servis Problemi</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  {/* Dinamik Alanlar - Kategori BazÄ±nda */}
                  {formData.category === 'kalite' && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Etkilenen ParÃ§a Adedi (adet)"
                        type="number"
                        value={formData.quantityAffected || ''}
                        onChange={(e) => setFormData({ ...formData, quantityAffected: Number(e.target.value) })}
                        helperText="Kalite probleminden etkilenen parÃ§a sayÄ±sÄ±"
                        inputProps={{ min: 0, step: 1 }}
                      />
                    </Grid>
                  )}
                  
                  {formData.category === 'teslimat' && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Gecikme SÃ¼resi (gÃ¼n)"
                        type="number"
                        value={formData.delayDays || ''}
                        onChange={(e) => setFormData({ ...formData, delayDays: Number(e.target.value) })}
                        helperText="Teslimat gecikmesi gÃ¼n olarak"
                        inputProps={{ min: 0, step: 1 }}
                      />
                    </Grid>
                  )}
                  
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Uygunsuzluk AÃ§Ä±klamasÄ±"
                      multiline
                      rows={3}
                      value={formData.description || ''}
                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                      required
                      helperText="UygunsuzluÄŸun detaylÄ± aÃ§Ä±klamasÄ±"
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Ã–nem Derecesi</InputLabel>
                      <Select
                        value={formData.severity || 'dÃ¼ÅŸÃ¼k'}
                        onChange={(e) => setFormData({ ...formData, severity: e.target.value })}
                      >
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="yÃ¼ksek">YÃ¼ksek</MenuItem>
                        <MenuItem value="orta">Orta</MenuItem>
                        <MenuItem value="dÃ¼ÅŸÃ¼k">DÃ¼ÅŸÃ¼k</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Tespit Tarihi"
                      type="date"
                      value={formData.detectedDate || new Date().toISOString().split('T')[0]}
                      onChange={(e) => setFormData({ ...formData, detectedDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Hedef Tamamlanma Tarihi"
                      type="date"
                      value={formData.dueDate || ''}
                      onChange={(e) => setFormData({ ...formData, dueDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      helperText="UygunsuzluÄŸun giderilmesi gereken tarih"
                    />
                  </Grid>
                  
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Durum</InputLabel>
                      <Select
                        value={formData.status || 'aÃ§Ä±k'}
                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                      >
                        <MenuItem value="aÃ§Ä±k">AÃ§Ä±k</MenuItem>
                        <MenuItem value="araÅŸtÄ±rÄ±lÄ±yor">AraÅŸtÄ±rÄ±lÄ±yor</MenuItem>
                        <MenuItem value="dÃ¼zeltiliyor">DÃ¼zeltiliyor</MenuItem>
                        <MenuItem value="kapalÄ±">KapalÄ±</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'defect' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <FormControl fullWidth>
                      <InputLabel>TedarikÃ§i</InputLabel>
                      <Select
                        value={formData.supplierId || ''}
                        onChange={(e) => setFormData({ ...formData, supplierId: e.target.value })}
                      >
                        {suppliers.map(supplier => (
                          <MenuItem key={supplier.id} value={supplier.id}>
                            {supplier.name}
                          </MenuItem>
                        ))}
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Hata TÃ¼rÃ¼"
                      value={formData.defectType || ''}
                      onChange={(e) => setFormData({ ...formData, defectType: e.target.value })}
                      required
                    />
                  </Grid>
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Parti NumarasÄ±"
                      value={formData.batchNumber || ''}
                      onChange={(e) => setFormData({ ...formData, batchNumber: e.target.value })}
                    />
                  </Grid>
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="AÃ§Ä±klama"
                      multiline
                      rows={3}
                      value={formData.description || ''}
                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="Miktar (adet)"
                      type="number"
                      value={formData.quantity || 0}
                      onChange={(e) => setFormData({ ...formData, quantity: Number(e.target.value) })}
                      inputProps={{ min: 0, step: 1 }}
                      helperText="HatalÄ± parÃ§a adedi"
                    />
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <FormControl fullWidth>
                      <InputLabel>Ã–nem Derecesi</InputLabel>
                      <Select
                        value={formData.severity || 'minor'}
                        onChange={(e) => setFormData({ ...formData, severity: e.target.value })}
                      >
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="major">Major</MenuItem>
                        <MenuItem value="minor">Minor</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                  <Grid item xs={12} md={4}>
                    <TextField
                      fullWidth
                      label="DÃ¼zeltme Maliyeti (â‚º)"
                      type="number"
                      value={formData.correctionCost || 0}
                      onChange={(e) => setFormData({ ...formData, correctionCost: Number(e.target.value) })}
                      inputProps={{ min: 0, step: 0.01 }}
                      helperText="Tahmini maliyet"
                    />
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'pair' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <Typography variant="h6" gutterBottom color="primary">
                      TedarikÃ§i EÅŸleÅŸtirme Bilgileri
                    </Typography>
                  </Grid>
                  
                  {/* Ana TedarikÃ§i SeÃ§imi - Opsiyonel */}
                  <Grid item xs={12} md={6}>
                    <Autocomplete
                      fullWidth
                      options={suppliers.filter(s => s.type === 'onaylÄ±')}
                      getOptionLabel={(option) => option.name}
                      value={suppliers.find(s => s.id === formData.primarySupplierId) || null}
                      onChange={(event, newValue) => {
                        const selectedSupplierId = newValue?.id || '';
                        
                        setFormData({ 
                          ...formData, 
                          primarySupplierId: selectedSupplierId
                        });
                      }}
                      renderInput={(params) => (
                        <TextField
                          {...params}
                          label="Ana TedarikÃ§i (Opsiyonel)"
                          helperText="Alternatifler arasÄ±ndan seÃ§im yapmak iÃ§in boÅŸ bÄ±rakabilirsiniz"
                        />
                      )}
                      renderOption={(props, option) => (
                        <Box component="li" {...props}>
                            <Box display="flex" alignItems="center" gap={1}>
                              <CheckCircleIcon color="success" fontSize="small" />
                            <Box>
                              <Typography variant="body2" fontWeight="500">
                                {option.name}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {option.category} â€¢ Puan: {option.performanceScore}
                              </Typography>
                            </Box>
                          </Box>
                        </Box>
                      )}
                      filterOptions={(options, { inputValue }) =>
                        options.filter(option =>
                          option.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.category.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.materialTypes.some(mt => mt.toLowerCase().includes(inputValue.toLowerCase()))
                        )
                      }
                      noOptionsText="TedarikÃ§i bulunamadÄ±"
                    />
                  </Grid>

                  {/* 1. Alternatif TedarikÃ§i SeÃ§imi */}
                  <Grid item xs={12} md={6}>
                    <Autocomplete
                      fullWidth
                      options={suppliers.filter(s => (s.type === 'alternatif' || s.type === 'onaylÄ±') && 
                        s.id !== formData.primarySupplierId && 
                        s.id !== (formData.alternativeSupplierIds || [])[1])}
                      getOptionLabel={(option) => option.name}
                      value={suppliers.find(s => s.id === (formData.alternativeSupplierIds || [])[0]) || null}
                      onChange={(event, newValue) => {
                        const currentIds = formData.alternativeSupplierIds || [];
                        const newIds = [...currentIds];
                        newIds[0] = newValue?.id || '';
                        // BoÅŸ stringleri filtrele
                        const filteredIds = newIds.filter(id => id !== '');
                        setFormData({ ...formData, alternativeSupplierIds: filteredIds });
                      }}
                      renderInput={(params) => (
                        <TextField
                          {...params}
                          label="1. Alternatif TedarikÃ§i (Opsiyonel)"
                          helperText="Arama yaparak tedarikÃ§i bulabilirsiniz"
                        />
                      )}
                      renderOption={(props, option) => (
                        <Box component="li" {...props}>
                            <Box display="flex" alignItems="center" gap={1}>
                              <SwapHorizIcon color="warning" fontSize="small" />
                            <Box>
                              <Typography variant="body2" fontWeight="500">
                                {option.name}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {option.type} â€¢ {option.category} â€¢ Puan: {option.performanceScore}
                              </Typography>
                            </Box>
                          </Box>
                        </Box>
                      )}
                      filterOptions={(options, { inputValue }) =>
                        options.filter(option =>
                          option.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.category.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.type.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.materialTypes.some(mt => mt.toLowerCase().includes(inputValue.toLowerCase()))
                        )
                      }
                      noOptionsText="TedarikÃ§i bulunamadÄ±"
                    />
                  </Grid>

                  {/* 2. Alternatif TedarikÃ§i SeÃ§imi */}
                  <Grid item xs={12} md={6}>
                    <Autocomplete
                      fullWidth
                      options={suppliers.filter(s => (s.type === 'alternatif' || s.type === 'onaylÄ±') && 
                        s.id !== formData.primarySupplierId && 
                        s.id !== (formData.alternativeSupplierIds || [])[0])}
                      getOptionLabel={(option) => option.name}
                      value={suppliers.find(s => s.id === (formData.alternativeSupplierIds || [])[1]) || null}
                      onChange={(event, newValue) => {
                        const currentIds = formData.alternativeSupplierIds || [];
                        const newIds = [...currentIds];
                        newIds[1] = newValue?.id || '';
                        // BoÅŸ stringleri filtrele
                        const filteredIds = newIds.filter(id => id !== '');
                        setFormData({ ...formData, alternativeSupplierIds: filteredIds });
                      }}
                      renderInput={(params) => (
                        <TextField
                          {...params}
                          label="2. Alternatif TedarikÃ§i (Opsiyonel)"
                          helperText="Ä°kinci alternatif tedarikÃ§i seÃ§ebilirsiniz"
                        />
                      )}
                      renderOption={(props, option) => (
                        <Box component="li" {...props}>
                          <Box display="flex" alignItems="center" gap={1}>
                            <SwapHorizIcon color="info" fontSize="small" />
                            <Box>
                              <Typography variant="body2" fontWeight="500">
                                {option.name}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {option.type} â€¢ {option.category} â€¢ Puan: {option.performanceScore}
                              </Typography>
                            </Box>
                          </Box>
                        </Box>
                      )}
                      filterOptions={(options, { inputValue }) =>
                        options.filter(option =>
                          option.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.category.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.type.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.materialTypes.some(mt => mt.toLowerCase().includes(inputValue.toLowerCase()))
                        )
                      }
                      noOptionsText="TedarikÃ§i bulunamadÄ±"
                    />
                  </Grid>

                  {/* 3. Alternatif TedarikÃ§i SeÃ§imi */}
                  <Grid item xs={12} md={6}>
                    <Autocomplete
                      fullWidth
                      options={suppliers.filter(s => (s.type === 'alternatif' || s.type === 'onaylÄ±') && 
                        s.id !== formData.primarySupplierId && 
                        s.id !== (formData.alternativeSupplierIds || [])[0] &&
                        s.id !== (formData.alternativeSupplierIds || [])[1])}
                      getOptionLabel={(option) => option.name}
                      value={suppliers.find(s => s.id === (formData.alternativeSupplierIds || [])[2]) || null}
                      onChange={(event, newValue) => {
                        const currentIds = formData.alternativeSupplierIds || [];
                        const newIds = [...currentIds];
                        newIds[2] = newValue?.id || '';
                        // BoÅŸ stringleri filtrele
                        const filteredIds = newIds.filter(id => id !== '');
                        setFormData({ ...formData, alternativeSupplierIds: filteredIds });
                      }}
                      renderInput={(params) => (
                        <TextField
                          {...params}
                          label="3. Alternatif TedarikÃ§i (Opsiyonel)"
                          helperText="ÃœÃ§Ã¼ncÃ¼ alternatif tedarikÃ§i seÃ§ebilirsiniz"
                        />
                      )}
                      renderOption={(props, option) => (
                        <Box component="li" {...props}>
                          <Box display="flex" alignItems="center" gap={1}>
                            <SwapHorizIcon color="secondary" fontSize="small" />
                            <Box>
                              <Typography variant="body2" fontWeight="500">
                                {option.name}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {option.type} â€¢ {option.category} â€¢ Puan: {option.performanceScore}
                              </Typography>
                            </Box>
                          </Box>
                        </Box>
                      )}
                      filterOptions={(options, { inputValue }) =>
                        options.filter(option =>
                          option.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.category.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.type.toLowerCase().includes(inputValue.toLowerCase()) ||
                          option.materialTypes.some(mt => mt.toLowerCase().includes(inputValue.toLowerCase()))
                        )
                      }
                      noOptionsText="TedarikÃ§i bulunamadÄ±"
                    />
                  </Grid>

                  {/* Kategori */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Kategori</InputLabel>
                      <Select
                        value={formData.category || ''}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      >
                        <MenuItem value="stratejik">Stratejik</MenuItem>
                        <MenuItem value="kritik">Kritik</MenuItem>
                        <MenuItem value="rutin">Rutin</MenuItem>
                        <MenuItem value="genel">Genel</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* EÅŸleÅŸtirme Nedeni */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="EÅŸleÅŸtirme Nedeni"
                      multiline
                      rows={3}
                      value={formData.reason || ''}
                      onChange={(e) => setFormData({ ...formData, reason: e.target.value })}
                      placeholder="Bu eÅŸleÅŸtirmenin nedenini aÃ§Ä±klayÄ±n (Ã¶rn: Risk azaltma, yedek tedarik, maliyet optimizasyonu)"
                      helperText="EÅŸleÅŸtirmenin amacÄ±nÄ± ve gerekÃ§esini belirtin"
                    />
                  </Grid>

                  {/* Ã–nerilen Ä°nceleme Tarihi */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Ä°lk Ä°nceleme Tarihi"
                      type="date"
                      value={formData.firstReviewDate || new Date().toISOString().split('T')[0]}
                      onChange={(e) => setFormData({ ...formData, firstReviewDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      helperText="EÅŸleÅŸtirmenin ne zaman gÃ¶zden geÃ§irileceÄŸi"
                    />
                  </Grid>

                  {/* Ä°nceleme Periyodu */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Ä°nceleme Periyodu</InputLabel>
                      <Select
                        value={formData.reviewPeriod || '3'}
                        onChange={(e) => setFormData({ ...formData, reviewPeriod: e.target.value })}
                      >
                        <MenuItem value="1">1 Ay</MenuItem>
                        <MenuItem value="3">3 Ay</MenuItem>
                        <MenuItem value="6">6 Ay</MenuItem>
                        <MenuItem value="12">12 Ay</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Ek Notlar */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Ek Notlar"
                      multiline
                      rows={2}
                      value={formData.notes || ''}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      placeholder="Varsa ek bilgiler ve Ã¶zel durumlar"
                    />
                  </Grid>

                  {/* Risk DeÄŸerlendirmesi */}
                  <Grid item xs={12}>
                    <Typography variant="subtitle2" gutterBottom color="text.secondary">
                      Risk DeÄŸerlendirmesi
                    </Typography>
                    <FormControl fullWidth>
                      <InputLabel>Risk Seviyesi</InputLabel>
                      <Select
                        value={formData.riskLevel || 'dÃ¼ÅŸÃ¼k'}
                        onChange={(e) => setFormData({ ...formData, riskLevel: e.target.value })}
                      >
                        <MenuItem value="dÃ¼ÅŸÃ¼k">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="success.main" borderRadius="50%" />
                            DÃ¼ÅŸÃ¼k Risk
                          </Box>
                        </MenuItem>
                        <MenuItem value="orta">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="warning.main" borderRadius="50%" />
                            Orta Risk
                          </Box>
                        </MenuItem>
                        <MenuItem value="yÃ¼ksek">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={12} height={12} bgcolor="error.main" borderRadius="50%" />
                            YÃ¼ksek Risk
                          </Box>
                        </MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>
                </Grid>
              </Box>
            )}

            {dialogType === 'audit' && (
              <Box component="form" sx={{ mt: 2 }}>
                <Grid container spacing={2}>
                  <Grid item xs={12}>
                    <Typography variant="h6" gutterBottom color="primary">
                      Denetim Planlama
                    </Typography>
                  </Grid>
                  
                  {/* TedarikÃ§i SeÃ§imi */}
                  <Grid item xs={12} md={6}>
                    <Autocomplete
                      fullWidth
                      options={suppliers}
                      getOptionLabel={(option) => option.name}
                      value={suppliers.find(s => s.id === formData.supplierId) || null}
                      onChange={(event, newValue) => {
                        setFormData({ ...formData, supplierId: newValue?.id || '' });
                      }}
                      isOptionEqualToValue={(option, value) => option.id === value.id}
                      renderInput={(params) => (
                        <TextField
                          {...params}
                          label="TedarikÃ§i *"
                          placeholder="TedarikÃ§i adÄ± yazÄ±n veya listeden seÃ§in..."
                          required
                          error={!formData.supplierId}
                          helperText={!formData.supplierId ? "TedarikÃ§i seÃ§imi zorunludur" : ""}
                          InputProps={{
                            ...params.InputProps,
                            startAdornment: (
                              <>
                                <BusinessIcon color="primary" fontSize="small" sx={{ mr: 1 }} />
                                {params.InputProps.startAdornment}
                              </>
                            ),
                          }}
                        />
                      )}
                      renderOption={(props, option) => (
                        <Box component="li" {...props}>
                          <Box display="flex" alignItems="center" gap={1} width="100%">
                            <BusinessIcon fontSize="small" color="primary" />
                            <Box flex={1}>
                              <Typography variant="body2" fontWeight="500">
                                {option.name}
                              </Typography>
                              <Box display="flex" alignItems="center" gap={1}>
                                <Chip 
                                  label={option.type} 
                                  size="small" 
                                  color={option.type === 'onaylÄ±' ? 'success' : 'default'}
                                  sx={{ fontSize: '0.7rem', height: 18 }}
                                />
                                <Chip 
                                  label={`${option.category}`} 
                                  size="small" 
                                  color="primary" 
                                  variant="outlined"
                                  sx={{ fontSize: '0.7rem', height: 18 }}
                                />
                                <Typography variant="caption" color="text.secondary">
                                  {option.riskLevel} risk
                                </Typography>
                                {option.performanceScore >= 0 && (
                                  <Chip 
                                    label={`${option.performanceScore}%`} 
                                    size="small" 
                                    color={
                                      option.performanceScore >= 90 ? 'success' :  // A SÄ±nÄ±fÄ±
                                      option.performanceScore >= 75 ? 'info' :     // B SÄ±nÄ±fÄ±
                                      option.performanceScore >= 60 ? 'warning' :  // C SÄ±nÄ±fÄ±
                                      'error'                                       // D SÄ±nÄ±fÄ±
                                    }
                                    sx={{ fontSize: '0.7rem', height: 18, ml: 'auto' }}
                                  />
                                )}
                              </Box>
                            </Box>
                          </Box>
                        </Box>
                      )}
                      noOptionsText="TedarikÃ§i bulunamadÄ±"
                      loadingText="YÃ¼kleniyor..."
                      clearText="Temizle"
                      openText="AÃ§"
                      closeText="Kapat"
                    />
                  </Grid>

                  {/* Denetim TÃ¼rÃ¼ */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth required>
                      <InputLabel>Denetim TÃ¼rÃ¼</InputLabel>
                      <Select
                        value={formData.auditType || 'planlÄ±'}
                        onChange={(e) => setFormData({ ...formData, auditType: e.target.value })}
                      >
                        <MenuItem value="planlÄ±">PlanlÄ± Denetim</MenuItem>
                        <MenuItem value="ani">Ani Denetim</MenuItem>
                        <MenuItem value="takip">Takip Denetimi</MenuItem>
                        <MenuItem value="acil">Acil Denetim</MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* Denetim Tarihi */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="Denetim Tarihi"
                      type="date"
                      value={formData.auditDate || ''}
                      onChange={(e) => setFormData({ ...formData, auditDate: e.target.value })}
                      InputLabelProps={{ shrink: true }}
                      required
                    />
                  </Grid>

                  {/* DenetÃ§i */}
                  <Grid item xs={12} md={6}>
                    <TextField
                      fullWidth
                      label="DenetÃ§i AdÄ±"
                      value={formData.auditorName || ''}
                      onChange={(e) => setFormData({ ...formData, auditorName: e.target.value })}
                      required
                    />
                  </Grid>

                  {/* Denetim Durumu */}
                  <Grid item xs={12} md={6}>
                    <FormControl fullWidth>
                      <InputLabel>Denetim Durumu</InputLabel>
                      <Select
                        value={formData.status || 'planlÄ±'}
                        onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                      >
                        <MenuItem value="planlÄ±">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={8} height={8} bgcolor="primary.main" borderRadius="50%" />
                            PlanlÄ±
                          </Box>
                        </MenuItem>
                        <MenuItem value="devam_ediyor">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={8} height={8} bgcolor="info.main" borderRadius="50%" />
                            Devam Ediyor
                          </Box>
                        </MenuItem>
                        <MenuItem value="tamamlandÄ±">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={8} height={8} bgcolor="success.main" borderRadius="50%" />
                            TamamlandÄ±
                          </Box>
                        </MenuItem>
                        <MenuItem value="gecikmiÅŸ">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={8} height={8} bgcolor="error.main" borderRadius="50%" />
                            GecikmiÅŸ
                          </Box>
                        </MenuItem>
                        <MenuItem value="iptal">
                          <Box display="flex" alignItems="center" gap={1}>
                            <Box width={8} height={8} bgcolor="grey.main" borderRadius="50%" />
                            Ä°ptal
                          </Box>
                        </MenuItem>
                      </Select>
                    </FormControl>
                  </Grid>

                  {/* GerÃ§ekleÅŸtirilen Tarih - sadece tamamlandÄ± veya devam_ediyor durumunda gÃ¶ster */}
                  {(formData.status === 'tamamlandÄ±' || formData.status === 'devam_ediyor') && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="GerÃ§ekleÅŸtirilen Tarih"
                        type="date"
                        value={formData.actualAuditDate || ''}
                        onChange={(e) => setFormData({ ...formData, actualAuditDate: e.target.value })}
                        InputLabelProps={{ shrink: true }}
                        helperText="Denetimin fiilen gerÃ§ekleÅŸtirildiÄŸi tarih"
                      />
                    </Grid>
                  )}

                  {/* Gecikme Durumu - checkbox */}
                  <Grid item xs={12} md={6}>
                    <FormControlLabel
                      control={
                        <Checkbox
                          checked={formData.isDelayed || false}
                          onChange={(e) => setFormData({ ...formData, isDelayed: e.target.checked })}
                          color="warning"
                        />
                      }
                      label={
                        <Box display="flex" alignItems="center" gap={1}>
                          <WarningIcon fontSize="small" color="warning" />
                          Denetim gecikmiÅŸ mi?
                        </Box>
                      }
                    />
                  </Grid>

                  {/* Gecikme GÃ¼n SayÄ±sÄ± - sadece gecikme varsa gÃ¶ster */}
                  {formData.isDelayed && (
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Gecikme GÃ¼n SayÄ±sÄ±"
                        type="number"
                        value={formData.delayDays || ''}
                        onChange={(e) => setFormData({ ...formData, delayDays: parseInt(e.target.value) || 0 })}
                        inputProps={{ min: 0, max: 365 }}
                        helperText="KaÃ§ gÃ¼n gecikti?"
                      />
                    </Grid>
                  )}

                  {/* Gecikme AÃ§Ä±klamasÄ± - sadece gecikme varsa gÃ¶ster */}
                  {formData.isDelayed && (
                    <Grid item xs={12}>
                      <TextField
                        fullWidth
                        label="Gecikme AÃ§Ä±klamasÄ±"
                        multiline
                        rows={3}
                        value={formData.delayReason || ''}
                        onChange={(e) => setFormData({ ...formData, delayReason: e.target.value })}
                        placeholder="Denetimin neden geciktiÄŸini aÃ§Ä±klayÄ±n (Ã¶rn: TedarikÃ§i tesisinde yangÄ±n, denetÃ§i hastalÄ±ÄŸÄ±, Ã¼retim yoÄŸunluÄŸu)"
                        helperText="Gecikme nedenini detaylÄ± olarak belirtin"
                        required={formData.isDelayed}
                      />
                    </Grid>
                  )}

                  {/* Denetim KapsamÄ± */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Denetim KapsamÄ±"
                      multiline
                      rows={3}
                      value={formData.auditScope || ''}
                      onChange={(e) => setFormData({ ...formData, auditScope: e.target.value })}
                      placeholder="Denetim kapsamÄ±nÄ± belirtin (Ã¶rn: Kalite sistemi, Ã¼retim sÃ¼reÃ§leri, dokÃ¼man kontrolÃ¼)"
                    />
                  </Grid>

                  {/* Ã–zel Notlar */}
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      label="Ã–zel Notlar"
                      multiline
                      rows={2}
                      value={formData.auditNotes || ''}
                      onChange={(e) => setFormData({ ...formData, auditNotes: e.target.value })}
                      placeholder="Denetim ile ilgili Ã¶zel durumlar veya dikkat edilmesi gerekenler"
                    />
                  </Grid>
                </Grid>
              </Box>
            )}
          </DialogContent>

          <DialogActions>
            <Button onClick={() => setDialogOpen(false)} color="inherit">
              Ä°ptal
            </Button>
            <Button onClick={handleSaveDialog} variant="contained" color="primary">
              {selectedItem ? 'GÃ¼ncelle' : 'Kaydet'}
            </Button>
          </DialogActions>
        </Dialog>

        {/* TedarikÃ§i DeÄŸiÅŸtirme Dialog */}
        <Dialog 
          open={switchDialogOpen} 
          onClose={() => setSwitchDialogOpen(false)} 
          maxWidth="sm" 
          fullWidth
        >
          <DialogTitle>
            <Box display="flex" alignItems="center" gap={1}>
              <SwapHorizIcon color="warning" />
              Alternatif TedarikÃ§iyi Ana Yap
            </Box>
          </DialogTitle>
          <DialogContent>
            <Box sx={{ pt: 2 }}>
              {selectedPairForSwitch && (
                <>
                  <Typography variant="body1" gutterBottom>
                    <strong>Mevcut Ana TedarikÃ§i:</strong> {selectedPairForSwitch.primarySupplier?.name || 'BelirtilmemiÅŸ'}
                  </Typography>
                  
                  <Typography variant="body2" color="text.secondary" gutterBottom sx={{ mb: 3 }}>
                    Hangi alternatif tedarikÃ§iyi ana tedarikÃ§i yapmak istiyorsunuz?
                  </Typography>

                  <FormControl fullWidth>
                    <InputLabel>Alternatif TedarikÃ§i SeÃ§in</InputLabel>
                    <Select
                      value={selectedAlternativeForSwitch}
                      onChange={(e) => setSelectedAlternativeForSwitch(e.target.value)}
                      label="Alternatif TedarikÃ§i SeÃ§in"
                    >
                      {selectedPairForSwitch.alternativeSuppliers.map((supplier) => (
                        <MenuItem key={supplier.id} value={supplier.id}>
                          <Box display="flex" alignItems="center" gap={1} width="100%">
                            <Box>
                              <Typography variant="body2" fontWeight="500">
                                {supplier.name}
                              </Typography>
                              <Box display="flex" alignItems="center" gap={1}>
                                <Typography variant="caption" color="text.secondary">
                                  {supplier.type} â€¢ {supplier.category}
                                </Typography>
                                <Chip 
                                  label={`${supplier.performanceScore}%`} 
                                  color={supplier.performanceScore >= 80 ? 'success' : 'warning'} 
                                  size="small" 
                                  sx={{ ml: 1 }}
                                />
                              </Box>
                            </Box>
                          </Box>
                        </MenuItem>
                      ))}
                    </Select>
                    <Typography variant="caption" color="text.secondary" sx={{ mt: 1 }}>
                      SeÃ§ilen tedarikÃ§i ana tedarikÃ§i olacak, mevcut ana tedarikÃ§i alternatif olarak kalacak.
                    </Typography>
                  </FormControl>

                  {/* Performans KarÅŸÄ±laÅŸtÄ±rmasÄ± */}
                  {selectedAlternativeForSwitch && (
                    <Box sx={{ mt: 3, p: 2, bgcolor: 'grey.50', borderRadius: 1 }}>
                      <Typography variant="subtitle2" gutterBottom>
                        Performans KarÅŸÄ±laÅŸtÄ±rmasÄ±
                      </Typography>
                      {(() => {
                        const selectedSupplier = selectedPairForSwitch.alternativeSuppliers.find(s => s.id === selectedAlternativeForSwitch);
                        const currentPrimary = selectedPairForSwitch.primarySupplier;
                        
                        return (
                          <Grid container spacing={2}>
                            <Grid item xs={6}>
                              <Box textAlign="center">
                                <Typography variant="body2" color="text.secondary">
                                  Mevcut Ana
                                </Typography>
                                <Typography variant="h6">
                                  {currentPrimary?.performanceScore || 0}%
                                </Typography>
                                <Typography variant="caption">
                                  {currentPrimary?.name}
                                </Typography>
                              </Box>
                            </Grid>
                            <Grid item xs={6}>
                              <Box textAlign="center">
                                <Typography variant="body2" color="text.secondary">
                                  Yeni Ana
                                </Typography>
                                <Typography variant="h6" color={
                                  (selectedSupplier?.performanceScore || 0) > (currentPrimary?.performanceScore || 0) 
                                    ? 'success.main' : 'warning.main'
                                }>
                                  {selectedSupplier?.performanceScore || 0}%
                                </Typography>
                                <Typography variant="caption">
                                  {selectedSupplier?.name}
                                </Typography>
                              </Box>
                            </Grid>
                          </Grid>
                        );
                      })()}
                    </Box>
                  )}
                </>
              )}
            </Box>
          </DialogContent>
          <DialogActions>
            <Button 
              onClick={() => {
                setSwitchDialogOpen(false);
                setSelectedPairForSwitch(null);
                setSelectedAlternativeForSwitch('');
              }} 
              color="inherit"
            >
              Ä°ptal
            </Button>
            <Button 
              onClick={handleConfirmSwitch} 
              variant="contained" 
              color="warning"
              disabled={!selectedAlternativeForSwitch}
              startIcon={<SwapHorizIcon />}
            >
              TedarikÃ§iyi DeÄŸiÅŸtir
            </Button>
          </DialogActions>
        </Dialog>

        {/* Denetim GerÃ§ekleÅŸtirme Dialog */}
        <Dialog 
          open={auditExecutionDialogOpen} 
          onClose={() => setAuditExecutionDialogOpen(false)} 
          maxWidth="md" 
          fullWidth
        >
          <DialogTitle>
            <Box display="flex" alignItems="center" gap={1}>
              <AssignmentTurnedInIcon color="success" />
              Denetimi GerÃ§ekleÅŸtir
            </Box>
          </DialogTitle>
          <DialogContent>
            <Box sx={{ pt: 2 }}>
              {selectedAuditForExecution && (
                <>
                  <Box sx={{ mb: 3, p: 2, bgcolor: 'grey.50', borderRadius: 1 }}>
                    <Typography variant="h6" gutterBottom>
                      Denetim Bilgileri
                    </Typography>
                    <Grid container spacing={2}>
                      <Grid item xs={6}>
                        <Typography variant="body2" color="text.secondary">
                          TedarikÃ§i:
                        </Typography>
                        <Typography variant="body1" fontWeight="500">
                          {suppliers.find(s => s.id === selectedAuditForExecution.supplierId)?.name || 'Bilinmiyor'}
                        </Typography>
                      </Grid>
                      <Grid item xs={6}>
                        <Typography variant="body2" color="text.secondary">
                          Planlanan Tarih:
                        </Typography>
                        <Typography variant="body1" fontWeight="500">
                          {new Date(selectedAuditForExecution.auditDate).toLocaleDateString('tr-TR')}
                        </Typography>
                      </Grid>
                      <Grid item xs={6}>
                        <Typography variant="body2" color="text.secondary">
                          Denetim TÃ¼rÃ¼:
                        </Typography>
                        <Typography variant="body1" fontWeight="500">
                          {selectedAuditForExecution.auditType === 'planlÄ±' ? 'PlanlÄ±' :
                           selectedAuditForExecution.auditType === 'ani' ? 'Ani' :
                           selectedAuditForExecution.auditType === 'takip' ? 'Takip' :
                           selectedAuditForExecution.auditType === 'acil' ? 'Acil' : 'KapsamlÄ±'}
                        </Typography>
                      </Grid>
                      <Grid item xs={6}>
                        <Typography variant="body2" color="text.secondary">
                          DenetÃ§i:
                        </Typography>
                        <Typography variant="body1" fontWeight="500">
                          {selectedAuditForExecution.auditorName}
                        </Typography>
                      </Grid>
                    </Grid>
                  </Box>

                  <Box sx={{ mb: 3 }}>
                    <Typography variant="h6" gutterBottom>
                      Denetim SonuÃ§larÄ±
                    </Typography>

                    {/* GerÃ§ekleÅŸme Tarihi */}
                    <TextField
                      fullWidth
                      type="date"
                      label="Denetim GerÃ§ekleÅŸme Tarihi"
                      value={auditActualDate}
                      onChange={(e) => handleAuditDateChange(e.target.value)}
                      InputLabelProps={{ shrink: true }}
                      sx={{ mb: 2 }}
                      helperText="Denetimin gerÃ§ekten yapÄ±ldÄ±ÄŸÄ± tarihi seÃ§in"
                    />

                    {/* Gecikme Durumu UyarÄ±sÄ± */}
                    {isDelayed && (
                      <Alert severity="warning" sx={{ mb: 3 }}>
                        <Typography variant="body2" fontWeight="600">
                          âš ï¸ DENETÄ°M GECÄ°KMESÄ° TESPÄ°T EDÄ°LDÄ°
                        </Typography>
                        <Typography variant="body2">
                          Planlanan tarih: {new Date(selectedAuditForExecution.auditDate).toLocaleDateString('tr-TR')}
                        </Typography>
                        <Typography variant="body2">
                          GerÃ§ekleÅŸme tarihi: {new Date(auditActualDate).toLocaleDateString('tr-TR')}
                        </Typography>
                        <Typography variant="body1" color="error" fontWeight="600">
                          Gecikme sÃ¼resi: {delayDays} gÃ¼n
                        </Typography>
                      </Alert>
                    )}

                    {/* Gecikme AÃ§Ä±klamasÄ± */}
                    {isDelayed && (
                      <TextField
                        fullWidth
                        multiline
                        rows={3}
                        label="Gecikme AÃ§Ä±klamasÄ± *"
                        value={auditDelayReason}
                        onChange={(e) => setAuditDelayReason(e.target.value)}
                        placeholder="Denetimin neden geciktiÄŸini detaylÄ± olarak aÃ§Ä±klayÄ±n..."
                        required
                        error={isDelayed && !auditDelayReason.trim()}
                        helperText={isDelayed && !auditDelayReason.trim() ? 
                          "Gecikme durumunda aÃ§Ä±klama girmeniz zorunludur" : 
                          "Gecikme nedenini detaylÄ± ÅŸekilde belirtiniz"}
                        sx={{ mb: 3 }}
                      />
                    )}
                    
                    <FormControl fullWidth sx={{ mb: 3 }}>
                      <Typography variant="body2" color="text.secondary" gutterBottom>
                        Denetim PuanÄ± (0-100)
                      </Typography>
                      <Box display="flex" alignItems="center" gap={2}>
                        <Slider
                          value={auditScore}
                          onChange={(_, value) => setAuditScore(value as number)}
                          min={0}
                          max={100}
                          step={5}
                          marks={[
                            { value: 0, label: '0' },
                            { value: 25, label: '25' },
                            { value: 50, label: '50' },
                            { value: 75, label: '75' },
                            { value: 100, label: '100' }
                          ]}
                          valueLabelDisplay="on"
                          sx={{ flex: 1 }}
                        />
                        <TextField
                          type="number"
                          value={auditScore}
                          onChange={(e) => setAuditScore(Math.min(100, Math.max(0, parseInt(e.target.value) || 0)))}
                          inputProps={{ min: 0, max: 100 }}
                          sx={{ width: 80 }}
                        />
                      </Box>
                      <Box display="flex" justifyContent="center" mt={1}>
                        <Chip
                          label={
                            auditScore >= 90 ? 'A SÄ±nÄ±fÄ± (90-100)' :
                            auditScore >= 75 ? 'B SÄ±nÄ±fÄ± (75-89)' :
                            auditScore >= 60 ? 'C SÄ±nÄ±fÄ± (60-74)' : 'D SÄ±nÄ±fÄ± (0-59)'
                          }
                          color={
                            auditScore >= 90 ? 'success' :
                            auditScore >= 75 ? 'info' :
                            auditScore >= 60 ? 'warning' : 'error'
                          }
                        />
                      </Box>
                    </FormControl>

                    <TextField
                      fullWidth
                      multiline
                      rows={4}
                      label="Denetim BulgularÄ± ve NotlarÄ±"
                      value={auditFindings}
                      onChange={(e) => setAuditFindings(e.target.value)}
                      placeholder="Denetim sÄ±rasÄ±nda tespit edilen bulgular, iyileÅŸtirme Ã¶nerileri ve notlar..."
                      helperText="Her satÄ±ra bir bulgu yazabilirsiniz. Bu alanÄ± boÅŸ bÄ±rakabilirsiniz."
                    />
                  </Box>
                </>
              )}
            </Box>
          </DialogContent>
          <DialogActions>
            <Button 
              onClick={() => {
                setAuditExecutionDialogOpen(false);
                setSelectedAuditForExecution(null);
                setAuditScore(0);
                setAuditFindings('');
                setAuditActualDate('');
                setAuditDelayReason('');
                setDelayDays(0);
                setIsDelayed(false);
              }} 
              color="inherit"
            >
              Ä°ptal
            </Button>
            <Button 
              onClick={handleSaveAuditExecution} 
              variant="contained" 
              color="success"
              disabled={auditScore === 0 || !auditActualDate || (isDelayed && !auditDelayReason.trim())}
              startIcon={<AssignmentTurnedInIcon />}
            >
              Denetimi Tamamla
            </Button>
          </DialogActions>
        </Dialog>

        {/* Denetim DetaylarÄ± GÃ¶rÃ¼ntÃ¼leme Dialog */}
        <Dialog 
          open={auditDetailsDialogOpen} 
          onClose={() => setAuditDetailsDialogOpen(false)} 
          maxWidth="lg" 
          fullWidth
        >
          <DialogTitle>
            <Box display="flex" alignItems="center" gap={1}>
              <ViewIcon color="info" />
              Denetim DetaylarÄ±
            </Box>
          </DialogTitle>
          <DialogContent>
            <Box sx={{ pt: 2 }}>
              {selectedAuditForView && (
                <>
                  {/* Temel Bilgiler */}
                  <Paper sx={{ p: 3, mb: 3, bgcolor: 'grey.50' }}>
                    <Typography variant="h6" gutterBottom sx={{ color: 'primary.main' }}>
                      ğŸ¢ Temel Bilgiler
                    </Typography>
                    <Grid container spacing={3}>
                      <Grid item xs={12} md={6}>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">Denetim ID:</Typography>
                          <Typography variant="body1" fontWeight="600">{selectedAuditForView.id}</Typography>
                        </Box>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">TedarikÃ§i:</Typography>
                          <Typography variant="body1" fontWeight="600">
                            {suppliers.find(s => s.id === selectedAuditForView.supplierId)?.name || 'Bilinmiyor'}
                          </Typography>
                        </Box>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">Denetim TÃ¼rÃ¼:</Typography>
                          <Chip 
                            label={
                              selectedAuditForView.auditType === 'planlÄ±' ? 'PlanlÄ± Denetim' :
                              selectedAuditForView.auditType === 'ani' ? 'Ani Denetim' :
                              selectedAuditForView.auditType === 'takip' ? 'Takip Denetimi' :
                              selectedAuditForView.auditType === 'acil' ? 'Acil Denetim' : 'KapsamlÄ± Denetim'
                            }
                            color="primary"
                            size="small"
                            sx={{ fontWeight: 600 }}
                          />
                        </Box>
                      </Grid>
                      <Grid item xs={12} md={6}>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">DenetÃ§i:</Typography>
                          <Typography variant="body1" fontWeight="600">{selectedAuditForView.auditorName}</Typography>
                        </Box>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">Durum:</Typography>
                          <Chip 
                            label={
                              selectedAuditForView.status === 'planlÄ±' ? 'PlanlÄ±' :
                              selectedAuditForView.status === 'devam_ediyor' ? 'Devam Ediyor' :
                              selectedAuditForView.status === 'tamamlandÄ±' ? 'TamamlandÄ±' :
                              selectedAuditForView.status === 'gecikmiÅŸ' ? 'GecikmiÅŸ' : 'Ä°ptal'
                            }
                            color={
                              selectedAuditForView.status === 'tamamlandÄ±' ? 'success' :
                              selectedAuditForView.status === 'devam_ediyor' ? 'info' :
                              selectedAuditForView.status === 'gecikmiÅŸ' ? 'error' :
                              selectedAuditForView.status === 'planlÄ±' ? 'warning' : 'default'
                            }
                            size="small"
                            sx={{ fontWeight: 600 }}
                          />
                        </Box>
                        <Box sx={{ mb: 2 }}>
                          <Typography variant="body2" color="text.secondary">Otomatik PlanlandÄ±:</Typography>
                          <Chip 
                            label={selectedAuditForView.isAutoScheduled ? 'Evet' : 'HayÄ±r'}
                            color={selectedAuditForView.isAutoScheduled ? 'success' : 'default'}
                            size="small"
                          />
                        </Box>
                      </Grid>
                    </Grid>
                  </Paper>

                  {/* Tarih Bilgileri */}
                  <Paper sx={{ p: 3, mb: 3, bgcolor: 'info.50' }}>
                    <Typography variant="h6" gutterBottom sx={{ color: 'info.main' }}>
                      ğŸ“… Tarih Bilgileri
                    </Typography>
                    <Grid container spacing={3}>
                      <Grid item xs={12} md={4}>
                        <Box sx={{ textAlign: 'center', p: 2 }}>
                          <Typography variant="body2" color="text.secondary">Planlanan Tarih</Typography>
                          <Typography variant="h6" fontWeight="600" color="primary.main">
                            {new Date(selectedAuditForView.auditDate).toLocaleDateString('tr-TR')}
                          </Typography>
                        </Box>
                      </Grid>
                      <Grid item xs={12} md={4}>
                        <Box sx={{ textAlign: 'center', p: 2 }}>
                          <Typography variant="body2" color="text.secondary">GerÃ§ekleÅŸen Tarih</Typography>
                          <Typography variant="h6" fontWeight="600" color={selectedAuditForView.actualAuditDate ? 'success.main' : 'text.disabled'}>
                            {selectedAuditForView.actualAuditDate ? 
                              new Date(selectedAuditForView.actualAuditDate).toLocaleDateString('tr-TR') : 
                              'HenÃ¼z gerÃ§ekleÅŸtirilmedi'
                            }
                          </Typography>
                        </Box>
                      </Grid>
                      <Grid item xs={12} md={4}>
                        <Box sx={{ textAlign: 'center', p: 2 }}>
                          <Typography variant="body2" color="text.secondary">Sonraki Denetim</Typography>
                          <Typography variant="h6" fontWeight="600" color="warning.main">
                            {new Date(selectedAuditForView.nextAuditDate).toLocaleDateString('tr-TR')}
                          </Typography>
                        </Box>
                      </Grid>
                    </Grid>

                    {/* Gecikme Bilgileri */}
                    {selectedAuditForView.isDelayed && (
                      <Alert severity="warning" sx={{ mt: 2 }}>
                        <Typography variant="body2" fontWeight="600">
                          âš ï¸ Bu denetim {selectedAuditForView.delayDays} gÃ¼n gecikmiÅŸtir
                        </Typography>
                        {selectedAuditForView.delayReason && (
                          <Typography variant="body2" sx={{ mt: 1 }}>
                            <strong>Gecikme AÃ§Ä±klamasÄ±:</strong> {selectedAuditForView.delayReason}
                          </Typography>
                        )}
                      </Alert>
                    )}
                  </Paper>

                  {/* SonuÃ§lar */}
                  {selectedAuditForView.status === 'tamamlandÄ±' && (
                    <Paper sx={{ p: 3, mb: 3, bgcolor: 'success.50' }}>
                      <Typography variant="h6" gutterBottom sx={{ color: 'success.main' }}>
                        ğŸ“Š Denetim SonuÃ§larÄ±
                      </Typography>
                      <Grid container spacing={3}>
                        <Grid item xs={12} md={6}>
                          <Box sx={{ textAlign: 'center', p: 2 }}>
                            <Typography variant="body2" color="text.secondary">Denetim PuanÄ±</Typography>
                            <Typography variant="h4" fontWeight="700" color="success.main">
                              {selectedAuditForView.score}/100
                            </Typography>
                            <Chip 
                              label={
                                selectedAuditForView.score >= 90 ? 'A SÄ±nÄ±fÄ± (MÃ¼kemmel)' :
                                selectedAuditForView.score >= 75 ? 'B SÄ±nÄ±fÄ± (Ä°yi)' :
                                selectedAuditForView.score >= 60 ? 'C SÄ±nÄ±fÄ± (Orta)' : 'D SÄ±nÄ±fÄ± (ZayÄ±f)'
                              }
                              color={
                                selectedAuditForView.score >= 90 ? 'success' :
                                selectedAuditForView.score >= 75 ? 'info' :
                                selectedAuditForView.score >= 60 ? 'warning' : 'error'
                              }
                              sx={{ mt: 1, fontWeight: 600 }}
                            />
                          </Box>
                        </Grid>
                        <Grid item xs={12} md={6}>
                          <Box sx={{ p: 2 }}>
                            <Typography variant="body2" color="text.secondary" gutterBottom>
                              Denetim BulgularÄ±
                            </Typography>
                            {selectedAuditForView.findings && selectedAuditForView.findings.length > 0 ? (
                              <Box sx={{ 
                                maxHeight: 150, 
                                overflow: 'auto',
                                bgcolor: 'white',
                                p: 2,
                                borderRadius: 1,
                                border: '1px solid',
                                borderColor: 'grey.300'
                              }}>
                                {selectedAuditForView.findings.map((finding, index) => (
                                  <Typography key={index} variant="body2" sx={{ mb: 1 }}>
                                    â€¢ {finding}
                                  </Typography>
                                ))}
                              </Box>
                            ) : (
                              <Typography variant="body2" color="text.secondary" fontStyle="italic">
                                Herhangi bir bulgu kaydedilmemiÅŸ
                              </Typography>
                            )}
                          </Box>
                        </Grid>
                      </Grid>
                    </Paper>
                  )}

                  {/* PlanlÄ± denetimler iÃ§in ek bilgi */}
                  {selectedAuditForView.status === 'planlÄ±' && (
                    <Alert severity="info" sx={{ mb: 2 }}>
                      <Typography variant="body2">
                        ğŸ’¡ Bu denetim henÃ¼z gerÃ§ekleÅŸtirilmemiÅŸtir. Ä°ÅŸlemler kÄ±smÄ±ndan "Denetimi GerÃ§ekleÅŸtir" butonuna tÄ±klayarak denetimi baÅŸlatabilirsiniz.
                      </Typography>
                    </Alert>
                  )}
                </>
              )}
            </Box>
          </DialogContent>
          <DialogActions>
            <Button onClick={() => setAuditDetailsDialogOpen(false)} color="inherit">
              Kapat
            </Button>
            {selectedAuditForView?.status === 'planlÄ±' && (
              <Button 
                onClick={() => {
                  setAuditDetailsDialogOpen(false);
                  if (selectedAuditForView) {
                    handleExecuteAudit(selectedAuditForView);
                  }
                }} 
                variant="contained" 
                color="success"
                startIcon={<AssignmentTurnedInIcon />}
              >
                Denetimi GerÃ§ekleÅŸtir
              </Button>
            )}
            {selectedAuditForView?.status === 'tamamlandÄ±' && (
              <Button 
                onClick={() => {
                  setAuditDetailsDialogOpen(false);
                  if (selectedAuditForView) {
                    handleEditItem(selectedAuditForView, 'audit');
                  }
                }} 
                variant="outlined" 
                color="primary"
                startIcon={<EditIcon />}
              >
                DÃ¼zenle
              </Button>
            )}
          </DialogActions>
        </Dialog>

        {/* Denetim Tarihi DÃ¼zenleme Dialog */}
        <Dialog open={auditDateDialogOpen} onClose={() => setAuditDateDialogOpen(false)} maxWidth="sm" fullWidth>
          <DialogTitle>
            <Box display="flex" alignItems="center" gap={1}>
              <ScheduleIcon color="primary" />
              Denetim Tarihi DÃ¼zenle
            </Box>
          </DialogTitle>
          <DialogContent>
            <Box sx={{ pt: 2 }}>
              {selectedSupplierForAudit && (
                <>
                  <Typography variant="body1" gutterBottom>
                    <strong>TedarikÃ§i:</strong> {selectedSupplierForAudit.name}
                  </Typography>
                  <Typography variant="body2" color="text.secondary" gutterBottom sx={{ mb: 3 }}>
                    Mevcut denetim tarihi: {new Date(selectedSupplierForAudit.nextAuditDate).toLocaleDateString('tr-TR')}
                  </Typography>
                  <TextField
                    fullWidth
                    label="Yeni Denetim Tarihi"
                    type="date"
                    value={newAuditDate}
                    onChange={(e) => setNewAuditDate(e.target.value)}
                    InputLabelProps={{ shrink: true }}
                    helperText="Denetim iÃ§in yeni tarih seÃ§in"
                  />
                </>
              )}
            </Box>
          </DialogContent>
          <DialogActions>
            <Button onClick={() => setAuditDateDialogOpen(false)} color="inherit">
              Ä°ptal
            </Button>
            <Button 
              onClick={handleSaveAuditDate} 
              variant="contained" 
              color="primary"
              disabled={!newAuditDate}
            >
              Tarihi GÃ¼ncelle
            </Button>
                   </DialogActions>
         </Dialog>

        {/* Snackbar for notifications */}
        <Snackbar
          open={snackbar.open}
          autoHideDuration={6000}
          onClose={() => setSnackbar({ ...snackbar, open: false })}
          anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}
        >
          <Alert 
            onClose={() => setSnackbar({ ...snackbar, open: false })} 
            severity={snackbar.severity}
            variant="filled"
          >
            {snackbar.message}
          </Alert>
        </Snackbar>
      </Box>
    </ErrorBoundary>
  );
};

export default SupplierQualityManagement; 